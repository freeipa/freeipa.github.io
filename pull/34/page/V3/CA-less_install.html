
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CA-less_install &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V3/CA-less_install';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V3/CA-less_install.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CA-less_install</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-rotation">Certificate rotation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kdc-pkinit-considerations">KDC pkinit considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#affected-commands">Affected commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clients">Clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-root-ca-file">Why –root-ca-file?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-management-faq">Certificate management FAQ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-check-what-format-files-are">How to check what format files are?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-certs-are-there-in-a-file">How many certs are there in a file?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-extact-certs-or-or-combine-certs-into-files">How to extact certs or or combine certs into files?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pem-files">PEM Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#base64-encoded-der-certificates">Base64-encoded DER certificates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-nss-database">Using a NSS database</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-check-that-my-certificates-will-be-usable">How to check that my certificates will be usable?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-managment">Feature Managment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ca-less-install">
<h1>CA-less_install<a class="headerlink" href="#ca-less-install" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>IPA should support installing without an embedded Certificate Authority,
with user-provided SSL certificates for the HTTP and <a class="reference external" href="Directory_Server">Directory
Server</a>.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>User installs IPA using the –http_pkcs12, –dirsrv_pkcs12,
–http_pin, –dirsrv_pin, –root-ca-file options, giving appropriate
certificates.</p></li>
<li><p>IPA installs and works normally, excluding the certificate management
operations</p></li>
<li><p>User creates a replica using –http_pkcs12, –dirsrv_pkcs12,
–http_pin, –dirsrv_pin options to ipa-replica-prepare</p></li>
<li><p>Replica works normally, excluding certificate management operaions</p></li>
</ol>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
<p>To install without a CA, the following options must be provided to
ipa-server-install:</p>
<ul class="simple">
<li><p>–http_pkcs12: a PKCS#12 file containing the HTTP server certificate</p></li>
<li><p>–dirsrv_pkcs12: a PKCS#12 file containing the Directory server
certificate</p></li>
<li><p>–http_pin: password for the file given in –http_pkcs12</p></li>
<li><p>–dirsrv_pin: password for the file given in –dirsrv_pkcs12</p></li>
<li><p>–root-ca-file: a PEM file containing the root CA certificate</p></li>
</ul>
<p>Each of the PKCS#12 files must contain exactly one certificate with a
private key. This will be used as the server certificate. It must also
contain certificates of any intermediate CAs. It may contain any number
of other certificates without matching private keys. The two PKCS#12
files may (and often will) be the same. The certificates must be valid
as server certs for the given host.</p>
<p>The PEM file given by –root-ca-file must contain exactly one
certificate. This cert will be trusted as a root CA on the IPA server
and all clients. Both server certs must be signed by this CA (possibly
via a trust chain). It will be available in <code class="docutils literal notranslate"><span class="pre">/etc/ipa/ca.crt</span></code> and in
the cACertificate attribute of cn=CACert,cn=ipa,cn=etc,$SUFFIX in LDAP,
just like the IPA CA cert in Dogtag-based installations.</p>
<p>Note that –root-ca-file gives the root of trust, which may not
necessarily be the root of a certificate chain. For example, if a user
wishes to trust a company-wide certificate, but not an external the CA
that signed it, –root-ca-file should give the company certificate.</p>
<p>These options are incompatible with –external-ca.</p>
<p>To install a replica, following options must be provided to
ipa-replica-prepare:</p>
<ul class="simple">
<li><p>–http_pkcs12</p></li>
<li><p>–dirsrv_pkcs12</p></li>
<li><p>–http_pin</p></li>
<li><p>–dirsrv_pin</p></li>
</ul>
<p>The root CA is taken from the existing master. All requirements
mentioned in the ipa-server-install case apply.</p>
</section>
<section id="certificate-rotation">
<h2>Certificate rotation<a class="headerlink" href="#certificate-rotation" title="Link to this heading">#</a></h2>
<p>Neither the Dogtag CA nor Certmonger are installed on IPA servers in
this scenario. Before the server certificates expire, new ones must be
issued and installed manually.</p>
<p>In this setup, no warnings are given about certs that are about to
expire.</p>
</section>
<section id="kdc-pkinit-considerations">
<h2>KDC pkinit considerations<a class="headerlink" href="#kdc-pkinit-considerations" title="Link to this heading">#</a></h2>
<p>In the future, another certificate will be needed for the KDC. It will
be specified using the –pkinit_pkcs and –pkinit_pin options, similarly
to the other two certs.</p>
<p>Currently KDC pkinit is disabled.</p>
</section>
<section id="affected-commands">
<h2>Affected commands<a class="headerlink" href="#affected-commands" title="Link to this heading">#</a></h2>
<p>IPA’s cert plugin and cert-* commands will not be available at all.
Calling them will result in CommandError (code 905) No online help will
be available on them, or on the “cert” topic.</p>
<p>Certificates removed from LDAP will not be automatically revoked. This
affects the following commands:</p>
<ul class="simple">
<li><p>host-del</p></li>
<li><p>host-mod</p></li>
<li><p>host-disable</p></li>
<li><p>service-del</p></li>
<li><p>service-mod</p></li>
<li><p>service-disable</p></li>
</ul>
</section>
<section id="clients">
<h2>Clients<a class="headerlink" href="#clients" title="Link to this heading">#</a></h2>
<p>Clients in a CA-less IPA installation will work normally, except host
certificates will not be assigned automatically.</p>
<p>Older clients configure certmonger to obtain the host certificate, which
will fail, with the following line appearing periodically in the system
log:</p>
<p>``   Server failed request, will retry: 905 (RPC failed at server.  unknown command ‘cert_request’).``</p>
<p>The errors can be stopped by issuing:</p>
<div class="line-block">
<div class="line">``   # getcert list  # to find out the certmonger request ID``</div>
<div class="line">``   # getcert stop-tracking ``</div>
</div>
<p>If needed, machine certificates may be obtained from the external CA and
added to the server with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``   ipa host-mod ``\ `` --certificate ``
</pre></div>
</div>
</section>
<section id="why-root-ca-file">
<h2>Why –root-ca-file?<a class="headerlink" href="#why-root-ca-file" title="Link to this heading">#</a></h2>
<p>IPA requires the user to specify the root CA to be trusted. This done to
ensure that all replicas and clients trust the IPA certificates, no
matter what their initial configuration is.</p>
<p>Theoretically the CA certificate could be extracted from PKCS#12 files,
but to ensure transparency and the administrator’s control when it comes
to trusting a root CA, it must always be specified explicitly.</p>
<p>In the future it might be possible to trust more than one CA in this
way.</p>
</section>
<section id="certificate-management-faq">
<h2>Certificate management FAQ<a class="headerlink" href="#certificate-management-faq" title="Link to this heading">#</a></h2>
</section>
<section id="how-to-check-what-format-files-are">
<h2>How to check what format files are?<a class="headerlink" href="#how-to-check-what-format-files-are" title="Link to this heading">#</a></h2>
<p>Use the handy <code class="docutils literal notranslate"><span class="pre">file</span></code> command.</p>
<p>PEM files show up as such:</p>
<div class="line-block">
<div class="line">``   $ file /etc/ipa/ca.crt``</div>
<div class="line">``   /etc/ipa/ca.crt: PEM certificate``</div>
</div>
<p>PKCS#12 files show up as just “data”:</p>
<div class="line-block">
<div class="line">``   $ file dirsrv.p12``</div>
<div class="line">``   dirsrv.p12: data``</div>
</div>
<p>To check a PKCS#12 file, you need to know the password:</p>
<div class="line-block">
<div class="line">``   $ pk12util -l dirsrv.p12``</div>
<div class="line">``   Enter password for PKCS12 file:``</div>
<div class="line">``   Certificate(has private key):``</div>
<div class="line">``       &lt;…&gt;``</div>
<div class="line">``   Certificate:``</div>
<div class="line">``       &lt;…&gt;``</div>
<div class="line">``   Key(shrouded):``</div>
<div class="line">``       &lt;…&gt;``</div>
</div>
</section>
<section id="how-many-certs-are-there-in-a-file">
<h2>How many certs are there in a file?<a class="headerlink" href="#how-many-certs-are-there-in-a-file" title="Link to this heading">#</a></h2>
<p>For PKCS#12 files, use <code class="docutils literal notranslate"><span class="pre">pk12util</span> <span class="pre">-l</span></code> (see previous section).</p>
<p>For PEM files, simply open the file in a pager or text editor and count
the number of blocks. A certificate will look like this:</p>
<div class="line-block">
<div class="line">``   $ cat /etc/ipa/ca.crt``</div>
<div class="line">``   —–BEGIN CERTIFICATE—–``</div>
<div class="line">``   MIIDuzCCAqOgAwIBAgIBATANBgkqhkiG9w0BAQsFADBFMSMwIQYDVQQKExpJRE0u``</div>
<div class="line">``   TEFCLkVORy5CUlEuUkVESEFULkNPTTEeMBwGA1UEAxMVQ2VydGlmaWNhdGUgQXV0``</div>
<div class="line">``   aG9yaXR5MB4XDTEzMDMyMDE3MDQxNFoXDTMzMDMyMDE3MDQxNFowRTEjMCEGA1UE``</div>
<div class="line">``   ChMaSURNLkxBQi5FTkcuQlJRLlJFREhBVC5DT00xHjAcBgNVBAMTFUNlcnRpZmlj``</div>
<div class="line">``   YXRlIEF1dGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMZi``</div>
<div class="line">``   pF9Dz5O1rVTRnwIdttHl0sKpHeRqzi/S7bnAFh3Jb2UxzFmHTpgQFKqq72mYatpL``</div>
<div class="line">``   O0BPc47IGh9gwGZNLcEaNCf7zYCbqBJso8RV6SxbHSEdo+JuSYhMxVasKQcojqeY``</div>
<div class="line">``   /wx11A4NSQAco6mBZz255llZqMQcJVMW4T8aioUd19Yh35CM9vr6l6dgUnvA9fAF``</div>
<div class="line">``   TOl144yfF8AjvF1hIAePjLyl+Y/xxh1U2j5hF4z7ZeUGHKVZR9pQ62kbM7TgAR6Y``</div>
<div class="line">``   YLGpis44JPfgRVkDGEkc7Vzpct1D4Iz7/oGMV+0kbJbz+9DSIHWY10QTtf9mNQNn``</div>
<div class="line">``   xKGa3wCf5u8ctfmms8cCAwEAAaOBtTCBsjAfBgNVHSMEGDAWgBQCHF1DVeHg3kUG``</div>
<div class="line">``   VRm/j0f9eji6nzAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBxjAdBgNV``</div>
<div class="line">``   HQ4EFgQUAhxdQ1Xh4N5FBlUZv49H/Xo4up8wTwYIKwYBBQUHAQEEQzBBMD8GCCsG``</div>
<div class="line">``   AQUFBzABhjNodHRwOi8vdm0tMDg0LmlkbS5sYWIuZW5nLmJycS5yZWRoYXQuY29t``</div>
<div class="line">``   OjgwL2NhL29jc3AwDQYJKoZIhvcNAQELBQADggEBAB3+or2Q/aPO4ZMBE4Q6xCMV``</div>
<div class="line">``   09ESAXXT/0DLakAt28ljy1wWKVR3d54TxZJ4DEcYgbxDa1A87DZW8sn+LM4Uwap9``</div>
<div class="line">``   DUyHA0mhBjROe6NXgJQl9aZ7IeE1ht+pw/n+JR2sg3ccYHvQjRcEZj2OPQuavyPn``</div>
<div class="line">``   hwokDc3FVarlsQcrtfePG3e8TQXAnpSxV+KAMBEp4yib5nrkNZZoU+nqMI0ftXrk``</div>
<div class="line">``   rP5q0SaEBEjC4+AoYje4Bv3+8RKT1kwBMkTL8eRRuWZmKvOy9sCnnFfU4HMMkPTK``</div>
<div class="line">``   NJg9Gt8a/xU6GK239M1keCKct87VqWN1unXaD51bgotK1UJWj1q8H262mSYzfRg=``</div>
<div class="line">``   —–END CERTIFICATE—–``</div>
</div>
</section>
<section id="how-to-extact-certs-or-or-combine-certs-into-files">
<h2>How to extact certs or or combine certs into files?<a class="headerlink" href="#how-to-extact-certs-or-or-combine-certs-into-files" title="Link to this heading">#</a></h2>
<section id="pem-files">
<h3>PEM Files<a class="headerlink" href="#pem-files" title="Link to this heading">#</a></h3>
<p>PEM files are plain text; manipulate them using a text editor</p>
</section>
<section id="base64-encoded-der-certificates">
<h3>Base64-encoded DER certificates<a class="headerlink" href="#base64-encoded-der-certificates" title="Link to this heading">#</a></h3>
<p>The letters and symbols between a PEM file’s BEGIN CERTIFICATE and END
CERTIFICATE markers are a base64-encoded DER-encoded X.509 certificate.
To convert between PEM and base64-encoded DER, just add or remove the
markers in a text editor.</p>
</section>
<section id="using-a-nss-database">
<h3>Using a NSS database<a class="headerlink" href="#using-a-nss-database" title="Link to this heading">#</a></h3>
<p>NSS databases can be manipulated using <code class="docutils literal notranslate"><span class="pre">certutil</span></code> and <code class="docutils literal notranslate"><span class="pre">pk12util</span></code>.</p>
<p>In a NSS database, each certificate is identified using a “nickname”.
The nickname can be set with -n option, or taken from the “Friendly
name” entry in a PKCS#12 file, or from the Subject of the certificate.
Note that nicknames and Friendly Names are *not* part of the cert
itself.</p>
<p>Create a temporary NSS database using:</p>
<p>``   certutil -N -d /path/to/nssdb``</p>
<p>Remember to set appropriate permissions if you’re working with sensitive
data.</p>
<p>To list nicknames and trust flags in of the certs in the database,
enter:</p>
<p>``   certutil -L -d /path/to/nssdb/``</p>
<p>To import a PKCS#12 file to a database:</p>
<p>``   pk12util -i /path/to/pkcs12file.p12 -d /path/to/nssdb``</p>
<p>To export a PKCS#12 file from a database (this will export the
certificate chain and private key(s), if available):</p>
<p>``   pk12util -o /path/to/pkcs12file.p12 -d /path/to/nssdb -n ``</p>
<p>To import a PEM file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``   certutil -A -d /path/to/nssdb -n ``\ `` -a -t ``\ `` -i ``
</pre></div>
</div>
<p>For an explicitly trusted (root) CA, use “CT,C,C” for flags. Otherwise
use “,,”</p>
<p>To export a PEM file (to stdout):</p>
<p>``   certutil -L -d /path/to/nssdb -n <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` -a</span></code></p>
<p>Note that PEM is referred to as “ASCII” in certutil documentation.</p>
<p>To create a self-signed root CA certificate and private key:</p>
<p>``   certutil -S -d /path/to/nssdb -s “CN=$(hostname)” -m $RANDOM -n RootCA -t CT,C,C -x``</p>
<p>You should substitute a unique serial number for $RANDOM.</p>
<p>To generate a Certificate Signing Request for a server:</p>
<p>``   certutil -R -d /path/to/nssdb -s “CN=$(hostname)” -1 -a -o request.csr``</p>
<p>Select Digital Signature, Non-Repudiation and Key Encipherment for the
extension.</p>
<p>To sign the CSR, and get a PEM file with the cert:</p>
<p>``   certutil -C -d /path/to/nssdb -m $RANDOM -a -i request.csr -c RootCA``</p>
<p>Again, substitute a unique serial number for $RANDOM.</p>
</section>
</section>
<section id="how-to-check-that-my-certificates-will-be-usable">
<h2>How to check that my certificates will be usable?<a class="headerlink" href="#how-to-check-that-my-certificates-will-be-usable" title="Link to this heading">#</a></h2>
<p>To inspect PKCS#12 files, use <code class="docutils literal notranslate"><span class="pre">pk12util</span> <span class="pre">-l</span></code>. For other files, import
them in a NSS database and use <code class="docutils literal notranslate"><span class="pre">certutil</span> <span class="pre">-L</span></code>. See above for details.</p>
<p>For the servers, you will need certs with a private key. These show up
as “Certificate(has private key):” in <code class="docutils literal notranslate"><span class="pre">pk12util</span></code> output, and with “u”
flags in <code class="docutils literal notranslate"><span class="pre">certutil</span> <span class="pre">-L</span></code> without <code class="docutils literal notranslate"><span class="pre">-n</span></code> The certs will need Digital
Signature, Non-Repudiation and Key Encipherment in the “Certificate Key
Usage” extension (visible in <code class="docutils literal notranslate"><span class="pre">pk12util</span> <span class="pre">-l</span></code> and <code class="docutils literal notranslate"><span class="pre">certutil</span> <span class="pre">-L</span> <span class="pre">-n</span></code>
output). Also, server certs must have “CN=” in the Subject.</p>
<p>The server certs will need a valid trust chain leading up to the CA
certificate. You can check the trust chain following the “Subject” and
“Issuer” lines in the <code class="docutils literal notranslate"><span class="pre">pk12util</span> <span class="pre">-l</span></code> output. CAs should have
Certificate Signing and CRL Signing in their “Certificate Key Usage”
extension.</p>
</section>
<section id="feature-managment">
<h2>Feature Managment<a class="headerlink" href="#feature-managment" title="Link to this heading">#</a></h2>
<p>UI</p>
<p>N/A</p>
<p>CLI</p>
<p>The –http_pkcs12, –dirsrv_pkcs12, –http_pin, –dirsrv_pin options to
ipa-server-install and ipa-replica-prepare work again. The
–root-ca-file option was added to ipa-server-install.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h2>
<p>The feature can be installed as detailed above. There is no supported
way to enable a CA once a CA-less IPA is installed, or to revert to
CA-less from a Dogtag installation.</p>
</section>
<section id="replication">
<h2>Replication<a class="headerlink" href="#replication" title="Link to this heading">#</a></h2>
<p>When creating a replica file, certificates for that replica must be
specified. These must be signed by the CA given as –root-ca-file to the
original master (a copy of this CA cert is in /etc/ipa/ca.crt).</p>
</section>
<section id="updates-and-upgrades">
<h2>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Link to this heading">#</a></h2>
<p>Existing installs are not affected.</p>
<p>Upgrading CA-less instances should work normally.</p>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">#</a></h2>
<p>See <a class="reference external" href="V3/CA-less_install/Test">dedicated test page</a>.</p>
</section>
<section id="rfe-author">
<h2>RFE Author<a class="headerlink" href="#rfe-author" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="User:pviktorin">pviktori</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-rotation">Certificate rotation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kdc-pkinit-considerations">KDC pkinit considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#affected-commands">Affected commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#clients">Clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-root-ca-file">Why –root-ca-file?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-management-faq">Certificate management FAQ</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-check-what-format-files-are">How to check what format files are?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-certs-are-there-in-a-file">How many certs are there in a file?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-extact-certs-or-or-combine-certs-into-files">How to extact certs or or combine certs into files?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pem-files">PEM Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#base64-encoded-der-certificates">Base64-encoded DER certificates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-nss-database">Using a NSS database</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-check-that-my-certificates-will-be-usable">How to check that my certificates will be usable?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-managment">Feature Managment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>