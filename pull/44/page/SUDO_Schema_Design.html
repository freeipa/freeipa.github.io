
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SUDO_Schema_Design &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/SUDO_Schema_Design';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/SUDO_Schema_Design.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SUDO_Schema_Design</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">SUDO_Schema_Design</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-sudo-schema-proposal">Alternative SUDO Schema Proposal</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-considerations">Design Considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-schema">Proposed Schema</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rules">Rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sudo-rules-and-hbac-rules">SUDO rules and HBAC rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defaults">Defaults</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-we-must-support-netgroups-in-the-sudo-rules">Why we must support netgroups in the SUDO rules?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-questions">Open questions</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="sudo-schema-design">
<h1>SUDO_Schema_Design<a class="headerlink" href="#sudo-schema-design" title="Link to this heading">#</a></h1>
</section>
<section id="alternative-sudo-schema-proposal">
<h1>Alternative SUDO Schema Proposal<a class="headerlink" href="#alternative-sudo-schema-proposal" title="Link to this heading">#</a></h1>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">#</a></h2>
<p>This page describes a proposal for the LDAP schema objects to support
centrally managed SUDO rules.</p>
</section>
<section id="design-considerations">
<h2>Design Considerations<a class="headerlink" href="#design-considerations" title="Link to this heading">#</a></h2>
<p>The SUDO rules can already be loaded into an LDAP server and managed
centrally. The schema for the solutions is described here:
<a class="reference external" href="http://www.sudo.ws/sudo/sudoers.ldap.man.html">1</a>. The SUDO client
can use this schema to query central server and download rules. The
schema can be loaded into IPA server too, however, it is disjoint from
other objects IPA manages. The goal of the this document is to define
and alternative schema that can be used by IPA and would be tighter
integrated with other objects IPA manages. This would provide a better
manageability of the access control rules and would reduce a risk of a
mistake or misconfiguration of SUDO. The mail considerations for the
design are:</p>
<ul class="simple">
<li><p>The design should take into the objects that are currently managed by
IPA:</p>
<ul>
<li><p>Users</p></li>
<li><p>Groups</p></li>
<li><p>Hosts</p></li>
<li><p>Host groups</p></li>
<li><p>Netgoups</p></li>
</ul>
</li>
</ul>
<p>and integrate tightly with those objects providing easy cross
referencing of the entries.</p>
<ul class="simple">
<li><p>The designed schema should be able to express all the core use cases
including</p>
<ul>
<li><p>Defaults</p></li>
<li><p>Rules that boil down to Identity A on Host B can execute set C as
identity D. Where:</p>
<ul>
<li><p>Identities A and D can be expressed as a:</p>
<ul>
<li><p>User(s)</p></li>
<li><p>Group(s)</p></li>
<li><p>Netgroup(s)</p></li>
</ul>
</li>
<li><p>Host B can be expressed as a:</p>
<ul>
<li><p>Host(s)</p></li>
<li><p>Host Group(s)</p></li>
<li><p>Netgroup(s)</p></li>
</ul>
</li>
<li><p>Set C is a set of commands (may be a combination of individual
commands and groups of commands)</p></li>
</ul>
</li>
</ul>
</li>
<li><p>The schema should be sufficient to express the rules. It is not
required to follow the exact same syntax as the SUDO schema provides
as long as the rules are powerful to express the access control
policy and a rule can be translated into standard SUDO schema entry
by the compatibility plugin.</p></li>
<li><p>The ambiguities of the order of the LDAP entries should be
considered. The new schema should allow deterministic result
regardless of the order the records returned.</p></li>
<li><p>The new schema should allow disabling rules without deleting them.</p></li>
</ul>
</section>
<section id="proposed-schema">
<h2>Proposed Schema<a class="headerlink" href="#proposed-schema" title="Link to this heading">#</a></h2>
<p>Sudo rules should be located in some part of the tree. Assume that
<strong>SUDOers</strong> will be used as a name of the container. Then the full DN
will look like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">cn=SUDOers,dc=example,dc=com.</span></code></p>
</section>
<section id="rules">
<h2>Rules<a class="headerlink" href="#rules" title="Link to this heading">#</a></h2>
<p>The rule object will be similar to the one defined by the standard SUDO
schema but with additional attributes and will use DNs instead of string
attributes to point to users or groups.</p>
<p>Here is the standard SUDO schema for reference in OpenLDAP format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>attributetype ( 1.3.6.1.4.1.15953.9.1.1
   NAME &#39;sudoUser&#39;
   DESC &#39;User(s) who may  run sudo&#39;
   EQUALITY caseExactIA5Match
   SUBSTR caseExactIA5SubstringsMatch
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.2
   NAME &#39;sudoHost&#39;
   DESC &#39;Host(s) who may run sudo&#39;
   EQUALITY caseExactIA5Match
   SUBSTR caseExactIA5SubstringsMatch
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.3
   NAME &#39;sudoCommand&#39;
   DESC &#39;Command(s) to be executed by sudo&#39;
   EQUALITY caseExactIA5Match
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.4
   NAME &#39;sudoRunAs&#39;
   DESC &#39;User(s) impersonated by sudo&#39;
   EQUALITY caseExactIA5Match
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.5
   NAME &#39;sudoOption&#39;
   DESC &#39;Options(s) followed by sudo&#39;
   EQUALITY caseExactIA5Match
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.6
   NAME &#39;sudoRunAsUser&#39;
   DESC &#39;User(s) impersonated by sudo&#39;
   EQUALITY caseExactIA5Match
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributetype ( 1.3.6.1.4.1.15953.9.1.7
   NAME &#39;sudoRunAsGroup&#39;
   DESC &#39;Group(s) impersonated by sudo&#39;
   EQUALITY caseExactIA5Match
   SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
objectclass ( 1.3.6.1.4.1.15953.9.2.1 NAME &#39;sudoRole&#39; SUP top STRUCTURAL
   DESC &#39;Sudoer Entries&#39;
   MUST ( cn )
   MAY ( sudoUser $ sudoHost $ sudoCommand $ sudoRunAs $ sudoRunAsUser $
         sudoRunAsGroup $ sudoOption $ description )
   )
</pre></div>
</div>
<p>Let us look at each of the attributes and its use more closely.</p>
<ul>
<li><p><strong>sudoUser</strong> (required per spec)</p>
<ul class="simple">
<li><p>A user name</p></li>
<li><p>uid</p></li>
<li><p>Unix group</p></li>
<li><p>User netgroup</p></li>
</ul>
<p>As we can see the SUDO user can be easily expressed by the attribute
that would point to a DN of the existing user, group or netgroup
object. The combination of the userCategory and memberUser attributes
well described in the definition of the association object can also
express special cases that we might want to handle in future. One of
the examples will be ALL users and another will be External trusted
users. This will become relevant when we get the domain trusts
implemented in a later version. For the sake of the current version
it makes sense to include userCategory attribute but make the
software not use it. We would not be able to take advantage of the
userCategory capabilities until either the SUDO client is tough to
support special values or the SSSD is implemented and an intermediary
between SUDO client and new server schema discussed here.
In addition to the users known to IPA for the sake of SUDO rules it
will be beneficial to allow configuring SUDO rules that apply to the
external to IPA users. The best examples are standard local users
like “adm”, “oracle”, “apache” etc. To allow handling such accounts
we will introduce a new attribute:</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                  <span class="n">NAME</span> <span class="s1">&#39;externalUser&#39;</span>
                  <span class="n">DESC</span> <span class="s1">&#39;Multivalue string attribute that allows storing user names.&#39;</span>
                  <span class="n">EQUALITY</span> <span class="n">caseIgnoreMatch</span>
                  <span class="n">ORDERING</span> <span class="n">caseIgnoreMatch</span>
                  <span class="n">SUBSTR</span> <span class="n">caseIgnoreSubstringsMatch</span>
                  <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span>
                  <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">For</span> <span class="n">the</span> <span class="n">sake</span> <span class="n">of</span> <span class="n">simplicity</span> <span class="n">we</span> <span class="n">will</span> <span class="n">support</span> <span class="n">only</span> <span class="n">accounts</span> <span class="n">specified</span> <span class="n">by</span>
<span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">by</span> <span class="n">uid</span><span class="o">.</span>
</pre></div>
</div>
<ul>
<li><p><strong>sudoHost</strong> (required per spec)</p>
<ul class="simple">
<li><p>A host name</p></li>
<li><p>IP address</p></li>
<li><p>IP network</p></li>
<li><p>Host netgroup</p></li>
<li><p>ALL will match any host.</p></li>
</ul>
<p>For the host the memberHost and hostCategory attributes can handle
most of these cases. If memberHost is a DN of a hist, host group, or
host netgroup we cover half. The value “All” in the hostCategory will
be equivalent to the special value ALL used by SUDO. There is a need
to express IP network. I see three different ways of doing it:</p>
<ol class="arabic simple">
<li><p>Not support it at all - is this an option? The point is that the
hosts in the same subnet should probably have a group anyways so
instead of giving IP mask a group or netgroup can be referenced.</p></li>
<li><p>Create a special attribute that will hold the value as a text
string</p></li>
<li><p>Use hostCategory attribute which is in some way a special category</p></li>
</ol>
<p>The answer very much depends on the feedback from the community and
our preference.
Using a separate attribute would probably be the right thing to do
just for the sake of the clean design and maintainability.
The attribute then can look like this:</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span> <span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                  <span class="n">NAME</span> <span class="s1">&#39;hostMask&#39;</span>
                  <span class="n">DESC</span> <span class="s1">&#39;IP mask to identify a subnet.&#39;</span>
                  <span class="n">EQUALITY</span> <span class="n">caseIgnoreMatch</span>
                  <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span>
                  <span class="n">ORDERING</span> <span class="n">caseIgnoreMatch</span>
                  <span class="n">SUBSTR</span> <span class="n">caseIgnoreSubstringsMatch</span>
                  <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">The</span> <span class="n">values</span> <span class="n">it</span> <span class="n">will</span> <span class="n">hold</span> <span class="n">may</span> <span class="n">look</span> <span class="n">like</span> <span class="n">IPv4</span> <span class="ow">or</span> <span class="n">IPv6</span> <span class="n">addresses</span> <span class="ow">or</span>
<span class="n">expressed</span> <span class="n">using</span> <span class="n">the</span> <span class="n">CIDR</span> <span class="n">notation</span> <span class="k">for</span> <span class="n">example</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mf">128.138.243.0</span>
 <span class="mf">128.138.204.0</span><span class="o">/</span><span class="mi">24</span>
 <span class="mf">128.138.242.0</span>
 <span class="n">ffff</span><span class="p">:</span><span class="n">ffff</span><span class="p">:</span><span class="n">ffff</span><span class="p">:</span><span class="n">ffff</span><span class="p">::</span>

<span class="n">Instead</span> <span class="n">of</span> <span class="n">defining</span> <span class="n">a</span> <span class="n">new</span> <span class="n">attribute</span> <span class="n">we</span> <span class="n">can</span> <span class="n">also</span> <span class="n">consider</span> <span class="n">existing</span>
<span class="n">attribute</span> <span class="o">**</span><span class="n">ipNetmaskNumber</span><span class="o">**</span> <span class="n">but</span> <span class="n">this</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="n">defines</span> <span class="k">as</span> <span class="n">single</span>
<span class="n">value</span> <span class="n">attribute</span> <span class="n">which</span> <span class="n">would</span> <span class="n">create</span> <span class="n">a</span> <span class="n">limitation</span> <span class="n">on</span> <span class="n">specifying</span>
<span class="n">multiple</span> <span class="n">masks</span> <span class="ow">in</span> <span class="n">one</span> <span class="n">entry</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span> <span class="n">nisSchema</span><span class="mf">.1.21</span>
                  <span class="n">NAME</span> <span class="s1">&#39;ipNetmaskNumber&#39;</span>
                  <span class="n">DESC</span> <span class="s1">&#39;IP netmask as a dotted decimal, eg. 255.255.255.0, omitting leading zeros&#39;</span>
                  <span class="n">EQUALITY</span> <span class="n">caseIgnoreIA5Match</span>
                  <span class="n">SYNTAX</span> <span class="s1">&#39;IA5String</span><span class="si">{128}</span><span class="s1">&#39;</span> <span class="n">SINGLE</span><span class="o">-</span><span class="n">VALUE</span> <span class="p">)</span>

<span class="n">Or</span> <span class="n">we</span> <span class="n">reuse</span> <span class="n">an</span> <span class="n">attribute</span> <span class="n">already</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">schema</span> <span class="k">for</span> <span class="n">the</span>
<span class="n">external</span> <span class="p">(</span><span class="n">unmanaged</span><span class="p">)</span> <span class="n">hosts</span><span class="o">.</span> <span class="n">This</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">a</span> <span class="n">good</span> <span class="n">option</span> <span class="n">since</span> <span class="n">we</span>
<span class="n">need</span> <span class="n">to</span> <span class="n">also</span> <span class="n">support</span> <span class="n">hosts</span> <span class="n">that</span> <span class="n">run</span> <span class="n">SUDO</span> <span class="n">but</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span>
<span class="n">IPA</span> <span class="n">universe</span> <span class="ow">and</span> <span class="n">thus</span> <span class="n">must</span> <span class="n">be</span> <span class="n">directly</span> <span class="n">listed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">rule</span><span class="o">.</span> <span class="n">However</span> <span class="ow">in</span>
<span class="n">this</span> <span class="n">case</span> <span class="n">we</span> <span class="n">would</span> <span class="n">have</span> <span class="n">to</span> <span class="n">have</span> <span class="n">a</span> <span class="n">special</span> <span class="n">prefixing</span> <span class="n">inside</span> <span class="n">the</span>
<span class="n">attribute</span> <span class="n">value</span> <span class="n">to</span> <span class="n">distinguish</span> <span class="n">the</span> <span class="n">two</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;externalHost&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Multivalue string attribute that allows storing host names.&#39;</span>
                 <span class="n">EQUALITY</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">ORDERING</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">SUBSTR</span> <span class="n">caseIgnoreSubstringsMatch</span>
                 <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">After</span> <span class="n">a</span> <span class="n">brief</span> <span class="n">evaluation</span> <span class="n">I</span> <span class="n">suggest</span> <span class="n">including</span> <span class="n">both</span> <span class="n">attributes</span><span class="o">.</span> <span class="n">The</span>
<span class="o">**</span><span class="n">externalHost</span><span class="o">**</span> <span class="k">for</span> <span class="n">external</span> <span class="n">names</span> <span class="ow">not</span> <span class="n">otherwise</span> <span class="n">managed</span> <span class="n">by</span> <span class="n">the</span>
<span class="n">system</span> <span class="ow">and</span> <span class="n">the</span> <span class="o">**</span><span class="n">hostMask</span><span class="o">**</span> <span class="k">for</span> <span class="n">the</span> <span class="n">net</span> <span class="n">mask</span> <span class="ow">or</span> <span class="n">subnet</span> <span class="n">specification</span>
<span class="k">as</span> <span class="n">define</span> <span class="n">by</span> <span class="n">SUDO</span> <span class="n">syntax</span><span class="o">.</span> <span class="n">The</span> <span class="n">management</span> <span class="n">plugin</span> <span class="n">should</span> <span class="n">implement</span>
<span class="n">strict</span> <span class="n">syntax</span> <span class="n">checking</span> <span class="n">rules</span> <span class="n">to</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">this</span> <span class="n">string</span> <span class="n">has</span> <span class="n">the</span>
<span class="n">right</span> <span class="nb">format</span> <span class="ow">and</span> <span class="n">matches</span> <span class="n">the</span> <span class="n">expectation</span><span class="o">.</span> <span class="n">When</span> <span class="n">synthesizing</span> <span class="n">entries</span>
<span class="n">the</span> <span class="n">compat</span> <span class="n">plugin</span> <span class="n">will</span> <span class="n">take</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">this</span> <span class="n">attribute</span> <span class="n">verbatim</span><span class="p">,</span> <span class="n">add</span>
<span class="n">a</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">stick</span> <span class="n">into</span> <span class="n">the</span> <span class="n">outgoing</span> <span class="n">attribute</span><span class="o">.</span> <span class="n">No</span> <span class="n">syntax</span> <span class="n">checking</span>
<span class="n">will</span> <span class="n">be</span> <span class="n">performed</span><span class="o">.</span>
</pre></div>
</div>
<ul>
<li><p><strong>sudoCommand</strong> (required per spec)</p>
<p>According to SODO manual this is: a Unix command with optional
command line arguments, potentially including globbing characters
(aka wild cards). The special value ALL will match any command. If a
command is prefixed with an exclamation point ‘!’, the user will be
prohibited from running that command.
There are several important ideas that worth discussing regarding the
commands in a rule.</p>
</li>
<li><ul>
<li><p>We can use the commands in the same way as SUDO uses this
attribute, however this does not to seem to be the most efficient
way.</p></li>
<li><p>We can create a special object class to store commands and a
special object class to store groups of commands. This would allow
defining a set of the commands once, grouping them in a logical
way and making a rule reference a DN of a group of commands as
well as individual commands directly if needed. It can be a mixed
bag of both. It also leads to a more controversial idea of not
allowing negation of the commands on per command basis but rather
a negation of the whole rule. Unfortunately this does not work
since SUDO utility has an issue with matching multiple records.
The problem is that if there is an allow and deny rule that can be
matched there is no guarantee which one would come first to the
client. SUDO does not take this into account and does not check
deny rules first. To account for this complication we would have
to allow deny and allow commands in one rule. For this we will
have two similar attributes. One will be the pointer to the
commands or groups of commands that are allowed by the rule and
other attribute will be the pointer to the denied commands or
groups of commands.</p>
<p>It seems that if the rules are defined following this paradigm the
conversion of the proposed schema into a legacy schema via compat
plugin would still produce a set of rules that old clients will be
able to deal with. The proposed approach much better structures
the access control policies for the advantage of the administrator
(he can easier see who can do what) and future use for the times
when SUDO is enhanced to offload the decision making to a plugin
that will be capable of directly or indirectly (most likely via
SSSD) access the new schema and take advantage of its structure.
However it does not make much sense to allow nested groups of the
commands at least originally. The nested group support comes with
cost. It is not clear if there is or will be a requirement to
support nested groups of commands in SUDO rules. So for the first
implementation we will assume that the nested groups support for
commands is not required.
Command and command group objects will have ipaUniqueID attribute
to allow easy changing of the commands or group names to avoid
costly subtree renames. However we will use the cn too as the UI
displays the names rather than IDs.
Category of the commands will be added to denote classes of the
commands. For the first implementation only “all” will be
supported. The logic of handling the member command attributes and
category attributes should be the following:</p>
<blockquote>
<div><p>If no memberAllowCmd, memberDenyCmd or cmdCategory attribute is
specified - no command is allowed
If cmdCategory is specified (the only supported value so far is
“all”)</p>
<blockquote>
<div><p>The memberAllowCmd is ignored
If memberDenyCmd is specified it defines commands or groups
of the commands that are not allowed while all the rest are
allowed by the category attribute.</p>
</div></blockquote>
<p>If cmdCategory is not specified</p>
<blockquote>
<div><p>If memberAllowCmd is specified it defines commands or groups
of the commands that are allowed
If memberDenyCmd is specified it defines commands or groups
of the commands that are not allowed</p>
</div></blockquote>
</div></blockquote>
<p>The SUDO commands will be stored in the cn=SUDOcmd,dc=…
container while the sudo groups will be stored in the
cn=SUDOcmdgrp,dc=… container.</p>
</li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>objectClasses: (2.16.840.1.113730.3.8.8.TBD
                NAME &#39;ipaSudoCmd&#39;
                DESC &#39;IPA object class for SUDO command&#39;
                STRUCTURAL
                MUST ( ipaUniqueID $ sudoCmd )
                MAY  ( memberOf $ description )
                X-ORIGIN &#39;IPA v2&#39; )
objectClasses: (2.16.840.1.113730.3.8.8.TBD
                NAME &#39;ipaSudoCmdGrp&#39;
                DESC &#39;IPA object class to store groups of SUDO commands&#39;
                SUP groupOfNames
                MUST ( ipaUniqueID )
                STRUCTURAL
                X-ORIGIN &#39;IPA v2&#39; )

attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;sudoCmd&#39;
                 DESC &#39;Command(s) to be executed by sudo&#39;
                 EQUALITY caseExactMatch
                 ORDERING caseExactMatch
                 SUBSTR caseExactSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )

attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;memberAllowCmd&#39;
                 DESC &#39;Reference to a command or group of the commands.&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;memberDenyCmd&#39;
                 DESC &#39;Reference to a command or group of the commands.&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;cmdCategory&#39;
                 DESC &#39;Additional classification for commands&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN &#39;IPA v2&#39; )
</pre></div>
</div>
<ul>
<li><p><strong>sudoOption</strong> (optional per spec)</p>
<p>This attribute is used for two purposes - first to define the default
options that apply to all SUDO rules and secondarily to be able to
override specific options in the specific rules. It does not make
sense to change something in comparison to the standard SUDO schema
for this attribute so we will define and analogous attribute of the
same type.</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributetype</span> <span class="p">(</span> <span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                <span class="n">NAME</span> <span class="s1">&#39;ipaSudoOpt&#39;</span>
                <span class="n">DESC</span> <span class="s1">&#39;Options(s) followed by sudo&#39;</span>
                <span class="n">EQUALITY</span> <span class="n">caseExactIA5Match</span>
                <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.26</span> <span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p><strong>sudoRunAs</strong> - is deprecated</p></li>
<li><p><strong>sudoRunAsUser</strong> &amp; <strong>sudoRunAsGroup</strong> (optional per spec)</p>
<ul class="simple">
<li><p>User</p>
<ul>
<li><p>A user name or uid that commands may be run as</p></li>
<li><p>Unix group that contains a list of users that commands may be
run as</p></li>
<li><p>User netgroup that contains a list of users that commands may
be run as.</p></li>
<li><p>The special value ALL will match any user.</p></li>
</ul>
</li>
<li><p>Group (defines the gid of the group the command will be run as)</p>
<ul>
<li><p>A Unix group or gid that commands may be run as.</p></li>
<li><p>The special value ALL will match any group.</p></li>
</ul>
</li>
</ul>
<p>The run as functionality is very complex requires several multiple
attributes to do it cleanly. First of all there should be a way to
point to and existing IPA managed users, groups or netgroups that
aggregate uses the command can be run as. To point to those objects
we need a DN style attribute.</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAs&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Reference to a user or group that the commands can be run as.&#39;</span>
                 <span class="n">SUP</span> <span class="n">memberUser</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">Secondarily</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">the</span> <span class="n">sudo</span> <span class="n">commands</span> <span class="n">to</span> <span class="n">be</span> <span class="n">run</span> <span class="k">as</span> <span class="n">users</span>
<span class="n">that</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">managed</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAsExtUser&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Multivalue string attribute that allows storing user name the command can be run as&#39;</span>
                 <span class="n">EQUALITY</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">ORDERING</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">SUBSTR</span> <span class="n">caseIgnoreSubstringsMatch</span>
                 <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">We</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">referencing</span> <span class="n">external</span> <span class="n">users</span> <span class="n">by</span> <span class="n">the</span> <span class="n">uid</span> <span class="n">only</span> <span class="n">by</span>
<span class="n">login</span> <span class="n">name</span><span class="o">.</span>

<span class="n">Lastly</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">support</span> <span class="n">an</span> <span class="n">option</span> <span class="n">to</span> <span class="n">run</span> <span class="k">as</span> <span class="nb">any</span> <span class="n">user</span><span class="o">.</span> <span class="n">This</span> <span class="n">can</span> <span class="n">be</span>
<span class="n">accomplished</span> <span class="n">by</span> <span class="n">using</span> <span class="n">a</span> <span class="n">special</span> <span class="n">value</span> <span class="s2">&quot;ALL&quot;</span> <span class="ow">in</span> <span class="n">the</span>
<span class="s2">&quot;ipaSudoRunAsExtUser&quot;</span> <span class="n">attribute</span><span class="o">.</span> <span class="n">The</span> <span class="n">draback</span> <span class="n">of</span> <span class="n">this</span> <span class="n">solution</span> <span class="ow">is</span> <span class="n">that</span>
<span class="n">it</span> <span class="n">potentially</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">naming</span> <span class="n">collision</span> <span class="n">between</span> <span class="n">a</span> <span class="n">local</span> <span class="n">user</span> <span class="n">named</span>
<span class="s2">&quot;all&quot;</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">spacial</span> <span class="n">value</span><span class="o">.</span> <span class="n">it</span> <span class="n">also</span> <span class="n">introduces</span> <span class="n">special</span> <span class="n">processing</span>
<span class="ow">and</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attribute</span><span class="o">.</span>
<span class="n">Alternatively</span> <span class="n">we</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">special</span> <span class="n">attribute</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">the</span>
<span class="n">userCategory</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">association</span> <span class="nb">object</span> <span class="n">to</span> <span class="n">express</span> <span class="n">notion</span> <span class="n">of</span>
<span class="s2">&quot;all&quot;</span> <span class="n">users</span> <span class="ow">or</span> <span class="nb">all</span> <span class="s2">&quot;external users&quot;</span> <span class="ow">or</span> <span class="s2">&quot;all trusted users&quot;</span> <span class="n">etc</span><span class="o">.</span>
<span class="n">Though</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">very</span> <span class="n">corner</span> <span class="n">case</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">approach</span> <span class="n">seems</span> <span class="n">a</span> <span class="n">bit</span> <span class="n">an</span>
<span class="n">overkill</span> <span class="n">it</span> <span class="n">allows</span> <span class="n">a</span> <span class="n">cleaner</span> <span class="ow">and</span> <span class="n">consistent</span> <span class="n">logic</span> <span class="n">across</span> <span class="n">the</span> <span class="n">board</span> <span class="n">of</span>
<span class="n">how</span> <span class="n">we</span> <span class="n">handle</span> <span class="n">user</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">system</span> <span class="k">as</span> <span class="n">a</span> <span class="n">whole</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAsUserCategory&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Additional classification for users&#39;</span>
                 <span class="n">SUP</span> <span class="n">userCategory</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">The</span> <span class="n">only</span> <span class="n">value</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">supported</span> <span class="n">so</span> <span class="n">far</span> <span class="ow">is</span> <span class="s2">&quot;all&quot;</span><span class="o">.</span>

<span class="n">For</span> <span class="n">the</span> <span class="n">run</span> <span class="k">as</span> <span class="n">group</span> <span class="n">we</span> <span class="n">will</span> <span class="n">need</span> <span class="n">to</span> <span class="n">have</span> <span class="n">very</span> <span class="n">similar</span> <span class="n">handling</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAsGroup&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Reference to group that the commands can be run as.&#39;</span>
                 <span class="n">SUP</span> <span class="n">memberUser</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAsExtGroup&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Multivalue string attribute that allows storing group name the command can be run as&#39;</span>
                 <span class="n">EQUALITY</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">ORDERING</span> <span class="n">caseIgnoreMatch</span>
                 <span class="n">SUBSTR</span> <span class="n">caseIgnoreSubstringsMatch</span>
                 <span class="n">SYNTAX</span> <span class="mf">1.3.6.1.4.1.1466.115.121.1.15</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>

<span class="n">We</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">referencing</span> <span class="n">external</span> <span class="n">groups</span> <span class="n">by</span> <span class="n">the</span> <span class="n">gid</span> <span class="n">only</span> <span class="n">by</span>
<span class="n">group</span> <span class="n">name</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeTypes</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.16.840.1.113730.3.8.7</span><span class="o">.</span><span class="n">TBD</span>
                 <span class="n">NAME</span> <span class="s1">&#39;ipaSudoRunAsGroupCategory&#39;</span>
                 <span class="n">DESC</span> <span class="s1">&#39;Additional classification for groups&#39;</span>
                 <span class="n">SUP</span> <span class="n">userCategory</span>
                 <span class="n">X</span><span class="o">-</span><span class="n">ORIGIN</span> <span class="s1">&#39;IPA v2&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sudo-rules-and-hbac-rules">
<h2>SUDO rules and HBAC rules<a class="headerlink" href="#sudo-rules-and-hbac-rules" title="Link to this heading">#</a></h2>
<p>When a user invokes SUDO he needs to authenticate. On the managed hosts
the SSSD will do the access control enforcement for those
authentications using HBAC rules. If the authentication is not allowed
the SUDO command will fail with the authentication error. This need to
be avoided. Different proposals have been considered. Some were colling
for some kind of the automatic (using a DS managed entry plugin) or less
automatic (using a special management plugin) solution. Both of these
solutions might cause many unwanted HBAC entries to be created in the
system significantly reducing its manageability. After a thorough
evaluation we came to the conclusion that the best approach would be to
add several special preloaded entries that will help to over come the
SUDO authentication problem.</p>
<ul class="simple">
<li><p>First we will create a special service group named “SUDO”.</p></li>
<li><p>This service group will have two services “sudo” and “sudo-i”</p></li>
<li><p>We will add a disabled allow HBAC rule for all users and on all hosts
referencing this service group. It will be to administrator to enable
it if he is planning to manage SUDO with IPA. Alternatively the
administrator will be able to add other more granular access rules at
his discretion.</p></li>
</ul>
<p>The pre configured data template will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dn: cn=SUDO,cn=hbacservicegroups,cn=accounts,$SUFFIX
changetype: add
objectClass: ipaobject
objectClass: ipahbacservicegroup
objectClass: nestedGroup
objectClass: groupOfNames
objectClass: top
cn: SUDO
description: Default group of SUDO related services
dn: cn=sudo,cn=hbacservices,cn=accounts,$SUFFIX
changetype: add
objectClass: ipaobject
objectClass: ipahbacservice
cn: sudo
memberOf:&#39;cn=SUDO,cn=hbacservicegroups,cn=accounts,$SUFFIX&#39;
description: Login service for sudo
dn: cn=sudo-i,cn=hbacservices,cn=accounts,$SUFFIX
changetype: add
objectClass: ipaobject
objectClass: ipahbacservice
cn: sudo-i
memberOf:&#39;cn=SUDO,cn=hbacservicegroups,cn=accounts,$SUFFIX&#39;
description: Login service for sudo-i

dn: cn=SUDO Login,cn=hbac,cn=accounts,$SUFFIX
changetype add
objectClass: top
objectClass: ipaAssociation
objectClass: ipaHBACRule
cn: SUDO Login
description: Default HBAC rule to allow authentication via SUDO commands.
ipaEnabledFlag: false
accessRuleType: allow
userCategory: all
hostCategory: all
sourceHostCategory: all
memberService: &#39;cn=SUDO,cn=hbacservicegroups,cn=accounts,$SUFFIX&#39;
</pre></div>
</div>
<p>If we realize that we need a more tight coupling between the SUDO and
HBAC rules we will implement them later based on the feedback from the
community.</p>
</section>
<section id="defaults">
<h2>Defaults<a class="headerlink" href="#defaults" title="Link to this heading">#</a></h2>
<p>As in the standard SUDO schema the “default” options will be represented
by the same rule object but with a special name: cn=defaults. This
allows to maintain consistency in the lookups between old and new
schema.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>To summarize the schema for the new SUDO rule object will look like
this:</p>
<p>Existing objects already defined in the IPA schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>attributeTypes: (2.16.840.1.113730.3.8.3.1
                 NAME &#39;ipaUniqueID&#39;
                 DESC &#39;Unique identifier&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.5
                 NAME &#39;memberUser&#39;
                 DESC &#39;Reference to a principal that performs an action (usually user).&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.6
                 NAME &#39;userCategory&#39;
                 DESC &#39;Additional classification for users&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.7
                 NAME &#39;memberHost&#39;
                 DESC &#39;Reference to a device where the operation takes place (usually host).&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.8
                 NAME &#39;hostCategory&#39;
                 DESC &#39;Additional classification for hosts&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.9
                 NAME &#39;ipaEnabledFlag&#39;
                 DESC &#39;The flag to show if the association is active or should be ignored&#39;
                 EQUALITY booleanMatch
                 ORDERING booleanMatch
                 SUBSTR booleanMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.7 SINGLE-VALUE
                 X-ORIGIN &#39;IPA v2&#39; )
objectClasses: (2.16.840.1.113730.3.8.4.6
                NAME &#39;ipaAssociation&#39;
                ABSTRACT
                MUST ( ipaUniqueID    $ cn )
                MAY  ( memberUser     $ userCategory $
                       memberHost     $ hostCategory $
                       ipaEnabledFlag $ description )
                X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.3.11
                 NAME &#39;externalHost&#39;
                 DESC &#39;Multivalue string attribute that allows storing host names.&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
objectClasses: (2.16.840.1.113730.3.8.4.3
                NAME &#39;nestedGroup&#39;
                DESC &#39;Group that supports nesting&#39;
                SUP groupOfNames
                STRUCTURAL
                MAY memberOf
                X-ORIGIN &#39;IPA v2&#39; )
attributeTypes ( 2.16.840.1.113730.3.8.3.13
                 NAME &#39;accessRuleType&#39;
                 DESC &#39;The flag to represent if it is allow or deny rule.&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39;)
Note: valid values for accessRuleType are &quot;allow&quot; or &quot;deny&quot;
</pre></div>
</div>
<p>New attributes and objects added by this design:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>objectClasses: (2.16.840.1.113730.3.8.8.TBD
                NAME &#39;ipaSudoCmd&#39;
                DESC &#39;IPA object class for SUDO command&#39;
                STRUCTURAL
                MUST ( ipaUniqueID $ sudoCmd )
                MAY  ( memberOf $ description )
                X-ORIGIN &#39;IPA v2&#39; )
objectClasses: (2.16.840.1.113730.3.8.8.TBD
                NAME &#39;ipaSudoCmdGrp&#39;
                DESC &#39;IPA object class to store groups of SUDO commands&#39;
                SUP groupOfNames
                MUST ( ipaUniqueID )
                STRUCTURAL
                X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;sudoCmd&#39;
                 DESC &#39;Command(s) to be executed by sudo&#39;
                 EQUALITY caseExactMatch
                 ORDERING caseExactMatch
                 SUBSTR caseExactSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;memberAllowCmd&#39;
                 DESC &#39;Reference to a command or group of the commands that are allowed by the rule.&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;memberDenyCmd&#39;
                 DESC &#39;Reference to a command or group of the commands that are denied by the rule.&#39;
                 SUP distinguishedName
                 EQUALITY distinguishedNameMatch
                 ORDERING distinguishedNameMatch
                 SUBSTR distinguishedNameMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;cmdCategory&#39;
                 DESC &#39;Additional classification for commands&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN &#39;IPA v2&#39; )
attributetypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;externalUser&#39;
                 DESC &#39;Multivalue string attribute that allows storing user names.&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributetypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoOpt&#39;
                 DESC &#39;Options(s) followed by sudo&#39;
                 EQUALITY caseExactIA5Match
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAs&#39;
                 DESC &#39;Reference to a user or group that the commands can be run as.&#39;
                 SUP memberUser
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAsExtUser&#39;
                 DESC &#39;Multivalue string attribute that allows storing user name the command can be run as&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAsUserCategory&#39;
                 DESC &#39;Additional classification for users&#39;
                 SUP userCategory
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAsGroup&#39;
                 DESC &#39;Reference to group that the commands can be run as.&#39;
                 SUP memberUser
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAsExtGroup&#39;
                 DESC &#39;Multivalue string attribute that allows storing group name the command can be run as&#39;
                 EQUALITY caseIgnoreMatch
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;ipaSudoRunAsGroupCategory&#39;
                 DESC &#39;Additional classification for groups&#39;
                 SUP userCategory
                 X-ORIGIN &#39;IPA v2&#39; )
attributeTypes: (2.16.840.1.113730.3.8.7.TBD
                 NAME &#39;hostMask&#39;
                 DESC &#39;IP mask to identify a subnet.&#39;
                 EQUALITY caseIgnoreMatch
                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
                 ORDERING caseIgnoreMatch
                 SUBSTR caseIgnoreSubstringsMatch
                 X-ORIGIN &#39;IPA v2&#39; )
objectClasses: (2.16.840.1.113730.3.8.8.TBD
                NAME &#39;ipaSudoRule&#39;
                SUP ipaAssociation
                STRUCTURAL
                MAY ( externalUser $
                      externalHost $ hostMask $
                      memberAllowCmd $ memberDenyCmd $ cmdCategory $
                      ipaSudoOpt $
                      ipaSudoRunAs $ ipaSudoRunAsExtUser $ ipaSudoRunAsUserCategory $
                      ipaSudoRunAsGroup $ ipaSudoRunAsExtGroup $ ipaSudoRunAsGroupCategory )
                X-ORIGIN &#39;IPA v2&#39; )
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<p>Default rule</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">ipaUniqueID</span><span class="o">=</span><span class="n">d4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0800200</span><span class="n">c9a66</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">SUDOers</span><span class="o">...</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">top</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">ipaAssociation</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">ipaSudoRule</span>
<span class="n">ipaUniqueID</span><span class="p">:</span> <span class="n">d4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0800200</span><span class="n">c9a66</span>
<span class="n">cn</span><span class="p">:</span> <span class="n">defaults</span>
<span class="n">ipaSudoOpt</span><span class="p">:</span> <span class="n">env_keep</span><span class="o">+=</span><span class="n">SSH_AUTH_SOCK</span>
<span class="n">ipaSudoOpt</span><span class="p">:</span> <span class="o">...</span>
<span class="n">ipaSudoOpt</span><span class="p">:</span> <span class="o">...</span>
<span class="n">compatVisible</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<p>A rule that denies specified users on the given machines to run su
command as a local root on centrally managed “superuser” account.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">ipaUniqueID</span><span class="o">=</span><span class="n">d4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0800200</span><span class="n">c9a66</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">SUDOers</span><span class="o">...</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">top</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">ipaAssociation</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">ipaSudoRule</span>
<span class="n">ipaUniqueID</span><span class="p">:</span> <span class="n">d4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0800200</span><span class="n">c9a66</span>
<span class="n">cn</span><span class="p">:</span> <span class="n">defaults</span> <span class="k">for</span> <span class="n">virtual</span> <span class="n">lab</span>
<span class="n">compatVisible</span><span class="p">:</span> <span class="n">true</span>
<span class="n">memberHost</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">VirtGuests</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">hostgroups</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">memberHost</span><span class="p">:</span> <span class="n">fqdn</span><span class="o">=</span><span class="n">myhost</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">computers</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">externalHost</span><span class="p">:</span> <span class="n">lobby</span><span class="o">.</span><span class="n">workstation</span><span class="o">.</span><span class="n">external</span><span class="o">.</span><span class="n">com</span>
<span class="n">hostMask</span><span class="p">:</span> <span class="mf">128.138.204.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">memberUser</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">sss</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">users</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">memberUser</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">dpal</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">users</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">memberUser</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">Engineering</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">memberDenyCmd</span><span class="p">:</span> <span class="n">f4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0</span><span class="n">abc200c9a67</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">SUDOcmd</span><span class="o">...</span>
<span class="n">ipaSudoRunAsExtUser</span><span class="p">:</span> <span class="n">root</span>
<span class="n">ipaSudoRunAs</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">superuser</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">users</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">accounts</span><span class="p">,</span><span class="o">...</span>
<span class="n">dn</span><span class="p">:</span> <span class="n">ipaUniqueID</span><span class="o">=</span><span class="n">f4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0</span><span class="n">abc200c9a67</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">SUDOcmd</span><span class="o">...</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">top</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">ipaSudoCmd</span>
<span class="n">ipaUniqueID</span><span class="p">:</span> <span class="n">f4453480</span><span class="o">-</span><span class="n">cc53</span><span class="o">-</span><span class="mi">11</span><span class="n">dd</span><span class="o">-</span><span class="n">ad8b</span><span class="o">-</span><span class="mi">0</span><span class="n">abc200c9a67</span>
<span class="n">sudoCmd</span><span class="p">:</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">su</span>
</pre></div>
</div>
</section>
<section id="why-we-must-support-netgroups-in-the-sudo-rules">
<h2>Why we must support netgroups in the SUDO rules?<a class="headerlink" href="#why-we-must-support-netgroups-in-the-sudo-rules" title="Link to this heading">#</a></h2>
<p>Current SUDO client when needs to evaluate whether user is allowed to
execute the command or not works the following way:</p>
<ul class="simple">
<li><p>It downloads all LDAP rules that are applicable to this current user</p></li>
<li><p>Filters out the rules that do not apply to the host</p></li>
<li><p>Filters out the rules that do not apply to the command in question.</p></li>
</ul>
<p>For the sake of the argument we are interested in step 2). The
deployments that centrally manage SUDO via LDAP do not put individual
hosts into each SUDO rule. Instead they create a netgroup consisting of
only hosts and reference it in the SUDO rule. Putting individual hosts
into the SUDO rules will be unmanageable. We can’t do anything with the
SUDO client on all the platforms the customers are using SUDO on. We can
eventually solve it for Linux but not for existing Solaris, HP-UX, AIX
and other boxes. So the IPA server should be capable of:</p>
<ul class="simple">
<li><p>Serving SUDO rules in the standard SUDO format since the client
expects it this way (will be done via the compat plugin)</p></li>
<li><p>Allowing SUDO rules to have a netgroup name as a value in the
synthesized sudoHost attribute</p></li>
<li><p>Serving netgroup information in the standard netgroup format defined
by RFC 2307 (already done by the compat plugin)</p></li>
</ul>
<p>Our original plan was to allow SUDO rule to point to the netgroup DN via
memberHost attribute. However later we realized that for easier
migration and compatibility it would be better to create a managed
netgroup entry for every host group automatically. So now we decided not
allow SUDO rule to point to the netgroup directly. Instead the compat
plugin will detect that whether host group has a shadow netgroup entry.
If it does it will use its name in the synthesized compatible SUDO rule,
otherwise it will expand the host group and stick member hosts directly
into the entry. The IPA server will automatically create netgoups for
host groups for years to come until the need need for the netgroups is
completely eliminated and admins would be able to turn it off. By that
time there will be no more need for the SUDO compat configuration.</p>
</section>
<section id="open-questions">
<h2>Open questions<a class="headerlink" href="#open-questions" title="Link to this heading">#</a></h2>
<ul>
<li><p>Is it Ok to not allow specifying external users and groups by uid and
gid?</p>
<p><strong>Current plan is to not allow specifying users by uid and gid.</strong></p>
</li>
<li><p>Can we not support netgroups with memberUser attribute?</p>
<p><strong>We will not support netgroups for users.</strong></p>
</li>
<li><p>What should we do about hostMask? Can we defer it?</p>
<p><strong>We will defer it at least in the UI.</strong></p>
</li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">SUDO_Schema_Design</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-sudo-schema-proposal">Alternative SUDO Schema Proposal</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-considerations">Design Considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-schema">Proposed Schema</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rules">Rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sudo-rules-and-hbac-rules">SUDO rules and HBAC rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defaults">Defaults</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-we-must-support-netgroups-in-the-sudo-rules">Why we must support netgroups in the SUDO rules?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-questions">Open questions</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>