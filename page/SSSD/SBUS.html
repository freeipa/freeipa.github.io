

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>SBUS &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/SSSD/SBUS';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/SSSD/SBUS.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SBUS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-d-bus-protocol">Overview of D-BUS Protocol</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-server">The D-BUS Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-connection">The D-BUS Connection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-message">The D-BUS Message</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-system-bus">The D-BUS System Bus</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sssd-and-d-bus">SSSD and D-BUS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sssd-infrastructure">SSSD Infrastructure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sbus-server">SBUS Server</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="sbus">
<h1>SBUS<a class="headerlink" href="#sbus" title="Permalink to this heading">#</a></h1>
<section id="overview-of-d-bus-protocol">
<h2>Overview of D-BUS Protocol<a class="headerlink" href="#overview-of-d-bus-protocol" title="Permalink to this heading">#</a></h2>
<p>The D-BUS protocol was designed as an IPC mechanism for use in desktop
components. The D-BUS specification provides a marshalled wire format
for transmitting signals and method calls to other processes.</p>
<p>The D-BUS protocol has four primary components:</p>
</section>
<section id="the-d-bus-server">
<h2>The D-BUS Server<a class="headerlink" href="#the-d-bus-server" title="Permalink to this heading">#</a></h2>
<p>A common source of confusion, the D-BUS server is not a server in the
traditional sense. Rather than accepting connections and listening for
requests on that connection, the D-BUS server is instead used only for
establishing connections.</p>
</section>
<section id="the-d-bus-connection">
<h2>The D-BUS Connection<a class="headerlink" href="#the-d-bus-connection" title="Permalink to this heading">#</a></h2>
<p>This is the workhorse of the D-BUS protocol. Once a D-BUS connection has
been made to a D-BUS server, it becomes a peer-to-peer connection.
Either end of the connection can listen for method calls or signals, and
either end can initiate them.</p>
</section>
<section id="the-d-bus-message">
<h2>The D-BUS Message<a class="headerlink" href="#the-d-bus-message" title="Permalink to this heading">#</a></h2>
<p>D-BUS messages come in three primary forms. These are D-BUS method
calls, D-BUS Signals and D-BUS errors. D-BUS signals and D-BUS errors
are one-way messages from one end of a D-BUS connection to the other,
intended to carry a brief message (such as a signal to start or stop a
service, or a notification that an error has occurred in the
connection). D-BUS errors are usually generated by the internal D-BUS
API itself, though they can be generated by your own code as well.</p>
<p>D-BUS method calls are the bread-and-butter of the D-BUS protocol. The
purpose of these calls is to essentially run a method on a remote
process and treat it as if it had been run locally. These calls may (or
may not) receive replies from the other end of the connection.</p>
<p>D-BUS method calls can be invoked in a blocking or nonblocking method,
but within the SSSD we will use the nonblocking approach exclusively
(except in unit test binaries, where events should be in serial)</p>
<p>Details of the message specification can be read at
<a class="reference external" href="http://dbus.freedesktop.org/doc/dbus-specification.html#message-protocol">http://dbus.freedesktop.org/doc/dbus-specification.html#message-protocol</a></p>
</section>
<section id="the-d-bus-system-bus">
<h2>The D-BUS System Bus<a class="headerlink" href="#the-d-bus-system-bus" title="Permalink to this heading">#</a></h2>
<p>The system bus is a special implementation of the D-BUS protocol. It was
designed by the freedesktop project to handle communication between the
many system daemons. The system bus is an implementation of the D-BUS
server that will act as a central routing station for D-BUS
communication between services that are registered to it. When using the
system bus, a D-BUS client can initiate a connection and then
communicate indirectly to other processes also connected to the bus by
sending a message with a known destination.</p>
<p>In the SSSD, we do not use the system bus due to the heavy traffic that
it sees from the desktop components. Instead we will rely on using the
direct connections.</p>
</section>
<section id="sssd-and-d-bus">
<h2>SSSD and D-BUS<a class="headerlink" href="#sssd-and-d-bus" title="Permalink to this heading">#</a></h2>
<p>In the SSSD, we have implemented a version of the D-BUS protocol that we
call the SBUS. The SBUS is built atop libdbus-1 from the freedesktop
project, but will implement only a subset of D-BUS features.</p>
</section>
<section id="sssd-infrastructure">
<h2>SSSD Infrastructure<a class="headerlink" href="#sssd-infrastructure" title="Permalink to this heading">#</a></h2>
<p>The SSSD makes use of the event library developed by the Samba project.
This event library implements a very robust mainloop for processes.</p>
<p>In order to take advantage of the nonblocking features of the D-BUS
server and D-BUS connection, these portions of the D-BUS API must be
integrated into the process’ mainloop. We have developed a set of
SSSD-specific helper functions to simplify this integration. There is a
library of SBUS tools located within the “sbus” directory in the SSSD
tree.</p>
</section>
<section id="sbus-server">
<h2>SBUS Server<a class="headerlink" href="#sbus-server" title="Permalink to this heading">#</a></h2>
<p>The SBUS server will be run on one side or the other of any SSSD process
that requires communication from other processes. Some examples of this
are the Monitor service (which uses SBUS to verify the availability of
the SSSD processes) and the Data Provider (which will listen for cache
update requests from NSS, PAM and INFO pipe, as well as serving requests
to Data Provider Backends such as FreeIPA)</p>
<p>Instantiating an SBUS server using the SBUS library can be done with the
sbus_new_server() helper routine. This call requires a pointer to an
event context and a function to properly set up new connections. This
helper function will handle the primary duties of setting up a new
connection, and then will invoke the function specified by the user. Put
more simply, this function describes what to do with a new connection
once it’s established.</p>
<p>An example from the monitor code is to transmit an identity request to
the new connection. Once this request returns, the Monitor will be able
to keep track of which of the required services are alive, and which pid
they are using.</p>
<p><a class="reference external" href="Category:Obsolete">Category:Obsolete</a></p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-d-bus-protocol">Overview of D-BUS Protocol</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-server">The D-BUS Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-connection">The D-BUS Connection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-message">The D-BUS Message</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-d-bus-system-bus">The D-BUS System Bus</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sssd-and-d-bus">SSSD and D-BUS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sssd-infrastructure">SSSD Infrastructure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sbus-server">SBUS Server</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>