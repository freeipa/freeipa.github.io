

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>CA_certificate_renewal &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/CA_certificate_renewal';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/CA_certificate_renewal.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CA_certificate_renewal</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-ca-certificate-renewal">Automated CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-ca-certificate-renewal">Manual CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-install-of-ca-certificate">Manual install of CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-certificate-store">Shared certificate store</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-renewal-of-ipa-ca-certificate">Automatic renewal of IPA CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ca-certificate-management-utility">CA certificate management utility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-certificate-update-utility">Client certificate update utility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installers">Installers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Automated CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Manual CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Manual install of CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-update-of-local-ca-certificate-files">Manual update of local CA certificate files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="ca-certificate-renewal">
<h1>CA_certificate_renewal<a class="headerlink" href="#ca-certificate-renewal" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>Allow automated and manual renewal of IPA CA certificate. Provide an
utility for manual renewal, including modification of chaining
(self-signed vs. signed by external CA). Store multiple CA certificates
in LDAP and distribute them to clients.</p>
<p>This page describes <strong>phase 1</strong> of the CA certificate management
feature, which consists of automated and manual CA certificate renewal,
CA certificate management utility and storage of multiple CA certificate
in LDAP. Visit <a class="reference external" href="V4/CA_certificate_renewal_(2)">V4/CA certificate renewal
(2)</a> for description of <strong>phase 2</strong>,
which consists of distribution of CA certificates to IPA clients.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">#</a></h2>
</section>
<section id="automated-ca-certificate-renewal">
<h2>Automated CA certificate renewal<a class="headerlink" href="#automated-ca-certificate-renewal" title="Permalink to this heading">#</a></h2>
<p>When the CA certificate is nearing its expiration time, it should be
automatically renewed. The renewed certificate will use the same keypair
and subject name as the old certificate.</p>
<p>This only works for self-signed CA certificates in CA-ful installs.</p>
</section>
<section id="manual-ca-certificate-renewal">
<h2>Manual CA certificate renewal<a class="headerlink" href="#manual-ca-certificate-renewal" title="Permalink to this heading">#</a></h2>
<p>Allow admin to manually renew the CA certificate and possibly change its
chaining (self-signed → signed by external CA, signed by external CA →
self-signed, signed by external CA → signed by other external CA)
(<strong>phase 1</strong>) and have the renewed certificate automatically distributed
to all systems in the domain (<strong>phase 2</strong>). The renewed certificate will
use the same keypair and subject name as the old certificate.</p>
<p>This works for any CA certificate in CA-ful installs.</p>
</section>
<section id="manual-install-of-ca-certificate">
<h2>Manual install of CA certificate<a class="headerlink" href="#manual-install-of-ca-certificate" title="Permalink to this heading">#</a></h2>
<p>In CA-less installs, CA certificate renewal is completely in charge of a
3rd party CA. Provide means of installing CA certificates obtained from
such a CA (<strong>phase 1</strong>) and automatically distribute them to all systems
in the domain (<strong>phase 2</strong>).</p>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h2>
</section>
<section id="shared-certificate-store">
<h2>Shared certificate store<a class="headerlink" href="#shared-certificate-store" title="Permalink to this heading">#</a></h2>
<p>CA certificates will be stored in entries under
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``dn: cn=EXAMPLE.COM IPA CA,cn=certificates,cn=ipa,cn=etc,``\ *``suffix``*
| ``objectClass: ipaCertificate``
| ``objectClass: pkiCA``
| ``objectClass: ipaKeyPolicy``
| ``cn: cn=EXAMPLE.COM IPA CA``
| ``ipaCertSubject: CN=Certificate Authority,O=EXAMPLE.COM``
| ``ipaCertIssuerSerial: CN=Certificate Authority,O=EXAMPLE.COM;1``
| ``ipaCertIssuerSerial: CN=Certificate Authority,O=EXAMPLE.COM;22``
| ``ipaPublicKey: ``\ *``DER-encoded public key``*
| ``ipaConfigString: ipaCA``
| ``ipaConfigString: compatCA``
| ``cACertificate;binary:: ``\ *``DER-encoded certificate 1``*
| ``cACertificate;binary:: ``\ *``DER-encoded certificate 2``*
| ``ipaKeyTrust: trusted``
| ``ipaKeyExtUsage: 1.3.6.1.5.5.7.3.1``
| ``ipaKeyExtUsage: 1.3.6.1.5.5.7.3.2``
| ``ipaKeyExtUsage: 1.3.6.1.5.5.7.3.3``
| ``ipaKeyExtUsage: 1.3.6.1.5.5.7.3.4``
</pre></div>
</div>
<p>Each entry represents a set of certificates using a single subject name
and public key and contains trust policy for the set of certificates
(based on <a class="reference external" href="http://p11-glue.freedesktop.org/doc/storing-trust-policy/index.html">p11-kit trust
policy</a>).
The attributes are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cn</span></code></p>
<p>Nickname for the certificates. The value must be unique in the store.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCertSubject</span></code></p>
<p>Subject name of the certificates. The value must be unique in the
store. Semicolons in the subject name are escaped as <code class="docutils literal notranslate"><span class="pre">\3b</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCertIssuerSerial</span></code></p>
<p>Issuer name and serial number of each certificate in the set,
separated by semicolon. Each value must be unique in the store.
Semicolons in the issuer name are escaped as <code class="docutils literal notranslate"><span class="pre">\3b</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">`ipaPublicKey</span></code> &lt;V4/PKCS11_in_LDAP/Schema#Encoded_key_data&gt;`__</p>
<p>Public key of the certificates as DER-encoded SubjectPublicKeyInfo.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaConfigString</span></code></p>
<p>Configuration flags:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaCA</span></code></p>
<p>This entry represents the IPA CA certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compatCA</span></code></p>
<p>When a new certificate is added to the set, update
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em> with it.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cACertificate</span></code></p>
<p>Each of the certificates in the set in DER encoding.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyTrust</span></code></p>
<p>Trust setting for the certificates:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unknown</span></code> (default)</p>
<p>Trust is not explicitly given. If there is other source of trust
information, it should be used instead.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">trusted</span></code></p>
<p>The certificates in the set are explicitly trusted.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">distrusted</span></code></p>
<p>The certificates in the set are explicitly distrusted.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyUsage</span></code></p>
<p>Allowed key usages for the certificates as purpose bit names from the
key usage certificate extension (see <a class="reference external" href="http://tools.ietf.org/html/rfc5280#section-4.2.1.3%7CRFC">5280, section
4.2.1.3</a>).
A value of <code class="docutils literal notranslate"><span class="pre">none</span></code> means no key usages are allowed. Default value is
the value of the key usage extension from each certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaKeyExtUsage</span></code></p>
<p>Allowed extended key usages as key purpose OIDs (see <a class="reference external" href="http://tools.ietf.org/html/rfc5280#section-4.2.1.12%7CRFC">5280, section
4.2.1.12</a>).
A value of <code class="docutils literal notranslate"><span class="pre">1.3.6.1.4.1.3319.6.10.16</span></code> means no extended key usages
are allowed. Default value is the value of the extended key usage
extension from each certificate.
For trusted CA certificates, the value of this attribute is mapped to
NSS / certutil trust flags as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.1</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">C,,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.2</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">T,,</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.3</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">,,C</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.3.6.1.5.5.7.3.4</span></code> ⇒ <code class="docutils literal notranslate"><span class="pre">,C,</span></code></p></li>
</ul>
</li>
</ul>
<p>The entries will be readable by everyone and writable only by the
directory manager (for installers and management tools) and the server
host (for automatic renewal).</p>
<p>The new schema used for the entries is:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaCertSubject’``</div>
<div class="line">``                 DESC ‘Subject name’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 SINGLE-VALUE``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaCertIssuerSerial’``</div>
<div class="line">``                 DESC ‘Issuer name and serial number’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SUBSTR caseIgnoreSubstringsMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyTrust’``</div>
<div class="line">``                 DESC ‘Key trust (unknown, trusted, distrusted)’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’) ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyUsage’``</div>
<div class="line">``                 DESC ‘Allowed key usage’``</div>
<div class="line">``                 EQUALITY caseIgnoreMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’) ``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.???</span></code></div>
<div class="line">``                 NAME ‘ipaKeyExtUsage’``</div>
<div class="line">``                 DESC ‘Allowed extended key usage’``</div>
<div class="line">``                 EQUALITY objectIdentifierMatch``</div>
<div class="line">``                 SYNTAX 1.3.6.1.4.1.1466.115.121.1.38``</div>
<div class="line">``                 X-ORIGIN ‘IPA v4’)``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.???</span></code></div>
<div class="line">``                NAME ‘ipaCertificate’``</div>
<div class="line">``                SUP top STRUCTURAL``</div>
<div class="line">``                MUST ( cn $ ipaCertSubject $ ipaCertIssuerSerial $ ipaPublicKey )``</div>
<div class="line">``                MAY  ( ipaConfigString )``</div>
<div class="line">``                X-ORIGIN ‘IPA v4’ )``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.???</span></code></div>
<div class="line">``                NAME ‘ipaKeyPolicy’``</div>
<div class="line">``                SUP top AUXILIARY``</div>
<div class="line">``                MAY  ( ipaKeyTrust $ ipaKeyUsage $ ipaExtKeyUsage )``</div>
<div class="line">``                X-ORIGIN ‘IPA v4’)``</div>
</div>
</section>
<section id="automatic-renewal-of-ipa-ca-certificate">
<h2>Automatic renewal of IPA CA certificate<a class="headerlink" href="#automatic-renewal-of-ipa-ca-certificate" title="Permalink to this heading">#</a></h2>
<p>The CA certificate managed by Dogtag will be tracked by certmonger. If
the certificate is self-signed, it will be automatically renewed. If the
certificate is signed by an external CA, the renewal attempt will fail
with an error, advising the administrator to renew the certificate
manually. The error is syslogged with ALERT severity.</p>
</section>
<section id="ca-certificate-management-utility">
<h2>CA certificate management utility<a class="headerlink" href="#ca-certificate-management-utility" title="Permalink to this heading">#</a></h2>
<p>There will be new utility to manage CA certificates,
<code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code>. It will have several subcommands:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">renew</span></code><em>``options``</em></p>
<p>This command will be available only for CA-ful installs and will be
used to renew the IPA CA certificate. The certificate can be renewed
either as self-signed or signed by an external CA. By default, the
chaining used for the old certificate is used for the new certificate
as well. Renewing a CA certificate signed by an external CA is a 2
step operation: in the first step, a CSR is exported to
<code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code>; in the second step, the signed certificate
is installed.
The available options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--self-signed</span></code></p>
<p>Renew the CA certificate as self-signed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--external-ca</span></code></p>
<p>Renew the CA certificate as signed by an external CA, step 1:
Export CSR to <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--external-cert-file</span></code><em>``file``</em></p>
<p>Renew the CA certificate as signed by an external CA, step 2:
Install the new CA certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--password</span></code><em>``password``</em></p>
<p>Directory manager password. Required for external CA renewal step
2.</p>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">install</span></code><em>``options``</em> <em>``file``</em></p>
<p>Install CA certificate from a PEM file.
The available options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code><em>``nickname``</em>, <code class="docutils literal notranslate"><span class="pre">--nickname</span></code><em>``nickname``</em></p>
<p>Nickname for the certificate.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code><em>``flags``</em>, <code class="docutils literal notranslate"><span class="pre">--trust-flags</span></code><em>``flags``</em></p>
<p>Trust flags for the certificate in NSS / certutil format.</p>
</li>
</ul>
</li>
</ul>
</section>
<section id="client-certificate-update-utility">
<h2>Client certificate update utility<a class="headerlink" href="#client-certificate-update-utility" title="Permalink to this heading">#</a></h2>
<p>There will be new utility, <code class="docutils literal notranslate"><span class="pre">ipa-certupdate</span></code>, for updating CA
certificates on clients with up-to-date data from LDAP. Until <strong>phase
2</strong> is complete, running it manually will be the only way to update the
CA certificates after installation.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>In CA-ful installs, CA certificate renewal is handled by certmonger.
Automatic renewal is handled by certmonger itself. In manual renewal,
<code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> resubmits the certmonger request for the CA
certificate. If the CA certificate is self-signed, the request is
submitted directly to Dogtag. If the CA certificate is signed by an
external CA, <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> exports the CSR created by certmonger
to <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code> in the first step. In the seconds step, it
updates <code class="docutils literal notranslate"><span class="pre">cn=ca_renewal,cn=ipa,cn=etc,</span></code><em>``suffix``</em> so that the new
CA certificate can be picked up by certmonger and resubmits the
certmonger request. In the post-save command of the certmonger request,
the renewed CA certificate is added to
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>.</p>
<p>When installing new CA certificate manually, <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span></code> adds
the certificate directly to
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>.</p>
<p>When a CA certificate is renewed, its previous version is not removed to
allow rollover.</p>
</section>
<section id="feature-management">
<h2>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">#</a></h2>
<p>UI</p>
<p>N/A</p>
<p>CLI</p>
<p>See <a class="reference external" href="#CA_certificate_management_utility">design</a>.</p>
</section>
<section id="installers">
<h2>Installers<a class="headerlink" href="#installers" title="Permalink to this heading">#</a></h2>
<p>N/A</p>
</section>
<section id="upgrade">
<h2>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this heading">#</a></h2>
<p>Old clients will look for IPA CA certificate in
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em>. A copy of the most recent
IPA CA certificate needs to be maintained in this entry for
compatibility with old clients.</p>
<p>Old servers do not have
<code class="docutils literal notranslate"><span class="pre">cn=certificates,cn=ipa,cn=etc,</span></code><em>``suffix``</em>. Client installer has
to look for CA certificates both in this entry and in
<code class="docutils literal notranslate"><span class="pre">cn=CAcert,cn=ipa,cn=etc,</span></code><em>``suffix``</em> for compatibility with old
servers.</p>
</section>
<section id="how-to-test">
<h2>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">#</a></h2>
</section>
<section id="id1">
<h2>Automated CA certificate renewal<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>Install IPA server with CA (either self-signed or signed by external
CA)</p></li>
<li><p>Get the expiration date of the IPA CA certificate:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert list -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Move system time 3 weeks before the expiration date</p></li>
<li><p>Check the status of the certmonger request:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert list -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If the IPA CA was installed self-signed:</p>
<ol class="arabic simple">
<li><p>Wait for the certmonger request to complete, it should end up with
MONITORING status</p></li>
<li><p>Check that the renewed CA certificate was added to the LDAP
certificate store and to the <code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS
database</p></li>
</ol>
</li>
<li><p>If the IPA CA was installed signed by external CA:</p>
<ol class="arabic simple">
<li><p>Wait for the certmonger request to complete, it should end up with
CA_WORKING status</p></li>
<li><p>Check that an error was syslogged with ALERT severity</p></li>
</ol>
</li>
</ol>
</section>
<section id="id2">
<h2>Manual CA certificate renewal<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server with CA (either self-signed or signed by external
CA)</p></li>
<li><p>To renew the IPA CA certificate as self-signed:</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, if the IPA CA was not installed
self-signed, add the <code class="docutils literal notranslate"><span class="pre">--self-signed</span></code> option</p></li>
<li><p>Wait for the command to complete</p></li>
<li><p>Check that the renewed CA certificate was added to the LDAP
certificate store and to the <code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS
database</p></li>
</ol>
</li>
<li><p>To renew the IPA CA certificate as signed by external CA:</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, if the IPA CA was not installed
signed by external CA, add the <code class="docutils literal notranslate"><span class="pre">--external-ca</span></code> option</p></li>
<li><p>The command will produce a CSR file at <code class="docutils literal notranslate"><span class="pre">/var/lib/ipa/ca.csr</span></code></p></li>
<li><p>Sign the CSR file with the external CA to get the renewed CA
certificate</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code>, specify the renewed CA
certificate and external CA certificate chain files in the
<code class="docutils literal notranslate"><span class="pre">--external-cert-file</span></code> option</p></li>
<li><p>Wait for the command to complete</p></li>
<li><p>Check that the renewed CA certificate and the external CA
certificate were added to the LDAP certificate store and to the
<code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS database</p></li>
</ol>
</li>
</ol>
</section>
<section id="id3">
<h2>Manual install of CA certificate<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-cacert-manage</span> <span class="pre">install</span></code> to install the CA certificate</p></li>
<li><p>Check that the certificate was added to the LDAP certificate store</p></li>
</ol>
</section>
<section id="manual-update-of-local-ca-certificate-files">
<h2>Manual update of local CA certificate files<a class="headerlink" href="#manual-update-of-local-ca-certificate-files" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Install IPA server(s) and possibly client(s)</p></li>
<li><p>Renew or install CA certificate(s)</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ipa-certupdate</span></code> on either a server or a client</p></li>
<li><p>Check that the <code class="docutils literal notranslate"><span class="pre">/etc/ipa/nssdb</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/pki/nssdb</span></code> NSS
databases and the <code class="docutils literal notranslate"><span class="pre">/etc/ipa/ca.crt</span></code> file were updated with CA
certificates from the LDAP certificate store</p></li>
<li><p>If on a server, additionaly check that the
<code class="docutils literal notranslate"><span class="pre">/etc/dirsrv/slapd-REALM</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/httpd/alias</span></code> NSS databases
and the <code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/ca.crt</span></code> file were updated as well</p></li>
<li><p>If on a server with a CA, additionaly check that the
<code class="docutils literal notranslate"><span class="pre">/etc/pki/pki-tomcat/alias</span></code> NSS database was updated as well</p></li>
</ol>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">#</a></h2>
<p>TODO</p>
</section>
<section id="rfe-author">
<h2>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="User:Jcholast">Jan Cholasta</a></p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-ca-certificate-renewal">Automated CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-ca-certificate-renewal">Manual CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-install-of-ca-certificate">Manual install of CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shared-certificate-store">Shared certificate store</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-renewal-of-ipa-ca-certificate">Automatic renewal of IPA CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ca-certificate-management-utility">CA certificate management utility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-certificate-update-utility">Client certificate update utility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installers">Installers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Automated CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Manual CA certificate renewal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Manual install of CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-update-of-local-ca-certificate-files">Manual update of local CA certificate files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>