

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Integrating_a_Samba_File_Server_With_IPA &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Howto/Integrating_a_Samba_File_Server_With_IPA';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/Howto/Integrating_a_Samba_File_Server_With_IPA.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Integrating_a_Samba_File_Server_With_IPA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing:</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="integrating-a-samba-file-server-with-ipa">
<h1>Integrating_a_Samba_File_Server_With_IPA<a class="headerlink" href="#integrating-a-samba-file-server-with-ipa" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://www.redhat.com/archives/freeipa-users/2014-October/msg00458.html">Provided by Loris Santamaria on the freeipa-users&#64;redhat.com
list.</a></p>
<p>Samba is a popular choice for a CIFS file server in Linux and Windows
deployments, and thanks to SSSD v1.12.2+ now it is easier than ever to
integrate a Samba file server in an IPA domain, with the usual goodies
expected from IPA, such as Single Sign On and support for trusted Active
Directory users.</p>
<p><strong>NOTE</strong>: Only Kerberos authentication will work when accessing Samba
shares using this method. This means that Windows clients not joined to
Active Directory forest trusted by IPA would not be able to access the
shares. This is related to SSSD not yet being able to handle NTLMSSP
authentication.</p>
<p><strong>NOTE</strong>: When a Windows client accesses shares, Windows UI will need to
be able to resolve SIDs in access control lists. Inability to do so will
affect user experience and the way how applications are expected to work
with the share. <a class="reference external" href="https://talks.vda.li/talks/2017/SambaXP/freeipa_gc.pdf">A set of experiments in
2017</a> have
demonstrated that Microsoft does not test various fall backs around this
behavior and only consider the path used by Windows UI to communicate
with a Global Catalog service. It is also a ‘client-specific’ behavior
and thus is not subject of a protocol interoperability or being
documented anywhere. While for some applications/use cases it may work,
it will not work for many others, thus we cannot really qualify it as a
supported solution from FreeIPA side.</p>
<section id="requirements">
<h2>Requirements:<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>An IPA v3.3+ domain</p></li>
<li><p>A CentOS or RHEL 7 server, which will be configured as a Samba file
server (Fedora 21 and RHEL7.1 are preferred)</p></li>
<li><p>Optionally, one trusted AD forest</p></li>
</ul>
<p><strong>NOTE</strong>: On the IPA masters run <code class="docutils literal notranslate"><span class="pre">ipa-adtrust-install</span></code> to configure
IPA masters to handle Samba-specific object classes and attributes.
ipa-adtrust-install is part of <code class="docutils literal notranslate"><span class="pre">freeipa-server-trust-ad</span></code> package in
Fedora (<code class="docutils literal notranslate"><span class="pre">ipa-server-trust-ad</span></code> in RHEL 7 or CentOS).</p>
<p><strong>‘’IMPORTANT NOTE</strong>’’: On the samba file server it is necessary to
install <strong>sssd v1.12.2+</strong>, available in <strong>RHEL7.1/CentOS7.1</strong> or
<strong>Fedora 21</strong>. The packages sssd-libwbclient and libwbclient(from samba)
use alternatives to switch between these libraries. Packaging can be
different on other distributions and thus it needn’t work even with
sssd-libwbclient v1.12+.</p>
<ol class="arabic simple">
<li><p>Install required packages packages:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">-y</span> <span class="pre">install</span> <span class="pre">ipa-client</span> <span class="pre">sssd-libwbclient</span> <span class="pre">samba</span> <span class="pre">samba-client</span></code></p>
<ol class="arabic simple" start="2">
<li><p>join file server to the ipa realm:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa-client-install</span> <span class="pre">--mkhomedir</span></code></p>
<p><strong>NOTE</strong>: This step may fail shortly after creating the keytab and
configuring sssd, caused by the version mismatch between ipa server
(3.3) and client (4.1). If failure happens, one can complete the
configuration manually:</p>
<p><code class="docutils literal notranslate"><span class="pre">authconfig</span> <span class="pre">--enablesssdauth</span> <span class="pre">--enablemkhomedir</span> <span class="pre">--update</span></code> (on the samba
file server)</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">dnsrecord-add</span> <span class="pre">my.realm</span> <span class="pre">sambatest</span> <span class="pre">--a-rec=x.y.w.z</span></code> (on ipa server)</p>
<ol class="arabic simple" start="3">
<li><p>On the ipa server create the cifs principal for samba:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">service-add</span> <span class="pre">cifs/sambatest.my.realm</span></code></p>
<ol class="arabic simple" start="4">
<li><p>Install keytab on the samba file server:</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">ipa-getkeytab</span> <span class="pre">-s</span> <span class="pre">ipaserver.my.realm</span> <span class="pre">-p</span> <span class="pre">cifs/sambatest.my.realm</span> <span class="pre">-k</span> <span class="pre">/etc/samba/samba.keytab</span></code></p>
<ol class="arabic simple" start="5">
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/samba/smb.conf</span></code> on the samba file server:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
        <span class="n">workgroup</span> <span class="o">=</span> <span class="n">MY</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="n">MY</span><span class="o">.</span><span class="n">REALM</span>
        <span class="n">dedicated</span> <span class="n">keytab</span> <span class="n">file</span> <span class="o">=</span> <span class="n">FILE</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">samba</span><span class="o">.</span><span class="n">keytab</span>
        <span class="n">kerberos</span> <span class="n">method</span> <span class="o">=</span> <span class="n">dedicated</span> <span class="n">keytab</span>
        <span class="n">log</span> <span class="n">file</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">log</span><span class="o">.%</span><span class="n">m</span>
        <span class="n">security</span> <span class="o">=</span> <span class="n">ads</span>

<span class="p">[</span><span class="n">homes</span><span class="p">]</span>
        <span class="n">browsable</span> <span class="o">=</span> <span class="n">no</span>
        <span class="n">writable</span> <span class="o">=</span> <span class="n">yes</span>

<span class="p">[</span><span class="n">shared</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">shared</span>
        <span class="n">writable</span> <span class="o">=</span> <span class="n">yes</span>
        <span class="n">browsable</span><span class="o">=</span><span class="n">yes</span>
        <span class="n">write</span> <span class="nb">list</span> <span class="o">=</span> <span class="nd">@admins</span>
</pre></div>
</div>
<p>6) To enable samba <code class="docutils literal notranslate"><span class="pre">/home</span></code> sharing you should turn the proper selinux
boolean:</p>
<p><code class="docutils literal notranslate"><span class="pre">setsebool</span> <span class="pre">-P</span> <span class="pre">samba_enable_home_dirs</span> <span class="pre">on</span></code></p>
<ol class="arabic simple" start="7">
<li><p>restart samba</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">smb.service</span></code></p>
</section>
<section id="testing">
<h2>Testing:<a class="headerlink" href="#testing" title="Permalink to this heading">#</a></h2>
<p>On another linux member of the IPA domain it is possible to connect to
the samba shares using <code class="docutils literal notranslate"><span class="pre">smbclient</span> <span class="pre">-k</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">kinit</span> <span class="pre">user&#64;MY.REALM</span></code></p>
<p>smbclient -k -L sambatest.my.realm</p>
<p>smbclient -k //sambatest.my.realm/shared</p>
<p>On a Microsoft Windows machine member of a trusted AD domain it is
possible to connect to the samba shares by typing in the windows
explorer location bar:</p>
<p><code class="docutils literal notranslate"><span class="pre">\\sambatest.my.realm</span></code></p>
<p>Also, if the AD user is an (indirect) member of the IPA admins group,
thanks to the trust relationship and with the above sample <code class="docutils literal notranslate"><span class="pre">smb.conf</span></code>
he may have write access to the <code class="docutils literal notranslate"><span class="pre">\shared</span></code> folder.</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing:</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>