
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Authselect_migration &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Authselect_migration';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Authselect_migration.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Authselect_migration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#current-implementation">Current implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-dependency">Package dependency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-installation">Client installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-restore">Backup/restore</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-advise-plugins">ipa-advise plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-decisions">General decisions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-client-installation">New client installation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-sssd-and-noac-options">–no-sssd and –noac options</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-stack-configuration">PAM stack configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mkhomedir-option">–mkhomedir option</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nis-domain-configuration">NIS domain configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-uninstallation">Client uninstallation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-server-installation">New server installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-and-restore">Backup and restore</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#backup">Backup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restore">Restore</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">ipa-advise plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-client-for-smart-card-auth-plugin">config-client-for-smart-card-auth plugin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-fedora-authconfig-plugin">config-fedora-authconfig plugin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-plugins">other plugins</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-for-older-clients">Migration for older clients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-for-older-servers">Migration for older servers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-installations">New installations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="authselect-migration">
<h1>Authselect_migration<a class="headerlink" href="#authselect-migration" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p><strong>authselect</strong> is a new tool to configure authentication sources on a
system. It is going to replace <strong>authconfig</strong> in the future (see the
page for
<a class="reference external" href="https://fedoraproject.org/wiki/Changes/Authselect">Authselect</a> on
Fedora wiki). Since IPA is dependent on authconfig, it is required to
extend its functionality so authselect can be used when it is available.
Authselect will be a default tool in Fedora 28, authconfig command will
still be available (provided by the authselect-compat package) but its
functionality will be limited.</p>
<p>The major difference between authconfig and authselect is the use of a
configuration <strong>profile</strong>: authselect provides <strong>pre-defined profiles</strong>
that can be tuned by enabling specific <strong>features</strong>. The available
profiles can be found using <code class="docutils literal notranslate"><span class="pre">authselect</span> <span class="pre">list</span></code> and their features with
<code class="docutils literal notranslate"><span class="pre">authselect</span> <span class="pre">show</span> <span class="pre">PROFILE-ID</span></code>. For instance, the sssd profile accepts
the features with-mkhomedir or with-smartcard, and the winbind profile
accepts the feature with-mkhomedir but not with-smartcard.</p>
</section>
<section id="current-implementation">
<h2>Current implementation<a class="headerlink" href="#current-implementation" title="Link to this heading">#</a></h2>
<p>This section lists the components of FreeIPA that are currently relying
on authconfig.</p>
</section>
<section id="package-dependency">
<h2>Package dependency<a class="headerlink" href="#package-dependency" title="Link to this heading">#</a></h2>
<p>FreeIPA currently has a dependency on authconfig package (freeipa-client
package).</p>
</section>
<section id="client-installation">
<h2>Client installation<a class="headerlink" href="#client-installation" title="Link to this heading">#</a></h2>
<p>Currently authconfig is triggered during client install to:</p>
<ul class="simple">
<li><p>configure NIS. the commands below is used</p></li>
</ul>
<p>`` authconfig –nisdomain=``</p>
<ul class="simple">
<li><p>with sssd (default).</p></li>
</ul>
<p>To enable SSSD for user information and authentication:</p>
<p>`` authconfig –enablesssd –enablesssdauth``</p>
<p>To enable kerberos authentication:</p>
<p>`` authconfig –enablekrb5 –nostart``</p>
<ul class="simple">
<li><p>no_sssd (deprecated).</p></li>
</ul>
<p>To enable LDAP for user information:</p>
<p>`` authconfig –enableldap –enableforcelegacy``</p>
<p>The following ipa-client-install options have an impact on
authentication configuration:</p>
<ul class="simple">
<li><p>–nisdomain=NISDOMAIN: Set the NIS domain name as specified. By
default, this is set to the IPA domain name.</p></li>
<li><p>–no-nisdomain: Do not configure NIS domain name.</p></li>
<li><p>–no-sssd: Do not configure the client to use SSSD for
authentication, use nss_ldap instead.</p></li>
<li><p>–noac: Do not use Authconfig to modify the nsswitch.conf and PAM
configuration.</p></li>
</ul>
<p>Note that the ipa client code is using the <strong>tasks</strong> package to call
distribution-specific code: only the fedora-like distributions use
authconfig, other distributions must implement their own routines to
configure the authentication mechanisms.</p>
</section>
<section id="backup-restore">
<h2>Backup/restore<a class="headerlink" href="#backup-restore" title="Link to this heading">#</a></h2>
<p>The commands ipa-backup and ipa-restore both need to save/restore the
current configuration. ipa-backup is calling:</p>
<p>`` authconfig –savebackup ``</p>
<p>and saves the content of the backup directory in the backup file.
ipa-restore is calling</p>
<p>`` authconfig –restorebackup ``</p>
<p>to restore the saved configuration.</p>
</section>
<section id="ipa-advise-plugins">
<h2>ipa-advise plugins<a class="headerlink" href="#ipa-advise-plugins" title="Link to this heading">#</a></h2>
<p>ipa-advise command provides configuration advices for various use cases.
For instance, ipa-advise config-server-for-smart-card-auth produces a
shell script that can be executed in order to configure the server to
allow Smart Card authentication. Some of the plugins produce shell
scripts that are calling authconfig:</p>
<ul class="simple">
<li><p>ipa-advise config-client-for-smart-card-auth: Instructions for
enabling Smart Card authentication on a single FreeIPA client.</p></li>
<li><p>ipa-advise config-fedora-authconfig: Authconfig instructions for
configuring Fedora 18/19 client with IPA server without use of SSSD.</p></li>
<li><p>ipa-advise config-redhat-sssd-before-1-9: Instructions for
configuring a system with an old version of SSSD (1.5-1.8) as a
FreeIPA client.</p></li>
<li><p>ipa-advise config-redhat-nss-pam-ldapd: Instructions for configuring
a system with nss-pam-ldapd as a FreeIPA client.</p></li>
<li><p>ipa-advise config-redhat-nss-ldap: Instructions for configuring a
system with nss-ldap as a FreeIPA client.</p></li>
</ul>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
</section>
<section id="general-decisions">
<h2>General decisions<a class="headerlink" href="#general-decisions" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>As authselect may not be available on all distributions, we need to
keep the same strategy as implemented by the current code: rely on
the tasks package to have distribution-specific code. FreeIPA team
will provide code for fedora-like distributions, based on authselect
and the other distributions should not be disturbed by the changes.</p></li>
<li><p>Authselect-compat package provides an equivalent to authconfig, with
a compatibility layer for some options and deprecating other options.
Because of these deprecated options, it does not seem safe enough to
keep on using authconfig tool and the choice is made to completely
switch to using authselect. This implies that the dependency on
authconfig will be completely removed and replaced with a dependency
on authselect. Note that we will not have any dependency on
authselect-compat, meaning that FreeIPA code should not rely any more
on authconfig command.</p></li>
<li><p>It seems obvious to state that FreeIPA will use the sssd profile but
this has major consequences. Previously, it was possible to install a
client with –no-sssd or –noac options, but it will not be possible
any more for new client installations on fedora-based distributions.</p></li>
</ul>
</section>
<section id="new-client-installation">
<h2>New client installation<a class="headerlink" href="#new-client-installation" title="Link to this heading">#</a></h2>
<p>Currently, the algorithm for PAM stack configuration is the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ````
| ``authconfig --nisdomain=&lt;domain&gt;``
| ``if (sssd) then ``
| ``   authconfig --enablesssd --enablesssdauth``
| ``else ``
| ``   authconfig --enableldap --enableforcelegacy --enablekrb5 --nostart``
| ``done``
| ``if (mkhomedir) then``
| ``   authconfig --enablemkhomedir``
| ``done``
</pre></div>
</div>
<section id="no-sssd-and-noac-options">
<h3>–no-sssd and –noac options<a class="headerlink" href="#no-sssd-and-noac-options" title="Link to this heading">#</a></h3>
<p>With the migration to authselect and the choice of using sssd profile,
we will now refuse the –no-sssd and -noac options for fedora-based
distributions. This can be achieved by adding a tasks method (i.e. with
a distribution-specific implementation) is_nosssd_supported(), and a
check in the client installer that refuses the option in case
is_nosssd_supported returns False.</p>
</section>
<section id="pam-stack-configuration">
<h3>PAM stack configuration<a class="headerlink" href="#pam-stack-configuration" title="Link to this heading">#</a></h3>
<p>Calls to the authconfig tool are completely replaced by calls to
authselect, picking the sssd profile. PAM configuration steps are moved
into a separate class following bridge oop pattern. All related code is
under ipaplatform/redhat/authconfig.py, ensuring that only fedora-based
distributions are impacted by the modifications.</p>
</section>
<section id="mkhomedir-option">
<h3>–mkhomedir option<a class="headerlink" href="#mkhomedir-option" title="Link to this heading">#</a></h3>
<p>The homedir creation can also be enabled with authselect with:
<code class="docutils literal notranslate"><span class="pre">authselect</span> <span class="pre">select</span> <span class="pre">sssd</span> <span class="pre">with-mkhomedir</span></code>.</p>
</section>
<section id="nis-domain-configuration">
<h3>NIS domain configuration<a class="headerlink" href="#nis-domain-configuration" title="Link to this heading">#</a></h3>
<p>Authconfig is currently used in the client installer to configure the
NIS domain. It is also possible to configure the NIS domain without a
call to authconfig tool, by <a class="reference external" href="https://access.redhat.com/articles/2278">direct modification of a config
file</a>. This is the chosen
approach: append (or replace) the <code class="docutils literal notranslate"><span class="pre">NISDOMAIN=value</span></code> line in the file
/etc/sysconfig/network.</p>
</section>
</section>
<section id="client-uninstallation">
<h2>Client uninstallation<a class="headerlink" href="#client-uninstallation" title="Link to this heading">#</a></h2>
<p>The client uninstallation needs to revert the system to the same state
as before client install. In order to do this, the client installation
will store the profile used pre-installation in the system store
(/var/lib/ipa-client/sysrestore/sysrestore.state) with the following
format:</p>
<div class="line-block">
<div class="line">`` [authselect]``</div>
<div class="line">`` profile=``</div>
<div class="line">`` features_list=``</div>
</div>
<p>Profile and features_list will be used to revert to the previous state
during uninstallation.</p>
<p>Note: When the client was installed with the authconfig tool, the system
store does not contain this information. In this case, the uninstaller
will simply warn that it is not able to revert to the exact state before
installation and will apply the default authselect profile, namely the
sssd profile without any feature.</p>
</section>
<section id="new-server-installation">
<h2>New server installation<a class="headerlink" href="#new-server-installation" title="Link to this heading">#</a></h2>
<p>The server-specific install code is not impacted by this migration (only
the client-part of the installation is).</p>
</section>
<section id="backup-and-restore">
<h2>Backup and restore<a class="headerlink" href="#backup-and-restore" title="Link to this heading">#</a></h2>
<section id="backup">
<h3>Backup<a class="headerlink" href="#backup" title="Link to this heading">#</a></h3>
<p>The authselect tool offers the “current” command to retrieve the current
configuration (profile and enabled features). For instance:</p>
<div class="line-block">
<div class="line">`` $ authselect current –raw``</div>
<div class="line">`` sssd with-mkhomedir``</div>
</div>
<p>The ipa-backup command needs to use this command to save the current
configuration inside a new file in the backup directory.</p>
</section>
<section id="restore">
<h3>Restore<a class="headerlink" href="#restore" title="Link to this heading">#</a></h3>
<p>Note: only full restore is impacted by this feature. Data-only restore
does not touch the authentication configuration.</p>
<p>The ipa-restore command needs to read the saved configuration from the
backup directory and re-apply the same configuration using</p>
<p>`` $ authselect select <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` ``\</span> <span class="pre">`` --force</span></code></p>
<p>Note: if the backup was done on a server *before* the migration to
authselect, the ipa-restore will detect that restore is trying to
restore data from a different release and prompt for user confirmation
with a warning. Unattended restore will fail.</p>
</section>
</section>
<section id="id1">
<h2>ipa-advise plugins<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<section id="config-client-for-smart-card-auth-plugin">
<h3>config-client-for-smart-card-auth plugin<a class="headerlink" href="#config-client-for-smart-card-auth-plugin" title="Link to this heading">#</a></h3>
<p>This plugin configures a FreeIPA client for smart card authentication.
Instead of calling</p>
<p>`` authconfig –enablesssd –enablesssdauth –enablesmartcard ‘ ‘–smartcardmodule=sssd –smartcardaction=1 –updateall``</p>
<p>the plugin must use</p>
<p>`` authselect enable-feature with-smartcard``</p>
</section>
<section id="config-fedora-authconfig-plugin">
<h3>config-fedora-authconfig plugin<a class="headerlink" href="#config-fedora-authconfig-plugin" title="Link to this heading">#</a></h3>
<p>This plugin configures Fedora 18/19 client without the use of sssd.
These versions are not suppported any more and the plugin can be
dropped.</p>
</section>
<section id="other-plugins">
<h3>other plugins<a class="headerlink" href="#other-plugins" title="Link to this heading">#</a></h3>
<p>The other plugins (config-redhat-sssd-before-1-9,
config-redhat-nss-pam-ldapd and config-redhat-nss-ldap) are related to
RHEL 5, where authselect will not be available. The scripts produced by
ipa-advise can be generated on a recent FreeIPA server and run on a
RHEL5 system, meaning that we can keep them.</p>
</section>
</section>
<section id="upgrade">
<h2>Upgrade<a class="headerlink" href="#upgrade" title="Link to this heading">#</a></h2>
<section id="migration-for-older-clients">
<h3>Migration for older clients<a class="headerlink" href="#migration-for-older-clients" title="Link to this heading">#</a></h3>
<p>Client upgrade will not modify the configuration since the PAM stack
configuration is already in place.</p>
</section>
<section id="migration-for-older-servers">
<h3>Migration for older servers<a class="headerlink" href="#migration-for-older-servers" title="Link to this heading">#</a></h3>
<p>The server has to be migrated to authselect to make sure that backup and
restore code works properly for new servers and also for older servers.
If no migration was implemented, this would imply that backup/restore
code must be able to handle 2 different types of configurations (with
authconfig or with authselect), leading to a maintenance nightmare.
Because of this, the choice is made to migrate the configuration to an
authselect profile during the upgrade.</p>
<p>The ipa-server-upgrade tool will perform the migration to an authselect
profile. It needs to take care of the following points:</p>
<ul class="simple">
<li><p>check if the server was initially installed with the flag –mkhomedir
(by reading the content of the system store). In this case, the sssd
profile with enable-mkhomedir option must be selected. Otherwise use
the sssd profile without the option.</p></li>
<li><p>update the configuration backed up in the system store
(/var/lib/ipa-client/sysrestore/sysrestore.state). The system store
may contain</p></li>
</ul>
<div class="line-block">
<div class="line">`` [authconfig]``</div>
<div class="line">`` mkhomedir=…``</div>
<div class="line">`` ldap=…``</div>
<div class="line">`` krb5=…``</div>
<div class="line">`` sssd=…``</div>
<div class="line">`` sssdauth=…``</div>
</div>
<p>and this would have to be replaced with</p>
<div class="line-block">
<div class="line">`` [authselect]``</div>
<div class="line">`` profile=sssd``</div>
<div class="line">`` mkhomedir=…``</div>
</div>
</section>
</section>
<section id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<p>As this migration is mainly internal, it will not modify the interfaces
as seen by a user or system administrator, except for the use of
–no-sssd or –noac options in ipa-client-install (which will now be
refused on fedora-based distributions).</p>
<p>A careful user may notice the presence of a new directory
/etc/authselect created during the authselect package installation,
containing /etc/authselect/authselect.conf file storing the current
profile and features:</p>
<div class="line-block">
<div class="line">`` $ cat /etc/authselect/authselect.conf ``</div>
<div class="line">`` sssd``</div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>The tests need to focus on 2 main parts, new installations and upgrades.
They can be run on fedora-based distributions.</p>
</section>
<section id="id2">
<h2>Upgrade<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>upgrade must keep the mkhomedir flag (if the server was installed
with –mkhomedir, then the authselect config obtained after upgrade
must also have this option)</p></li>
<li><p>backup and restore must still be working after the upgrade</p></li>
<li><p>uninstall must still be working after the upgrade (potentially with a
warning if the client was installed with authconfig).</p></li>
</ul>
</section>
<section id="new-installations">
<h2>New installations<a class="headerlink" href="#new-installations" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>new client installation must install the sssd profile, with or
without the with-mkhomedir feature (depending on the presence of
–mkhomedir flag)</p></li>
<li><p>ipa-client-install must refuse the –no-sssd and –noac options with
a meaningful error message</p></li>
<li><p>client install / uninstall must revert to the previous authselect
profile</p></li>
<li><p>new server installation must install the sssd profile, with or
without the with-mkhomedir feature (depending on the presence of
–mkhomedir flag)</p></li>
<li><p>backup/restore must work with a new server installation</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#current-implementation">Current implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-dependency">Package dependency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-installation">Client installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-restore">Backup/restore</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-advise-plugins">ipa-advise plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-decisions">General decisions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-client-installation">New client installation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-sssd-and-noac-options">–no-sssd and –noac options</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-stack-configuration">PAM stack configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mkhomedir-option">–mkhomedir option</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nis-domain-configuration">NIS domain configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-uninstallation">Client uninstallation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-server-installation">New server installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-and-restore">Backup and restore</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#backup">Backup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restore">Restore</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">ipa-advise plugins</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-client-for-smart-card-auth-plugin">config-client-for-smart-card-auth plugin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config-fedora-authconfig-plugin">config-fedora-authconfig plugin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-plugins">other plugins</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-for-older-clients">Migration for older clients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-for-older-servers">Migration for older servers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-installations">New installations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>