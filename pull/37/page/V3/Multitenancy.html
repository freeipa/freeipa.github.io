
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Multitenancy &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V3/Multitenancy';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V3/Multitenancy.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multitenancy</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Multitenancy</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-status">IPA Status</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#required-changes">Required Changes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-server-dit-layout">Directory Server DIT Layout</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-api">New API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-server-plugins">Directory Server Plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseldap-plugin">BaseLDAP plugin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kerberos">Kerberos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dns">DNS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-authority">Certificate Authority</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-client">IPA-CLIENT</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="multitenancy">
<h1>Multitenancy<a class="headerlink" href="#multitenancy" title="Link to this heading">#</a></h1>
</section>
<section id="description">
<h1>Description<a class="headerlink" href="#description" title="Link to this heading">#</a></h1>
<p>Multi-tenancy is an aspect of Identity Management (IdM) where multiple
parties use the same resource without learn any information about each
other. The example is two rival companies who both operate servers
hosted in a public cloud. Neither company should be aware of the
existance of the other users presence in the web using, and they
definitely should not be able to enumerate either the users or the hosts
of the other company due to information leaks inside the cloud services.</p>
<p>The entities stored under each tenant have a relatively high likelihood
of reusing the same names. User names and group names are often have a
high number of names that are commonly used. For example, both companies
might have someone with the user name of asmith and a group named
developers. However, in the first company, asmith has a UID of 512 and
developers has a GID of 2100, but in the other company asmith has a UID
of 87687 and developers has a GID of 6332. Both need to exist in the IdM
server and be distinguishable from the other.</p>
<section id="ipa-status">
<h2>IPA Status<a class="headerlink" href="#ipa-status" title="Link to this heading">#</a></h2>
<p>IPA currently has a completely flat data model. All data is stored in
two instances: one for the IPA user and host database, and one for the
PKI CA. The Kerberos server would only serve out tickets for a single
domain. The Directory server has the vast majority of its data open read
only available to anonymous binds. The user Admin has full control over
the entire set of entites in the system.</p>
<p>FreeIPA stores the data it manages inside a Directory Server (389)
instance in a subtree that, by default, mirrors the domain name of the
server. Thus the server ipa.example.com would store in the subtree
cn=example,cn=com. The layout of this subtree will be referred to as the
current Directory Information Tree (DIT) Layout. The database suffix of
the subtree will be referred to as the current baseDN.</p>
<p>In addition, each IPA server manages a Kerberos Realm. By default the
name of the realm matches the domain name, but in all capitals. The zone
example.com would have a corresponding realm EXAMPLE.COM.</p>
</section>
</section>
<section id="required-changes">
<h1>Required Changes<a class="headerlink" href="#required-changes" title="Link to this heading">#</a></h1>
<p>These are the changes necessary to the FreeIPA server to support a cloud
deployment and multi-tenancy.</p>
<section id="directory-server-dit-layout">
<h2>Directory Server DIT Layout<a class="headerlink" href="#directory-server-dit-layout" title="Link to this heading">#</a></h2>
<p>Each tenant in the Identity Management system would be limited to a
subtree named after the tenant: cn={TENANT},cn=tenants,$suffix. This
subtree would have a DIT Layout similar to the main DIT Layout; it will
include all identity related subtrees necessary to create users, groups
and tenant specific policies (HBAC, SUDO etc…) . The initial
(undeletable) suffix is the Identity Infrastructure Owner and used for
the management of the tenants. The other subtrees will be referred to as
tenant trees.</p>
<p>When performing an action in the IPA server, the user is identified by
their principal, which contains the Kerberos Realm name. This can be
used to distinguish which domain, and by extension, which subtree, the
action should use for data. Operations are limited to the current tenant
subtree. Cloud administrators will need the ability to explicitly
specify a tenant in order to perform maintenance operations on the
tenants.</p>
<p>The directory will no longer be world readable. Instead, ACIs will limit
the users ability to read only the subtree in which they are enrolled.
LDAP operations will require an authenticated bind.</p>
<p>When updating FreeIPA, DIT layout changes changes need to be applied to
each of the the tenant trees. However the DIT should not and cannot
really change, as that would tend to break tenant configurations if you
do. Additions can be made but they should be very limited and optional.
Instead FreeIPA should allow tenants to opt-in in new features when that
involves touching their subtree rather then forcing it on them.</p>
</section>
<section id="new-api">
<h2>New API<a class="headerlink" href="#new-api" title="Link to this heading">#</a></h2>
<p>ipa run-as will be used by the administrative users to run commands for
a tenat. For example, to add a user to a tenant named “community”:</p>
<p>ipa run-as community user-add gwashington –first George –last
Washington</p>
<p>The implementation should follow the techniques used by the batch
command in ipalib/plugins/batch.py.</p>
</section>
<section id="directory-server-plugins">
<h2>Directory Server Plugins<a class="headerlink" href="#directory-server-plugins" title="Link to this heading">#</a></h2>
<p>Some configuration changes will need to be made around a number of the
Directory Server plug-ins with regards to scope. We will likely need
separate configuration entries to restrict the plug-ins to each tenant
subtree. This includes the following plug-ins (and maybe others as
well):</p>
<ol class="arabic simple">
<li><p>memberOf</p></li>
<li><p>DNA</p></li>
<li><p>Managed Entries</p></li>
<li><p>Auto-Membership</p></li>
<li><p>Attribute Uniqueness</p></li>
</ol>
</section>
<section id="baseldap-plugin">
<h2>BaseLDAP plugin<a class="headerlink" href="#baseldap-plugin" title="Link to this heading">#</a></h2>
<p>Instead of just reading the BaseDN out of the configuration file, the
base DN needs to be calculated based on the Kerberos principal of the
calling user. This value should be cached in the WSGI application so
that it does not always require multiple round trips to the LDAP server.</p>
</section>
<section id="kerberos">
<h2>Kerberos<a class="headerlink" href="#kerberos" title="Link to this heading">#</a></h2>
<p>Each tenant would get its own Kerberos Realm, but each would trust the
Cloud Provider’s realm. The httpd/mod_auth_kerberos needs to be capable
of accepting new realms. When adding a new tenant, we might need to
update krb5.conf on the IPA server to know about the new realm.</p>
</section>
<section id="dns">
<h2>DNS<a class="headerlink" href="#dns" title="Link to this heading">#</a></h2>
<p>The BIND DynDB back end code would need to be extended to read zone
information from multiple subtrees in order to read the DNS entires in
the tenant trees.</p>
<p>It is also possible to keep the current approach, and then add the
ability to identify which users and tenants can manage and control DNS
entries. The simpler solution is to modify BIND Dyn DB.</p>
</section>
<section id="certificate-authority">
<h2>Certificate Authority<a class="headerlink" href="#certificate-authority" title="Link to this heading">#</a></h2>
<p>We would continue to have only one CA, and have IPA submit all
Certificate requests as a single Agent. The IPA server will ensure that
a user can only request certificates for entities within their own
subtree.</p>
</section>
<section id="ipa-client">
<h2>IPA-CLIENT<a class="headerlink" href="#ipa-client" title="Link to this heading">#</a></h2>
<p>When enrolling a host, the principal used to authenticate with the IPA
server will determine which subtree will hold host. This involves
changing the LDAP configuration information in the following client
components:</p>
<ol class="arabic simple">
<li><p>SSSD</p></li>
<li><p>nss_ldap</p></li>
<li><p>Kerberos.</p></li>
</ol>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Multitenancy</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-status">IPA Status</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#required-changes">Required Changes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-server-dit-layout">Directory Server DIT Layout</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-api">New API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-server-plugins">Directory Server Plugins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#baseldap-plugin">BaseLDAP plugin</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kerberos">Kerberos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dns">DNS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certificate-authority">Certificate Authority</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-client">IPA-CLIENT</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>