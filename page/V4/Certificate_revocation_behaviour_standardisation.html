
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Certificate_revocation_behaviour_standardisation &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Certificate_revocation_behaviour_standardisation';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Certificate_revocation_behaviour_standardisation.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Certificate_revocation_behaviour_standardisation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Certificate_revocation_behaviour_standardisation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#terminology">Terminology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-guidelines">Design guidelines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#issuance-of-a-new-certificate-non-renewal">Issuance of a new certificate (non-renewal)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renewal-due-to-impending-expiry">Renewal due to impending expiry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renewal-for-other-reasons">Renewal for other reasons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revocation-without-renewal">Revocation without renewal</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cert-request"><code class="docutils literal notranslate"><span class="pre">cert-request</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-from-current-behaviour">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-mod"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-mod</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-remove-cert"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-remove-cert</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-del-disable"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-{del,disable}</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-cert-revoke"><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">cert-revoke</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certmonger">Certmonger</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Differences from current behaviour</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="certificate-revocation-behaviour-standardisation">
<h1>Certificate_revocation_behaviour_standardisation<a class="headerlink" href="#certificate-revocation-behaviour-standardisation" title="Link to this heading">#</a></h1>
</section>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h1>
<p>In the past, FreeIPA automatically revoked certificates upon renewal.
This behaviour was acceptable when the <em>one certificate per service</em> was
the only thing that was possible.</p>
<p>With the implementation of <a class="reference external" href="V4/Certificate%20Profiles">custom certificate
profiles</a> and <a class="reference external" href="V4/User%20Certificates">user
certificates</a>, it was decided to stop
revoking certificates upon renewal. Because of the possibility of
multiple certificates (for different purposes) per principal, it was not
always known which certificate should be revoked. Revocation list growth
was also a concern.</p>
<p>This change in behaviour continues to confuse users and developers. For
example, <a class="reference external" href="https://pagure.io/freeipa/issue/7482">https://pagure.io/freeipa/issue/7482</a> was filed, suggesting the
lack of revocation of the old certificate upon renewal was a regression.
A patch and <a class="reference external" href="https://github.com/freeipa/freeipa/pull/1915#issuecomment-388295460">pull
request</a>
were created before, in the ensuing discussion, it was discovered that
this was the intended behaviour. This episode prompted a debate about
what our certificate revocation behaviour should be.</p>
<p>The purpose of this design is to formalise what FreeIPA’s certificate
revocation behaviour(s) should be (being the canonical reference for
such behaviour), and to outline any changes necessary to implement the
behaviour(s).</p>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Link to this heading">#</a></h2>
<dl class="simple">
<dt><em>IPA-managed CA</em></dt><dd><p>The IPA CA, any lightweight CA hosted in the Dogtag instance, or any
other CA that FreeIPA can cause to revoke certificates.</p>
</dd>
</dl>
</section>
<section id="design-guidelines">
<h2>Design guidelines<a class="headerlink" href="#design-guidelines" title="Link to this heading">#</a></h2>
<p>The following guidelines inform this design. They are important
considerations, not unbreakable rules. Deviations should be justified.</p>
<ul class="simple">
<li><p>Command behaviour should be consistent across use cases. For example,
a command should not revoke a certificate in some circumstances but
not others (unless explicitly told to do so).</p></li>
<li><p>Similar commands for different principal types should have similar
behaviour. For example, if <code class="docutils literal notranslate"><span class="pre">service-disable</span></code> revokes certificates,
then <code class="docutils literal notranslate"><span class="pre">user-disable</span></code> should revoke certificates.</p></li>
<li><p>Specialised behaviour should belong to specialised commands. For
example, a general command for manipulating LDAP objects should not
have specialised behaviours for some attributes, such as revoking
removed <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> values.</p></li>
<li><p>Multiple simpler commands are better than single commands with
complex behaviour and many options. Yes, it might mean an
administrator has to type more commands. But automation reduces that
concern, and it is easier for the administrator to get it right.</p></li>
<li><p>Ideally, there should be a single command to accomplish a given
action. Administrators should not have to ask <em>“should I use
service-mod or service-remove-cert?”</em></p></li>
</ul>
</section>
<section id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Link to this heading">#</a></h2>
<p><strong>Hosts and services can have multiple certificates.</strong> The common case
is when host or services principals only need one certificate. Although
it may seem desirable to automatically revoke an old certificate when it
is renewed, in the general case where a subject principal can have
multiple certificates, it is not decidable which of their existing
certificates is being renewed (and should be revoked, removed).</p>
<p><strong>A certificate is included in the ``userCertificate`` attribute of at
most one principal.</strong> In this design we ignore the possibility of a
single <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute value occurring on multiple
principals. This situation does not arise in normal use.</p>
</section>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h1>
<section id="issuance-of-a-new-certificate-non-renewal">
<h2>Issuance of a new certificate (non-renewal)<a class="headerlink" href="#issuance-of-a-new-certificate-non-renewal" title="Link to this heading">#</a></h2>
<p>A host, service or user certificate is being requested for some new
purpose. The subject may already have certificates for other purposes.
Existing certificates <em>must not be revoked</em>.</p>
</section>
<section id="renewal-due-to-impending-expiry">
<h2>Renewal due to impending expiry<a class="headerlink" href="#renewal-due-to-impending-expiry" title="Link to this heading">#</a></h2>
<p>A certificate is requested to renew an existing certificate. After the
new certificate is issued, it does no harm to revoke the old
certificate. But it is <em>not necessary to revoke</em> the old certificate,
because it will soon expire.</p>
</section>
<section id="renewal-for-other-reasons">
<h2>Renewal for other reasons<a class="headerlink" href="#renewal-for-other-reasons" title="Link to this heading">#</a></h2>
<p>A certificate could be renewed before its expiration time is near, for
any reason (e.g. re-key due to compromise, add a Subject Alternative
Name, etc.) As a simplifying assumption, we’ll treat all revocation
reasons the same way. It is therefore <em>necessary to revoke</em> the
certificate that is being replaced (and only that certificate).</p>
</section>
<section id="revocation-without-renewal">
<h2>Revocation without renewal<a class="headerlink" href="#revocation-without-renewal" title="Link to this heading">#</a></h2>
<p>A certificate (or its subject) may cease operation such that revocation
is required. If a single certificate requires revocation, in the common
case, it should also be removed from the subject’s <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code>
attribute (if present). If the principal is being disabled or deleted,
all of its certificates should be revoked, whether it is a host, service
or user principal.</p>
<p><strong>TODO</strong> is there any case where an administrator would want to
disable/preserve a user but <em>not revoke certificates</em>?</p>
</section>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h1>
<section id="cert-request">
<h2><code class="docutils literal notranslate"><span class="pre">cert-request</span></code><a class="headerlink" href="#cert-request" title="Link to this heading">#</a></h2>
<p>Based on the use cases above, requesting a new certificate is
<em>sometimes</em> associated with a desire to revoke <em>one</em> certificate.
Revocation as a default behaviour is wrong.</p>
<p>Could we make <code class="docutils literal notranslate"><span class="pre">cert-request</span></code> smart enough to guess what it should do?
Fuzzy heuristics that could be employed to make a guess, e.g. by
examining certificate attributes, validity period, the subject public
key, the profile and CA that were used, and so on. The guessing logic
would be complex, and could not guarantee a correct answer. It is not
the right approach.</p>
<p>Keeping in mind the desire for consistent behaviour of commands, and the
fact that <code class="docutils literal notranslate"><span class="pre">cert-request</span></code> is already a complicated command, the correct
behaviour is for <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">cert-request</span></code> to <strong>never revoke any
certificate</strong>, nor remove any <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute value from
the subject principal’s entry.</p>
</section>
<section id="differences-from-current-behaviour">
<h2>Differences from current behaviour<a class="headerlink" href="#differences-from-current-behaviour" title="Link to this heading">#</a></h2>
<p>None.</p>
</section>
<section id="host-service-user-mod">
<h2><code class="docutils literal notranslate"><span class="pre">{host,service,user}-mod</span></code><a class="headerlink" href="#host-service-user-mod" title="Link to this heading">#</a></h2>
<p>Removal of a <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute value <strong>shall not revoke the
certificate</strong>.</p>
<p>Rationale: The <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> command already provides revocation
behaviour. Non-IPA-managed certificates cannot be revoked by FreeIPA, so
revoking IPA-managed certificates violates the consistency guideline.
Not all certificates that need revocation will appear in the subject’s
<code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute (e.g. if the profile does not store
certificates), so explicit <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> is still needed. Furthermore,
forcing the operator to use <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> allows them to specify a
revocation reason.</p>
</section>
<section id="id1">
<h2>Differences from current behaviour<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Revocation behaviour needs to be removed from the <code class="docutils literal notranslate"><span class="pre">service-mod</span></code> and
<code class="docutils literal notranslate"><span class="pre">host-mod</span></code> commands. (<strong>Backwards compatibility concern.</strong>)</p>
</section>
<section id="host-service-user-remove-cert">
<h2><code class="docutils literal notranslate"><span class="pre">{host,service,user}-remove-cert</span></code><a class="headerlink" href="#host-service-user-remove-cert" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">{host,service,user}-remove-cert</span></code> commands <strong>shall not revoke
certificates</strong>.</p>
<p>Rationale: The <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> command already provides revocation
behaviour. Non-IPA-managed certificates cannot be revoked by FreeIPA, so
revoking IPA-managed certificates violates the consistency guideline.
Not all certificates that need revocation will appear in the subject’s
<code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute (e.g. if the profile does not store
certificates), so explicit <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> is still needed. Furthermore,
forcing the operator to use <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> allows them to specify a
revocation reason.</p>
</section>
<section id="id2">
<h2>Differences from current behaviour<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>Revocation behaviour needs to be removed from the
<code class="docutils literal notranslate"><span class="pre">service-remove-cert</span></code> and <code class="docutils literal notranslate"><span class="pre">host-remove-cert</span></code> commands. (<strong>Backwards
compatibility concern.</strong>)</p>
</section>
<section id="host-service-user-del-disable">
<h2><code class="docutils literal notranslate"><span class="pre">{host,service,user}-{del,disable}</span></code><a class="headerlink" href="#host-service-user-del-disable" title="Link to this heading">#</a></h2>
<p>When deleting or disabling a user, host or service it makes sense to
revoke certifiates. (<strong>QUESTION</strong> counterexamples?) Should
<code class="docutils literal notranslate"><span class="pre">{host,service,user}-{del,disable}</span></code> revoke certificates, or not?</p>
<p>Points in favour:</p>
<ul class="simple">
<li><p>Unlike other commands that deal with individual certificates, there
is no alternative command for revoking <em>all of a principal’s
certificates</em>. Command proliferation is undesirable.</p></li>
<li><p>This is the current behaviour for the <code class="docutils literal notranslate"><span class="pre">host-</span></code> and <code class="docutils literal notranslate"><span class="pre">service-</span></code>
commands. Fewer behavioural changes are required.</p></li>
</ul>
<p>Points against:</p>
<ul class="simple">
<li><p>A principal may have a mix of IPA-managed and non-IPA-managed
certificates. IPA cannot revoke the latter. This violates the
consistency guideline.</p></li>
</ul>
<p>The decided behaviour is that these commands <strong>shall revoke all
IPA-managed certificates</strong> and, for the <code class="docutils literal notranslate"><span class="pre">-disable</span></code> and
<code class="docutils literal notranslate"><span class="pre">user-del</span> <span class="pre">--preserve</span></code> commands, <strong>all IPA-managed certificates shall
be removed from the entry</strong>. The revocation reason shall be
<code class="docutils literal notranslate"><span class="pre">unspecified</span></code>.</p>
<p>Command output shall be updated to advise of any non-IPA-managed
certificates, so that an administrator may take appropriate actions.</p>
</section>
<section id="id3">
<h2>Differences from current behaviour<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">user-del</span></code> and <code class="docutils literal notranslate"><span class="pre">user-disable</span></code> commands need to have the
revocation behaviour implemented.</p>
<p>The affected commands need to be enhanced to report the non-IPA-managed
certificates.</p>
</section>
<section id="ipa-cert-revoke">
<h2><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">cert-revoke</span></code><a class="headerlink" href="#ipa-cert-revoke" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code> command shall revoke the nominated certificate. It
shall not remove the revoked certificate from LDAP entries.</p>
</section>
<section id="id4">
<h2>Differences from current behaviour<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>None.</p>
</section>
<section id="certmonger">
<h2>Certmonger<a class="headerlink" href="#certmonger" title="Link to this heading">#</a></h2>
<p>Unlike the <code class="docutils literal notranslate"><span class="pre">cert-request</span></code> command, Certmonger renewal helpers have
precise knowledge of the certificate being renewed. It is also the case
that for any renewal performed via Certmonger, it is either desirable to
revoke the certificate (e.g. key rotation due to compromise), or it is
not a significant operational concern to revoke the certificate (e.g.
renewal due to impending expiry; the revoked certificate appear on CRL
only for a short time).</p>
<p>Therefore the <code class="docutils literal notranslate"><span class="pre">ipa</span></code> renewal helper <strong>shall revoke the superseded
certificate</strong> after successful issuance of a new certificate.</p>
<p>Furthermore, the accumulation of <code class="docutils literal notranslate"><span class="pre">userCertificate</span></code> attribute values in
principal entries where short-lived certificates are used is a known
pain point. Therefore, Certmonger <strong>shall remove the superseded
certificate from the principal’s entry</strong>.</p>
<p><strong>QUESTION</strong> is this actually a good idea? What are customer
expectations? If you’re rekeying due to compromise, surely it is not too
much a burden to <code class="docutils literal notranslate"><span class="pre">getcert</span> <span class="pre">rekey</span></code> <em>and</em> <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">cert-revoke</span></code>?</p>
</section>
<section id="id5">
<h2>Differences from current behaviour<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ipa</span></code> renewal helper needs to be updated to invoke <code class="docutils literal notranslate"><span class="pre">cert-revoke</span></code>
and <code class="docutils literal notranslate"><span class="pre">{user,host,service}-remove-cert</span></code> (or equivalent) after a
successfull renewal.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h1>
<p>TODO</p>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Link to this heading">#</a></h1>
<p>There are no management knobs for controlling the revocation behaviour.</p>
</section>
<section id="upgrade">
<h1>Upgrade<a class="headerlink" href="#upgrade" title="Link to this heading">#</a></h1>
<p>No specific upgrade steps are required.</p>
<p>Behavioural changes need to be prominently and clearly outlined in
release notes. Changes in revocation behaviour could catch users off
guard. It is important not to rush any changes through. We’ll need to
engage with our user base to explain the changes, and outline steps to
preserve the existing revocation behaviour if so desired.</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">#</a></h1>
<p>TODO</p>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Certificate_revocation_behaviour_standardisation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#terminology">Terminology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-guidelines">Design guidelines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#issuance-of-a-new-certificate-non-renewal">Issuance of a new certificate (non-renewal)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renewal-due-to-impending-expiry">Renewal due to impending expiry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renewal-for-other-reasons">Renewal for other reasons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revocation-without-renewal">Revocation without renewal</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cert-request"><code class="docutils literal notranslate"><span class="pre">cert-request</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-from-current-behaviour">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-mod"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-mod</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-remove-cert"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-remove-cert</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#host-service-user-del-disable"><code class="docutils literal notranslate"><span class="pre">{host,service,user}-{del,disable}</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipa-cert-revoke"><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">cert-revoke</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Differences from current behaviour</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#certmonger">Certmonger</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Differences from current behaviour</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>