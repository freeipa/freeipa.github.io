

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>chronyd_support &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/ntpd_deprecation/chronyd_support';</script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/page/V4/ntpd_deprecation/chronyd_support.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>chronyd_support</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="chronyd-support">
<h1>chronyd_support<a class="headerlink" href="#chronyd-support" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>While using Single-Sign-on authentication provided via an
<a class="reference external" href="http://web.mit.edu/kerberos/">MIT</a>
<a class="reference external" href="http://en.wikipedia.org/wiki/Kerberos_%28protocol%29">Kerberos</a> KDC
there must not be any significant clock skew between server and clients
so a time synchronization service is required.</p>
<p>When FreeIPA started there was only ntpd that offered hooks to sign NTP
packets using kerberos keys. Now as the change is required we think
about chronyd as replacement for ntpd as there will not be a ntpd in new
fedora releases.</p>
<p>FreeIPA server supports only a configuration of ntpd. ntpd is being
deprecated in Fedora 28 therefore IPA must deprecate it as well. FreeIPA
needs network time synchronization to have all clients and servers
synchronized because of time based services so there should be
replacement for it.</p>
<p>NTP - network time protocol ntpd, chronyd - time service implementations
based on NTP</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>ipa-{server,replica}-install</p></li>
</ul>
<p>Install first check for NTP services already running and disable all in
favor of ntpd. After this check if there is NO option -N set installer
will force ntpd configuration. It alters ntpd configuration file enable
service and add record to LDAP.</p>
<ul class="simple">
<li><p>ipa-client-install</p></li>
</ul>
<p>FreeIPA client install first tries to configure itself as client to
existing ntpd instance on network. Same behavior can be reproduced by
chrony.</p>
<p>With -N FreeIPA is not configuring ntpd server nor client. Option
–force-ntp is now used to disable any other NTP services.</p>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h2>
<p>The idea of ntpd replacement with <em>chronyd</em> played with idea not using
FreeIPA as NTP server but only as NTP client.</p>
<p>Installer deprecates –force-ntp option and forces chronyd service by
default if there is any conflicting time service running on host.</p>
<p>Unless we do not specify the -N option described down below FreeIPA
installer will enable chronyd daemon with respective client
configuration (default or user-defined).</p>
<p>Installer used with -N option will not configure chronyd nor enable
chronyd service if it is not running. This option should be used in case
administrator would like to have other NTP service than chronyd.</p>
<ul class="simple">
<li><p><strong>Dependencies</strong>:</p>
<ul>
<li><ul>
<li><p>ntpd</p></li>
</ul>
</li>
<li><ul>
<li><p>chrony</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>File ipaclient/install/ntpconf.py has been replaced with
ipaclient/install/timeconf.py. The configuration of chronyd service
handled by methods in the ipaclient/install/timeconf.py file and it is
done same way in client and master installation using Augeas tool.</p>
<p>Note that different StateStores for chronyd in {master, replica DL0} and
{replica DL1} are used. This is caused by installation of master using
master’s StateStore and client using client’s StateStore.</p>
<p>Due to change that FreeIPA is no longer a NTP server providing clock
only client the removal of the NTP server role from the FreeIPA has been
done. There is no need for instalation to add _ntp._udp record with the
FreeIPA master’s hostname to DNS as well.</p>
<p>If there is not specified –ntp-server option and no –ntp-pool option
as well the FreeIPA installer will try use autodiscovery for _ntp._udp
record in DNS and configure chrony with discovered server address. When
DNS has no _ntp._udp record default chrony configuration will be used.</p>
<p>The –ntp-server (knob ntp_servers) is used to specify a exactly one
time server and may be used multiple times. The –ntp-pool option is
meant to be pool of multiple servers resolved as one hostname. This
pool’s servers may vary but pool address will be still same and chronyd
daemon will choose only one server randomly from this pool.</p>
<p>After succesfull configuration of chrony client we run waitsync to
synchronize with given time source.</p>
<p>Note that FreeIPA will force chronyd service therefore disable any other
conflicting time synchronization daemon when the -N option is not used.</p>
<p>All changes related to –force-ntp option and ntpd replacement should be
reflected into man pages.</p>
<p>CLI</p>
<p>The ipa-{server,replica}-install did not support the –ntp-server option
so support has been added with the new option –ntp-pool as well. The
ipa-client-install supports the new option –ntp-pool as well Overview
of the CLI commands. Example:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Options</p></th>
<th class="head"><p>Behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ipa-server-install</p></td>
<td><p>-N</p></td>
<td><p>will NOT configure
NOR start a local
time service(chronyd
client)</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-server-install</p></td>
<td></td>
<td><p>will use default
chrony configuration
when autodiscovery
for _ntp._udp
record fails(enables
chronyd)</p></td>
</tr>
<tr class="row-even"><td><p>ipa-server-install</p></td>
<td><p>–
ntp-server=1.foo.bar</p></td>
<td><p>will configure
chrony client using
foo.bar NTP server
and enable chronyd
daemon</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-server-install</p></td>
<td><p>–
ntp-server=1.foo.bar
–
ntp-server=2.foo.bar</p></td>
<td><p>will configure
chrony client using
1.foo.bar and
2.foo.bar NTP
servers and enable
chronyd daemon</p></td>
</tr>
<tr class="row-even"><td><p>ipa-server-install</p></td>
<td><p>–n
tp-pool=pool.foo.bar</p></td>
<td><p>will configure
chrony client using
pool.foo.bar NTP
pool and enable
chronyd daemon</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-replica-install</p></td>
<td><p>-N</p></td>
<td><p>will NOT configure
NOR start a local
time service(chronyd
client)</p></td>
</tr>
<tr class="row-even"><td><p>ipa-replica-install</p></td>
<td></td>
<td><p>will use default
chrony configuration
when autodiscovery
for _ntp._udp
record fails(enables
chronyd)</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-replica-install</p></td>
<td><p>–
ntp-server=1.foo.bar</p></td>
<td><p>will configure
chrony client using
foo.bar NTP server
and enable chronyd
daemon</p></td>
</tr>
<tr class="row-even"><td><p>ipa-replica-install</p></td>
<td><p>–
ntp-server=1.foo.bar
–
ntp-server=2.foo.bar</p></td>
<td><p>will configure
chrony client using
1.foo.bar and
2.foo.bar NTP
servers and enable
chronyd daemon</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-replica-install</p></td>
<td><p>–n
tp-pool=pool.foo.bar</p></td>
<td><p>will configure
chrony client using
pool.foo.bar NTP
pool and enable
chronyd daemon</p></td>
</tr>
<tr class="row-even"><td><p>ipa-client-install</p></td>
<td><p>-N</p></td>
<td><p>will NOT configure
NOR start a local
time service(chronyd
client)</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-client-install</p></td>
<td></td>
<td><p>will use default
chrony configuration
when autodiscovery
for _ntp._udp
record fails(enables
chronyd)</p></td>
</tr>
<tr class="row-even"><td><p>ipa-client-install</p></td>
<td><p>–
ntp-server=1.foo.bar</p></td>
<td><p>will configure
chrony client using
foo.bar NTP server
and enable chronyd
daemon</p></td>
</tr>
<tr class="row-odd"><td><p>ipa-client-install</p></td>
<td><p>–
ntp-server=1.foo.bar
–
ntp-server=2.foo.bar</p></td>
<td><p>will configure
chrony client using
1.foo.bar and
2.foo.bar NTP
servers and enable
chronyd daemon</p></td>
</tr>
<tr class="row-even"><td><p>ipa-client-install</p></td>
<td><p>–n
tp-pool=pool.foo.bar</p></td>
<td><p>will configure
chrony client using
pool.foo.bar NTP
pool and enable
chronyd daemon</p></td>
</tr>
</tbody>
</table>
</section>
<section id="upgrade">
<h2>Upgrade<a class="headerlink" href="#upgrade" title="Permalink to this heading">#</a></h2>
<p>While upgrading IPA server there is need for:</p>
<ul class="simple">
<li><p>complete removal of ntpd service related configuration files</p></li>
<li><p>disablement of ntpd service</p></li>
<li><p>removal of _ntp._udp DNS record</p></li>
</ul>
<p>(taken care with method ntpd_cleanup(fqdn, fstore)</p>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">#</a></h2>
<p>fresh install with -N and ntpd already setup</p>
<p>fresh install with -N and chrony already setup</p>
<p>fresh install with -N and without any time service configuration</p>
<p>fresh install without any time option and ntpd already setup</p>
<p>fresh install without any time option and chrony already setup</p>
<p>fresh install without any time option and without any time conf</p>
<p>upgrade on instance installed with -N and ntpd already setup</p>
<p>upgrade on instance installed with -N and chrony already setup</p>
<p>upgrade on instance installed with -N and without any time conf</p>
<p>upgrade on instance installed without any time option and ntpd already
setup</p>
<p>upgrade on instance installed without any time option and chrony already
setup</p>
<p>upgrade on instance installed without any time option and without any
time conf</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>