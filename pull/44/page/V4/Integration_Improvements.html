
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Integration_Improvements &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Integration_Improvements';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Integration_Improvements.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Integration_Improvements</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scope">Scope</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lead-engineers">Lead Engineers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supporting-engineers">Supporting Engineers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-implementation">Design &amp; Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-for-local-configuration-directory">API for local configuration directory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precedents">Precedents</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cons">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tickets-prs">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-package-dependencies-for-distribution-with-pip">Add package dependencies for distribution with pip</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-runtime-requirements">Build and runtime requirements</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fedora-rhel">Fedora / RHEL</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#debian">Debian</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks">Remarks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipaplatform-auto-configuration">ipaplatform auto-configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Remarks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipaplatform-debian-support">ipaplatform Debian support</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pypi-packages">PyPI packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to Use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="integration-improvements">
<h1>Integration_Improvements<a class="headerlink" href="#integration-improvements" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p><strong>Local installation and configuration of FreeIPA client libaries.</strong></p>
<p>As of now it is rather hard to use FreeIPA’s client API or command line
programs outside of a regular, system-wide installation. FreeIPA doesn’t
follow best practices for Python packaging. It’s a side effect if
FreeIPA being a single vendor Open Source project.</p>
<ol class="arabic simple">
<li><p>Despite the fact that the client libraries <code class="docutils literal notranslate"><span class="pre">ipaclient</span></code> and
<code class="docutils literal notranslate"><span class="pre">ipalib</span></code> are written in Python and properly packaged with
setuptools, FreeIPA client is not distributable and installable with
pip. System-wide installation with a package manager is not an option
for local installations inside a virtual env.</p></li>
<li><p>FreeIPA assumes that the host has been enrolled by root with
<code class="docutils literal notranslate"><span class="pre">ipa-client-install</span></code>. System-wide configuration as root is not an
option for integrations. For instance for automation with Ansible it
is preferable to have a local configuration that does not require
host enrollment. The local of configuration files can be overriden
already but FreeIPA lacks a simple and official API.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ipaplatform</span></code> package contains platform and distribution
specific configuration like service names, paths and constants. The
package is configured on build time. It does not support runtime
detection of platforms.</p></li>
</ol>
<p>I’m proposing a series of small changes and improvements to FreeIPA’s
configuration and packaging in order to enable local installation and
configuration of client-side tools. Once all improvements are in place,
FreeIPA’s client tools can be installed and configured in an isolated
virtualenv. Multiple configurations and even different versions of
FreeIPA’s client libraries can be installed on a single machine. Admin
privileges are only required to install compiler and some build
dependencies, but not for virtualenvs and configuration.</p>
</section>
<section id="scope">
<h2>Scope<a class="headerlink" href="#scope" title="Link to this heading">#</a></h2>
<p>The scope of the proposal is limited to Python client libraries. The
Python packages and <code class="docutils literal notranslate"><span class="pre">IPA_CONFDIR</span></code> env var neither include FreeIPA
server libraries (<code class="docutils literal notranslate"><span class="pre">ipaserver</span></code>, web interface, supporting daemons) nor
enrolment of clients. A local installation just contains the Python code
and the <code class="docutils literal notranslate"><span class="pre">ipa</span></code> command. First of all, the proposal will enable
developers to use <code class="docutils literal notranslate"><span class="pre">ipalib</span></code> in 3rd party code to call FreeIPA plugins
remotely over JSON or XML-RPC. For now, advanced features like keytabs
and DNS auto-discovery are deliberately not included.</p>
<p>For now integration is limited to supported platforms: Fedora, RHEL and
Debian-like platforms with systemd. Other platforms like Windows, BSD,
macOS, and Linux distributions with System V Init are out of scope.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># create and activate a virtual env
$ virtualenv /tmp/ipaenv
$ source /tmp/ipaenv/bin/activate

# install ipaclient and dependencies locally
(ipaenv) $ pip install ipaclient

# create and activate a local configuration
(ipaenv) $ ipa-client-gencfg /tmp/ipaenv/config master.ipa.example
(ipaenv) $ export IPA_CONFDIR=/tmp/ipaenv/config
(ipaenv) $ export KRB5_CONFIG=$IPA_CONFDIR/krb5.conf
(ipaenv) $ ls /tmp/ipaenv/config/
ca.crt  default.conf  krb5.conf  nssdb

# use local configuration to acquire TGT and talk to a server
(ipaenv) $ kinit admin
(ipaenv) $ ipa ping
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ipa-client-gencfg</span></code> command is just an example.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>As a developer of a third-party Python library or application I like
to use <code class="docutils literal notranslate"><span class="pre">ipalib</span></code> to perform RPC plugin calls. I also like to follow
common best practices for Python packages to install <code class="docutils literal notranslate"><span class="pre">ipalib</span></code> and
its dependencies. These best practices pip install-able packages,
virtual envs and tox.</p></li>
<li><p>As a developer of an OpenStack project I like to have a simple way to
install and use FreeIPA client libraries on a variety of
distributions.</p></li>
<li><p>As a developer of an OpenStack project unit and functional tests
executed by tox in a venv are mandatory so the minimum is to be able
to import ipalib/ipaplatform. The backend may be mocked or otherwise
worked around but not being able to import code using IPA is a
show-stopper.</p></li>
<li><p>As an ordinary user without root privileges I like to install and
configure a local copy of the <code class="docutils literal notranslate"><span class="pre">ipa</span></code> command. I can acquire a
Kerberos TGT and know the hostname of a FreeIPA server but can neiter
install software with a package manager nor enroll my machine.</p></li>
<li><p>For an Ansible playbook I like to have a simple and consistent way to
point <code class="docutils literal notranslate"><span class="pre">ipa</span></code> command and <code class="docutils literal notranslate"><span class="pre">ipalib.api</span></code> to a local FreeIPA config
file <code class="docutils literal notranslate"><span class="pre">krb5.conf</span></code> and <code class="docutils literal notranslate"><span class="pre">nssdb</span></code>. The files can’t be global and must
be part of the current Ansible inventory.</p></li>
<li><p>As a maintainer of a project that uses <code class="docutils literal notranslate"><span class="pre">ipaclient</span></code> I like to verify
compatibility with multiple versions of FreeIPA without resorting to
heavy weight solutions like containers or virtual machines. Instead I
prefer virtual envs with pinned package versions.</p></li>
</ul>
</section>
<section id="lead-engineers">
<h2>Lead Engineers<a class="headerlink" href="#lead-engineers" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Christian Heimes (IPA/CS)</p></li>
</ul>
</section>
<section id="supporting-engineers">
<h2>Supporting Engineers<a class="headerlink" href="#supporting-engineers" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Adam Young (OpenStack Platform)</p></li>
<li><p>Rob Crittenden (OpenStack Platform)</p></li>
</ul>
</section>
<section id="design-implementation">
<h2>Design &amp; Implementation<a class="headerlink" href="#design-implementation" title="Link to this heading">#</a></h2>
</section>
<section id="api-for-local-configuration-directory">
<h2>API for local configuration directory<a class="headerlink" href="#api-for-local-configuration-directory" title="Link to this heading">#</a></h2>
<p>At the moment FreeIPA has multuple ways to load a different config file
than the default <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> from <code class="docutils literal notranslate"><span class="pre">/etc/ipa</span></code>.</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">ipa</span></code> command, config options can be overriden with the <code class="docutils literal notranslate"><span class="pre">-e</span></code>
flag. For example
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">-e</span> <span class="pre">confdir=/path/to/alternative/directory</span> <span class="pre">ping</span></code> loads
<code class="docutils literal notranslate"><span class="pre">default.conf</span></code> from an alternative directory.</p></li>
<li><p>Python application can override settings during the initialization
phase of FreeIPA API, e.g.
<code class="docutils literal notranslate"><span class="pre">ipalib.api.bootstrap(confdir='/path/to/alternative/directory')</span></code>.
Once <code class="docutils literal notranslate"><span class="pre">ipalib.api</span></code> is fully configured, all settings are read-only.</p></li>
</ul>
<p>Both approaches have some disadvantages. A user must repeat the <code class="docutils literal notranslate"><span class="pre">-e</span></code>
option in every call to <code class="docutils literal notranslate"><span class="pre">ipa</span></code> or create a shell alias. It’s both
tedious and error-prone. Some scripts don’t have an override, e.g.
<code class="docutils literal notranslate"><span class="pre">ipa-client-automount</span></code>.</p>
<p>I propose a <code class="docutils literal notranslate"><span class="pre">IPA_CONFDIR</span></code> environment variable that works comparable
with MIT Kerberos’ <code class="docutils literal notranslate"><span class="pre">KRB5_CONFIG</span></code> environment variable,
<a class="reference external" href="https://web.mit.edu/kerberos/krb5-1.14/doc/admin/env_variables.html">https://web.mit.edu/kerberos/krb5-1.14/doc/admin/env_variables.html</a> . In
presence of the environment variable, FreeIPA API will use the value of
the environment variable as path for <code class="docutils literal notranslate"><span class="pre">confdir</span></code>. An explicit <code class="docutils literal notranslate"><span class="pre">-e</span></code>
option or <code class="docutils literal notranslate"><span class="pre">api.bootstrap()</span></code> argument takes precedence over the
environment variable. Some contexts (e.g. server, installers, update)
will still depend on global setting and system file. Therefore they
won’t support the env var and refuse to initialize the API.</p>
<section id="precedents">
<h3>Precedents<a class="headerlink" href="#precedents" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>MIT KRB5 has <code class="docutils literal notranslate"><span class="pre">KRB5_CONFIG</span></code>,
<a class="reference external" href="https://web.mit.edu/kerberos/krb5-1.14/doc/admin/env_variables.html">https://web.mit.edu/kerberos/krb5-1.14/doc/admin/env_variables.html</a></p></li>
<li><p>freedesktop.org has <code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_HOME</span></code>,
<a class="reference external" href="https://specifications.freedesktop.org/basedir-spec/latest/ar01s03.html">https://specifications.freedesktop.org/basedir-spec/latest/ar01s03.html</a></p></li>
<li><p>Python has multiple env vars like <code class="docutils literal notranslate"><span class="pre">PYTHONHOME</span></code>,
<a class="reference external" href="https://docs.python.org/2/using/cmdline.html#environment-variables">https://docs.python.org/2/using/cmdline.html#environment-variables</a></p></li>
<li><p>pip uses <code class="docutils literal notranslate"><span class="pre">PIP_*</span></code>,
<a class="reference external" href="https://pip.pypa.io/en/stable/user_guide/#environment-variables">https://pip.pypa.io/en/stable/user_guide/#environment-variables</a></p></li>
<li><p>Wikipedia defines: <em>Environment variables are a set of dynamic named
values that can affect the way running processes will behave on a
computer.</em></p></li>
</ul>
</section>
<section id="pros">
<h3>Pros<a class="headerlink" href="#pros" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IPA_CONFDIR</span></code> works similar to MIT KRB5’s <code class="docutils literal notranslate"><span class="pre">KRB5_CONFIG</span></code>.</p></li>
<li><p>Local configuration for <code class="docutils literal notranslate"><span class="pre">ipa</span></code> command and <code class="docutils literal notranslate"><span class="pre">ipalib</span></code> becomes easy.
A user or program just has to set the environment variables
<code class="docutils literal notranslate"><span class="pre">IPA_CONFDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">KRB5_CONFIG</span></code> to local configuration files. All
API calls automatically pick up the right configuration in the
current shell session.</p></li>
</ul>
</section>
<section id="cons">
<h3>Cons<a class="headerlink" href="#cons" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>It’s yet another way to set the <code class="docutils literal notranslate"><span class="pre">confdir</span></code> option.</p></li>
</ul>
</section>
<section id="tickets-prs">
<h3>Tickets / PRs<a class="headerlink" href="#tickets-prs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Allow client commands without enrolling</p>
<ul>
<li><p><a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6389">https://fedorahosted.org/freeipa/ticket/6389</a></p></li>
</ul>
</li>
<li><p>Use env var <code class="docutils literal notranslate"><span class="pre">IPA_CONFDIR</span></code> to get confdir for cli context</p>
<ul>
<li><p><a class="github reference external" href="https://github.com/freeipa/freeipa/pull/182">freeipa/freeipa#182</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipalib.api.finalize()</span></code> requires Kerberos credentials</p>
<ul>
<li><p><a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6408">https://fedorahosted.org/freeipa/ticket/6408</a></p></li>
</ul>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">api.env.nss_dir</span></code> instead of <code class="docutils literal notranslate"><span class="pre">paths.IPA_NSSDB_DIR</span></code></p>
<ul>
<li><p><a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6386">https://fedorahosted.org/freeipa/ticket/6386</a></p></li>
<li><p><a class="github reference external" href="https://github.com/freeipa/freeipa/pull/143">freeipa/freeipa#143</a></p></li>
</ul>
</li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">api.env.nss_dir</span></code> relative to <code class="docutils literal notranslate"><span class="pre">api.env.confdir</span></code></p>
<ul>
<li><p><a class="github reference external" href="https://github.com/freeipa/freeipa/pull/180">freeipa/freeipa#180</a></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="add-package-dependencies-for-distribution-with-pip">
<h2>Add package dependencies for distribution with pip<a class="headerlink" href="#add-package-dependencies-for-distribution-with-pip" title="Link to this heading">#</a></h2>
<p>With FreeIPA’s recent move to setuptools, the Python build system
supports wheels. Wheels <a class="reference external" href="https://wheel.readthedocs.io/en/latest/">https://wheel.readthedocs.io/en/latest/</a> is the
new and recommended packaging format for Python libraries. In order to
make FreeIPA’s client packages easily install-able with pip, the
packages need to provide a list of install requirements. Setuptools
include the requirements in the packages’. Pip downloads and install the
requirements automatically.</p>
<section id="build-and-runtime-requirements">
<h3>Build and runtime requirements<a class="headerlink" href="#build-and-runtime-requirements" title="Link to this heading">#</a></h3>
<p>FreeIPA no longer contains C extensions. It depends on a couple of
packages with C extensions that require a compiler, libraries and
headers at build time. Python packages with C code are cffi,
cryptography, gssapi, pyldap/python-ldap, python-nss and
[STRIKEOUT:lxml]. FreeIPA also uses some external programs like openssl,
kinit and certutil from nss-tools.</p>
<p>ipapython’s dependencies on libxml, libxslt and lmxl could be dropped
replacing lxml with Python stdlib’s xml.etree package. The XML parser in
the standard library is built on top of libexpat. xml.etree does not
provide all features of lxml.etree. That’s not a problem since FreeIPA
uses only basic features and no advanced features like XSLT or complex
XPath. <strong>FIXED</strong> ipaclient no longer imports lxml.</p>
<section id="fedora-rhel">
<h4>Fedora / RHEL<a class="headerlink" href="#fedora-rhel" title="Link to this heading">#</a></h4>
<p>On Fedora and RHEL the runtime dependencies are provided by:</p>
<ul class="simple">
<li><p>python-pip</p></li>
<li><p>keyutils</p></li>
<li><p>krb5-workstation</p></li>
<li><p>openssl</p></li>
<li><p>openldap-clients</p></li>
<li><p>nss-tools</p></li>
<li><p>libffi</p></li>
</ul>
<p>Further more build time dependencies are:</p>
<ul class="simple">
<li><p>python-wheel</p></li>
<li><p>gcc</p></li>
<li><p>krb5-devel</p></li>
<li><p>libffi-devel</p></li>
<li><p>nss-devel</p></li>
<li><p>openldap-devel</p></li>
<li><p>openssl-devel</p></li>
</ul>
</section>
<section id="debian">
<h4>Debian<a class="headerlink" href="#debian" title="Link to this heading">#</a></h4>
<p>Runtime dependencies:</p>
<ul class="simple">
<li><p>python-pip</p></li>
<li><p>krb5-user</p></li>
<li><p>openssl</p></li>
<li><p>ldap-utils</p></li>
<li><p>libnss3-tools</p></li>
<li><p>libffi6</p></li>
<li><p>[STRIKEOUT:libxml2]</p></li>
<li><p>[STRIKEOUT:libxslt1.1]</p></li>
</ul>
<p>Build dependencies:</p>
<ul class="simple">
<li><p>python-dev</p></li>
<li><p>python-wheel</p></li>
<li><p>build-essential</p></li>
<li><p>pkg-config</p></li>
<li><p>libkrb5-dev</p></li>
<li><p>libffi-dev</p></li>
<li><p>libnss3-dev</p></li>
<li><p>libldap2-dev</p></li>
<li><p>libsasl2-dev</p></li>
<li><p>libssl-dev</p></li>
<li><p>[STRIKEOUT:libxml2-dev]</p></li>
<li><p>[STRIKEOUT:libxslt1-dev]</p></li>
</ul>
</section>
</section>
<section id="id1">
<h3>Pros<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>FreeIPA’s client libraries become easy installable in a virtual env.</p></li>
</ul>
</section>
<section id="id2">
<h3>Cons<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Package requirements from <code class="docutils literal notranslate"><span class="pre">freeipa.spec</span></code> are duplicated in
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code> files. It increases package maintenance slightly.</p></li>
</ul>
</section>
<section id="remarks">
<h3>Remarks<a class="headerlink" href="#remarks" title="Link to this heading">#</a></h3>
<p>python-nss does not support wheels yet,
<a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1389739">https://bugzilla.redhat.com/show_bug.cgi?id=1389739</a></p>
</section>
<section id="id3">
<h3>Tickets / PRs<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Make ipaclient pip install-able
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6468">https://fedorahosted.org/freeipa/ticket/6468</a></p></li>
<li><p>` &lt;<a class="reference external" href="https://github.com/tiran/freeipa/commits/python_requirements">https://github.com/tiran/freeipa/commits/python_requirements</a>&gt;`__<a class="reference external" href="https://github.com/tiran/freeipa/commits/python_requirements">https://github.com/tiran/freeipa/commits/python_requirements</a></p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">`setup.py</span></code>` files PyPI compatible
<a class="github reference external" href="https://github.com/freeipa/freeipa/pull/197">freeipa/freeipa#197</a></p></li>
<li><p>Use xml.etree instead of lxml in odsmgr.py
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6469">https://fedorahosted.org/freeipa/ticket/6469</a></p></li>
</ul>
</section>
</section>
<section id="ipaplatform-auto-configuration">
<h2>ipaplatform auto-configuration<a class="headerlink" href="#ipaplatform-auto-configuration" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ipaplatform</span></code> package is an abstraction layer for platform and
distribution specific settings and services. The other FreeIPA packages
use <code class="docutils literal notranslate"><span class="pre">ipaplatform.constants</span></code>, <code class="docutils literal notranslate"><span class="pre">ipaplatform.paths</span></code>,
<code class="docutils literal notranslate"><span class="pre">ipaplatform.services</span></code>, and <code class="docutils literal notranslate"><span class="pre">ipaplatform.tasks</span></code>. Internally the
modules are aliases, e.g. on Fedora <code class="docutils literal notranslate"><span class="pre">ipaplatform.paths</span></code> is an alias
for <code class="docutils literal notranslate"><span class="pre">ipaplatform.fedora.paths</span></code>. As of now the aliases are implemented
with symlinks. The symlinks are created at build time by autoconf. The
approach is not compatible with Python wheels and pip. FreeIPA packages
might be build on Fedora but installed on CentOS.</p>
<p>I’m proposing two changes:</p>
<ul class="simple">
<li><p>Platform selection shall become an import time decision. The platform
id is read from <code class="docutils literal notranslate"><span class="pre">/etc/os-release</span></code>. The file is available on all
relevant platform. It also contains an ordered list of similar
platforms. For example on CentOS the <em>ID</em> is <code class="docutils literal notranslate"><span class="pre">centos</span></code> and <em>ID_LIKE</em>
are <code class="docutils literal notranslate"><span class="pre">rhel</span></code> and <code class="docutils literal notranslate"><span class="pre">fedora</span></code> in that order. Since <code class="docutils literal notranslate"><span class="pre">ipaplatform</span></code> does
not provide a <code class="docutils literal notranslate"><span class="pre">ipaplatform.centos</span></code> sub-package, it will
automatically select <code class="docutils literal notranslate"><span class="pre">ipaplatform.rhel</span></code> as platform provider for
CentOS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ipaplatform</span></code> is turned into a namespace package. A namespace
package allows third parties to provide external packages with
platform definitions, e.g. a <code class="docutils literal notranslate"><span class="pre">ipaplatform.debian</span></code> package.</p></li>
</ul>
<section id="id4">
<h3>Pros<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The platform reflects the actual platform that FreeIPA is running on.</p></li>
<li><p>The platform selector falls back to related platform identifiers.</p></li>
<li><p>Third parties can provide pip install-able platform modules.</p></li>
</ul>
</section>
<section id="id5">
<h3>Cons<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The implementation becomes a bit more complicated.</p></li>
</ul>
</section>
<section id="id6">
<h3>Remarks<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">__path__</span></code> trick is not compatible with namespace packages.
<code class="docutils literal notranslate"><span class="pre">ipaplatform.__init__</span></code> cannot contain any code.</p>
<p>pylint is not able to understand meta import hooks. An AstroidBuilder
plugin for pylint turned out to be too fragile. My new implementation
uses a facade module that is replaced with the actual module.</p>
</section>
<section id="id7">
<h3>Tickets / PRs<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="github reference external" href="https://github.com/tiran/freeipa/commits/ipaplatform_detect">tiran/freeipa</a></p></li>
<li><p>Select ipaplatform at runtime
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6474">https://fedorahosted.org/freeipa/ticket/6474</a></p></li>
</ul>
</section>
</section>
<section id="ipaplatform-debian-support">
<h2>ipaplatform Debian support<a class="headerlink" href="#ipaplatform-debian-support" title="Link to this heading">#</a></h2>
<p>FreeIPA upstream does not include platform configuration for
Debian-based distributions. In order to support development and
deployment on other distributions, FreeIPA should include Timo Aalton’s
patch for <code class="docutils literal notranslate"><span class="pre">ipaplatform.debian</span></code>. There is demand for Debian support
from OpenStack side.</p>
<section id="id8">
<h3>Tickets / PRs<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Include ipaplatform.debian
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/6475">https://fedorahosted.org/freeipa/ticket/6475</a></p></li>
</ul>
</section>
</section>
<section id="pypi-packages">
<h2>PyPI packages<a class="headerlink" href="#pypi-packages" title="Link to this heading">#</a></h2>
<p><strong>details TBD</strong></p>
<p>I have reservered four package names on PyPI:</p>
<ul class="simple">
<li><p>ipaclient</p></li>
<li><p>ipalib</p></li>
<li><p>ipaplatform</p></li>
<li><p>ipapython</p></li>
</ul>
<p>Further more I have registered four additional packages to prevent name
squatting attacks. The <code class="docutils literal notranslate"><span class="pre">ipa</span></code> and <code class="docutils literal notranslate"><span class="pre">freeipa</span></code> packages just contain
metadata (dependency on <code class="docutils literal notranslate"><span class="pre">ipalib</span></code>) and no code. The <code class="docutils literal notranslate"><span class="pre">ipaserver</span></code> and
<code class="docutils literal notranslate"><span class="pre">ipatests</span></code> packages have no release at all.</p>
<ul class="simple">
<li><p>ipaserver</p></li>
<li><p>ipatests</p></li>
<li><p>ipa</p></li>
<li><p>freeipa</p></li>
</ul>
</section>
<section id="upgrade">
<h2>Upgrade<a class="headerlink" href="#upgrade" title="Link to this heading">#</a></h2>
<p>Package dependencies must be synced between RPM spec and setup.py /
ipasetup.py.</p>
</section>
<section id="how-to-use">
<h2>How to Use<a class="headerlink" href="#how-to-use" title="Link to this heading">#</a></h2>
<p><strong>TBW</strong></p>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">#</a></h2>
<p><strong>TBW</strong></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scope">Scope</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lead-engineers">Lead Engineers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supporting-engineers">Supporting Engineers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-implementation">Design &amp; Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-for-local-configuration-directory">API for local configuration directory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precedents">Precedents</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pros">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cons">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tickets-prs">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-package-dependencies-for-distribution-with-pip">Add package dependencies for distribution with pip</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-runtime-requirements">Build and runtime requirements</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fedora-rhel">Fedora / RHEL</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#debian">Debian</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks">Remarks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipaplatform-auto-configuration">ipaplatform auto-configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Pros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Cons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Remarks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ipaplatform-debian-support">ipaplatform Debian support</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Tickets / PRs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pypi-packages">PyPI packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to Use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>