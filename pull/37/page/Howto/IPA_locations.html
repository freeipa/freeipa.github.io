
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>IPA_locations &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Howto/IPA_locations';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/Howto/IPA_locations.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>IPA_locations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#short-feature-description">Short feature description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#information-good-to-know">Information good to know</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topology">Topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-server">Installation (server)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-locations">Adding locations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-servers-to-locations">Adding servers to locations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-configuration">Advanced configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-service-weight">Setting service weight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lowering-ttl">Lowering TTL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-client">Installation (client)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verification">Verification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-list-of-all-required-records">Get list of all required records</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-non-freeipa-dns-servers">Example with non-FreeIPA DNS servers</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ipa-locations">
<h1>IPA_locations<a class="headerlink" href="#ipa-locations" title="Link to this heading">#</a></h1>
<section id="short-feature-description">
<h2>Short feature description<a class="headerlink" href="#short-feature-description" title="Link to this heading">#</a></h2>
<p>IPA (DNS) Locations feature can be used to distribute load from clients.
This is done by SRV records with the proper priority set and CNAME
aliases. Servers in IPA location redirect DNS queries using CNAME to
location records.</p>
<p>IPA servers outside location work as backup servers. In case that all
IPA servers in the particular location failed to respond, servers from
outside of the location will be used.</p>
</section>
<section id="information-good-to-know">
<h2>Information good to know<a class="headerlink" href="#information-good-to-know" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Only IPA system services are supported.</p></li>
<li><p>IPA DNS subsystem must be installed.</p></li>
<li><p>IPA DNS must be authoritative for primary IPA DNS domain.</p></li>
<li><p>IPA locations use SRV records, without functional DNS server inside a
location, this location effectively stops working.</p></li>
<li><p>IPA locations use priority field in SRV records to prefer servers in
the location. Servers with priority 0 belongs to the location,
servers with priority 50 are backup servers from outside of the
location.</p></li>
<li><p>Membership of client in a location depends on DNS server which is
configured as resolver for client. (Directly or indirectly through
recursors etc.)</p></li>
<li><p>Each location must contain at leas one IPA DNS server.</p></li>
<li><p>Multiple IPA DNS servers per location are recommended (backup DNS
servers inside one location).</p></li>
<li><p>Be careful with caching DNS servers. Caching DNS servers may cause
delay in propagation of changes in locations. This can be solved by
lowering TTL for location records in advance (IPA default is one
day).</p></li>
<li><p>Clients must be able to work with SRV and CNAME records to work with
IPA locations properly.</p></li>
</ul>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
</section>
<section id="topology">
<h2>Topology<a class="headerlink" href="#topology" title="Link to this heading">#</a></h2>
<figure class="align-default" id="id1">
<img alt="dns_location_topology.svg" src="../../_images/Dns_location_topology.svg" /><figcaption>
<p><span class="caption-text">dns_location_topology.svg</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="installation-server">
<h2>Installation (server)<a class="headerlink" href="#installation-server" title="Link to this heading">#</a></h2>
<p>Please note the following steps are just examples, in real world, do not
forget to add additional replication agreements as backup to prevents
disconnect topology.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``[root@berlin ~
[root@prague1 ~]# ipa-replica-install --setup-dns
[root@prague2 ~]# ipa-replica-install --setup-dns
[root@paris1 ~]# ipa-replica-install --setup-dns
[root@paris2 ~]# ipa-replica-install
[root@paris3 ~]# ipa-replica-install --setup-dns
</pre></div>
</div>
</section>
<section id="adding-locations">
<h2>Adding locations<a class="headerlink" href="#adding-locations" title="Link to this heading">#</a></h2>
<p>Use <strong>location-add</strong> command to create a new location.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa location-add czechrep --description=&quot;Czech republic clients&quot;</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa location-add france --description=&quot;France clients&quot;</span>
</pre></div>
</div>
</section>
<section id="adding-servers-to-locations">
<h2>Adding servers to locations<a class="headerlink" href="#adding-servers-to-locations" title="Link to this heading">#</a></h2>
<p>Use <strong>server-mod</strong> command to add server into location. Server can be
member of only one location.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa server-mod prague1.example.com --location=czechrep</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa server-mod prague2.example.com --location=czechrep</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa server-mod paris1.example.com --location=france</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa server-mod paris2.example.com --location=france</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa server-mod paris3.example.com --location=france</span>
</pre></div>
</div>
</section>
<section id="advanced-configuration">
<h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Link to this heading">#</a></h2>
<section id="setting-service-weight">
<h3>Setting service weight<a class="headerlink" href="#setting-service-weight" title="Link to this heading">#</a></h3>
<p>Using weight attribute in SRV records, you can customize load between
servers in a location (for servers without location too). Servers with
better performance can have assigned higher weight for IPA services and
those servers will receive more queries than others. To set weight for
IPA system SRV records, please use <strong>server-mod</strong>. For further
information about weight please see <a class="reference external" href="https://tools.ietf.org/html/rfc2782#page-3">RFC 2783 page
3</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin</span> <span class="pre">~]#</span> <span class="pre">ipa</span> <span class="pre">server-mod</span> <span class="pre">paris2.example.com</span> <span class="pre">--service-weight=2000</span></code></p>
</section>
<section id="lowering-ttl">
<h3>Lowering TTL<a class="headerlink" href="#lowering-ttl" title="Link to this heading">#</a></h3>
<p>In case you use caching DNS servers, you may need to lower default TTL
(86400) of the IPA domain. Any change in locations or in system records
will be reflected on caching servers after the TTL of original records
expires. Lowering TTL in advance is good for planned changes in
topology.</p>
<p>To change default TTL use <strong>dnszone-mod</strong> command.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin</span> <span class="pre">~]#</span> <span class="pre">ipa</span> <span class="pre">dnszone-mod</span> <span class="pre">example.com.</span> <span class="pre">--default-ttl=3600</span></code></p>
</section>
</section>
<section id="installation-client">
<h2>Installation (client)<a class="headerlink" href="#installation-client" title="Link to this heading">#</a></h2>
<p>Client must have set the proper resolver which belongs to the location
where clients are supposed to be located in. Preferred is to configure
resolvers using DHCP, as we expect that the network topology respects
geographical location, and the DHCP provides the closest DNS server IP
addresses, thus this should be done without any extra configuration.</p>
<p>Please note that all nameservers configured on client should be in the
same location. A configuration with nameservers from various location
will work, but it may result into inefficient resolving.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">prague</span> <span class="o">~</span><span class="p">]</span> <span class="c1"># cat /etc/resolv.conf</span>
<span class="n">nameserver</span> <span class="mf">10.10.0.1</span>
<span class="n">nameserver</span> <span class="mf">10.10.0.2</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">paris</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/resolv.conf</span>
<span class="n">nameserver</span> <span class="mf">10.50.0.1</span>
<span class="n">nameserver</span> <span class="mf">10.50.0.3</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/resolv.conf</span>
<span class="n">nameserver</span> <span class="mf">10.30.0.1</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">oslo</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cat /etc/resolv.conf</span>
<span class="n">nameserver</span> <span class="mf">10.30.0.1</span>
</pre></div>
</div>
<p>If resolvers are properly set, you can install clients by using
<strong>ipa-client-install</strong>.</p>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Link to this heading">#</a></h2>
<p>We can use <strong>dig</strong> to verify returned DNS records</p>
<p>Server/client without locations</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># dig +short _ldap._tcp.example.com SRV</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">berlin</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">2000</span> <span class="mi">389</span> <span class="n">paris2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
</pre></div>
</div>
<p>Server/client inside <em>czechrep</em> location</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">prague</span> <span class="o">~</span><span class="p">]</span><span class="c1"># dig +short _ldap._tcp.example.com SRV</span>
<span class="n">_ldap</span><span class="o">.</span><span class="n">_tcp</span><span class="o">.</span><span class="n">czechrep</span><span class="o">.</span><span class="n">_locations</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># CNAME alias _ldap._tcp --&gt; _ldap._tcp.czechrep._locations</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">berlin</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># server with lower priority (50), outside of location</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># server inside location</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">50</span> <span class="mi">2000</span> <span class="mi">389</span> <span class="n">paris2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
</pre></div>
</div>
<p>Server/client inside <em>france</em> location</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@client</span><span class="o">-</span><span class="n">paris</span> <span class="o">~</span><span class="p">]</span><span class="c1"># dig +short _ldap._tcp.example.com SRV</span>
<span class="n">_ldap</span><span class="o">.</span><span class="n">_tcp</span><span class="o">.</span><span class="n">france</span><span class="o">.</span><span class="n">_locations</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># CNAME alias _ldap._tcp --&gt; _ldap._tcp.france._locations</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">berlin</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># server with lower priority (50), outside of location</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">50</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">prague2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>    <span class="c1"># server inside location</span>
<span class="mi">0</span> <span class="mi">2000</span> <span class="mi">389</span> <span class="n">paris2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">paris3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
</pre></div>
</div>
<section id="get-list-of-all-required-records">
<h3>Get list of all required records<a class="headerlink" href="#get-list-of-all-required-records" title="Link to this heading">#</a></h3>
<p>You can use command <strong>ipa dns-update-system-records –dry-run</strong> to print
list of all required system records, and location records. Eventually if
some records are missing in IPA domain, you can use this command
<strong>without –dry-run</strong> option to fix missing system records.</p>
</section>
</section>
<section id="example-with-non-freeipa-dns-servers">
<h2>Example with non-FreeIPA DNS servers<a class="headerlink" href="#example-with-non-freeipa-dns-servers" title="Link to this heading">#</a></h2>
<p>The first example assumed that you have at least one FreeIPA DNS server
in each location. With same effort the same feature can be implemented
also using external DNS servers. Following example is using InfoBlox’s
support for DNS view to simulate multiple DNS servers in each location:</p>
<ul class="simple">
<li><p>On Infoblox, create DNS view <strong>for each location</strong>:</p></li>
<li><p>Data Management -&gt; DNS -&gt; Zones -&gt; click to Plus sign to add DNS view</p></li>
<li><p>Add DNS view step 1 -&gt; fill-in name, use the same name as for IPA location, e.g. “czechrep”</p></li>
<li><p>Add DNS view step 2 -&gt; specify Match Clients rule so that all clients in “czechrep” location domain belong to this DNS view</p></li>
<li><p>Add DNS view step 3 -&gt; Save</p></li>
<li><p>In each DNS view, create two zones with names: “_udp.”, “_tcp.”</p></li>
</ul>
<p>These zones (specific for each DNS view) will be filled-in with records
produced by the IPA server.</p>
<ul class="simple">
<li><p>On a IPA server, run command:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;berlin</span> <span class="pre">~]#</span> <span class="pre">ipa</span> <span class="pre">dns-update-system-records</span> <span class="pre">--dry-run</span></code></p>
<p>It will produce a lot of DNS records. We are interested in records
listed in section <strong>IPA location records</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IPA</span> <span class="n">location</span> <span class="n">records</span><span class="p">:</span>
  <span class="n">_kerberos</span><span class="o">-</span><span class="n">master</span><span class="o">.</span><span class="n">_tcp</span><span class="o">.</span><span class="n">czechrep</span><span class="o">.</span><span class="n">_locations</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span> <span class="o">...</span>
  <span class="n">_kerberos</span><span class="o">-</span><span class="n">master</span><span class="o">.</span><span class="n">_udp</span><span class="o">.</span><span class="n">france</span><span class="o">.</span><span class="n">_locations</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span> <span class="o">...</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Each IPA location has own set of records. Records specific to given
location contain <code class="docutils literal notranslate"><span class="pre">._locations</span></code> in their name.</p>
<ul class="simple">
<li><p>For each DNS location/DNS view, select relevant records from
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">dns-update-system-records</span> <span class="pre">--dry-run</span></code>’s output and transform
them to form suitable for general purpose DNS server. E.g.:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCATION</span><span class="o">=</span><span class="n">czechrep</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@berlin</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa dns-update-system-records --dry-run | grep $LOCATION._locations | sed &quot;s/\.$LOCATION\._locations//&quot;</span>
</pre></div>
</div>
<p>This way, you will obtain list of records for each location. Each list
contains records with the same names (the left side) but different data
(the right side).</p>
<ul class="simple">
<li><p>As the last step, take this list of records and for each location,
copy it into particular Infoblox’s DNS view.</p></li>
</ul>
<p>Now you are done. Clients using DNS discovery to find IPA servers will
prefer the local servers automatically (as soon as DNS TTL expires). Of
course, the procedure needs to be repeated each time you reconfigure IPA
location or do a modification to a IPA server topology.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#short-feature-description">Short feature description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#information-good-to-know">Information good to know</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topology">Topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-server">Installation (server)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-locations">Adding locations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-servers-to-locations">Adding servers to locations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-configuration">Advanced configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-service-weight">Setting service weight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lowering-ttl">Lowering TTL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-client">Installation (client)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verification">Verification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-list-of-all-required-records">Get list of all required records</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-with-non-freeipa-dns-servers">Example with non-FreeIPA DNS servers</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>