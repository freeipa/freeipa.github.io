<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Summary" href="Certificate_renewal.html" />
    <link rel="prev" title="Introduction" href="Certificate_Authority.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>One of the major requirements for the IPA v2 release is to integrate the
Certificate Authority into the IPA server. The main use case for this is
provisioning certificates for use by applications, for example web
server or IMAP server. There is no requirement to provision user
certificates. This is deferred to later version of IPA. Also there is no
plan to deploy certificates to all the IPA clients. Instead the clients
will be using kerberos keytab to authenticate to IPA server.</p>
</section>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<section id="certificate-management-interfaces">
<span id="id1"></span><h2>Certificate Management Interfaces<a class="headerlink" href="#certificate-management-interfaces" title="Permalink to this heading">¶</a></h2>
<p>Certificate life cycle management includes the following basic
operations:</p>
<ul class="simple">
<li><p>Requesting certificates. If a new certificate needs to be issued it
should be possible to request a new certificate from the system. The
assumption is that the keypair is generated on the client system, and
the client is submitting a public key to the CA. In IPA v2 we are not
planning to support key escrow use case and server side key
generation. This will be added later when add support for user
certificate authentication.</p></li>
<li><p>Checking request status. In different situations the certificate
issuance can be delayed pending administrative approval. There is a
need to be able to track and check the status of outstanding
requests.</p></li>
<li><p>Getting certificate. When the request is approved there should be a
way to retrieve the certificate and store it in the appropriate
location.</p></li>
<li><p>Revoking certificates. If the certificate is lost or compromised it
should be possible to revoke it so that it can not be used any more.
There is also an option to not completely revoke certificate by put
it on hold. The example of the situation would be when the user left
his smart card at home. His certificates can be put on hold till next
day.</p></li>
<li><p>Take certificate off “hold”. When the certificate is on hold take it
off hold.</p></li>
</ul>
<p>All these operations are performed by the Certificate Authority (CA). To
prevent direct access to the CA by IPA clients, the CA is front-ended
with the Registration Authority (RA). It will be impossible to request
anything from the CA bypassing RA. The RA will be embedded into the
XML-RPC back end as an XML-RPC back end plugin. This plugin will be
responsible for validating the permission of the client and proxying its
request to the CA through RA, and then collecting the response and
sending it back.</p>
<p>The back end management plugin can be used for management of the
certificates in the system through UI and CLI. For v2 we are planning to
allow certificates to be associated with a host. If there are multiple
services running on the same host there might be a need to issue
multiple certificates. There are several approaches how this can be
done:</p>
<ul class="simple">
<li><p>The simplest approach would be to allow just multiple certificates to
be issued for one host. In this case the CA will publish the issued
certificates into the multi valued attribute in the host entry. There
is a concern about this solution that is currently being
investigated. It is related to unpublishing the certificate when it
is revoked. I might be that the code responsible for this feature is
not capable of removing the certificate from the multi value
attribute. If this is the case then we would have to solve the
problem by publishing the certificates into separate entries.</p></li>
<li><p>The second approach is to have child entries under host entries where
the certificates will be stored. This way there will be no problems
with publishing and unpublishing the certificates but we would a bit
violate the flat approach to our tree.</p></li>
<li><p>The third option would be to put the certificate into the service
entry. Conceptually service entries are now used to store a kerberos
principal’s keys. Adding auxiliary class to store certificate
attribute to the service entry might also be a viable option.</p></li>
<li><p>The last option is not to publish the certificates at all and for any
administrative need query the CA using RA. This would be a bit of
performance burden and would require RA to expose a more robust
querying interface than currently planned.</p></li>
</ul>
<div class="line-block">
<div class="line">Currently we are leaning towards the combination of the first and
third options. If the first option is not available we might decide to
allow one certificate for a host entry and if there are more needed
the certificates can be issued to the services running on the host in
this case we would have to modify the service to alternatively be a
container for the kerberos data and for the certificate.</div>
<div class="line">It should be possible to perform the following tasks via either
management interface:</div>
</div>
<ul class="simple">
<li><p>List the certificates issued to a host. If the certificates are
issued to the host itself then the command or UI would be based on
the host identity. In CLI the command can be something like:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">ipa</span><span class="o">-</span><span class="n">certs</span> <span class="nb">list</span> <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="n">my</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">somewhere</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>In the UI it can be a section in the edit/view host screen. Since the UI
will use AJAX we will be able to have this section collapsed by default
and retrieve cert information only explicitly on demand if we see
performance issues (especially if end up not publishing the certs at all
and would have to retrieve information form CA itself). If we put the
certificates into the host entry, the command will just retrieve the
entry and list the certificates that are stored in the multi valued
attribute. If we have to put the certificates in special entries under
host, the host management plugin would have to enumerate these entries
and build the certificate list this way. If we decide to store the
certificates in services, we would have to list the services themselves
in the UI. The services will have the fully qualified host name as a
part of the principal and this is how they can be matched and associated
to the host they are running on. If we decide not to publish certs at
all we would have to have the RA request that would ask the CA about all
the certificates issued to a given host.</p>
<ul class="simple">
<li><p>Get status of a certificate. Display the properties of the
certificate including host name, serial number, expiration etc. In UI
there should be a button that would allow selecting certificate from
the list and clicking “details” button. On command line this should
be a command like:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">ipa</span><span class="o">-</span><span class="n">certs</span> <span class="nb">list</span> <span class="o">--</span><span class="n">serial</span><span class="o">=&lt;</span><span class="n">serial</span> <span class="n">number</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Revoke a certificate. In the UI there should be a button that would
allow selecting certificate from the list and clicking “revoke”
button. On command line this should be a command like:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">ipa</span><span class="o">-</span><span class="n">certs</span> <span class="n">revoke</span> <span class="o">--</span><span class="n">serial</span><span class="o">=&lt;</span><span class="n">serial</span> <span class="n">number</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Renew certificate. If the certificate is going to expire there should
be a way to issue a replacement certificate. In the UI there should
be a button that would allow selecting a certificate from the list
and clicking “renew” button. On command line this should be a command
like:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">ipa</span><span class="o">-</span><span class="n">certs</span> <span class="n">renew</span> <span class="o">--</span><span class="n">serial</span><span class="o">=&lt;</span><span class="n">serial</span> <span class="n">number</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Get a new certificate. There should be a way to request a certificate
for host (or service) from the UI and command line.</p></li>
</ul>
</section>
<section id="access-control">
<span id="id2"></span><h2>Access Control<a class="headerlink" href="#access-control" title="Permalink to this heading">¶</a></h2>
<p>The certificate operations can be performed only via RA. The management
plugin that interacts with RA would have to check if the user is allowed
to perform certificate operations. In IPA v2 we decided that we will not
have a granular access control over individual operations. Instead we
will check that a user who is trying to execute a certificate command is
a member of the specific group. If he is a member of the group then he
would be able to perform any of the certificate related operations. The
name of the group will default to “administrators” but would be
changeable in a specific configuration entry (see below).</p>
</section>
<section id="actual-operations">
<span id="id3"></span><h2>Actual Operations<a class="headerlink" href="#actual-operations" title="Permalink to this heading">¶</a></h2>
<p>Since in v2 we are not planning to support certificate operations with
user certificates not all operations that will be implemented would
actually be used and exposed via UI and CLI. For example pulling on hold
and talking off hold will not possible in v2 despite the fact that RA
and management plugin will be aware of this functionality. Also there
will be no approval process. This means that any request for a
certificate will be automatically approved. In this situation a request
for new or renewed certificate should be satisfied by CA within seconds.
It would be a responsibility of the management plugin to issue request
and then immediately retrieve the certificate. If might require some
polling logic to make sure that we do not time out a bit prematurely if
it took a bit longer for CA to issue a certificate.</p>
</section>
<section id="automatic-cert-provisioning">
<span id="id4"></span><h2>Automatic Cert Provisioning<a class="headerlink" href="#automatic-cert-provisioning" title="Permalink to this heading">¶</a></h2>
<div class="line-block">
<div class="line">So far we have been talking about the administrative tasks performed
by the administrator via UI and CLI. In those scenarios the
administrator is the actor and his access control properties are
checked before a certificate operation is granted. Potentially an
administrator (depending upon his privileges of cause) can perform all
the certificate operations including issuance, renewal and revocation.
Any of these operations is manual and requires user authentication
before it can be performed.</div>
<div class="line">There is one more use case when the certificate shall be issued or
renewed but the request is not authorized by user (administrator) but
rather by a host. The use case would be as following:</div>
</div>
<ul class="simple">
<li><p>IPA enabled host runs a web application that needs certificate for
its functioning. The certificate provisioning can be scripted as a
part of the installation.</p></li>
<li><p>IPA enabled host (if told to) would renew certificate on behalf of
the application if it detects that the certificate is about to
expire.</p></li>
</ul>
<div class="line-block">
<div class="line">We will talk about how it would be actually accomplished below.</div>
<div class="line">After some evaluation we agreed that there will be limitations of what
a host can request. We decided that it can request only certificate
for itself (or service running on the same host) and not for any other
host. It can also can’t automatically revoke certificates since in
case of a bug or some misconfiguration it can have unrepairable impact
on the customer environment.</div>
</div>
<section id="ipa-client-design">
<span id="id5"></span><h3>IPA Client Design<a class="headerlink" href="#ipa-client-design" title="Permalink to this heading">¶</a></h3>
<p>To be able to request a certificate from the IPA client automatically
there should be a utility tightly integrated with the IPA client that
would aid requesting the certificate for a service running on the host.
The following diagram shows all the IPA client components involved in
the operation.</p>
<p><a class="reference external" href="image:CertProvisioningSmall.jpg">image:CertProvisioningSmall.jpg</a></p>
<ol class="arabic simple">
<li><p>The cert utility, named ipa-get-cert on the diagram, will accept
command line parameters and store them in the LDB. This is the only
thing it will do.</p></li>
<li><p>The XML-RPC Client (formerly known as policy downloader) will be a
daemon. It will be event based as any other service on the client
designed so far. It will wake up periodically and see if there is
anything it needs to do. Originally we planned that the XML-RPC
Client will be responsible for only dealing with policies, but now
its responsibilities will broaden (thus the name change). The XML-RPC
Client being a component capable of establishing XML-RPC connection
will now be in charge of requesting certificates too, since that can
be done only through XML-RPC interface. So when XML-RPC Client wakes
up it will check if it is time to get policies or do something with
certificates. Here we really have several options on how we will
implement the flow of the operations. One scenario is shown on the
diagram but there are others that we will discuss below.</p></li>
<li><p>So as shown on the diagram the XML-RPC Client will wake up and if it
is time for check for cert tasks ask the Data Provider is there is
anything to do with the certs. The data provider will get data from
LDB.</p></li>
<li><p>Before sending it back it might check if the cert is already
provisioned into the LDAP entry and pull it from there or do some
other checks if needed. This is really an optional step and
implementation would decide if it is needed.</p></li>
<li><p>The IPA Data Provider will respond to the XML-RPC Client. It can
respond that there is nothing to do (which might be caused by the
fact that there is actually nothing to do or by the fact that the
client is offline), it can hand the XML-RPC Client back the
parameters of the request it should submit over XML-RPC or it can
return the certificate if we decide that step 4 makes sense.</p></li>
<li><p>If there is work to do the XML-RPC Client will formulate a request to
the IPA server over the XML-RPC connection.</p></li>
<li><p>The results of the request need to be recorded in the LDB so the
XML-RPC Client would call the Data Provider to request update to the
LDB.</p></li>
</ol>
<p>Alternatively if we think that the XML-RPC Client would not need the
Data Provider to do any lookups the XML-RPC Client will directly
interact with LDB but it still needs to ask data provider about the
offline status. The Data Provider is the only service that has authority
to determine the offline status. So the XML-RPC Client logic might be:</p>
<ul class="simple">
<li><p>Wake up and determine what operation it is supposed to do: certs or
policies (let us say certs)</p></li>
<li><p>Ask data provider is it is offline. If yes – sleep. If no continue.</p></li>
<li><p>Check if there is the cert related data to process. If no – sleep. If
yes continue.</p></li>
<li><p>If the data shows that XML-RPC request needs to be issued, then issue
request and process the results potentially updating LDB. If the data
shows that there needs to be an LDAP lookup, then request the LDAP
lookup from IPA Data Provider over DBUS interface. Process results.
Update LDB.</p></li>
</ul>
<p>The exact logic will be figured out during the implementation but the
following main points should be assumed and not changed:</p>
<ul class="simple">
<li><p>The XML-RPC Client will be a daemon (fork-exec by the service
controller).</p></li>
<li><p>The XML-RPC Client will have a main loop that will be event based and
events will be triggered by time elapsed or emitted at the start of
the daemon.</p></li>
<li><p>The XML-RPC Client will be a client of the IPA data provider as all
other services (PAM responder, NSS responder etc.) are.</p></li>
<li><p>The XML-RPC Client is in charge of the XML-RPC connection no other
process should be aware how to do XML-RPC.</p></li>
<li><p>The XML-RPC Client is in charge of all operations that can be done
only via XML-RPC. This now includes not only getting policies but
also requesting operations from CA via RA.</p></li>
<li><p>The XML-RPC Client may or may not directly connect to LDB. It
definitely would directly connect to the configuration instance of
LDB. If we would save the certificate related data there we would not
need to use data provider to connect to it. If we decide to store
this data in the LDB instance that stores other information we might
decide that it would be beneficial to access this data through data
provider.</p></li>
</ul>
</section>
<section id="server-policy-about-clients">
<span id="id6"></span><h3>Server Policy about Clients<a class="headerlink" href="#server-policy-about-clients" title="Permalink to this heading">¶</a></h3>
<p>Though the clients would have the capability to request new certificates
or track and renew old ones it does not mean that the server would
blindly respect and execute these requests. The management plugin that
interfaces with RA would have to determine that the current XML-RPC
request is executed under host principal and not by an administrative
user (see above). In the same configuration entry that will hold the
name of the group of user that would have access to certificate
operations, there will be an attribute that would hold the policy that
will control how server would react to the client requests to issue or
renew a certificate. In IPA v2 there will be 3 supported values.</p>
<ul class="simple">
<li><p>Always - always respect host’s requests</p></li>
<li><p>Never (default) - automatically ignore all requests coming from hosts</p></li>
<li><p>Renew - respect only renew requests. The RA uses one and the same
call for issuance and renewal so it is hard to differentiate the two
scenarios. To react differently in case of certificate renewal the
plugin will check the host (or service entry) for a certificate. If
the certificate already exists in the entry, then the request will be
treated as a renewal. If there is no certificate in the entry then it
would be treated as a new request.</p></li>
</ul>
<p>The list of the values can be later extended if needed.</p>
</section>
<section id="command-line-utility">
<span id="id7"></span><h3>Command Line Utility<a class="headerlink" href="#command-line-utility" title="Permalink to this heading">¶</a></h3>
<p>Now it is time to talk about the data that utility would collect. At its
core, the tool’s function is very similar to that of ipa-getkeytab, so
we’re aiming for a command-line interface which feels similar.</p>
<p>There will be only four commands that the utility would be able to
issue:</p>
<ul class="simple">
<li><p>Request certificate and track (by default or not track if told not
to) its expiration.</p></li>
<li><p>Start tracking expiration of an already provisioned certificate</p></li>
<li><p>Stop tracking expiration of an already provisioned certificate</p></li>
<li><p>Status – list current pending requests and/or currently tracked certs</p></li>
</ul>
<p>In the case of requesting a certificate the command might look like this
(the specific details will be determined at the implementation phase):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span><span class="o">-</span><span class="n">getcert</span> <span class="n">request</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">*</span> <span class="n">If</span> <span class="n">the</span> <span class="n">client</span> <span class="n">can</span> <span class="n">conceive</span> <span class="n">of</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">CA</span><span class="p">:</span>
  <span class="o">-</span><span class="n">c</span>        <span class="n">location</span> <span class="n">of</span> <span class="n">CA</span> <span class="p">(</span><span class="nb">format</span> <span class="n">TBD</span><span class="p">)</span>
<span class="o">*</span> <span class="n">If</span> <span class="n">we</span><span class="s1">&#39;re generating a key:</span>
  <span class="o">-</span><span class="n">g</span>        <span class="n">generate</span> <span class="n">a</span> <span class="n">new</span> <span class="n">key</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">use</span> <span class="n">an</span> <span class="n">already</span><span class="o">-</span><span class="n">generated</span> <span class="n">key</span><span class="p">)</span>
  <span class="o">-</span><span class="n">G</span> <span class="n">size</span>   <span class="n">size</span> <span class="n">of</span> <span class="n">new</span> <span class="n">key</span> <span class="p">(</span><span class="n">default</span> <span class="n">TBD</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Whether</span> <span class="n">we</span><span class="s1">&#39;re generating a key or not:</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">DIR</span>    <span class="n">database</span> <span class="n">containing</span> <span class="o">/</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">private</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">cert</span> <span class="p">(</span><span class="n">NSS</span><span class="p">)</span>
  <span class="o">-</span><span class="n">n</span> <span class="n">NAME</span>   <span class="n">nickname</span> <span class="n">to</span> <span class="n">give</span> <span class="n">issued</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
  <span class="o">-</span><span class="n">k</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="n">containing</span> <span class="o">/</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">PEM</span> <span class="n">private</span> <span class="n">key</span>
  <span class="o">-</span><span class="n">f</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">issued</span> <span class="n">PEM</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span>
<span class="o">*</span> <span class="n">Whether</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">to</span> <span class="n">track</span> <span class="n">expiration</span><span class="p">:</span>
  <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">track</span><span class="o">-</span><span class="n">expiration</span>
<span class="o">*</span> <span class="n">Optional</span> <span class="n">bits</span><span class="p">:</span>
  <span class="o">-</span><span class="n">S</span> <span class="n">NAME</span>   <span class="n">requested</span> <span class="n">subject</span> <span class="n">name</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">CN</span><span class="o">=&lt;</span><span class="n">fqdn</span><span class="o">&gt;</span><span class="p">)</span>
  <span class="o">-</span><span class="n">u</span> <span class="n">USAGE</span>  <span class="n">requested</span> <span class="n">usage</span><span class="o">/</span><span class="n">eku</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">tls</span><span class="o">-</span><span class="n">server</span><span class="p">)</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">NAME</span>   <span class="n">requested</span> <span class="n">service</span> <span class="n">name</span> <span class="n">part</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">host</span><span class="p">)</span>
</pre></div>
</div>
<p>In case of starting to track a certificate’s expiration, one shall
provide the following command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span><span class="o">-</span><span class="n">getcert</span> <span class="n">start</span><span class="o">-</span><span class="n">tracking</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">*</span> <span class="n">General</span> <span class="n">options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">DIR</span>    <span class="n">database</span> <span class="n">containing</span> <span class="n">private</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">cert</span> <span class="p">(</span><span class="n">NSS</span><span class="p">)</span>
  <span class="o">-</span><span class="n">n</span> <span class="n">NAME</span>   <span class="n">nickname</span> <span class="n">of</span> <span class="n">issued</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
  <span class="o">-</span><span class="n">k</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="n">containing</span> <span class="n">PEM</span> <span class="n">private</span> <span class="n">key</span>
  <span class="o">-</span><span class="n">f</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="n">containing</span> <span class="o">/</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">issued</span> <span class="n">PEM</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span>
<span class="o">*</span> <span class="n">If</span> <span class="n">the</span> <span class="n">client</span> <span class="n">can</span> <span class="n">conceive</span> <span class="n">of</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">CA</span><span class="p">:</span>
  <span class="o">-</span><span class="n">c</span> <span class="n">ARG</span>    <span class="n">location</span> <span class="n">of</span> <span class="n">CA</span> <span class="p">(</span><span class="nb">format</span> <span class="n">TBD</span><span class="p">)</span>
</pre></div>
</div>
<p>The utility will make sure that a certificate in the given format and
place already exists and then save the information about it in the LDB.</p>
<p>In case of stopping the tracking of a certificate’s expiration, it would
be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span><span class="o">-</span><span class="n">getcert</span> <span class="n">stop</span><span class="o">-</span><span class="n">tracking</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">*</span> <span class="n">General</span> <span class="n">options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">NUM</span>    <span class="n">serial</span> <span class="n">number</span> <span class="n">of</span> <span class="n">certificate</span>
  <span class="o">-</span><span class="n">S</span> <span class="n">KEYID</span>  <span class="n">subject</span> <span class="n">key</span> <span class="n">identifier</span> <span class="k">for</span> <span class="n">certificate</span>
<span class="o">*</span> <span class="n">In</span> <span class="n">case</span> <span class="n">the</span> <span class="n">serial</span> <span class="n">number</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">certificate</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">key</span> <span class="n">identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">known</span><span class="p">:</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">DIR</span>    <span class="n">database</span> <span class="n">containing</span> <span class="n">private</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">cert</span> <span class="p">(</span><span class="n">NSS</span><span class="p">)</span>
  <span class="o">-</span><span class="n">n</span> <span class="n">NAME</span>   <span class="n">nickname</span> <span class="n">of</span> <span class="n">issued</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
  <span class="o">-</span><span class="n">k</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="n">containing</span> <span class="n">PEM</span> <span class="n">private</span> <span class="n">key</span>
  <span class="o">-</span><span class="n">f</span> <span class="n">PATH</span>   <span class="n">file</span> <span class="n">containing</span> <span class="o">/</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">issued</span> <span class="n">PEM</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">only</span> <span class="n">valid</span> <span class="k">with</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
<p>To stop tracking of the cert expiration the utility will just remove an
entry that corresponds to the given cert from the LDB.</p>
<p>The status commend will list the contents of the cert data in the LDB.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span><span class="o">-</span><span class="n">getcert</span> <span class="nb">list</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">*</span> <span class="n">General</span> <span class="n">options</span><span class="p">:</span>
  <span class="o">--</span><span class="n">requests</span>  <span class="n">List</span> <span class="n">only</span> <span class="n">information</span> <span class="n">about</span> <span class="n">outstanding</span> <span class="n">requests</span>
  <span class="o">--</span><span class="n">tracking</span>  <span class="n">List</span> <span class="n">only</span> <span class="n">information</span> <span class="n">about</span> <span class="n">tracked</span> <span class="n">certificates</span>
</pre></div>
</div>
</section>
<section id="data-stored-in-ldb">
<span id="id8"></span><h3>Data Stored in LDB<a class="headerlink" href="#data-stored-in-ldb" title="Permalink to this heading">¶</a></h3>
<p>The data stored in the LDB will look like this:</p>
<ul class="simple">
<li><p>Entry that will contain request for a new certificate</p>
<ul>
<li><p>Location of the CA (if more than one can be known to the client)</p></li>
<li><p>Server-supplied identifier for tracking the state of the request</p></li>
<li><p>Date when the request was submitted</p></li>
<li><p>Format that the certificate shall be saved in</p></li>
<li><p>Path where the certificate shall be saved</p></li>
<li><p>Should its expiration be tracked or not once it’s issued</p></li>
<li><p>Format that the private key is stored in (for later)</p></li>
<li><p>Path where the private key can be found (for later)</p></li>
</ul>
</li>
<li><p>Entry that will contain expiration tracking information</p>
<ul>
<li><p>Serial number – retrieved from the issued certificate</p></li>
<li><p>Subject name – retrieved from the issued certificate</p></li>
<li><p>Subject key identifier – retrieved / calculated from the issued
certificate</p></li>
<li><p>Certificate expiration date – retrieved from the issued
certificate</p></li>
<li><p>Format that the private key is stored in (for generating a new
request)</p></li>
<li><p>Path where the private key can be found (for generating a new
request)</p></li>
<li><p>Format that the certificate is saved in</p></li>
<li><p>Path where the certificate was saved</p></li>
</ul>
</li>
</ul>
<p>The policy downloader will look at the data taken from these LDB entries
and take appropriate action.</p>
</section>
</section>
</section>
<section id="implementation-details">
<span id="id9"></span><h1>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this heading">¶</a></h1>
<section id="proposed-administrative-interfaces">
<span id="id10"></span><h2>Proposed Administrative Interfaces<a class="headerlink" href="#proposed-administrative-interfaces" title="Permalink to this heading">¶</a></h2>
<p>The following administrative utilities are proposed. These commands are
lacking details. For example the certificate request should contain
information whether we are requesting the certificate for the service or
for the host itself.</p>
<div class="line-block">
<div class="line">``   ./ipa request-certificate [–ca=``<code class="docutils literal notranslate"><span class="pre">] [--request_type=</span></code><a href="#id11"><span class="problematic" id="id12">``</span></a>] ``</div>
<div class="line">``   where``</div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``    'ipa-ca' is default backend plugin accessing IPA's internal CA</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``      'pkcs10' is a default request type supported by default CA plugin</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``           certificate request</span></code></div>
<div class="line">``   returning               error_code, error_message, issued_certificate``</div>
<div class="line">``  ``</div>
<div class="line">``   ./ipa revoke-certificate [–ca=``<code class="docutils literal notranslate"><span class="pre">] [--reason=</span></code><a href="#id13"><span class="problematic" id="id14">``</span></a>] ``</div>
<div class="line">``   where``</div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``    'ipa-ca' is default backend plugin accessing IPA's internal CA</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``     certificate serial number of the certificate to be revoked</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` certificate revocation reason</span></code></div>
<div class="line">``   returning               error_code, error_message``</div>
<div class="line">``  ``</div>
<div class="line">``   ./ipa take-certificate-off-hold [–ca=``<a href="#id15"><span class="problematic" id="id16">``</span></a>]  ``</div>
<div class="line">``   where``</div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``    'ipa-ca' is default backend plugin accessing IPA's internal CA</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``     certificate serial number of the certificate to be taken off hold</span></code></div>
<div class="line">``   returning               error_code, error_message``</div>
<div class="line">``  ``</div>
<div class="line">``   ./ipa check_request_status [–ca=``<a href="#id17"><span class="problematic" id="id18">``</span></a>] ``</div>
<div class="line">``   where``</div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``    'ipa-ca' is default backend plugin accessing IPA's internal CA</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``        is request id of the request to be verified</span></code></div>
<div class="line">``   returning               error_code, error_message, certificate_serial_number``</div>
<div class="line">``  ``</div>
<div class="line">``   ./ipa get-certificate [–ca=``<a href="#id19"><span class="problematic" id="id20">``</span></a>] ``</div>
<div class="line">``   where``</div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``    'ipa-ca' is default backend plugin accessing IPA's internal CA</span></code></div>
<div class="line">``       <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``     certificate serial number (of previously generated certificate) to be retrieved</span></code></div>
<div class="line">``   returning               error_code, error_message, issued_certificate``</div>
</div>
</section>
<section id="multiple-ca-support">
<span id="id21"></span><h2>Multiple CA Support<a class="headerlink" href="#multiple-ca-support" title="Permalink to this heading">¶</a></h2>
<p>You can customize this list to provide required certificate management
capabilities to IPA.</p>
<p>The IPA server is very extensible and pluggable. In IPA v2 we plan to
embed the CA but that does not mean that other CA’s can’t be used. To
support other CAs the only change required is a different management
plugin that will implement interfaces described below. The –ca option
allows selecting the plugin that will serve the request. This means that
one would be able to add support to any number of CAs without changes to
UI or CLI.</p>
<p>These are preliminary interfaces. They might need to be extended to
reflect other parameters. For example we would need to add the name of
the service a certificate is requested for.</p>
<div class="line-block">
<div class="line">``       def request_certificate(self, certificate_request=None, request_type=”pkcs10”):``</div>
<div class="line">``           # . . .``</div>
<div class="line">``           return (error_code, error_message, issued_certificate)``</div>
<div class="line">``  ``</div>
<div class="line">``       def revoke_certificate(self, serial_number=None, revocation_reason=0):``</div>
<div class="line">``           # . . .``</div>
<div class="line">``           return (error_code, error_message)``</div>
<div class="line">``  ``</div>
<div class="line">``       def take_certificate_off_hold(self, serial_number=None):``</div>
<div class="line">``           # . . .``</div>
<div class="line">``           return (error_code, error_message)``</div>
<div class="line">``  ``</div>
<div class="line">``       def check_request_status(self, request_id=None):``</div>
<div class="line">``           # . . .``</div>
<div class="line">``           return (error_code, error_message, certificate_serial_number)``</div>
<div class="line">``  ``</div>
<div class="line">``       def get_certificate(self, serial_number=None):``</div>
<div class="line">``           # . . .``</div>
<div class="line">``           return (error_code, error_message, issued_certificate)``</div>
</div>
</section>
<section id="configuration-entry">
<span id="id22"></span><h2>Configuration Entry<a class="headerlink" href="#configuration-entry" title="Permalink to this heading">¶</a></h2>
<p>The configuration entry most likely will be created under cn=etc. The
configuration entry will contain two attributes:</p>
<p>Standard “manager”, “member” or “owner” attribute. This attribute has a
DN syntax. It will point to DN of the group of users that are allowed to
issue certificate commands. By default it will point to DN of the
“admins” group that is created by default at the installation. If not
present reference to “admins” group should be assumed. If we choose
“manager” and want the referential integrity plugin to be able to track
changes we would have to add “manager” attribute to the list of the
attributes tracked by the referential integrity plugin. The “member” and
“owner” attributes are already listed in the referential integrity
attribute.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">attribute ( 2.16.840.1.113730.3.8.3.TBD</span></code></div>
<div class="line">``   NAME ‘hostCApolicy’ ``</div>
<div class="line">``   DESC ‘Policy on how to treat host requests for cert operations.’ ``</div>
<div class="line">``   EQUALITY caseIgnoreMatch ``</div>
<div class="line">``   ORDERING caseIgnoreMatch ``</div>
<div class="line">``   SUBSTR caseIgnoreSubstringsMatch ``</div>
<div class="line">``   SYNTAX 1.3.6.1.4.1.1466.115.121.1.15``</div>
<div class="line">``   SINGLE-VALUE``</div>
<div class="line">``   X-ORIGIN ‘IPA v2’)``</div>
</div>
<p>If not present “Never” should be assumed.</p>
<p>Object class will look like this:</p>
<div class="line-block">
<div class="line">`` objectclass ( 2.16.840.1.113730.3.8.4.TBD``</div>
<div class="line">``   NAME ‘ipaCAaccess’ ``</div>
<div class="line">``   STRUCTURAL ``</div>
<div class="line">``   MAY (member $ hostCApolicy) ``</div>
<div class="line">``   X-ORIGIN ‘IPA v2’ )``</div>
</div>
</section>
</section>
<section id="additional-research">
<span id="id23"></span><h1>Additional Research<a class="headerlink" href="#additional-research" title="Permalink to this heading">¶</a></h1>
<p>CA provides three authentication methods to access publishing directory:</p>
<div class="line-block">
<div class="line">1. basic authentication - using specified DN with password</div>
<div class="line">2. basic authentication over SSL - using specified DN with password
over SSL</div>
<div class="line">3. client authentication - using client certificate over SSL</div>
</div>
<p>We have decided to automatically create a special CA administrative user
in pretty much the same way we create the “kdc” account during
installation.</p>
<p>This account will look like this:</p>
<div class="line-block">
<div class="line">`` # CAadmin, sysaccounts, etc, example.com``</div>
<div class="line">`` dn: uid=CAadmin,cn=sysaccounts,cn=etc,dc=example,dc=com``</div>
<div class="line">`` objectClass: account``</div>
<div class="line">`` objectClass: simplesecurityobject``</div>
<div class="line">`` objectClass: top``</div>
<div class="line">`` uid: CAadmin``</div>
<div class="line">`` userPassword: …``</div>
</div>
<p>The account like this is currently used by KDC to connect to the DS.
Similar approach should be taken by the CA. CA will use this account to
bind to DS.</p>
<p><a class="reference external" href="Category:FreeIPA_v2">Category:FreeIPA v2</a> <a class="reference external" href="Category:What_is">Category:What
is</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/archive/pages/Certificate_Management.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>