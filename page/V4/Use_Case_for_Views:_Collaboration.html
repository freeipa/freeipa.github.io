
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Use_Case_for_Views:_Collaboration &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Use_Case_for_Views:_Collaboration';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Use_Case_for_Views:_Collaboration.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Use_Case_for_Views:_Collaboration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Use_Case_for_Views:_Collaboration</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#environment">Environment</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#current-situation-ldap-and-kerberos-support">Current situation: LDAP and Kerberos support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eventually-handle-windows-too">Eventually: Handle windows too</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-logical-functions">Four logical functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-and-reconciling">Merging and Reconciling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadirectory-block">Metadirectory block</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#override-block">Override block</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meeting-the-requirements">Meeting the requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tasks-scripts-and-automation">Tasks, Scripts and Automation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#recommendations">Recommendations</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="use-case-for-views-collaboration">
<h1>Use_Case_for_Views:_Collaboration<a class="headerlink" href="#use-case-for-views-collaboration" title="Link to this heading">#</a></h1>
</section>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h1>
<p>This page describes a prototype implementation of a “merged domain” in a
collaboration context. The hosting organization defined a collaboration
environment outside it’s security boundary: the network exists outside
the organizational firewall, and corporate machines (i.e., Windows
machines joined to the internal active directory domain) are not allowed
to plug into the collaboration network. The collaboration environment is
distinct from the internal corporate environment to such a degree that
active directory is only leveraged for user authentication and basic
user attributes (sn, givenName, mail, telephoneNumber). This basic
information about corporate users was merged with external users defined
and managed by FreeIPA.</p>
<p>The merging occurred outside of FreeIPA using off-the-shelf tools.
Merged identities were required to authenticate via LDAP simple bind
(primarily for web applications) as well as Kerberos. Upstream user
account entries in LDAP were remapped to a common DIT, specific user
attributes were overridden, and the “umich_schema” was implemented to
support cross realm NFS id mapping. Cross realm posix groups, composed
of a mixture of FreeIPA and AD identities were implemented in this
external directory. Common operations are being identified and are
currently implemented via scripts which are manually run from the
command line. A basic outline of the requirements, approach, and lessons
learned is presented.</p>
<p>This work is envisioned to illustrate one potential application of
“views” and serves as a use case for the work proposed in
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3979">https://fedorahosted.org/freeipa/ticket/3979</a>. This work describes a
local linux domain loosely coupled with foreign domains, which act
strictly as identity providers. Foreign identity providers must be able
to authenticate users via Kerberos, but need not provide any descriptive
user attributes. As such, the requirements for a bare Kerberos trust are
well represented here.</p>
</section>
<section id="environment">
<h1>Environment<a class="headerlink" href="#environment" title="Link to this heading">#</a></h1>
<section id="current-situation-ldap-and-kerberos-support">
<h2>Current situation: LDAP and Kerberos support<a class="headerlink" href="#current-situation-ldap-and-kerberos-support" title="Link to this heading">#</a></h2>
<p>The following figure shows the environment in which this prototype was
implemented. An organization has an internal network and a collaboration
network separated by a firewall. Corporate identities are served by the
corporate active directory server. External identities (for
collaborators) are served by FreeIPA. In actuality, the organization in
question is undergoing a phased migration from one active directory
server (agency level) to another (department level, containing many
agencies). Thus there are two upstream active directory servers feeding
identities to the metadirectory server. This is a very specialized
merging situation which creates duplicate user entries for every
identity in the system.</p>
<figure class="align-default" id="id1">
<img alt="MergeEnvironment.png" src="../../_images/MergeEnvironment.png" />
<figcaption>
<p><span class="caption-text">MergeEnvironment.png</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The above diagram optimistically shows a one way “realm trust” (raw
Kerberos trust) from AD to FreeIPA. This trust has not yet been granted.
Without the trust, NFS and SSO functions will not work. Initial
authentication using passwords will work without a trust (anyone can
<code class="docutils literal notranslate"><span class="pre">kinit</span></code>), but sssd cannot verify identities by requesting that the KDC
issue a <code class="docutils literal notranslate"><span class="pre">host/fqdn&#64;IPA_REALM</span></code> ticket based on the received TGT. It is
able to decrypt the client part of the ticket using the provided
password, however.</p>
<p>This environment provides the ability to authenticate via ldap simple
bind as well as kerberos. Linux machines can be joined to FreeIPA, and
windows machines which call the collaboration network home (few and far
between) are more or less standalone.</p>
</section>
<section id="eventually-handle-windows-too">
<h2>Eventually: Handle windows too<a class="headerlink" href="#eventually-handle-windows-too" title="Link to this heading">#</a></h2>
<p>Windows machines calling the collaboration environment home may
eventually be managed by a standalone domain controller. These windows
machines do not have the corporate OS image loaded, and as of this
moment, have no volume licensing agreement (i.e., windows machines on
the collaboration network have neither the corporate OS image nor any
bundled software.) A domain controller may be deployed to manage these
machines, but it will bear no resemblance to the domain controller on
the internal network.</p>
<p>Currently, the collaboration environment is dominated by Linux machines
and Windows machines are few and far between.</p>
</section>
</section>
<section id="requirements">
<h1>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h1>
<p>Requirements for upstream identity providers as well as for “identity
processing” once the identities enter the local domain are presented in
the following SysML requirements diagram.</p>
<figure class="align-default" id="id2">
<img alt="IdentityRequirements.png" src="../../_images/IdentityRequirements.png" />
<figcaption>
<p><span class="caption-text">IdentityRequirements.png</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Features of this arrangement include:</p>
<ul class="simple">
<li><p>local control over locally published user attributes, leveraging
upstream’s descriptive and contact attributes where possible.</p></li>
<li><p>local management of collisions between attribute values which must be
locally unique (uid, uidNumber, gidNumber)</p></li>
<li><p>clients in the local domain do not require credentials (or knowledge
of credentials) in an upstream domain</p></li>
<li><p>centralized management of all identities accessible to local machines
and services.</p></li>
<li><p>locally defined groups which may contain users from any combination
of local and upstream identities</p></li>
<li><p>users declare their identity via the same username string to all
hosts and services within the domain.</p></li>
<li><p>there is no dependance on any particular upstream user attribute,
including a SID.</p></li>
</ul>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h1>
<section id="four-logical-functions">
<h2>Four logical functions<a class="headerlink" href="#four-logical-functions" title="Link to this heading">#</a></h2>
<p>For the local domain to provide a consistent set of users to all
services (Windows, Linux, web applications, etc.) a certain amount of
manipulation is necessary. As shown below, the majority of users are
defined in some external user store which can be used for
authentication, but which cannot be assumed to contain any descriptive
user attributes. The foreign identities and locally defined identities
are merged together, and locally important attributes are synthesized if
missing, overridden if conflicting, or passed thru if provided.</p>
<figure class="align-default" id="id3">
<img alt="FourFunctions.png" src="../../_images/FourFunctions.png" />
<figcaption>
<p><span class="caption-text">FourFunctions.png</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The end result of merging users is to provide central control over a set
of flat local namespaces. Username is one of those namespaces. There
must be a unique mapping from the username to an identity, and central
control ensures that all web applications, services, and desktop logins
respect the <em>same</em> mapping. The <code class="docutils literal notranslate"><span class="pre">uidNumber</span></code> and <code class="docutils literal notranslate"><span class="pre">gidNumber</span></code>
attributes also refer to flat namespaces which must not have collisions.
Finally, this setup provides central control over a many-to-one mapping
from <code class="docutils literal notranslate"><span class="pre">GSSAuthName</span></code> to user identity (the idea being that your one
local account can support many ways of logging into it: upstream active
directory login, various OpenID providers, SAML, etc.) This is important
for NFSv4 id mapping, and hence filesystem permissions.</p>
<p>Linux and Windows host management are defined as two separate logical
functions because it is likely that they will require separate
controllers targeted for each platform. Hosts, regardless of OS, consume
the merged identities described above.</p>
</section>
<section id="merging-and-reconciling">
<h2>Merging and Reconciling<a class="headerlink" href="#merging-and-reconciling" title="Link to this heading">#</a></h2>
<p>Of the four logical functions listed above, this prototype of views is
intended to implement only the “Merge and Reconcile” function. The major
players of this system are depicted in the following SysML block
definition diagram. The components of the system traffic in two major
types of information: LDAP info for identity attributes, and Kerberos
info for authentication. In the case of some web applications, LDAP
traffic is used for authentication as well.</p>
<figure class="align-default" id="id4">
<img alt="IdentitySystemPlayers.png" src="../../_images/IdentitySystemPlayers.png" />
<figcaption>
<p><span class="caption-text">IdentitySystemPlayers.png</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>At the present time, the two broad categories of relying parties are:
web applications and POSIX desktops, in the lower right hand corner. The
left hand column represents the components necessary to implement the
merging and reconciling function. At the top of the left column is the
top-level block, identity merge. It is composed of the metadirectory and
override directory blocks, and it is connected to upstream identity
sources.</p>
<p>Note that the metadirectory and override directory traffic only in LDAP
info. These blocks serve only to proxy, remap/merge, and override
attribute information and do not attempt to proxy Kerberos
authentication traffic. This is why the enclosing “identity merge” block
has a single identity port carrying attribute information over LDAP, but
has three individual authentication ports carrying Kerberos traffic.
These Kerberos ports just connect directly back to the KDC which owns
the identity. As noted in the diagram, in <code class="docutils literal notranslate"><span class="pre">sssd</span></code> terms this
corresponds to a single merged domain having a single identity provider
and three distinct auth providers. Regardless of the details of
implementation, this characteristic is likely to always crop up when
attempting to create a coherent local view of multiple upstream domains.</p>
</section>
<section id="metadirectory-block">
<h2>Metadirectory block<a class="headerlink" href="#metadirectory-block" title="Link to this heading">#</a></h2>
<p>The metadirectory block has been implemented by an instance of OpenLDAP
configured with a single database of type “meta”. This database proxies
upstream and local identity sources, remapping them all onto a single
DIT. It only remaps (and does not reconcile). For the upstream sources,
only a handful of user attributes are proxied. The remainder are
discarded. In particular, user attributes relevant to POSIX desktops are
discarded. Even within my agency directory, these attributes have been
inconsistently managed over the years. (Older accounts have some posix
attributes, newer accounts do not.) After the transition to the
department active directory, it is unlikely that any guarantees can be
made regarding collisions between posix attributes created and managed
by the 20 or so substantially autonomous agencies currently being
gathered under one umbrella.</p>
<p>One salient fact to note: It is expressly <em>not</em> a requirement that
corporate fileservers (within the firewall) be interoperable with
clients or fileservers in the collaboration environment (outside the
firewall). In fact, intentionally sabotaging such interoperability by
redefining <code class="docutils literal notranslate"><span class="pre">uidNumbers</span></code> in the collaboration environment may actually
be considered a security feature.</p>
<p>Existing posix attributes might as well not exist. There is no
compelling reason to respect the existing assignments, particularly if
new assignments can be automatically made. Hence, posix attributes are
stripped out of corporate upstream identity sources by the
metadirectory. All attributes from the FreeIPA server (and hence
“external users”) are proxied by the metadirectory server.</p>
<p>The metadirectory server produces a DIT which looks something like this:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ou=users,ou=remapped,dc=collaboration,dc=example,dc=org</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ou=collaboration.example.org</span></code> (served by freeipa, holding
external users)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ou=agency_AD.example.org</span></code> (there is an entire tree under here
roughly reflecting the organizational structure of my agency)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ou=department_AD.example.org</span></code> (currently proxying
“ou=Agencies”, of which my own agency is one)</p></li>
</ul>
</li>
</ul>
<p>This DIT structure allows for a single LDAP query with a base DN of
<code class="docutils literal notranslate"><span class="pre">ou=users,ou=remapped,dc=collaboration,dc=example,dc=org</span></code> to find
users regardless of which identity source contains them.</p>
</section>
<section id="override-block">
<h2>Override block<a class="headerlink" href="#override-block" title="Link to this heading">#</a></h2>
<p>The override block is implemented by an OpenLDAP server having two “hdb”
style databases. One database contains posix group definitions, with a
suffix of <code class="docutils literal notranslate"><span class="pre">ou=groups,ou=local,dc=collaboration,dc=example,dc=org</span></code>. The
other database is configured with a translucent overlay, and has an
identical suffix as the above metadirectory:
<code class="docutils literal notranslate"><span class="pre">ou=users,ou=remapped,dc=collaboration,dc=example,dc=org</span></code>. The
translucent overlay is configured to proxy the OpenLDAP server
implementing the Metadirectory block, described above. The database
contains only those attributes which are added or overridden. All other
user attributes are retrieved from the metadirectory server, which in
turn retrieves them from the upstream sources.</p>
<p>The OpenLDAP server implementing the Override block is the server to
which all hosts, services, and web applications in the domain should
connect and query.</p>
</section>
</section>
<section id="evaluation">
<h1>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading">#</a></h1>
<section id="meeting-the-requirements">
<h2>Meeting the requirements<a class="headerlink" href="#meeting-the-requirements" title="Link to this heading">#</a></h2>
<p>A basic evaluation of the prototype implementation in terms of the
requirements is portrayed in the following SysML requirements diagram.
By and large the system is functional. Of the two problems noted, only
one requires an additional feature in a software product: <code class="docutils literal notranslate"><span class="pre">sssd</span></code> does
not have a vocabulary to describe a merged domain (one identity provider
and multiple auth providers). This more or less forces users to
configure clients with one domain per auth provider, which prevents
<code class="docutils literal notranslate"><span class="pre">sssd</span></code> from taking advantage of cross-realm groups.</p>
<figure class="align-default" id="id5">
<img alt="IdentitySystemRequirementAnnotations.png" src="../../_images/IdentitySystemRequirementAnnotations.png" />
<figcaption>
<p><span class="caption-text">IdentitySystemRequirementAnnotations.png</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="tasks-scripts-and-automation">
<h2>Tasks, Scripts and Automation<a class="headerlink" href="#tasks-scripts-and-automation" title="Link to this heading">#</a></h2>
<p>Allocating posix attributes and assigning them to a user is one of the
major functions of this system. The LDAP directories themselves provide
a persistence and publication mechanism, but do not support performing
such an allocation. FreeIPA creates and manages external users. It has
been given a range of ID numbers to use. All other users not managed by
FreeIPA are allocated uidNumbers from a different range. The process is
manual, and is only triggered when someone requires access to a POSIX
desktop (either via ssh, sftp, or because they need to mount an NFS
share.) The algorithm is simple: start issuing uidNumbers at the minimum
value of the range, incrementing the “next value to be assigned” by one
with every assignment. Users who only require access to web applications
are not allocated a uidNumber.</p>
<p>Renaming users is a critical function to manage a migration from one
upstream identity source to another. All of the users will be
duplicated, except for the fact that un-migrated users will fail to
authenticate in the target directory but not the source, and vice-versa
for migrated users. Simple LDAP queries cannot return more than one DN
when querying for a user, because that may well confuse the vast
majority of web applications. In my case, the offending copy of the
users identity was renamed to “not-“.</p>
</section>
</section>
<section id="recommendations">
<h1>Recommendations<a class="headerlink" href="#recommendations" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Enhance the FreeIPA/<code class="docutils literal notranslate"><span class="pre">sssd</span></code> identity system such that it can present
a self-consistent, merged and reconciled view of identities valid for
use in the local domain. If FreeIPA is going to centralize the
management of posix attributes assigned to foreign identities, sssd
should know how to interpret them. Likewise, the correct Kerberos
principal should be constructed and the correct Kerberos KDC should
be contacted when initial authentication is necessary.</p></li>
<li><p>Enhance 389-ds with the rough equivalent of OpenLDAP’s “meta”
database and the translucent overlay. Make it possible to configure
the metadirectory and the overlay directory in the same server.</p></li>
<li><p>Automate uidNumber allocation by monitoring ldap requests for the
uidNumber attribute. (i.e., if the ldap request <em>for a specific user</em>
succeeds in finding a DN for that user, but the uidNumber attribute
is missing, then assign one, store it, and return it.) Guard against
bulk assignment of uidNumbers which are probably unintentional (i.e.,
someone types <code class="docutils literal notranslate"><span class="pre">getent</span> <span class="pre">passwd</span></code>)</p></li>
</ul>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Use_Case_for_Views:_Collaboration</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#environment">Environment</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#current-situation-ldap-and-kerberos-support">Current situation: LDAP and Kerberos support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eventually-handle-windows-too">Eventually: Handle windows too</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#four-logical-functions">Four logical functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-and-reconciling">Merging and Reconciling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadirectory-block">Metadirectory block</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#override-block">Override block</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation">Evaluation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meeting-the-requirements">Meeting the requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tasks-scripts-and-automation">Tasks, Scripts and Automation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#recommendations">Recommendations</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>