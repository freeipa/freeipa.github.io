
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CA_Certificate_Renewal &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Howto/CA_Certificate_Renewal';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/Howto/CA_Certificate_Renewal.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CA_Certificate_Renewal</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#before-you-start">Before you start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-current-ipa">Procedure in current IPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-ipa-4-1">Procedure in IPA &lt; 4.1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request-renewed-certificate">Request renewed certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-ca-certificate-on-ca-servers">Renew CA Certificate on CA Servers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-ca-certificate-on-freeipa-clients">Renew CA Certificate on FreeIPA clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-ipa-4-0">Procedure in IPA &lt; 4.0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-the-certificate">Renew the Certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-new-ca-certificate-on-your-ipa-master-ca">Install the new CA certificate on your IPA master CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-new-ca-on-other-ipa-masters-with-a-ca">Install new CA on other IPA masters with a CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-new-ca-on-other-ipa-masters-without-a-ca">Install new CA on other IPA masters without a CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-new-ca-on-all-ipa-client-machines">Install the new CA on all IPA client machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ca-certificate-renewal">
<h1>CA_Certificate_Renewal<a class="headerlink" href="#ca-certificate-renewal" title="Link to this heading">#</a></h1>
<p>This page provides manual instructions to renew the IPA CA certificate.</p>
<section id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Link to this heading">#</a></h2>
<p><strong>Important:</strong> This article is about renewing Certificate Authority (CA)
certificate which by default expires in 20 years. In ``getcert list``
its nickname is ‘caSigningCert’. If you want to renew other certificate,
e.g., a host or service certificate which typically has expiration
period 2 years and is managed by Certmonger please check <a class="reference external" href="Certmonger#Manually_renew_a_certificate">manually
renewal section of Certmonger
page</a></p>
<p>This renewal must take place in the period in which your other
certificates are still valid. Your CA needs to be running in order to
renew its own subsystem certificates. If you try to renew the CA
certificate after it has expired such that its validity dates are past
the expiration date of the CA subsystem certificates then your IPA
server will not work.</p>
<p>So for example, your CA is set to expire on 12/23, along with all the CA
subsystem certificates and likely the server certificates used by Apache
and 389-ds.</p>
<p>You come in after Christmas to find that nothing works because the
certificates have expired. When you provide your CSR to the external CA,
they will need to issue a certificate that is valid from at least Dec
22. It <strong>must overlap</strong> the old validity time. You will need to reset
the system clock on the CA back to the 22nd in order to renew the other
certificates, then you can bring time forward.</p>
</section>
<section id="procedure-in-current-ipa">
<h2>Procedure in current IPA<a class="headerlink" href="#procedure-in-current-ipa" title="Link to this heading">#</a></h2>
<p>FreeIPA 4.1 introduced <a class="reference external" href="V4/CA_certificate_renewal">integrated CA certificate renewal
tools</a>. To manually renew the CA
certificate, run:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipa-cacert-manage</span> <span class="pre">renew</span></code></p>
</section>
<section id="procedure-in-ipa-4-1">
<h2>Procedure in IPA &lt; 4.1<a class="headerlink" href="#procedure-in-ipa-4-1" title="Link to this heading">#</a></h2>
</section>
<section id="request-renewed-certificate">
<h2>Request renewed certificate<a class="headerlink" href="#request-renewed-certificate" title="Link to this heading">#</a></h2>
<p>On a random FreeIPA server with CA installed run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert start-tracking -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39; -P &lt;pin&gt; -c dogtag-ipa-ca-renew-agent</span>
<span class="c1"># getcert resubmit -i &lt;id&gt; -T ipaCSRExport</span>
<span class="c1"># getcert stop-tracking -i &lt;id&gt;</span>
</pre></div>
</div>
<p>This will get a certificate request file (CSR) in <code class="docutils literal notranslate"><span class="pre">/root/ipa.csr</span></code>.
Sign the CSR file with the <em>external CA</em> and the save the resulting
certificate to <code class="docutils literal notranslate"><span class="pre">ipa.crt</span></code> in PEM format.</p>
</section>
<section id="renew-ca-certificate-on-ca-servers">
<h2>Renew CA Certificate on CA Servers<a class="headerlink" href="#renew-ca-certificate-on-ca-servers" title="Link to this heading">#</a></h2>
<p>On all FreeIPA servers <strong>with CA</strong> installed, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /usr/lib64/ipa/certmonger/stop_pkicad</span>
<span class="c1"># certutil -A -d /etc/pki/pki-tomcat/alias -n &#39;caSigningCert cert-pki-ca&#39; -t CT,C,C -a -i ipa.crt</span>
<span class="c1"># /usr/lib64/ipa/certmonger/renew_ca_cert &#39;caSigningCert cert-pki-ca&#39;</span>
</pre></div>
</div>
<p>On all FreeIPA servers run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># certutil -A -d /etc/dirsrv/slapd-REALM -n &#39;REALM IPA CA&#39; -t CT,,C -f /etc/dirsrv/slapd-REALM/pwdfile.txt -a -i ipa.crt</span>
<span class="c1"># certutil -A -d /etc/httpd/alias -n &#39;REALM IPA CA&#39; -t CT,C,C -f /etc/httpd/alias/pwdfile.txt -a -i ipa.crt</span>
<span class="c1"># systemctl restart dirsrv@REALM.service</span>
<span class="c1"># systemctl restart httpd</span>
</pre></div>
</div>
</section>
<section id="renew-ca-certificate-on-freeipa-clients">
<h2>Renew CA Certificate on FreeIPA clients<a class="headerlink" href="#renew-ca-certificate-on-freeipa-clients" title="Link to this heading">#</a></h2>
<p>On all FreeIPA servers and FreeIPA clients run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># certutil -A -d /etc/pki/nssdb -n &#39;IPA CA&#39; -t CT,C,C -a -i ipa.crt</span>
<span class="c1"># cp ipa.crt /etc/ipa/ca.crt</span>
</pre></div>
</div>
</section>
<section id="procedure-in-ipa-4-0">
<h2>Procedure in IPA &lt; 4.0<a class="headerlink" href="#procedure-in-ipa-4-0" title="Link to this heading">#</a></h2>
<p>You need the original CSR in order to obtain a new certificate. You may
be able to find this in one of three places:</p>
<ol class="arabic simple">
<li><p>The external CA may still have a copy of it</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">/root/ipa.csr</span></code> on the initial IPA master</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">/etc/pki-ca/CS.cfg</span></code> in <code class="docutils literal notranslate"><span class="pre">ca.signing.certreq</span></code> on the initial
IPA master. This will need to be converted to PEM format.</p></li>
</ol>
<p>You’ll need to know the nickname of your CA in the NSS databases. This
is usually ‘” IPA CA”. I will use “EXAMPLE.COM IPA CA”.</p>
<p>You can query the Apache database to find out what this currently is:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-L</span> <span class="pre">-d</span> <span class="pre">/etc/httpd/alias</span></code></p>
</section>
<section id="renew-the-certificate">
<h2>Renew the Certificate<a class="headerlink" href="#renew-the-certificate" title="Link to this heading">#</a></h2>
<p>Give the CSR to your external CA and have them issue you a new
certificate. This document assumes that the resulting certificate is
saved into /root/ipa.crt and that the external CA certificate chain is
saved into /root/external-ca.pem.</p>
<p>You will need to do this renewal on the IPA CA designated for managing
renewals.</p>
<p>One way to identify the initial IPA master is to see if the value for
<code class="docutils literal notranslate"><span class="pre">subsystem.select</span></code> is New.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># grep subsystem.select /etc/pki-ca/CS.cfg</span>
<span class="n">subsystem</span><span class="o">.</span><span class="n">select</span><span class="o">=</span><span class="n">New</span>
</pre></div>
</div>
<p>An alternative method is to look at the post-save command in this
output. It needs to be renew_ca_cert:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># getcert list</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">certificates</span> <span class="ow">and</span> <span class="n">requests</span> <span class="n">being</span> <span class="n">tracked</span><span class="p">:</span> <span class="mf">8.</span>
<span class="n">Request</span> <span class="n">ID</span> <span class="s1">&#39;20131125153455&#39;</span><span class="p">:</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">MONITORING</span>
        <span class="n">stuck</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">key</span> <span class="n">pair</span> <span class="n">storage</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="n">NSSDB</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;/var/lib/pki-ca/alias&#39;</span><span class="p">,</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;auditSigningCert cert-pki-ca&#39;</span><span class="p">,</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;NSS Certificate DB&#39;</span><span class="p">,</span><span class="n">pin</span><span class="o">=</span><span class="s1">&#39;455536908955&#39;</span>
        <span class="n">certificate</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="n">NSSDB</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;/var/lib/pki-ca/alias&#39;</span><span class="p">,</span><span class="n">nickname</span><span class="o">=</span><span class="s1">&#39;auditSigningCert cert-pki-ca&#39;</span><span class="p">,</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;NSS Certificate DB&#39;</span>
        <span class="n">CA</span><span class="p">:</span> <span class="n">dogtag</span><span class="o">-</span><span class="n">ipa</span><span class="o">-</span><span class="n">renew</span><span class="o">-</span><span class="n">agent</span>
        <span class="n">issuer</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">Certificate</span> <span class="n">Authority</span><span class="p">,</span><span class="n">O</span><span class="o">=</span><span class="n">EXAMPLE</span><span class="o">.</span><span class="n">COM</span>
        <span class="n">subject</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">CA</span> <span class="n">Audit</span><span class="p">,</span><span class="n">O</span><span class="o">=</span><span class="n">EXAMPLE</span><span class="o">.</span><span class="n">COM</span>
        <span class="n">expires</span><span class="p">:</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">15</span> <span class="mi">15</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">12</span> <span class="n">UTC</span>
        <span class="n">pre</span><span class="o">-</span><span class="n">save</span> <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ipa</span><span class="o">/</span><span class="n">certmonger</span><span class="o">/</span><span class="n">stop_pkicad</span>
        <span class="n">post</span><span class="o">-</span><span class="n">save</span> <span class="n">command</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ipa</span><span class="o">/</span><span class="n">certmonger</span><span class="o">/</span><span class="n">renew_ca_cert</span> <span class="s2">&quot;auditSigningCert cert-pki-ca&quot;</span>
        <span class="n">track</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">auto</span><span class="o">-</span><span class="n">renew</span><span class="p">:</span> <span class="n">yes</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="install-the-new-ca-certificate-on-your-ipa-master-ca">
<h2>Install the new CA certificate on your IPA master CA<a class="headerlink" href="#install-the-new-ca-certificate-on-your-ipa-master-ca" title="Link to this heading">#</a></h2>
<p>The CA needs to be shut down in order to update its certificate:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">stop</span></code></p>
<p>Update the CA certificate NSS database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/var/lib/pki-ca/alias</span> <span class="pre">-n</span> <span class="pre">'caSigningCert</span> <span class="pre">cert-pki-ca'</span> <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Replace the value of <code class="docutils literal notranslate"><span class="pre">ca.signing.cert</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/pki-ca/CS.cfg</span></code>. This
is the base64 value of the certificate. You can obtain this by removing
the BEGIN/END blocks from ipa.crt and compressing it into a single line.</p>
<p>Update the Apache NSS database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/httpd/alias</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the LDAP server instances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># certutil -A -d /etc/dirsrv/slapd-REALM -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
<span class="c1"># certutil -A -d /etc/dirsrv/slapd-PKI-IPA -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
</pre></div>
</div>
<p>Update the shared system database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/pki/nssdb</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the CA in the filesystem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat /root/ipa.crt /root/external-ca.pem &gt;/usr/share/ipa/html/ca.crt</span>
<span class="c1"># cp /root/ipa.crt /etc/ipa/ca.crt</span>
</pre></div>
</div>
<p>Restart the world</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">start</span></code></p>
<p>Update the CA in LDAP</p>
<p>First convert the certificate to DER form:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">openssl</span> <span class="pre">x509</span> <span class="pre">-outform</span> <span class="pre">DER</span> <span class="pre">-in</span> <span class="pre">/root/ipa.crt</span>&#160; <span class="pre">-out</span> <span class="pre">/tmp/ipa.der</span></code></p>
<p>Add to LDAP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># kinit admin</span>
<span class="c1"># ldapmodify -Y GSSAPI</span>
<span class="n">SASL</span><span class="o">/</span><span class="n">GSSAPI</span> <span class="n">authentication</span> <span class="n">started</span>
<span class="n">SASL</span> <span class="n">username</span><span class="p">:</span> <span class="n">admin</span><span class="nd">@EXAMPLE</span><span class="o">.</span><span class="n">COM</span>
<span class="n">SASL</span> <span class="n">SSF</span><span class="p">:</span> <span class="mi">56</span>
<span class="n">SASL</span> <span class="n">data</span> <span class="n">security</span> <span class="n">layer</span> <span class="n">installed</span><span class="o">.</span>
<span class="n">dn</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">CAcert</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">ipa</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">etc</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">changetype</span><span class="p">:</span> <span class="n">modify</span>
<span class="n">replace</span><span class="p">:</span> <span class="n">cacertificate</span><span class="p">;</span><span class="n">binary</span>
<span class="n">cacertificate</span><span class="p">;</span><span class="n">binary</span><span class="p">:</span><span class="o">&lt;</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipa</span><span class="o">.</span><span class="n">der</span>
</pre></div>
</div>
</section>
<section id="install-new-ca-on-other-ipa-masters-with-a-ca">
<h2>Install new CA on other IPA masters with a CA<a class="headerlink" href="#install-new-ca-on-other-ipa-masters-with-a-ca" title="Link to this heading">#</a></h2>
<p>The CA needs to be shut down in order to update its certificate:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">stop</span></code></p>
<p>Update the CA certificate NSS database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/var/lib/pki-ca/alias</span> <span class="pre">-n</span> <span class="pre">'caSigningCert</span> <span class="pre">cert-pki-ca'</span> <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Replace the value of <code class="docutils literal notranslate"><span class="pre">ca.signing.cert</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/pki-ca/CS.cfg</span></code>. This
is the base64 value of the certificate. You can obtain this by removing
the BEGIN/END blocks from ipa.crt and compressing it into a single line.</p>
<p>Update the Apache NSS database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/httpd/alias</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the LDAP server instances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># certutil -A -d /etc/dirsrv/slapd-REALM -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
<span class="c1"># certutil -A -d /etc/dirsrv/slapd-PKI-IPA -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
</pre></div>
</div>
<p>Update the shared system database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/pki/nssdb</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the CA in the filesystem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat /root/ipa.crt /root/external-ca.pem &gt;/usr/share/ipa/html/ca.crt</span>
<span class="c1"># cp /root/ipa.crt /etc/ipa/ca.crt</span>
</pre></div>
</div>
<p>Restart the world</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">start</span></code></p>
</section>
<section id="install-new-ca-on-other-ipa-masters-without-a-ca">
<h2>Install new CA on other IPA masters without a CA<a class="headerlink" href="#install-new-ca-on-other-ipa-masters-without-a-ca" title="Link to this heading">#</a></h2>
<p>Copy the updated CA to the machine. I’m assuming it is in /root/ipa.crt.</p>
<p>Stop the world</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">stop</span></code></p>
<p>Update the Apache NSS database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/httpd/alias</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the LDAP server instances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># certutil -A -d /etc/dirsrv/slapd-REALM -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
<span class="c1"># certutil -A -d /etc/dirsrv/slapd-PKI-IPA -n &#39;EXAMPLE.COM IPA CA&#39; -t CT,C,C -a -i /root/ipa.crt</span>
</pre></div>
</div>
<p>Update the shared system database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/pki/nssdb</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the CA in the filesystem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat /root/ipa.crt /root/external-ca.pem &gt;/usr/share/ipa/html/ca.crt</span>
<span class="c1"># cp /root/ipa.crt /etc/ipa/ca.crt</span>
</pre></div>
</div>
<p>Restart the world</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">service</span> <span class="pre">ipa</span> <span class="pre">start</span></code></p>
</section>
<section id="install-the-new-ca-on-all-ipa-client-machines">
<h2>Install the new CA on all IPA client machines<a class="headerlink" href="#install-the-new-ca-on-all-ipa-client-machines" title="Link to this heading">#</a></h2>
<p>Retrieve the updated IPA CA, I’ve put it into /root/ipa.crt.</p>
<p>Update the shared system database:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">certutil</span> <span class="pre">-A</span> <span class="pre">-d</span> <span class="pre">/etc/pki/nssdb</span> <span class="pre">-n</span> <span class="pre">'EXAMPLE.COM</span> <span class="pre">IPA</span> <span class="pre">CA'</span>&#160; <span class="pre">-t</span> <span class="pre">CT,C,C</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">/root/ipa.crt</span></code></p>
<p>Update the CA in the filesystem:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">cp</span> <span class="pre">/root/ipa.crt</span> <span class="pre">/etc/ipa/ca.crt</span></code></p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<p>See the <a class="reference external" href="Troubleshooting#PKI_Issues">Troubleshooting Guide</a>.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#before-you-start">Before you start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-current-ipa">Procedure in current IPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-ipa-4-1">Procedure in IPA &lt; 4.1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request-renewed-certificate">Request renewed certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-ca-certificate-on-ca-servers">Renew CA Certificate on CA Servers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-ca-certificate-on-freeipa-clients">Renew CA Certificate on FreeIPA clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procedure-in-ipa-4-0">Procedure in IPA &lt; 4.0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renew-the-certificate">Renew the Certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-new-ca-certificate-on-your-ipa-master-ca">Install the new CA certificate on your IPA master CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-new-ca-on-other-ipa-masters-with-a-ca">Install new CA on other IPA masters with a CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-new-ca-on-other-ipa-masters-without-a-ca">Install new CA on other IPA masters without a CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-new-ca-on-all-ipa-client-machines">Install the new CA on all IPA client machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>