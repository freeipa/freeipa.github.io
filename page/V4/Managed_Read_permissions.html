

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Managed_Read_permissions &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Managed_Read_permissions';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Managed_Read_permissions.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Managed_Read_permissions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Managed_Read_permissions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation-draft">Documentation draft</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade-considerations">Upgrade considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removed-default-permissions">Removed default permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changed-attribute-lists">Changed attribute lists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-aci-changes">Other ACI changes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem">The problem</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managed-permissions">Managed Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cli-api">CLI &amp; API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-permission-updater">Default Permission Updater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-legacy-default-permissions">Replacing legacy default permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-the-global-anonymous-read-aci">Removing the global anonymous read ACI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aci-txt">ACI.txt</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-managment">Feature Managment</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#major-configuration-options-and-enablement">Major configuration options and enablement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies">Dependencies</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#external-impact">External Impact</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-and-restore">Backup and Restore</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="managed-read-permissions">
<h1>Managed_Read_permissions<a class="headerlink" href="#managed-read-permissions" title="Permalink to this heading">#</a></h1>
</section>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h1>
<p>The IPA framework will handle default permissions more robustly with
respect to IPA updates and user-made changes.</p>
<p>In the future, this allow us to create a system of fine-grained,
user-controllable permissions with good defaults and predictable
behavior over upgrades.</p>
</section>
<section id="use-cases">
<h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">#</a></h1>
<p>Modifications to permissions that come with FreeIPA by default will be
restricted to changing the attribute lists and bind types.</p>
<p>For example, attempting to change a default “Modify Users” permission to
apply to Groups will fail:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa permission-mod 'System: Modify Users' --type=group</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa: ERROR: invalid 'ipapermlocation': not modifiable on managed permissions</span></code></div>
</div>
<p>So will attempting to make it apply to Read operations:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa permission-mod 'System: Modify Users' --right=read,</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa: ERROR: invalid 'ipapermright': not modifiable on managed permissions</span></code></div>
</div>
<p>On the other hand, making the permission not apply to the “gecos”
attribute is possible:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa permission-mod 'System: Modify Users' --excludedattrs=gecos</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">------------------------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Modified permission &quot;System: Modify Users&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">------------------------------------------</span></code></div>
<div class="line">``  Permission name: System: Modify Users``</div>
<div class="line">``  Granted rights: write``</div>
<div class="line">``  Effective attributes: businesscategory, carlicense, cn, description, displayname, employeetype, facsimiletelephonenumber, givenname, homephone, inetuserhttpurl, initials, l, labeleduri, loginshell, manager, mepmanagedentry, mobile, objectclass, ou, pager, postalcode,``</div>
<div class="line">``                        preferredlanguage, roomnumber, secretary, seealso, sn, st, street, telephonenumber, title, userclass``</div>
<div class="line">``  Excluded attributes: gecos``</div>
<div class="line">``  Default attributes: telephonenumber, cn, labeleduri, manager, street, displayname, homephone, title, facsimiletelephonenumber, loginshell, employeetype, description, businesscategory, preferredlanguage, roomnumber, mepmanagedentry, carlicense, postalcode, givenname,``</div>
<div class="line">``                      pager, seealso, objectclass, inetuserhttpurl, l, st, mobile, gecos, sn, ou, secretary, userclass, initials``</div>
<div class="line">``  Bind rule type: permission``</div>
<div class="line">``  Subtree: cn=users,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com``</div>
<div class="line">``  Type: user``</div>
<div class="line">``  Granted to Privilege: Modify Users and Reset passwords, User Administrators``</div>
<div class="line">``  Indirect Member of roles: helpdesk, User Administrator``</div>
</div>
<p>So is changing the bind rule type, i.e. making a permission apply to all
authenticated users, anyone including anonymous users, or specific users
selected by privileges:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa permission-mod 'System: Read User Membership' --bindtype=anonymous</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------------------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Modified permission &quot;System: Read User Membership&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------------------------------------</span></code></div>
<div class="line">``  Permission name: System: Read User Membership``</div>
<div class="line">``  Granted rights: read, compare, search``</div>
<div class="line">``  Effective attributes: memberof``</div>
<div class="line">``  Default attributes: memberof``</div>
<div class="line">``  Bind rule type: anonymous``</div>
<div class="line">``  Subtree: cn=users,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com``</div>
<div class="line">``  Type: user``</div>
</div>
</section>
<section id="documentation-draft">
<h1>Documentation draft<a class="headerlink" href="#documentation-draft" title="Permalink to this heading">#</a></h1>
<p>This section explains the behavior from the user’s point of view:</p>
<p>“Managed” permissions are those permissions that come pre-installed with
IPA, and are updated in new releases to cover new functionality. They
behave like regular, user-created permissions, with these differences:</p>
<ul class="simple">
<li><p>Their name, location and target can not be modified</p></li>
<li><p>They cannot be deleted (but note that setting default bindtype and
removing from all privileges will effectively disable a permission)</p></li>
<li><p>They have three sets of attributes:</p>
<ul>
<li><p><em>default</em> attributes, managed by IPA, cannot be changed by the
user</p></li>
<li><p><em>included</em> attributes (–includedattrs in the CLI) are extra attrs
that the user has added</p></li>
<li><p><em>excluded</em> attributes (–excludedattrs in the CLI) are those that
the user has removed</p></li>
</ul>
</li>
</ul>
<p>The permission applies to all attributes that appear in either its
<em>default</em> or <em>included</em> sets, but not in its <em>excluded</em> set.</p>
<p>It is possible to control the effective attributes using
permission-mod’s –attrs option, as with other permissions. The modifies
the <em>included</em> and <em>excluded</em> lists so that the effective list matches
the request.</p>
<p>(Note that attributes of user-created permissions work the same way, but
since the <em>default</em> and <em>excluded</em> sets are empty, only the <em>included</em>
set determines the effective attributes.)</p>
<p>Newer versions of IPA may add additional attributes to the <em>default</em>
set. Attributes added this way should be listed in the corresponding
Release Notes. If some of the new attributes are undesirable, add them
to the corresponding <em>excluded</em> list before the upgrade.</p>
<p>All managed permissions currently have the “System:” prefix in their
name, to prevent naming clashes between user-created permissions and
future IPA defaults.</p>
<p>In FreeIPA 4.0, most default permissions have been turned into Managed
ones. Some permissions still use the old “SYSTEM” scheme (i.e. they are
not modifiable, but may be only assigned to privileges). A list of these
permissions follows:</p>
<ul class="simple">
<li><p>Add Automember Rebuild Membership Task</p></li>
<li><p>Add Replication Agreements</p></li>
<li><p>Certificate Remove Hold</p></li>
<li><p>Get Certificates status from the CA</p></li>
<li><p>Modify DNA Range</p></li>
<li><p>Modify Replication Agreements</p></li>
<li><p>Remove Replication Agreements</p></li>
<li><p>Request Certificate</p></li>
<li><p>Request Certificates from a different host</p></li>
<li><p>Retrieve Certificates from the CA</p></li>
<li><p>Revoke Certificate</p></li>
<li><p>Write IPA Configuration</p></li>
</ul>
<section id="upgrade-considerations">
<h2>Upgrade considerations<a class="headerlink" href="#upgrade-considerations" title="Permalink to this heading">#</a></h2>
<p>When upgrading to IPA 4.0, the process will convert old default
permissions, such as.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipa-3-3$ ipa permission-find 'Modify Groups'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">1 permission matched</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------</span></code></div>
<div class="line">``  Permission name: Modify Groups``</div>
<div class="line">``  Permissions: write``</div>
<div class="line">``  Attributes: cn, description, gidnumber, objectclass, mepmanagedby, ipauniqueid``</div>
<div class="line">``  Type: group``</div>
<div class="line">``  Granted to Privilege: Group Administrators``</div>
<div class="line">``  Indirect Member of roles: User Administrator``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Number of entries returned 1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
</div>
<p>to managed ones, e.g.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa permission-find 'System: Modify Groups'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">1 permission matched</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--------------------</span></code></div>
<div class="line">``  Permission name: System: Modify Groups``</div>
<div class="line">``  Granted rights: write``</div>
<div class="line">``  Effective attributes: cn, description, gidnumber, ipauniqueid, mepmanagedby, objectclass``</div>
<div class="line">``  Default attributes: cn, objectclass, mepmanagedby, gidnumber, ipauniqueid, description``</div>
<div class="line">``  Bind rule type: permission``</div>
<div class="line">``  Subtree: cn=groups,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com``</div>
<div class="line">``  Type: group``</div>
<div class="line">``  Granted to Privilege: Group Administrators``</div>
<div class="line">``  Indirect Member of roles: User Administrator``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Number of entries returned 1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
</div>
<p>If the default permissions that come with IPA have been modified,
special care should be taken when upgrading.</p>
</section>
<section id="removed-default-permissions">
<h2>Removed default permissions<a class="headerlink" href="#removed-default-permissions" title="Permalink to this heading">#</a></h2>
<p>If a default permission was removed, the upgrade process will simply
create a new default permission. This is consistent with to how all IPA
upgrades work.</p>
</section>
<section id="changed-attribute-lists">
<h2>Changed attribute lists<a class="headerlink" href="#changed-attribute-lists" title="Permalink to this heading">#</a></h2>
<p>If only the attribute list differs from a past default, the permission
updater will set the <em>included</em>/<em>excluded</em> lists of the new default
permission to match the modifications.</p>
<p>Note that the updater considers default values from all past IPA
versions. Be sure to check the result after updating.</p>
</section>
<section id="other-aci-changes">
<h2>Other ACI changes<a class="headerlink" href="#other-aci-changes" title="Permalink to this heading">#</a></h2>
<p>If any other changes were made to a default permission, the updater
emits a warning and does not create the new permission. In this case,
there are two options:</p>
<p>1) Delete the old permission (e.g.
<code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">permission-del</span> <span class="pre">'Modify</span> <span class="pre">Groups'</span></code>), then run
<code class="docutils literal notranslate"><span class="pre">ipa-ldap-updater</span> <span class="pre">-p</span></code>. This will create the new default permission.</p>
<p>2) Change the old permission to a new-style (V2) permission by issuing
e.g. <code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">permission-mod</span> <span class="pre">'Modify</span> <span class="pre">Groups'</span></code> <em>on a server with IPA 4.0+</em>,
then run <code class="docutils literal notranslate"><span class="pre">ipa-ldap-updater</span> <span class="pre">-p</span></code>. This will also create the new default
permission, but the old one will be preserved as a user-created
permission.</p>
</section>
</section>
<section id="the-problem">
<h1>The problem<a class="headerlink" href="#the-problem" title="Permalink to this heading">#</a></h1>
<p>Currently, updates to permissions that come with IPA are specified in
.update files.</p>
<p>This approach has the disadvantage that if the user modifies the
permission, the updater will not recognize it, so it will end up not
being updated. This may result in reduced functionality (if needed
attributes are not added), or security issues (if attributes are not
deleted).</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h1>
<section id="managed-permissions">
<h2>Managed Permissions<a class="headerlink" href="#managed-permissions" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="V3/Permissions_V2">V2 permissions</a> with the <code class="docutils literal notranslate"><span class="pre">MANAGED</span></code> flag set are
called Managed permissions.</p>
<p>These permissions grant access to a set of attributes defined by IPA and
kept up-to-date on upgrades, while allowing users to add or remove
specific attributes from the default list.</p>
<p>The user can also manage the bind rule and privilege membership of
Managed permissions.</p>
<p>The other aspects of Managed permissions (name, location, target) are
not modifiable by the user. The user cannot manually add new Managed
permissions, or delete existing ones (unless –force is applied; but
later we may restrict this via ACIs).</p>
<p>To ensure that installing low-version replicas or disabling plugins does
not revoke access to existing data, the default list of attributes will
be kept in LDAP as <code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr</span></code>. Users can not modify this
list via the framework. On updates, new attributes will <em>only</em> be added
to this list. (To remove attributes, we would need to write a separate
update plugin.)</p>
<p>There will be two attribute types for holding attributes the admin added
and removed: <code class="docutils literal notranslate"><span class="pre">ipaPermIncludedAttr</span></code> and <code class="docutils literal notranslate"><span class="pre">ipaPermExcludedAttr</span></code>
respectively. (In user-created permissions, <code class="docutils literal notranslate"><span class="pre">ipaPermIncludedAttr</span></code> is
used for the same purpose as here, and excluded &amp; default are empty.)
See <a class="reference external" href="V3/Permissions_V2">V3/Permissions V2</a> for the schema definition.</p>
<p>When generating the ACI, the resulting attribute list will be computed
by taking the <code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr</span></code> set, adding any
<code class="docutils literal notranslate"><span class="pre">ipaPermIncludedAttr</span></code>s, and then removing any
<code class="docutils literal notranslate"><span class="pre">ipaPermExcludedAttr</span></code>s.</p>
<p>For example, this permission:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dn: cn=Read Users,cn=permissions,cn=pbac,$SUFFIX</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">cn: Read Users</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr: cn</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr: sn</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr: givenName</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermDefaultAttr: l</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermIncludedAttr: favoriteColor</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermExcludedAttr: givenName</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: top</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass: groupOfNames</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: ipaPermission</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectclass: ipaManagedPermission</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermType: SYSTEM</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermType: V2</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermType: MANAGED</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermLocation: cn=users,cn=accounts,$SUFFIX</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermRight: read</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermTarget: uid=*,cn=users,cn=accounts,$SUFFIX</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ipaPermBindRuleType: permission</span></code></div>
</div>
<p>would allow users to read all default user attributes except
<code class="docutils literal notranslate"><span class="pre">givenName</span></code>, plus additionally <code class="docutils literal notranslate"><span class="pre">favoriteColor</span></code>.</p>
</section>
<section id="cli-api">
<h2>CLI &amp; API<a class="headerlink" href="#cli-api" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">permission-{mod,find}</span></code> commands will gain two new options,
<code class="docutils literal notranslate"><span class="pre">--includedattrs</span></code> (API: <code class="docutils literal notranslate"><span class="pre">ipapermincludedattr</span></code>) and
<code class="docutils literal notranslate"><span class="pre">--excludedattrs</span></code> (API: <code class="docutils literal notranslate"><span class="pre">ipapermexcludedattr</span></code>). For
<code class="docutils literal notranslate"><span class="pre">permission-mod</span></code> it is an error to use <code class="docutils literal notranslate"><span class="pre">--excludedattrs</span></code> with
non-managed permissions.</p>
<p>For a managed permission, the <code class="docutils literal notranslate"><span class="pre">permission-{mod,find,show}</span></code> commands
will output all three lists (<code class="docutils literal notranslate"><span class="pre">ipapermdefaultattr</span></code>,
<code class="docutils literal notranslate"><span class="pre">ipapermallowedattr</span></code>, <code class="docutils literal notranslate"><span class="pre">ipapermexcludedattr</span></code>), as well as the
computed list of effective attributes.</p>
<p>For a non-managed permission, <code class="docutils literal notranslate"><span class="pre">permission-{mod,find,show}</span></code> will only
output the effective attributes (<code class="docutils literal notranslate"><span class="pre">attrs</span></code>). With <code class="docutils literal notranslate"><span class="pre">--all</span></code>, the
included attributes will also be included. As any missing attribute
course excluded and default will not be output. With <code class="docutils literal notranslate"><span class="pre">--raw</span></code>, only
<code class="docutils literal notranslate"><span class="pre">ipaPermIncludedAttr</span></code>, and not <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, wil be output.</p>
<p>It is an error to set the <code class="docutils literal notranslate"><span class="pre">ipapermlocation</span></code>, <code class="docutils literal notranslate"><span class="pre">ipapermtargetfilter</span></code>,
or <code class="docutils literal notranslate"><span class="pre">ipapermtarget</span></code> of a managed permission. (This means that it’s an
error to ise the API options <code class="docutils literal notranslate"><span class="pre">subtree</span></code>, <code class="docutils literal notranslate"><span class="pre">extratargetfilter</span></code>,
<code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">memberof</span></code>, <code class="docutils literal notranslate"><span class="pre">targetgroup</span></code>, or <code class="docutils literal notranslate"><span class="pre">type</span></code> with a managed
permission.)</p>
</section>
<section id="default-permission-updater">
<h2>Default Permission Updater<a class="headerlink" href="#default-permission-updater" title="Permalink to this heading">#</a></h2>
<p>A server post-update plugin will walk through ipalib <code class="docutils literal notranslate"><span class="pre">Object</span></code> plugins
and create/update managed permissions pertaining to them.</p>
<p>Names of such default permissions are <em>required</em> to start with “System:
“, so that default permissions added in future IPA releases do not
conflict with user-created permissions. The “:” character will not be
usable in <code class="docutils literal notranslate"><span class="pre">permission-add</span></code>. (It will be usable in <code class="docutils literal notranslate"><span class="pre">permission-mod</span></code>
and <code class="docutils literal notranslate"><span class="pre">permission-del</span></code>, where managed permissions are subject to the
limitations stated above.)</p>
<p>The IPA Object plugins will gain a new Python attribute,
<code class="docutils literal notranslate"><span class="pre">managed_permissions</span></code>, which will hold a template for the permissions
that are to be added by default to manage that object.</p>
<p>This will allow plugins to be more self-contained; it will no longer be
necessary to modify IPA’s update files to add the common cases of
plugin-specific permissions.</p>
<p>The format of the managed_permissions templates will be documented in
the <code class="docutils literal notranslate"><span class="pre">update_managed_permissions</span></code> server plugin
(<a class="reference external" href="https://git.fedorahosted.org/cgit/freeipa.git/tree/ipaserver/install/plugins/update_managed_permissions.py">link</a>).</p>
</section>
<section id="replacing-legacy-default-permissions">
<h2>Replacing legacy default permissions<a class="headerlink" href="#replacing-legacy-default-permissions" title="Permalink to this heading">#</a></h2>
<p>Another entry in the <code class="docutils literal notranslate"><span class="pre">managed_permissions</span></code>template, <code class="docutils literal notranslate"><span class="pre">replaces</span></code>,
will be used for replacing legacy permissions with new managed ones.
Example:</p>
<div class="line-block">
<div class="line">``   managed_permissions = {``</div>
<div class="line">``       ‘ipa:Modify SUDO Rule’: {``</div>
<div class="line">``           ‘ipapermbindruletype’: ‘permission’,``</div>
<div class="line">``           ‘ipapermright’: {‘write’},``</div>
<div class="line">``           ‘ipapermdefaultattr’: {``</div>
<div class="line">``               ‘description’, ‘ipaenabledflag’, ‘usercategory’,``</div>
<div class="line">``               ‘hostcategory’, ‘cmdcategory’, ‘ipasudorunasusercategory’,``</div>
<div class="line">``               ‘ipasudorunasgroupcategory’, ‘externaluser’,``</div>
<div class="line">``               ‘ipasudorunasextuser’, ‘ipasudorunasextgroup’, ‘memberdenycmd’,``</div>
<div class="line">``               ‘memberallowcmd’, ‘memberuser’``</div>
<div class="line">``           },``</div>
<div class="line">``           ‘replaces’: [``</div>
<div class="line">``               ‘(targetattr = “description || ipaenabledflag || usercategory || hostcategory || cmdcategory || ipasudorunasusercategory || ipasudorunasgroupcategory || externaluser || ipasudorunasextuser || ipasudorunasextgroup || memberdenycmd || memberallowcmd || memberuser”)(target = “<code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">```ldap:///ipauniqueid=</span></code> &lt;<a class="reference external" href="ldap:///ipauniqueid=">ldap:///ipauniqueid=</a>&gt;`__<code class="docutils literal notranslate"><span class="pre">*,cn=sudorules,cn=sudo,$SUFFIX&quot;)(version 3.0;acl &quot;permission:Modify Sudo rule&quot;;allow (write) groupdn = &quot;</span></code><code class="docutils literal notranslate"><span class="pre">`ldap:///cn=Modify</span></code> &lt;<a class="reference external" href="ldap:///cn=Modify">ldap:///cn=Modify</a>&gt;`__`` Sudo rule,cn=permissions,cn=pbac,$SUFFIX”;)’,``</div>
<div class="line">``           }``</div>
<div class="line">``       },``</div>
<div class="line">``       …``</div>
</div>
<p>If the an existing <em>legacy</em> (i.e. non-v2) permission exists either
without an associated ACI or with an ACI that <em>exactly</em> matches the
information specified in the <code class="docutils literal notranslate"><span class="pre">replaces</span></code> list, the old permission is
removed after the new one is added.</p>
<p>This ensures that</p>
<ul class="simple">
<li><p>the old permission is retained if the user has changed it</p></li>
<li><p>at no time are the ACIs revoked (briefly, there are two ACIs granting
the same access).</p></li>
</ul>
<p>If an existing legacy permission does match <code class="docutils literal notranslate"><span class="pre">cn</span></code> but <em>not</em> some other
attributes in the <code class="docutils literal notranslate"><span class="pre">replaces</span></code> dict, a warning is logged, the new
permission is added, and the old one is left in place.</p>
<p>The exception are attributes. If the ACI only differs in the list of
attributes, the permission is upgraded as notmal but with
<code class="docutils literal notranslate"><span class="pre">ipapermincludedattr</span></code> and <code class="docutils literal notranslate"><span class="pre">ipapermexcludedattr</span></code> set to reflect the
difference between the old default and the pre-existing permission.</p>
</section>
<section id="removing-the-global-anonymous-read-aci">
<h2>Removing the global anonymous read ACI<a class="headerlink" href="#removing-the-global-anonymous-read-aci" title="Permalink to this heading">#</a></h2>
<p>After the permission updater successfully runs, it will look for an ACI
named “Enable Anonymous access” in $SUFFIX, and remove it.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">update_anonymous_aci</span></code> server update plugin will be removed.</p>
</section>
<section id="aci-txt">
<h2>ACI.txt<a class="headerlink" href="#aci-txt" title="Permalink to this heading">#</a></h2>
<p>To ensure that permission changes are properly reviewed, a summary file
similar to API.txt will be generated, and it will be checked on each
build.</p>
<p>It will contain a summary of the default managed permissions.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">makeaci</span></code> script similar to <code class="docutils literal notranslate"><span class="pre">makeapi</span></code> will be provided and called
to check the file on each build.</p>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h1>
<p>No additional requirements or changes discovered during the
implementation phase.</p>
</section>
<section id="feature-managment">
<h1>Feature Managment<a class="headerlink" href="#feature-managment" title="Permalink to this heading">#</a></h1>
<p>UI</p>
<p>The immutable aspects of Managed permissions are grayed out in the Web
UI.</p>
<p>CLI</p>
<p>See the CLI &amp; API section in Design.</p>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">#</a></h1>
<p>Access control is configured via the existing RBAC system.</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">#</a></h1>
<p>N/A, ACIs and permissions are replicated.</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">#</a></h1>
<p>Old servers will not be able to modify Managed permissions, except
adding/removing them to/from prigileges. Details are in <a class="reference external" href="V3/Permissions_V2">Permissions
V2</a>, which will be implemented in the same
release. Managed permissions use the MANAGED flag.</p>
<p>Installations with customized ACIs will need some extra care when
upgrading, as detailed in Upgrade considerations above. (But note that
IPA’s upgrade behavior wrt modified default permissions has always been
underspecified and likely surprising.)</p>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">#</a></h1>
<p>No new package and library dependencies.</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">#</a></h1>
<p>Tests and documentation need to be written.</p>
</section>
<section id="backup-and-restore">
<h1>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this heading">#</a></h1>
<p>ACIs, permissions, privileges and roles are already included in backup &amp;
restore.</p>
</section>
<section id="test-plan">
<h1>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">#</a></h1>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="User:Pviktorin">Petr Viktorin</a></p>
<p><a class="reference external" href="Category:FreeIPA_V4_Test_Plan">Category:FreeIPA V4 Test Plan</a>
<a class="reference external" href="Category:FreeIPA_Test_Plan">Category:FreeIPA Test Plan</a></p>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Managed_Read_permissions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation-draft">Documentation draft</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade-considerations">Upgrade considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removed-default-permissions">Removed default permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changed-attribute-lists">Changed attribute lists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-aci-changes">Other ACI changes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem">The problem</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managed-permissions">Managed Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cli-api">CLI &amp; API</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-permission-updater">Default Permission Updater</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#replacing-legacy-default-permissions">Replacing legacy default permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-the-global-anonymous-read-aci">Removing the global anonymous read ACI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aci-txt">ACI.txt</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-managment">Feature Managment</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#major-configuration-options-and-enablement">Major configuration options and enablement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#replication">Replication</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies">Dependencies</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#external-impact">External Impact</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#backup-and-restore">Backup and Restore</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>