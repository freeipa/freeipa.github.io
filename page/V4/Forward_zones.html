

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Forward_zones &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Forward_zones';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Forward_zones.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Forward_zones</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forwarding-queries-per-a-zone">Forwarding queries per a zone</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forwarding-policy-in-forward-and-master-zones">Forwarding policy in forward and master zones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-an-ineffective-forward-zone">Avoid an ineffective forward zone</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-policy">Forward Policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-ipa-commands">New IPA commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone">dnsforwardzone-*</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-add">dnsforwardzone-add</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-mod">dnsforwardzone-mod</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-show">dnsforwardzone-show</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-find">dnsforwardzone-find</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-del">dnsforwardzone-del</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-enable">dnsforwardzone-enable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-disable">dnsforwardzone-disable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-add-permission">dnsforwardzone-add-permission</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-remove-permission">dnsforwardzone-remove-permission</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-configuration">Basic configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-a-forward-zone-with-forwarding-only-policy">Test a forward zone with forwarding only policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-a-forward-zone-with-forwarding-none-policy">Test a forward zone with forwarding none policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests">Unit tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="forward-zones">
<h1>Forward_zones<a class="headerlink" href="#forward-zones" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>Forward zones allow to configure the name server to use forwarding only
for a particular zone.</p>
<p>In older versions of IPA, to allow forwarding per zone, was required to
create master zone with forward statement together with unnecessary
records. Current implementation allows separate forward and master zones
in FreeIPA <a class="reference external" href="DNS">DNS</a> to follow BIND design and achieve consistent
behavior.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">#</a></h2>
</section>
<section id="forwarding-queries-per-a-zone">
<h2>Forwarding queries per a zone<a class="headerlink" href="#forwarding-queries-per-a-zone" title="Permalink to this heading">#</a></h2>
<p>Generally using global forwarders is all or nothing solution. Using
forward zones give more control to admin, which zones and how should be
forwarded.</p>
<section id="forwarding-policy-in-forward-and-master-zones">
<h3>Forwarding policy in forward and master zones<a class="headerlink" href="#forwarding-policy-in-forward-and-master-zones" title="Permalink to this heading">#</a></h3>
<p>Forwarding follows BIND design, here is short overview in table bellow,
for more information please read <a class="reference external" href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.ch06.html#id2583443">BIND
manual</a>.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>IPA forward-policy</p></th>
<th class="head"><p>behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>none</p></td>
<td><ol class="arabic simple">
<li><p>search local database for an
authoritative answer</p></li>
<li><p>if local server is
authoritative, return the
answer (including NXDOMAIN if
DNS name was not found)</p></li>
<li><p>if local server is not
authoritative, try only
recursion (if recursion is
allowed), no forwarding</p></li>
<li><p>return an answer obtained by
recursion</p></li>
</ol>
</td>
</tr>
<tr class="row-odd"><td><p>first (or as default)</p></td>
<td><ol class="arabic simple">
<li><p>search local database for an
authoritative answer</p></li>
<li><p>if local server is
authoritative, return the
answer (including NXDOMAIN if
DNS name was not found)</p></li>
<li><p>if local server is not
authoritative, try to query
forwarders</p></li>
<li><p>if query to forwarders failed,
try recursion (if recursion is
allowed)</p></li>
<li><p>return an answer from
forwarder or recursion</p></li>
</ol>
</td>
</tr>
<tr class="row-even"><td><p>only</p></td>
<td><ol class="arabic simple">
<li><p>search local database for an
authoritative answer</p></li>
<li><p>if local server is
authoritative, return the
answer (including NXDOMAIN if
DNS name was not found)</p></li>
<li><p>if local server is not
authoritative, try to query
forwarders</p></li>
<li><p>return an answer from
forwarders or return SERVFAIL
(if designated forwarders did
not reply)</p></li>
</ol>
</td>
</tr>
</tbody>
</table>
</section>
<section id="avoid-an-ineffective-forward-zone">
<h3>Avoid an ineffective forward zone<a class="headerlink" href="#avoid-an-ineffective-forward-zone" title="Permalink to this heading">#</a></h3>
<p>Be careful using following set of zones, where a master zone exists for
a forward zone.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa dnszone-add example.com.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">$ ipa dnsforwardzone-add  fw.example.com. --forwarder 192.0.2.1</span></code></div>
</div>
<p>In this case, forwarding will not work, because zone <em>example.com.</em> is
authoritative, and server return NXDOMAIN answer. To make forward zone
effective, you need delegate this forward domain using NS record to
different name server.</p>
<p>To add proper NS record use following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">$ ipa dnsrecord-add example.com. fw --ns-rec=</span></code></p>
</section>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h2>
<p>No changes for master zones required (‘idnsZone’ objectclass).</p>
<p>Forward zone will use own objectclass ‘idnsForwardZone’. (see below).</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClass ( 2.16.840.1.113730.3.8.6.3</span></code></div>
<div class="line">``   NAME ‘idnsForwardZone’``</div>
<div class="line">``   DESC ‘Forward Zone class’``</div>
<div class="line">``   SUP top``</div>
<div class="line">``   STRUCTURAL``</div>
<div class="line">``   MUST ( idnsName $ idnsZoneActive )``</div>
<div class="line">``   MAY ( idnsForwarders $ idnsForwardPolicy ) )``</div>
</div>
<p>The idnsName, idnsZoneActive, idnsForwarders, idnsForwardPolicy are the
same attributes as the ‘idnsZone’ objectclass uses.</p>
<p>Both types are stored in LDAP, under <code class="docutils literal notranslate"><span class="pre">idnsname=$DOMAIN,cn=dns,$SUFFIX</span></code>
Only one zone type can be stored under the same name. (To add forward
zone with same name you must remove master zone and vice versa)</p>
<p>Forward zones are enabled by default.</p>
</section>
<section id="forward-policy">
<h2>Forward Policy<a class="headerlink" href="#forward-policy" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">forward-policy</span> <span class="pre">=</span> <span class="pre">{first,</span> <span class="pre">only,</span> <span class="pre">none}</span></code>, default: <strong>first</strong></p>
<ul class="simple">
<li><p><strong>none</strong> - disable forwarding, forwarders are not required</p></li>
<li><p><strong>only</strong> - forward queries to forwarders (<strong>require</strong> to specify
<strong>forwarders</strong>)</p></li>
<li><p><strong>first</strong> - forward queries, if unanswered try to answer the query
(<strong>require</strong> to specify <strong>forwarders</strong>)</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>IPA</p></th>
<th class="head"><p>Bind</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>none</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">zone &quot;fwd.test.&quot; in {</span></code></div>
<div class="line">``  type forward;``</div>
<div class="line">``  forwarders { };``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">};</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>first (or as default)</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">zone &quot;fwd.test.&quot; in {</span></code></div>
<div class="line">``  type forward;``</div>
<div class="line">``  forwarders { <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` };</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">};</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>only</p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">zone &quot;fwd.test.&quot; in {</span></code></div>
<div class="line">``  type forward;``</div>
<div class="line">``  forward only;``</div>
<div class="line">``  forwarders { <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">`` };</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">};</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="new-ipa-commands">
<h2>New IPA commands<a class="headerlink" href="#new-ipa-commands" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-add</span></code>, to add a new forward zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-mod</span></code>, to modify a forward zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-show</span></code>, to show a forward zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-find</span></code>, to find a forward zone(s)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-del</span></code>, to delete a forward zone(s)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-enable</span></code>, to enable a forward zone(s)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-disable</span></code>, to disable a forward zone(s)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-add-permission</span></code>, to add the permission for per
forward zone access delegation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-remove-permission</span></code>, to remove the permission for
per forward zone access delegation</p></li>
</ul>
</section>
<section id="feature-management">
<h2>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">#</a></h2>
<p>UI</p>
<p>A new page <em>Network Services/DNS/DNS Forward Zones</em> in WebUI. This page
handle all required operations: show current list of forward zones, add
a new forward zone, delete a forward zone, display a forward zone,
allows to modify forwarders and forward policy per a forward zone,
disable/enable a forward zone.</p>
<p>Forward zone consists of a name, forwarders, forwarding policy, and
enabled/disabled status</p>
<p>CLI</p>
<section id="dnsforwardzone">
<h3>dnsforwardzone-*<a class="headerlink" href="#dnsforwardzone" title="Permalink to this heading">#</a></h3>
<p>Args <code class="docutils literal notranslate"><span class="pre">--forwarder</span></code>, <code class="docutils literal notranslate"><span class="pre">--forward-policy</span></code>, <code class="docutils literal notranslate"><span class="pre">--name-from-ip</span></code> have same
behavior as they have in dnszone-* commands.</p>
<p>Forward zone name has same restrictions as in the master zone
(dnszone-*).</p>
</section>
<section id="dnsforwardzone-add">
<h3>dnsforwardzone-add<a class="headerlink" href="#dnsforwardzone-add" title="Permalink to this heading">#</a></h3>
<p>will add a new forward zone. Is required to specify at least one
forwarder if forward-policy is not ‘none’.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-add zone.test. --forwarder=172.16.0.1 --forwarder=172.16.0.2 --forward-policy=first</span></code></div>
<div class="line">``  Zone name: zone.test.``</div>
<div class="line">``  Zone forwarders: 172.16.0.1, 172.16.0.2``</div>
<div class="line">``  Forward policy: first``</div>
</div>
</section>
<section id="dnsforwardzone-mod">
<h3>dnsforwardzone-mod<a class="headerlink" href="#dnsforwardzone-mod" title="Permalink to this heading">#</a></h3>
<p>will modify a forward zone. Is required to specify at least one
forwarder if forward-policy is not ‘none’. Modifications can be
performed in several ways.</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-mod zone.test. --forwarder=172.16.0.3</span></code></div>
<div class="line">``  Zone name: zone.test.``</div>
<div class="line">``  Zone forwarders: 172.16.0.3``</div>
<div class="line">``  Forward policy: first``</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-mod zone.test. --forward-policy=only</span></code></div>
<div class="line">``  Zone name: zone.test.``</div>
<div class="line">``  Zone forwarders: 172.16.0.3``</div>
<div class="line">``  Forward policy: only``</div>
</div>
</section>
<section id="dnsforwardzone-show">
<h3>dnsforwardzone-show<a class="headerlink" href="#dnsforwardzone-show" title="Permalink to this heading">#</a></h3>
<p>will show specified forward zone</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-show zone.test.</span></code></div>
<div class="line">``  Zone name: zone.test.``</div>
<div class="line">``  Zone forwarders: 172.16.0.5``</div>
<div class="line">``  Forward policy: first``</div>
</div>
</section>
<section id="dnsforwardzone-find">
<h3>dnsforwardzone-find<a class="headerlink" href="#dnsforwardzone-find" title="Permalink to this heading">#</a></h3>
<p>will find specified forward zone</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-find zone.test.</span></code></div>
<div class="line">``  Zone name: zone.test.``</div>
<div class="line">``  Zone forwarders: 172.16.0.3``</div>
<div class="line">``  Forward policy: first``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Number of entries returned 1</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">----------------------------</span></code></div>
</div>
</section>
<section id="dnsforwardzone-del">
<h3>dnsforwardzone-del<a class="headerlink" href="#dnsforwardzone-del" title="Permalink to this heading">#</a></h3>
<p>will delete specified forward zone(s)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``dnsforwardzone-del zone.test. ``
| ``----------------------------``
| ``Deleted forward DNS zone &quot;zone.test.&quot;``
| ``----------------------------``
</pre></div>
</div>
</section>
<section id="dnsforwardzone-enable">
<h3>dnsforwardzone-enable<a class="headerlink" href="#dnsforwardzone-enable" title="Permalink to this heading">#</a></h3>
<p>will enable specified forward zone(s) NOTE: Forward zones are enabled by
default.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``dnsforwardzone-enable zone.test. ``
| ``----------------------------``
| ``Enabled forward DNS zone &quot;zone.test.&quot;``
| ``----------------------------``
</pre></div>
</div>
</section>
<section id="dnsforwardzone-disable">
<h3>dnsforwardzone-disable<a class="headerlink" href="#dnsforwardzone-disable" title="Permalink to this heading">#</a></h3>
<p>will disable specified forward zone(s)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``dnsforwardzone-disable zone.test. ``
| ``----------------------------``
| ``Disabled forward DNS zone &quot;zone.test.&quot;``
| ``----------------------------``
</pre></div>
</div>
</section>
<section id="dnsforwardzone-add-permission">
<h3>dnsforwardzone-add-permission<a class="headerlink" href="#dnsforwardzone-add-permission" title="Permalink to this heading">#</a></h3>
<p>will add system permission</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-add-permission zone.test.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------------------------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Added system permission &quot;Manage DNS zone zone.test.&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------------------------------------------</span></code></div>
<div class="line">``  Manage DNS zone zone.test.``</div>
</div>
</section>
<section id="dnsforwardzone-remove-permission">
<h3>dnsforwardzone-remove-permission<a class="headerlink" href="#dnsforwardzone-remove-permission" title="Permalink to this heading">#</a></h3>
<p>will remove system permission</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">dnsforwardzone-remove-permission zone.test.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------------------------------------------</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Removed system permission &quot;Manage DNS zone zone.test.&quot;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">---------------------------------------------------------</span></code></div>
<div class="line">``  Manage DNS zone zone.test.``</div>
</div>
</section>
</section>
<section id="updates-and-upgrades">
<h2>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>idnsForwardZone objectclass is already supported by bind-dyndb-ldap
&gt;= 3.5. This covers also RHEL/CentOS &gt;= 7.0 so upgrades involving
only RHEL 7.x machines are seamless.</p></li>
<li><p>Unfortunatelly, we did not realize that interaction with RHEL/CentOS
&lt; 7.0 &amp;&amp; RHEL/CentOS &gt;= 7.1 in the same topology will not be
seamless. (See <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1175318">bug
1175318</a>.)</p>
<ul>
<li><p>RHEL 7.1 ships bind-dyndb-ldap &gt;= 6.0 which relies on new object
semantics which is not supported by bind-dyndb-ldap 2.3 shipped
with RHEL 6.6. As a result, forward zones will stop working on old
replicas as soon as RHEL 7.1 upgrade procedure is executed.</p></li>
<li><p>Solution is to patch bind-dyndb-ldap in RHEL 6.6.z and add support
for idnsForwardZone object class to it (see <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1176129">bug
1176129</a>).
It will allow RHEL 6.6.z+ replicas to continue to work after RHEL
7.1+ is joined to the topology.</p></li>
<li><p>Assumption is that from a moment of upgrade to RHEL 7.1+ on all
forward zones are managed from RHEL 7.1+ replicas (so the data are
stored in the new format).</p></li>
</ul>
</li>
<li><p>add idnsForwardZone objectclass to LDAP schema</p></li>
<li><p>All zones with configured forwarders and forward-policy not equal to
none, will be moved to idnsForwardZone objectclass, and idnsZone
class will be removed. First, the zones will be exported to LDIF as
backup in <strong>/var/lib/ipa/backup/</strong> directory, named as
<strong>dns-forward-zones-backup-%Y-%m-%d-%H-%M-%S.ldif</strong></p></li>
</ul>
<table class="table" id="id1">
<caption><span class="caption-text">Migration table</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>forward-policy</p></th>
<th class="head"><p>none</p></th>
<th class="head"><p>first</p></th>
<th class="head"><p>only</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>forwarders</p></td>
<td><p>master</p></td>
<td><p>forward</p></td>
<td><p>forward</p></td>
<td><p>forward</p></td>
</tr>
<tr class="row-odd"><td><p>no forwarders</p></td>
<td><p>master</p></td>
<td><p>master</p></td>
<td><p>master</p></td>
<td><p>master</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Transformation to forward zones, is executed only once, by one
replica only, and only if ipa version is lower than 4.0. This is
ensured by detection: if ‘idnsforwardzone’ objectclass is presented
in schema before schema upgrade, then no transformation is required,
else transform master zone to forward zone using rules above.</p></li>
</ul>
</section>
<section id="how-to-test">
<h2>How to Test<a class="headerlink" href="#how-to-test" title="Permalink to this heading">#</a></h2>
</section>
<section id="basic-configuration">
<h2>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>install <em>IPA server</em> with DNS, do not set up forwarders</p></li>
<li><p>Set up an <em>external DNS server</em> (IP: 192.0.2.200)</p></li>
<li><p>Configure zone <em>example.test.</em> on <em>external DNS server</em></p></li>
<li><p>Add A record <em>host.example.test. IN A 192.0.2.111</em> into zone
<em>example.test.</em> on <em>external DNS server</em></p></li>
</ol>
</section>
<section id="test-a-forward-zone-with-forwarding-only-policy">
<h2>Test a forward zone with forwarding only policy<a class="headerlink" href="#test-a-forward-zone-with-forwarding-only-policy" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>use the basic configuration above</p></li>
<li><p>test zone <em>example.test</em> using dig: <strong>$ dig &#64; A host.example.test.</strong></p></li>
<li><p>expected result: NXDOMAIN</p></li>
<li><p>add forward zone on <em>IPA server</em>: <strong>$ ipa dnsforwardzone-add
example.test. –forward-policy=only –forwarder=192.0.2.200</strong></p></li>
<li><p>test zone <em>example.test</em> using dig: <strong>$ dig &#64; A host.example.test.</strong></p></li>
<li><p>expected result: <em>host.example.test. IN A 192.0.2.111</em> record in the
answer, AUTHORITY SECTION is pointing to <em>external DNS server</em></p></li>
</ol>
</section>
<section id="test-a-forward-zone-with-forwarding-none-policy">
<h2>Test a forward zone with forwarding none policy<a class="headerlink" href="#test-a-forward-zone-with-forwarding-none-policy" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>use the basic configuration above</p></li>
<li><p>test zone <em>example.test</em> using dig: <strong>$ dig &#64; A host.example.test.</strong></p></li>
<li><p>expected result: NXDOMAIN</p></li>
<li><p>add global forwarder (external DNS server): <strong>ipa dnsconfig-mod
–forwarder=192.168.2.200</strong></p></li>
<li><p>test zone <em>example.test</em> using dig: <strong>$ dig &#64; A host.example.test.</strong></p></li>
<li><p>expected result: <em>host.example.test. IN A 192.0.2.111</em> record in the
answer, AUTHORITY SECTION is pointing to <em>external DNS server</em></p></li>
<li><p>add forward zone with none policy: <strong>$ ipa dnsforward-zone
example.test. –forward-policy=none</strong></p></li>
<li><p>test zone <em>example.test</em> using dig: <strong>$ dig &#64; A host.example.test.</strong></p></li>
<li><p>expected result: NXDOMAIN</p></li>
</ol>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this heading">#</a></h2>
</section>
<section id="unit-tests">
<h2>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Create forward zone:</p>
<ul>
<li><p><strong>dnsforwardzone-add fw-zone</strong></p>
<ul>
<li><p>Expectation: missing forwarders, ValidationError</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-add fw-zone –forward-policy=only</strong></p>
<ul>
<li><p>Expectation: missing forwarders, ValidationError</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-add fw-zone –forward-policy=none</strong></p>
<ul>
<li><p>Expectation: add fw-zone with policy none, no forwarders</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-add fw-zone –forwarder=172.16.15.1</strong></p>
<ul>
<li><p>Expectation: add fw-zone with policy first, forwarder
172.16.15.1</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-add fw-zone –forwarder=172.16.15.1
–forward-policy=only</strong></p>
<ul>
<li><p>Expectation: add fw-zone with policy only, forwarder
172.16.15.1</p></li>
</ul>
</li>
<li><p><strong>Try to add duplicated zone</strong></p>
<ul>
<li><p>Expectation: DuplicationError</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Modify forward zone</p>
<ul>
<li><p><strong>dnsforwardzone-mod fw-zone-without-forwarders
–forward-policy=only</strong></p>
<ul>
<li><p>Expectation: missing forwarders, ValidationError</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-mod fw-zone-without-forwarders
–forward-policy=first</strong></p>
<ul>
<li><p>Expectation: missing forwarders, ValidationError</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-mod fw-zone-policy-none
–forwarder={172.16.15.1,172.16.15.2}</strong></p>
<ul>
<li><p>Expectation: zone policy=none, forwarders: 172.16.15.1,
172.16.15.2</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-mod fw-zone-with-forwarders
–forward-policy=first</strong></p>
<ul>
<li><p>Expectation: zone policy=first, forwarders=</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-mod fw-zone-with-forwarders
–forward-policy=only</strong></p>
<ul>
<li><p>Expectation: zone policy=only, forwarders=</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Show forward zone</p>
<ul>
<li><p><strong>dnsforwardzone-show fw-zone</strong></p>
<ul>
<li><p>Expectation: retrieve zone</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Find forward zone</p>
<ul>
<li><p><strong>dnsforwardzone-find</strong></p>
<ul>
<li><p>Expectation: show all forward zones matching expression</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Disable/Enable forward zone</p>
<ul>
<li><p><strong>dnsforwardzone-enable fw-zone</strong></p>
<ul>
<li><p>Expectation: fw-zone becomes enabled</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-disable fw-zone</strong></p>
<ul>
<li><p>Expectation: fw-zone becomes disabled</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Add/Remove per-zone permission</p>
<ul>
<li><p><strong>dnsforwardzone-add-permision fw-zone</strong></p>
<ul>
<li><p>Expectation: create system permission for fw-zone</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-remove-permission fw-zone</strong></p>
<ul>
<li><p>Expectation: remove system permission for fw-zone</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Delete forward zone</p>
<ul>
<li><p>dnszone-del fw-zone</p>
<ul>
<li><p>Expectation: Zone is removed</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Mutual exclusion with master zones (*-add)</p>
<ul>
<li><p><strong>dnszone-add zone-exists-as-forward</strong></p>
<ul>
<li><p>Expectation: DuplicateError</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-add zone-exists-as-master</strong></p>
<ul>
<li><p>Expectation: DuplicateError</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Mutual exclusion with master zones (*-find)</p>
<ul>
<li><p><strong>dnszone-find</strong></p>
<ul>
<li><p>Expectation: Lists ONLY master zones</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-find</strong></p>
<ul>
<li><p>Expectation: LIsts ONLY forward zones</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Mutual exclusion with master zones (others)</p>
<ul>
<li><p><strong>dnszone-* forward-zone</strong></p>
<ul>
<li><p>Expectation: NotFound Error</p></li>
</ul>
</li>
<li><p><strong>dnsforwardzone-* master-zone</strong></p>
<ul>
<li><p>Expectation: NotFound Error</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Prevent dnsrecord-* commands work with forwardzone</p>
<ul>
<li><p><strong>dnsrecord-* forward-zone</strong></p>
<ul>
<li><p>Expectation: ValidationError: only master zones can contain
records</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="rfe-author">
<h2>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="User:Mbasti">mbasti</a></p>
<p><a class="reference external" href="Category:FreeIPA_V4_Test_Plan">Category:FreeIPA V4 Test Plan</a>
<a class="reference external" href="Category:FreeIPA_Test_Plan">Category:FreeIPA Test Plan</a></p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forwarding-queries-per-a-zone">Forwarding queries per a zone</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forwarding-policy-in-forward-and-master-zones">Forwarding policy in forward and master zones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-an-ineffective-forward-zone">Avoid an ineffective forward zone</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-policy">Forward Policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-ipa-commands">New IPA commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone">dnsforwardzone-*</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-add">dnsforwardzone-add</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-mod">dnsforwardzone-mod</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-show">dnsforwardzone-show</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-find">dnsforwardzone-find</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-del">dnsforwardzone-del</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-enable">dnsforwardzone-enable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-disable">dnsforwardzone-disable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-add-permission">dnsforwardzone-add-permission</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dnsforwardzone-remove-permission">dnsforwardzone-remove-permission</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates-and-upgrades">Updates and Upgrades</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-configuration">Basic configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-a-forward-zone-with-forwarding-only-policy">Test a forward zone with forwarding only policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-a-forward-zone-with-forwarding-none-policy">Test a forward zone with forwarding none policy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests">Unit tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-author">RFE Author</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>