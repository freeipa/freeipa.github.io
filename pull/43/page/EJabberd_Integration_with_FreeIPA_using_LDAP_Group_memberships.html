
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EJabberd_Integration_with_FreeIPA_using_LDAP_Group_memberships &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/EJabberd_Integration_with_FreeIPA_using_LDAP_Group_memberships';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/EJabberd_Integration_with_FreeIPA_using_LDAP_Group_memberships.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>EJabberd_Integration_with_FreeIPA_using_LDAP_Group_memberships</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-bind-account-in-freeipa">Create Bind account in FreeIPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-group-in-freeipa">Create Group in FreeIPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-epel-repository">Enable EPEL repository</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-ejabberd-package">Install ejabberd package</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-configuration-file-to-use-tls-for-communication-between-the-server-and-your-jabber-clients">Edit Configuration file to use TLS for communication between the Server and your Jabber clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-configuration-file-to-enable-ldap-authentication-and-group-validation">Edit Configuration file to enable LDAP authentication and Group validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-tcp-ports-on-local-server">Open TCP ports on local Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-xmpp-client-on-a-workstation">Configure XMPP Client on a Workstation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-user-s-to-the-jabber-users-group">Add user(s) to the “jabber_users” group</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ejabberd-integration-with-freeipa-using-ldap-group-memberships">
<h1>EJabberd_Integration_with_FreeIPA_using_LDAP_Group_memberships<a class="headerlink" href="#ejabberd-integration-with-freeipa-using-ldap-group-memberships" title="Link to this heading">#</a></h1>
<p><strong>HOWTO: Configure eJabberd to authenticate IPA users using LDAP Group
memberships.</strong></p>
<p><strong>Provided by Dale Macartney</strong></p>
<p>This guide has been written to show how you can integrate ejabberd (XMPP
Server) into FreeIPA using LDAP authentication, and to allow user’s
based on being a member of an allowed Group.</p>
<p>Please note: This document works, however uses an unencrypted method of
validating username and password data. As a result, this is a work in
progress. If you wish to use this method in its current state, please do
so at your own risk.</p>
<p>Passwords will be transmitted in CLEAR TEXT!, Please be aware of this.</p>
<p>The below details will walk you through how to add a Red Hat Enterprise
Linux 6.2 system to an IPA domain, and then configure eJabberd to allow
LDAP authentication with Group validation.</p>
<p>Details of this example are as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">Server</span><span class="p">:</span> <span class="n">ds01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Jabber</span> <span class="n">Server</span><span class="p">:</span> <span class="n">jabber01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">Client</span><span class="p">:</span> <span class="n">workstation01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">User</span><span class="p">:</span> <span class="n">testuser</span>
<span class="n">Group</span> <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;jabber_users&quot;</span>
<span class="n">Bind</span> <span class="n">account</span> <span class="o">=</span> <span class="s2">&quot;ejabberd&quot;</span>
<span class="n">Bind</span> <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;secret123&quot;</span>
</pre></div>
</div>
<section id="create-bind-account-in-freeipa">
<h2>Create Bind account in FreeIPA<a class="headerlink" href="#create-bind-account-in-freeipa" title="Link to this heading">#</a></h2>
<p>Start by logging into your IPA server. If you did not log in as the
admin user, optain a tgt for the admin user so we can add what we need
to. To do this, run the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># kinit admin</span>
<span class="n">Password</span> <span class="k">for</span> <span class="n">admin</span><span class="nd">@EXAMPLE</span><span class="o">.</span><span class="n">COM</span><span class="p">:</span>
</pre></div>
</div>
<p>You can verify your ticket with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@ds01 ~]# klist
Ticket cache: ``\ ```FILE:/tmp/krb5cc_0`` &lt;FILE:/tmp/krb5cc_0&gt;`__
Default principal: admin@EXAMPLE.COM
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Valid</span> <span class="n">starting</span>     <span class="n">Expires</span>            <span class="n">Service</span> <span class="n">principal</span>
<span class="mi">06</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">12</span> <span class="mi">23</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">48</span>  <span class="mi">06</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mi">12</span> <span class="mi">23</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">45</span>  <span class="n">krbtgt</span><span class="o">/</span><span class="n">EXAMPLE</span><span class="o">.</span><span class="n">COM</span><span class="nd">@EXAMPLE</span><span class="o">.</span><span class="n">COM</span>
</pre></div>
</div>
<p>Create a file with the following information. In this example, I created
/root/jabber.ldif. Don’t forget to change the userPassword to something
secure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">uid</span><span class="o">=</span><span class="n">ejabberd</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">sysaccounts</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">etc</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">changetype</span><span class="p">:</span> <span class="n">add</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">account</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">simplesecurityobject</span>
<span class="n">uid</span><span class="p">:</span> <span class="n">ejabberd</span>
<span class="n">userPassword</span><span class="p">:</span> <span class="n">secret123</span>
<span class="n">passwordExpirationTime</span><span class="p">:</span> <span class="mi">20380119031407</span><span class="n">Z</span>
<span class="n">nsIdleTimeout</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Once you have saved your file, import the information into LDAP with the
following command. Please note, you will need your Directory Manager
password here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ldapmodify -h ds01.example.com -p 389 -x -D &quot;cn=Directory Manager&quot; -w redhat123 -f jabber.ldif</span>
<span class="n">adding</span> <span class="n">new</span> <span class="n">entry</span> <span class="s2">&quot;uid=ejabberd,cn=sysaccounts,cn=etc,dc=example,dc=com&quot;</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="create-group-in-freeipa">
<h2>Create Group in FreeIPA<a class="headerlink" href="#create-group-in-freeipa" title="Link to this heading">#</a></h2>
<p>Whilst you are still on the IPA server, add the group to be used for our
jabber users.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa group-add</span>
<span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">jabber_users</span>
<span class="n">Description</span><span class="p">:</span> <span class="n">Group</span> <span class="n">used</span> <span class="n">to</span> <span class="n">validate</span> <span class="n">Jabber</span> <span class="n">authentication</span> <span class="n">to</span> <span class="n">allowed</span> <span class="n">users</span>
<span class="o">-</span> <span class="o">--------------------------</span>
<span class="n">Added</span> <span class="n">group</span> <span class="s2">&quot;jabber_users&quot;</span>
<span class="o">-</span> <span class="o">--------------------------</span>
  <span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">jabber_users</span>
  <span class="n">Description</span><span class="p">:</span> <span class="n">Group</span> <span class="n">used</span> <span class="n">to</span> <span class="n">validate</span> <span class="n">Jabber</span> <span class="n">authentication</span> <span class="n">to</span> <span class="n">allowed</span> <span class="n">users</span>
  <span class="n">GID</span><span class="p">:</span> <span class="mi">1668600006</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="enable-epel-repository">
<h2>Enable EPEL repository<a class="headerlink" href="#enable-epel-repository" title="Link to this heading">#</a></h2>
<p>As the the ejabberd package is not provided by Red Hat, you will need to
configure yum to use the EPEL repostories,</p>
<p>To do this, run the following on your soon to be, jabber server.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;jabber02</span> <span class="pre">~]#</span> <span class="pre">rpm</span> <span class="pre">-Uvh</span> <span class="pre">``\</span> <span class="pre">```http://mirror01.th.ifl.net/epel/5/i386/epel-release-5-4.noarch.rpm</span></code> &lt;<a class="reference external" href="http://mirror01.th.ifl.net/epel/5/i386/epel-release-5-4.noarch.rpm">http://mirror01.th.ifl.net/epel/5/i386/epel-release-5-4.noarch.rpm</a>&gt;`__</p>
</section>
<section id="install-ejabberd-package">
<h2>Install ejabberd package<a class="headerlink" href="#install-ejabberd-package" title="Link to this heading">#</a></h2>
<p>Install the ejabberd package by running the following</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;jabber02</span> <span class="pre">~]#</span> <span class="pre">yum</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">ejabberd</span></code></p>
</section>
<section id="edit-configuration-file-to-use-tls-for-communication-between-the-server-and-your-jabber-clients">
<h2>Edit Configuration file to use TLS for communication between the Server and your Jabber clients<a class="headerlink" href="#edit-configuration-file-to-use-tls-for-communication-between-the-server-and-your-jabber-clients" title="Link to this heading">#</a></h2>
<p>Once installed, open /etc/ejabberd/ejabberd.cfg and change the following
lines</p>
<p>Change the line</p>
<p><code class="docutils literal notranslate"><span class="pre">{hosts,</span> <span class="pre">[&quot;localhost&quot;]}.</span></code></p>
<p>so it reads as follows</p>
<p><code class="docutils literal notranslate"><span class="pre">{hosts,</span> <span class="pre">[&quot;example.com&quot;]}.</span></code></p>
<p>Change the line</p>
<p><code class="docutils literal notranslate"><span class="pre">%%{certfile,</span> <span class="pre">&quot;/etc/ejabberd/ejabberd.pem&quot;},</span> <span class="pre">starttls,</span></code></p>
<p>so it reads as follows</p>
<p><code class="docutils literal notranslate"><span class="pre">{certfile,</span> <span class="pre">&quot;/etc/ejabberd/ejabberd.pem&quot;},</span> <span class="pre">starttls,</span></code></p>
<p>Change the line</p>
<p><code class="docutils literal notranslate"><span class="pre">%%{s2s_use_starttls,</span> <span class="pre">optional}.</span></code></p>
<p>so it reads as follows</p>
<p><code class="docutils literal notranslate"><span class="pre">{s2s_use_starttls,</span> <span class="pre">optional}.</span></code></p>
<p>Change the line</p>
<p><code class="docutils literal notranslate"><span class="pre">%%{s2s_certfile,</span> <span class="pre">&quot;/etc/ejabberd/ejabberd.pem&quot;}.</span></code></p>
<p>so it reads as follows</p>
<p><code class="docutils literal notranslate"><span class="pre">{s2s_certfile,</span> <span class="pre">&quot;/etc/ejabberd/ejabberd.pem&quot;}.</span></code></p>
<p>Make sure you save your configuration file.</p>
</section>
<section id="edit-configuration-file-to-enable-ldap-authentication-and-group-validation">
<h2>Edit Configuration file to enable LDAP authentication and Group validation<a class="headerlink" href="#edit-configuration-file-to-enable-ldap-authentication-and-group-validation" title="Link to this heading">#</a></h2>
<p>Open /etc/ejabberd/ejabberd.cfg and add the following lines in the
Authentication section. Don’t forget to change the password to the one
you used earlier for your BIND account.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">auth_method</span><span class="p">,</span> <span class="n">ldap</span><span class="p">}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_servers</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ds01.example.com&quot;</span><span class="p">]}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_uids</span><span class="p">,</span> <span class="p">[{</span><span class="s2">&quot;uid&quot;</span><span class="p">}]}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_filter</span><span class="p">,</span> <span class="s2">&quot;(memberOf=cn=jabber_users,cn=groups,cn=accounts,dc=example,dc=com)&quot;</span><span class="p">}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_base</span><span class="p">,</span> <span class="s2">&quot;dc=example,dc=com&quot;</span><span class="p">}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_rootdn</span><span class="p">,</span> <span class="s2">&quot;uid=ejabberd,cn=sysaccounts,cn=etc,dc=example,dc=com&quot;</span><span class="p">}</span><span class="o">.</span>
<span class="p">{</span><span class="n">ldap_password</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">}</span><span class="o">.</span>
</pre></div>
</div>
<p>Save the config file once you have finished and restart ejabberd</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># service ejabberd start</span>
<span class="n">Starting</span> <span class="n">ejabberd</span><span class="p">:</span>                                         <span class="p">[</span>  <span class="n">OK</span>  <span class="p">]</span>
</pre></div>
</div>
<p>Verify that your service has started correctly after your changes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># service ejabberd status</span>
<span class="n">The</span> <span class="n">node</span> <span class="n">ejabberd</span><span class="nd">@jabber02</span> <span class="ow">is</span> <span class="n">started</span> <span class="k">with</span> <span class="n">status</span><span class="p">:</span> <span class="n">started</span>
<span class="n">ejabberd</span> <span class="mf">2.1.11</span> <span class="ow">is</span> <span class="n">running</span> <span class="ow">in</span> <span class="n">that</span> <span class="n">node</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="open-tcp-ports-on-local-server">
<h2>Open TCP ports on local Server<a class="headerlink" href="#open-tcp-ports-on-local-server" title="Link to this heading">#</a></h2>
<p>Now we need to open our firewall for a few ports for jabber to work with
our clients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># for x in 5269 5222 5223 5280 ; do iptables -I INPUT -p tcp --dport $x -j ACCEPT ; done</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1"># service iptables save</span>
<span class="n">iptables</span><span class="p">:</span> <span class="n">Saving</span> <span class="n">firewall</span> <span class="n">rules</span> <span class="n">to</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">iptables</span><span class="p">:[</span>  <span class="n">OK</span>  <span class="p">]</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@jabber02</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="configure-xmpp-client-on-a-workstation">
<h2>Configure XMPP Client on a Workstation<a class="headerlink" href="#configure-xmpp-client-on-a-workstation" title="Link to this heading">#</a></h2>
<p>Next we need to configure our jabber client. For the purpose of this
exercise, I have used pidgin, which is also available via the EPEL
repository.</p>
<p>Open Pidgin on your workstation. If this is the first time you have
launched Pidgin, it will prompt you to add an account.</p>
<p>Select XMPP and add your username, domain and password.</p>
<p>See the below picture for comparison.</p>
<figure class="align-default" id="id1">
<img alt="Add_Account.png" src="../_images/Add_Account.png" />
<figcaption>
<p><span class="caption-text">Add_Account.png</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once you have added your user credentials, click Advanced and enter your
jabber server name. (Please note, I took this screenshot whilst testing
another server, I will replace this screenshot shortly).</p>
<p>See the below picture for comparison.</p>
<figure class="align-default" id="id2">
<img alt="Add_Account\_-_Server_Settings.png" src="../_images/Add_Account_-_Server_Settings.png" />
<figcaption>
<p><span class="caption-text">Add_Account_-_Server_Settings.png</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once you have finished, click the add button. If you enable the account,
it will attempt to connect and ask you to accept the SSL certificate
that we enabled earlier.</p>
<p>See the below picture for comparison.</p>
<figure class="align-default" id="id3">
<img alt="SSL_Certificate.png" src="../_images/SSL_Certificate.png" />
<figcaption>
<p><span class="caption-text">SSL_Certificate.png</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Once you have accepted the certificate, you will see that your login
attempt failed. This is because we have not added any users to the
“jabber_users” group yet.</p>
</section>
<section id="add-user-s-to-the-jabber-users-group">
<h2>Add user(s) to the “jabber_users” group<a class="headerlink" href="#add-user-s-to-the-jabber-users-group" title="Link to this heading">#</a></h2>
<p>If you tail the logs of the jabber server as follows, you will see the
failed authentication attempt in the above step.</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;jabber02</span> <span class="pre">~]#</span> <span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">/var/log/ejabberd/ejabberd.log</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="n">INFO</span> <span class="n">REPORT</span><span class="o">====</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">30</span> <span class="o">===</span>
<span class="n">I</span><span class="p">(</span><span class="o">&lt;</span><span class="mf">0.376.0</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ejabberd_listener</span><span class="p">:</span><span class="mi">281</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="c1">#Port&lt;0.4119&gt;) Accepted connection  {{10,0,1,101},60643} -&gt; {{10,0,1,32},5222}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="n">INFO</span> <span class="n">REPORT</span><span class="o">====</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">30</span> <span class="o">===</span>
<span class="n">I</span><span class="p">(</span><span class="o">&lt;</span><span class="mf">0.380.0</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ejabberd_c2s</span><span class="p">:</span><span class="mi">657</span><span class="p">)</span> <span class="p">:</span> <span class="p">({</span><span class="n">socket_state</span><span class="p">,</span><span class="n">tls</span><span class="p">,</span>  <span class="p">{</span><span class="n">tlssock</span><span class="p">,</span><span class="c1">#Port&lt;0.4119&gt;,#Port&lt;0.4141&gt;},&lt;0.379.0&gt;}) Failed authentication for testuser@example.com</span>
</pre></div>
</div>
<p>Leave the tailing log running and switch back to your IPA server and add
your test user.</p>
<p>You can do this by doing the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa group-add-member</span>
<span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">jabber_users</span>
<span class="p">[</span><span class="n">member</span> <span class="n">user</span><span class="p">]:</span> <span class="n">testuser</span>
<span class="p">[</span><span class="n">member</span> <span class="n">group</span><span class="p">]:</span>
  <span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">jabber_users</span>
  <span class="n">Description</span><span class="p">:</span> <span class="n">Group</span> <span class="n">used</span> <span class="n">to</span> <span class="n">validate</span> <span class="n">Jabber</span> <span class="n">authentication</span> <span class="n">to</span> <span class="n">allowed</span> <span class="n">users</span>
  <span class="n">GID</span><span class="p">:</span> <span class="mi">1668600006</span>
  <span class="n">Member</span> <span class="n">users</span><span class="p">:</span> <span class="n">testuser</span>
<span class="o">-</span> <span class="o">-------------------------</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">members</span> <span class="n">added</span> <span class="mi">1</span>
<span class="o">-</span> <span class="o">-------------------------</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Jump back to your workstation and click the reconnect button. You should
see that your client has now logged in, and the following will appear in
the tailing logs on the jabber server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="n">INFO</span> <span class="n">REPORT</span><span class="o">====</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">35</span> <span class="o">===</span>
<span class="n">I</span><span class="p">(</span><span class="o">&lt;</span><span class="mf">0.376.0</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ejabberd_listener</span><span class="p">:</span><span class="mi">281</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="c1">#Port&lt;0.4159&gt;) Accepted connection {{10,0,1,101},60644} -&gt; {{10,0,1,32},5222}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="n">INFO</span> <span class="n">REPORT</span><span class="o">====</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">35</span> <span class="o">===</span>
<span class="n">I</span><span class="p">(</span><span class="o">&lt;</span><span class="mf">0.393.0</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ejabberd_c2s</span><span class="p">:</span><span class="mi">639</span><span class="p">)</span> <span class="p">:</span> <span class="p">({</span><span class="n">socket_state</span><span class="p">,</span><span class="n">tls</span><span class="p">,</span> <span class="p">{</span><span class="n">tlssock</span><span class="p">,</span><span class="c1">#Port&lt;0.4159&gt;,#Port&lt;0.4161&gt;},&lt;0.392.0&gt;}) Accepted authentication for testuser by ejabberd_auth_ldap</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=</span><span class="n">INFO</span> <span class="n">REPORT</span><span class="o">====</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span> <span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">36</span> <span class="o">===</span>
<span class="n">I</span><span class="p">(</span><span class="o">&lt;</span><span class="mf">0.393.0</span><span class="o">&gt;</span><span class="p">:</span><span class="n">ejabberd_c2s</span><span class="p">:</span><span class="mi">946</span><span class="p">)</span> <span class="p">:</span> <span class="p">({</span><span class="n">socket_state</span><span class="p">,</span><span class="n">tls</span><span class="p">,{</span><span class="n">tlssock</span><span class="p">,</span><span class="c1">#Port&lt;0.4159&gt;,#Port&lt;0.4161&gt;},&lt;0.392.0&gt;}) Opened session for testuser@example.com/91030605413396289162377</span>
</pre></div>
</div>
<p>Thats all folks, your jabber server is now finished and validating your
“jabber_users” Group.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-bind-account-in-freeipa">Create Bind account in FreeIPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-group-in-freeipa">Create Group in FreeIPA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enable-epel-repository">Enable EPEL repository</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-ejabberd-package">Install ejabberd package</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-configuration-file-to-use-tls-for-communication-between-the-server-and-your-jabber-clients">Edit Configuration file to use TLS for communication between the Server and your Jabber clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-configuration-file-to-enable-ldap-authentication-and-group-validation">Edit Configuration file to enable LDAP authentication and Group validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#open-tcp-ports-on-local-server">Open TCP ports on local Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-xmpp-client-on-a-workstation">Configure XMPP Client on a Workstation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-user-s-to-the-jabber-users-group">Add user(s) to the “jabber_users” group</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>