
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Remove_replica_in_a_managed_topology &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/HowTo/Remove_replica_in_a_managed_topology';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/HowTo/Remove_replica_in_a_managed_topology.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Remove_replica_in_a_managed_topology</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#designing-a-replication-topology">Designing a replication topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safely-removing-a-replica">Safely removing a replica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-a-leaf-replica">Removing a “leaf” replica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-an-internal-replica">Removing an “internal” replica</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="remove-replica-in-a-managed-topology">
<h1>Remove_replica_in_a_managed_topology<a class="headerlink" href="#remove-replica-in-a-managed-topology" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In IPA 4.3 the replication topology is controlled by the topology
plugin. Connections between replicas can only be created or removed by
the</p>
<p>ipa topologysegment-[add|del]</p>
<p>commands.</p>
<p>When a replica is removed by running</p>
<p>ipa-replica-manage del</p>
<p>the removal of replication segments and corresponding replication
agreements is automatically handled by the topology plugin.</p>
<p>But to be able to propagate these changes throughout the topology all
the remaining servers need to be connected. You should be careful in the
setup of a replication topology and in the actions to remove a replica.
the following sections will make recommendations for designig a
replication topology and how to procede when a replica has to be removed</p>
</section>
<section id="designing-a-replication-topology">
<h2>Designing a replication topology<a class="headerlink" href="#designing-a-replication-topology" title="Link to this heading">#</a></h2>
<p>The replication topology deployed should follow these rules:</p>
<p>Avoid single points of failure, the unavailability of one server or one
connection between servers should not disconnect the remaining servers.</p>
<p>Avoid high replication traffic in one node.</p>
<p>This will be further explained for the following replication topology
types:</p>
<figure class="align-default" id="id1">
<img alt="Topo-types.png" src="../../_images/Topo-types.png" />
<figcaption>
<p><span class="caption-text">Topo-types.png</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In Type 1 the replicas are connected in a string, any failing server
will disconnect the others.</p>
<p>In Type 2 the replicas are connected in a star like pattern, if replica
F is down all other replicas are disconnected, also replica F has to
manage all replicaion distribution from other servers, replica A,B ,C,D,
E will compete to update replica F, only one supplier can update a
replica at one time</p>
<p>In type 3 there is a good balance, all replicas are connected to others
vial different paths, also no replica has more than three replication
connections to handle</p>
</section>
<section id="safely-removing-a-replica">
<h2>Safely removing a replica<a class="headerlink" href="#safely-removing-a-replica" title="Link to this heading">#</a></h2>
</section>
<section id="removing-a-leaf-replica">
<h2>Removing a “leaf” replica<a class="headerlink" href="#removing-a-leaf-replica" title="Link to this heading">#</a></h2>
<p>Assuming the following replication topology:</p>
<p><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;--&gt;</span> <span class="pre">B</span> <span class="pre">&lt;--&gt;</span> <span class="pre">C</span> <span class="pre">&lt;--&gt;</span> <span class="pre">D</span></code></p>
<p>then the replicas at the endpoints of the replication chain, A or D, can
safely be removed by:</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa-replica-manage</span> <span class="pre">del</span> <span class="pre">A</span></code></p>
<p>The command removes the master entry for A and this will trigger that
the topoloy plugin removes the segment connecting A and B an will remove
the replication agreements A–&gt;B and B–&gt;A</p>
</section>
<section id="removing-an-internal-replica">
<h2>Removing an “internal” replica<a class="headerlink" href="#removing-an-internal-replica" title="Link to this heading">#</a></h2>
<p>Assume that in the above topology the internal node C should be removed.</p>
<p>If the command</p>
<p>ipa-replica-manage del C</p>
<p>is executed, the command will detect that the removal of C disconnects
the topology and rejects the command.</p>
<p>It will also list the replicas which will be no longer connected to each
other, use this information to add missing segments before finally
deleting the replica</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">checking</span> <span class="n">connectivity</span> <span class="ow">in</span> <span class="n">topology</span> <span class="n">suffix</span> <span class="s1">&#39;ipaca&#39;</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">Removal</span> <span class="n">of</span> <span class="s1">&#39;vm-110.abc.idm.lab.eng.brq.redhat.com&#39;</span> <span class="n">will</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">disconnected</span> <span class="n">topology</span> <span class="ow">in</span> <span class="n">suffix</span> <span class="s1">&#39;ipaca&#39;</span>
<span class="n">Changes</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">replicated</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">servers</span> <span class="ow">and</span> <span class="n">data</span> <span class="n">will</span> <span class="n">become</span> <span class="n">inconsistent</span><span class="o">.</span>
<span class="n">You</span> <span class="n">need</span> <span class="n">to</span> <span class="n">add</span> <span class="n">segments</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">disconnection</span> <span class="n">of</span> <span class="n">the</span> <span class="n">topology</span><span class="o">.</span>
<span class="n">Errors</span> <span class="ow">in</span> <span class="n">topology</span> <span class="n">after</span> <span class="n">removal</span><span class="p">:</span>
<span class="n">Topology</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">allow</span> <span class="n">server</span> <span class="n">vm</span><span class="o">-</span><span class="mf">072.</span><span class="n">abc</span><span class="o">.</span><span class="n">idm</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">brq</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span> <span class="n">to</span> <span class="n">replicate</span> <span class="k">with</span> <span class="n">servers</span><span class="p">:</span>
   <span class="n">vm</span><span class="o">-</span><span class="mf">192.</span><span class="n">abc</span><span class="o">.</span><span class="n">idm</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">brq</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span>
<span class="n">Topology</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">allow</span> <span class="n">server</span> <span class="n">vm</span><span class="o">-</span><span class="mf">192.</span><span class="n">abc</span><span class="o">.</span><span class="n">idm</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">brq</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span> <span class="n">to</span> <span class="n">replicate</span> <span class="k">with</span> <span class="n">servers</span><span class="p">:</span>
   <span class="n">vm</span><span class="o">-</span><span class="mf">072.</span><span class="n">abc</span><span class="o">.</span><span class="n">idm</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">brq</span><span class="o">.</span><span class="n">redhat</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NOTE:</span> <span class="pre">the</span> <span class="pre">removal</span> <span class="pre">of</span> <span class="pre">an</span> <span class="pre">internal</span> <span class="pre">node</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">enforced</span> <span class="pre">by</span> <span class="pre">adding</span> <span class="pre">--force</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">command,</span> <span class="pre">but</span> <span class="pre">it</span> <span class="pre">should</span> <span class="pre">never</span> <span class="pre">be</span> <span class="pre">done</span></code></p>
<p>There are two cases</p>
<ol class="loweralpha simple">
<li><p>node C is working and properly handling replication traffic</p></li>
</ol>
<p>Even if the node C is still operable and replicating its removal should
not be enforced. The removal of C will trigger the removal of the
connections to B and D, there can be race conditions where not all
information on topology change is replicated to D before the agreement
to D is removed.</p>
<p>And node D will be isolated after removal of C, so new segments will
have to be added. Therefore the adding of the new segment should be done
before the removal.</p>
<ol class="loweralpha simple" start="2">
<li><p>node C is inoperable and the topology is already broken.</p></li>
</ol>
<p>In this scenario there is no chance that the removal of C will be
propagated to D (if the removal is triggered on A or B) or to A,B (if
the removal is triggered from D). But the removal information is kept in
the changelog and will be sent after the topology is connected again by
adding new segments. Depending what other toplogy changes have been done
in between there could be race conditions where the late replication of
the removal could give unexpeted results.</p>
<p>As a conclusion, in both cases the topology should be extended first to
keep the topology connected, by running</p>
<p><code class="docutils literal notranslate"><span class="pre">ipa</span> <span class="pre">topologysegment-add</span> <span class="pre">--leftnode=A</span> <span class="pre">--rightnode=D</span></code></p>
<p>This ensures that the toplogy is fully connected again and keeps
connected after C is removed</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#designing-a-replication-topology">Designing a replication topology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safely-removing-a-replica">Safely removing a replica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-a-leaf-replica">Removing a “leaf” replica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-an-internal-replica">Removing an “internal” replica</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>