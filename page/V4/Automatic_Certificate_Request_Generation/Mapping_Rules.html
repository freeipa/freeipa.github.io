
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Mapping_Rules &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Automatic_Certificate_Request_Generation/Mapping_Rules';</script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/page/V4/Automatic_Certificate_Request_Generation/Mapping_Rules.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mapping_Rules</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Mapping_Rules</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-rules">Data rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax-rules">Syntax rules</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#planned-implementation">Planned implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-available-during-final-render">Data available during final render</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-features">Special features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#current-status">Current status</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#macros-not-tags">Macros, not tags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rule-suppression">Rule suppression</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alternatives-considered">Alternatives considered</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#template-languages">Template languages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-interpolation">Data interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Rule suppression</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="mapping-rules">
<h1>Mapping_Rules<a class="headerlink" href="#mapping-rules" title="Link to this heading">#</a></h1>
</section>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h1>
<p>Certificate Mapping Rule objects, as defined in
<a class="reference external" href="V4/Automatic_Certificate_Request_Generation#Mapping_data_to_fields">V4/Automatic_Certificate_Request_Generation#Mapping_data_to_fields</a>,
need a mechanism for defining how to use the data stored in IPA objects
to construct the configuration strings that are passed to the CSR
generation helper. This document aims to elaborate on the features
required for this mapping, and describe the current implementation as
well as possible alternatives.</p>
</section>
<section id="requirements">
<h1>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h1>
<p>There are two different types of mapping rules used in CSR data
formatting:</p>
<dl class="simple">
<dt>Data rules</dt><dd><p>Describe how to format an individual data item</p>
</dd>
<dt>Syntax rules</dt><dd><p>Describe how to combine data rules in order to create a complete
certificate field</p>
</dd>
</dl>
<section id="data-rules">
<h2>Data rules<a class="headerlink" href="#data-rules" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Include data attribute values</p></li>
<li><p>Include literal values</p></li>
<li><p>Include values requested from the user via a prompt</p></li>
<li><p>For certutil: replace commas with a different separator character (;
or +) within a DN-type subject alternative name</p></li>
<li><p>For certutil: shell quoting of parameters to prevent injection
attacks</p></li>
<li><p>Suppress rendering of a rule if necessary data is missing</p></li>
</ul>
</section>
<section id="syntax-rules">
<h2>Syntax rules<a class="headerlink" href="#syntax-rules" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Distinguish between generated config files and command-line arguments</p></li>
<li><p>For openssl: produce and reference new config file sections</p></li>
<li><p>For openssl: place config value in root or extensions section as
appropriate</p></li>
<li><p>Combine several values for same field (e.g. comma-separated list)</p></li>
<li><p>Suppress rendering of a rule if none of the data rules it contains
are going to be rendered</p></li>
</ul>
</section>
</section>
<section id="planned-implementation">
<h1>Planned implementation<a class="headerlink" href="#planned-implementation" title="Link to this heading">#</a></h1>
<p>We will use Jinja2 for templating. Data rules and syntax rules will both
be snippets of Jinja2 markup. The formatting process will be as follows:</p>
<ol class="arabic simple">
<li><p>Syntax rules will be rendered using Jinja2. Data rules (rule text,
not rendered) will be passed as the <code class="docutils literal notranslate"><span class="pre">datarules</span></code> attribute.</p></li>
<li><p>Rendered syntax rules will be processed by the Formatter class for
the selected CSR generation helper. The formatter combines these
partial rules into a full template for the config.</p></li>
<li><p>The template will be rendered using Jinja2. Several objects from the
IPA server (discussed below) will be available in the context for
this rendering.</p></li>
<li><p>The final rendered template will be returned to the caller, labeled
with its function (e.g. a command line or a config file)</p></li>
</ol>
<section id="data-available-during-final-render">
<h2>Data available during final render<a class="headerlink" href="#data-available-during-final-render" title="Link to this heading">#</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">subject</span></code></dt><dd><p>dict of data from the IPA object corresponding to the subject of this
certificate</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt><dd><p>dict of IPA configuration data (result of the config_show API call)</p>
</dd>
</dl>
</section>
<section id="special-features">
<h2>Special features<a class="headerlink" href="#special-features" title="Link to this heading">#</a></h2>
<p>Some less-than-obvious features will be required to support generating
the needed configs. Some of them will require extensions to the Jinja2
language, others just require specific usage of the tools that Jinja2
already provides.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">section</span> <span class="pre">%}{%</span> <span class="pre">endsection</span> <span class="pre">%}</span></code></dt><dd><p>This tag will be introduced to make the included block into a new
section, as for an openssl config file.</p>
</dd>
<dt>Easy escaping</dt><dd><p>Some tags, like <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">section</span> <span class="pre">%}</span></code>, are only meaningful during the
second (full-template) render. During the first render they will be
implemented to just insert the same tag in the output.</p>
</dd>
<dt>Location specifier</dt><dd><p>Rules must be able to provide guidance to the formatter about where
they belong in the config file (for example, whether a rule is an
extension or goes in the base <code class="docutils literal notranslate"><span class="pre">[req]</span></code> section). This is
accomplished by setting a template variable in the syntax rule, for
example <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">set</span> <span class="pre">location</span> <span class="pre">=</span> <span class="pre">&quot;req&quot;</span> <span class="pre">%}</span></code></p>
</dd>
</dl>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>Example data rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">email</span><span class="o">=</span><span class="p">{{</span><span class="n">subject</span><span class="o">.</span><span class="n">email</span><span class="p">}}</span>
<span class="n">O</span><span class="o">=</span><span class="p">{{</span><span class="n">config</span><span class="o">.</span><span class="n">ipacertificatesubjectbase</span><span class="p">}}</span>\<span class="n">nCN</span><span class="o">=</span><span class="p">{{</span><span class="n">subject</span><span class="o">.</span><span class="n">username</span><span class="p">}}</span>
</pre></div>
</div>
<p>Example syntax rule:</p>
<p><code class="docutils literal notranslate"><span class="pre">subjectAltName=&#64;{%</span> <span class="pre">section</span> <span class="pre">%}{{datarules|join('\n')}}{%</span> <span class="pre">endsection</span> <span class="pre">%}</span></code></p>
<p>Example composed config template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">req</span> <span class="p">]</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="n">no</span>
<span class="n">encrypt_key</span> <span class="o">=</span> <span class="n">no</span>

<span class="n">distinguished_name</span> <span class="o">=</span> <span class="p">{</span><span class="o">%</span> <span class="n">section</span> <span class="o">%</span><span class="p">}</span><span class="n">O</span><span class="o">=</span><span class="p">{{</span><span class="n">config</span><span class="o">.</span><span class="n">ipacertificatesubjectbase</span><span class="p">}}</span>
<span class="n">CN</span><span class="o">=</span><span class="p">{{</span><span class="n">subject</span><span class="o">.</span><span class="n">username</span><span class="p">}}{</span><span class="o">%</span> <span class="n">endsection</span> <span class="o">%</span><span class="p">}</span>

<span class="n">req_extensions</span> <span class="o">=</span> <span class="n">exts</span>

<span class="p">[</span> <span class="n">exts</span> <span class="p">]</span>
<span class="n">subjectAltName</span><span class="o">=@</span><span class="p">{</span><span class="o">%</span> <span class="n">section</span> <span class="o">%</span><span class="p">}</span><span class="n">email</span><span class="o">=</span><span class="p">{{</span><span class="n">subject</span><span class="o">.</span><span class="n">email</span><span class="p">}}{</span><span class="o">%</span> <span class="n">endsection</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="current-status">
<h1>Current status<a class="headerlink" href="#current-status" title="Link to this heading">#</a></h1>
<p>The code <a class="reference external" href="https://www.redhat.com/archives/freeipa-devel/2016-July/msg00462.html">currently under
review</a>
implements most of the features described above, with some exceptions:</p>
<section id="macros-not-tags">
<h2>Macros, not tags<a class="headerlink" href="#macros-not-tags" title="Link to this heading">#</a></h2>
<p>It was convenient to use jinja2 macros to implement some of the
<a class="reference external" href="#Special_features">#Special features</a> instead of adding new tags
which requires extending the parser. So, instead of
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">section</span> <span class="pre">%}{%</span> <span class="pre">endsection</span> <span class="pre">%}</span></code>, one has to use
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">call</span> <span class="pre">section()</span> <span class="pre">%}{%</span> <span class="pre">endcall</span> <span class="pre">%}</span></code> to enclose the contents of an
openssl config section. Similarly, the features that allow suppressing
rules with no data are implemented using jinja2 macros. If the macros
turn out to be problematic, we may want to move to using tags after all.</p>
</section>
<section id="rule-suppression">
<h2>Rule suppression<a class="headerlink" href="#rule-suppression" title="Link to this heading">#</a></h2>
<p>It is important that the final output does not contain
partially-constructed strings, reference empty sections, or provide
command-line flags missing their arguments. So, we must be able to
prevent rendering an entire rule, when some parts of it can not be
rendered due to missing data. That is currently implemented using three
macros: syntaxrule, datarule, and datafield.</p>
<ul class="simple">
<li><p>syntaxrule wraps the contents of a syntax rule and renders it only
when at least one of the included datarules will be rendered.</p></li>
<li><p>datarule wraps the contents of a data rule and renders it only when
all of the included datafields contain data. It informs the enclosing
syntaxrule whether the data rule will be rendered.</p></li>
<li><p>datafield wraps an individual data item. If the wrapped value is
empty, the enclosing datarule will not be rendered.</p></li>
</ul>
<p>The syntaxrule and datarule macros are applied automatically by the
framework code, so users should only be concerned about datafield. All
data items in the data rules must be marked as such using this macro,
for example:</p>
<p><code class="docutils literal notranslate"><span class="pre">email:{{ipa.datafield(subject.mail.0)|quote}}</span></code></p>
</section>
</section>
<section id="alternatives-considered">
<h1>Alternatives considered<a class="headerlink" href="#alternatives-considered" title="Link to this heading">#</a></h1>
<section id="template-languages">
<h2>Template languages<a class="headerlink" href="#template-languages" title="Link to this heading">#</a></h2>
<p>Several possible tools were considered and tested for implementing these
relationships before settling on jinja2:</p>
<ul class="simple">
<li><p>For prototyping only: built-in python code. This could take advantage
of the ability to query the API from within FreeIPA. However, it
would be unsafe to allow administrators to add new mappings that run
arbitrary code, so this does not satisfy the goal of giving
administrators the ability to define their own mappings.</p></li>
<li><p>Jinja2. Nice because it doesn’t reinvent the wheel by defining a new
syntax, but would add a dependency to FreeIPA. Would also probably
need to use its sandboxing features to prevent becoming a vector for
arbitrary code execution.</p></li>
<li><p>Custom syntax, perhaps similar to <a class="reference external" href="https://git.fedorahosted.org/cgit/slapi-nis.git/plain/doc/format-specifiers.txt">NIS format
specifiers</a>.
Would only need to define syntax for what we need, but a whole
language would need to be defined and implemented.</p></li>
</ul>
</section>
<section id="data-interpolation">
<h2>Data interpolation<a class="headerlink" href="#data-interpolation" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://blog.benjaminlipton.com/2016/07/19/csr-generation-templating.html">This blog
post</a>
(<a class="reference external" href="V4/Automatic_Certificate_Request_Generation/Thinking_About_Templating_Post">archived
here</a>)
analyzes some alternative ways of using jinja2 to format rules, besides
the current option of substituting data rules into syntax rules.</p>
</section>
<section id="id1">
<h2>Rule suppression<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>In retrospect, the definitions of the syntaxrule, datarule, and
datafield macros are difficult to understand and modify, in part because
it is difficult to avoid introducing unintended whitespace into the
produced output. As a result of this, the code has a couple of minor
bugs where sections are produced that should not be, which are difficult
to fix because of the brittleness of the macros. We may want to consider
an alternative implementation, such as:</p>
<ul class="simple">
<li><p>It may be possible to write a more flexible implementation as a
jinja2 tag rather than macros. Although not necessarily easier to
understand, a parser extension might be able to handle the
relationship between syntax rules, data rules, data fields, and
openssl sections better because it has access to the internal AST of
the template.</p></li>
<li><p>Instead of simply rendering things to see if they produce output, we
could explicitly tag data rules with the data items they depend on.
Then we could automatically insert <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code> statements into the
code to suppress things when those data items are unavailable. Of
course, if the tagged data items were incorrect the suppression would
not work correctly.</p></li>
<li><p>Finally, if we were interpolating user data during each render rather
than just the final one (<a class="reference external" href="http://blog.benjaminlipton.com/2016/07/19/csr-generation-templating.html#two-pass-data-interpolation">this
solution</a>
for example) we could easily drop any rules that didn’t produce
output. However, then we would be at much higher risk of template
injection attacks.</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Mapping_Rules</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-rules">Data rules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax-rules">Syntax rules</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#planned-implementation">Planned implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-available-during-final-render">Data available during final render</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-features">Special features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#current-status">Current status</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#macros-not-tags">Macros, not tags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rule-suppression">Rule suppression</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#alternatives-considered">Alternatives considered</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#template-languages">Template languages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-interpolation">Data interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Rule suppression</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>