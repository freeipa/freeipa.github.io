

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Pull-Request_CI &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Pull-Request_CI';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Pull-Request_CI.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Pull-Request_CI</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-host-environment-provisioning">Multi-host environment provisioning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#github-integration">GitHub integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-execution">Task execution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publishing-test-results-and-artifacts">Publishing test results and artifacts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="pull-request-ci">
<h1>Pull-Request_CI<a class="headerlink" href="#pull-request-ci" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>During FreeIPA development, existing test cases are often broken by
seemingly unrelated changes in the code. Manual testing of all use cases
isn’t feasible. Running the integration test suite manually is not
simple and very time consuming, and thus often skipped. This causes
frequent regressions and malfunctioning code in the master branch.</p>
<p>A proposed solution is to implement on pull-request (PR) continuous
integration (CI) that will run a large portion of the existing test
suite. Currently, we are running single host test on every pull request.
The goal of this effort is to extend our on-PR CI to also execute
multi-host tests. Running the extended test suite should help us to
discover broken test cases early on and stabilize our master branch.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>As a FreeIPA contributor,</p>
<ul>
<li><p>I open a pull request on GitHub against the project. FreeIPA core
developer verifies no malicious code will be executed during the
test runs and approves it for testing and PR is automatically
queued for test execution.</p></li>
<li><p>I update the pull-request. The changes have to be approved by a
core developer once again before the code is queued for test
execution.</p></li>
</ul>
</li>
<li><p>As a white-listed FreeIPA contributor,</p>
<ul>
<li><p>I open a pull request on GitHub against the project. This PR is
automatically queued for test execution.</p></li>
<li><p>I update the pull request’s code. This PR is automatically queued
for test execution.</p></li>
</ul>
</li>
</ul>
<p>Once the test execution finishes, I can see the test results directly in
the PR along with links to publicly accessible logs I can inspect to
debug failures.</p>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h2>
<p>The main goal of this feature is to enable execution of multi-host tests
on GitHub PRs. The following has to be addressed in this design:</p>
<ul class="simple">
<li><p>Multi-host environment provisioning</p></li>
<li><p>GitHub integration</p></li>
<li><p>Task execution</p></li>
<li><p>Publishing test results and artifcats</p></li>
<li><p>Deployment of test runners</p></li>
</ul>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Test results and logs are easily accessible to developers and
community</p>
<ul>
<li><p>It is crucial to be able to track down which test case has failed
and why</p></li>
<li><p>The results must be publicly accessible</p></li>
</ul>
</li>
<li><p>All test results are available under 1.5 hours</p>
<ul>
<li><p>Rapid feedback is a priority, even if that results in a smaller
test-suite</p></li>
<li><p>Up to 3 PRs can be tested simultaneously. Additional PRs may
increase the time.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id1">
<h2>Overview<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>Collection of machines called <em>test runners</em> are monitoring GitHub PRs.
Test runners can be running anywhere, they just need to have credentials
for GitHub, access to the internet and must support virtualization. If
the test runner itself is a virtual machine, it has to support nested
virtualization.</p>
<p>A prioritized queue of tasks is constructed from the PRs. These tasks
are builds and individual test suites that are executed atomically. Test
runner picks up a task with the highest priority and starts executing
it. This is announced through <a class="reference external" href="https://developer.github.com/v3/repos/statuses/">GitHub commit
status</a> update to
avoid collisions with other test runners.</p>
<p>Once the task is finished, a publicly accessible URL with links to the
artifacts (rpms, logs) is announced along with the task result in a
commit status.</p>
</section>
<section id="multi-host-environment-provisioning">
<h2>Multi-host environment provisioning<a class="headerlink" href="#multi-host-environment-provisioning" title="Permalink to this heading">#</a></h2>
<p>Hosts are provisioned as virtual machines (VM). To speed up the
provisioning and to alleviate issues with broken dependencies, VM
templates will be created and kept up-to-date. libvirt was chosen as the
provider and the templates themselves will be vargant boxes. The boxes
are published and accessible on <a class="reference external" href="https://atlas.hashicorp.com/freeipa">HashiCorp
Atlas</a>.</p>
</section>
<section id="github-integration">
<h2>GitHub integration<a class="headerlink" href="#github-integration" title="Permalink to this heading">#</a></h2>
<p>Test runners communicate through with GitHub through its API. Each pull
request has a collection of <a class="reference external" href="https://developer.github.com/v3/repos/statuses/">GitHub commit
statuses</a> associated
with it. These are used for all communication. This was inspired by the
<a class="reference external" href="https://github.com/cockpit-project/cockpit/tree/master/test">Cockpit
project</a>.</p>
</section>
<section id="task-execution">
<h2>Task execution<a class="headerlink" href="#task-execution" title="Permalink to this heading">#</a></h2>
<p>For each PR, a build and a series of test suites have to be executed.
The test runners use a common algorithm to determine the priority of all
waiting tasks for all pull requests. Idle test runner picks the
top-priority task, starts executing it, and marks it in progress.</p>
</section>
<section id="publishing-test-results-and-artifacts">
<h2>Publishing test results and artifacts<a class="headerlink" href="#publishing-test-results-and-artifacts" title="Permalink to this heading">#</a></h2>
<p>Once the task finishes, the artifacts (rpms, logs) are uploaded and a
URL is created. Currently, the artifacts are uploaded and stored on
<a class="reference external" href="https://fedorapeople.org/groups/freeipa/">fedorapeople.org</a>,
although any publicly accessible storage can be used.</p>
<p>The produced URL and the test result is announced by the test runner in
the GitHub commit status.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h2>
<p>For implementation details, see the <a class="reference external" href="https://github.com/freeipa/freeipa-pr-ci/blob/master/doc/README.md">Developer
Documentation</a>.</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-host-environment-provisioning">Multi-host environment provisioning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#github-integration">GitHub integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-execution">Task execution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publishing-test-results-and-artifacts">Publishing test results and artifacts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>