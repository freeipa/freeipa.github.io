
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Dovecot_IMAPS_Integration_with_FreeIPA_using_Single_Sign_On &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Dovecot_IMAPS_Integration_with_FreeIPA_using_Single_Sign_On';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/Dovecot_IMAPS_Integration_with_FreeIPA_using_Single_Sign_On.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Dovecot_IMAPS_Integration_with_FreeIPA_using_Single_Sign_On</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gotcha-s">Gotcha’s</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-system-to-ipa-domain-ensure-dns-is-working-correctly-otherwise-this-step-will-fail">Add system to IPA Domain (ensure DNS is working correctly otherwise this step will fail)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-dovecot-and-set-service-to-start-on-boot">Install Dovecot and set service to start on boot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-dovecot-conf-to-allow-imap">Edit /etc/dovecot/dovecot.conf to allow imap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-conf-d-10-auth-conf-to-configure-kerberos-authentication">Edit /etc/dovecot/conf.d/10-auth.conf to configure kerberos authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-ipa-group-for-mailbox-access">Create new IPA group for mailbox access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-users-to-mailusers-group">Add users to “mailusers” group</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-directory-for-user-mailboxes">Create new directory for user mailboxes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-conf-d-10-mail-conf-to-configure-the-mailbox-location">Edit /etc/dovecot/conf.d/10-mail.conf to configure the mailbox location</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-a-kerberos-keytab-for-dovecot-imap-access">Generate a kerberos keytab for Dovecot IMAP access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-the-permissions-of-the-keytab-to-allow-dovecot-to-read-the-file-note-this-should-be-kept-secure-so-only-grant-enough-privileges-as-absolutely-necessary">Change the permissions of the keytab to allow Dovecot to read the file (Note, this should be kept secure, so only grant enough privileges as absolutely necessary.)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restart-dovecot">Restart Dovecot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#send-a-test-email-to-your-user">Send a test email to your user</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-thunderbird-to-connect-to-imap-server">Configure Thunderbird to connect to IMAP Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verify-your-authentication-on-the-dovecot-server">Verify your authentication on the Dovecot server</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="dovecot-imaps-integration-with-freeipa-using-single-sign-on">
<h1>Dovecot_IMAPS_Integration_with_FreeIPA_using_Single_Sign_On<a class="headerlink" href="#dovecot-imaps-integration-with-freeipa-using-single-sign-on" title="Link to this heading">#</a></h1>
<p><strong>HOWTO: Configure Dovecot to authenticate IPA users using Kerberos with
Single Sign On.</strong></p>
<p><strong>Provided by Dale Macartney</strong></p>
<p>The below details will walk you through how to add a Red Hat Enterprise
Linux 6.2 system to an IPA domain, and then configure Dovecot to allow
single sign on to user mailboxes with IMAP/S.</p>
<p>Details of this example are as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">Server</span><span class="p">:</span> <span class="n">ds01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Dovecot</span> <span class="n">Server</span><span class="p">:</span> <span class="n">mail01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">Client</span><span class="p">:</span> <span class="n">workstation01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">IPA</span> <span class="n">User</span><span class="p">:</span> <span class="n">user1</span> <span class="ow">and</span> <span class="n">user2</span>
</pre></div>
</div>
<p><strong>Please Note: This guide describes using SSL combined with Dovecot to
deliver IMAPS support. This guide is not designed to cover how to create
a valid SSL certificate. This guide uses the default dovecot generated
certificate and it is HIGHLY recommended that if you wish to deploy this
into a production environment, that you replace this certificate with
your own trusted/validated certificate</strong></p>
<section id="gotcha-s">
<h2>Gotcha’s<a class="headerlink" href="#gotcha-s" title="Link to this heading">#</a></h2>
<p>I encounter a few gotcha’s around mailbox storage which would be
worthwhile remembering, or at least keep in mind for deployment
considerations.</p>
<p>Storing MailDir content in home directories is a very common method for
managing mailboxes.</p>
<p>If you use automount for your IPA based users (e.g. NFS Home
Directories), you need to keep in mind that Dovecot does not manage an
interactive login which would be when the automount normally occurs.</p>
<p>The result of this will mean that trying to store the MailDir folders in
a users network based home dir will fail as in the eyes of Dovecot, the
folder simply won’t exist. Basically, Dovecot will not be able to write
to your automount directory.</p>
<p>This guide will show you how to use local based storage to manage this
issue and create any directories which aren’t currently present.</p>
</section>
<section id="add-system-to-ipa-domain-ensure-dns-is-working-correctly-otherwise-this-step-will-fail">
<h2>Add system to IPA Domain (ensure DNS is working correctly otherwise this step will fail)<a class="headerlink" href="#add-system-to-ipa-domain-ensure-dns-is-working-correctly-otherwise-this-step-will-fail" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipa-client-install</span> <span class="pre">-U</span> <span class="pre">-p</span> <span class="pre">admin</span> <span class="pre">-w</span> <span class="pre">mysecretpassword</span></code></p>
</section>
<section id="install-dovecot-and-set-service-to-start-on-boot">
<h2>Install Dovecot and set service to start on boot<a class="headerlink" href="#install-dovecot-and-set-service-to-start-on-boot" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install dovecot</span>
<span class="c1"># chkconfig dovecot on</span>
</pre></div>
</div>
</section>
<section id="edit-etc-dovecot-dovecot-conf-to-allow-imap">
<h2>Edit /etc/dovecot/dovecot.conf to allow imap<a class="headerlink" href="#edit-etc-dovecot-dovecot-conf-to-allow-imap" title="Link to this heading">#</a></h2>
<p>Find</p>
<p><code class="docutils literal notranslate"><span class="pre">#protocols</span> <span class="pre">=</span> <span class="pre">imap</span> <span class="pre">pop3</span> <span class="pre">lmtp</span></code></p>
<p>and replace with</p>
<p><code class="docutils literal notranslate"><span class="pre">protocols</span> <span class="pre">=</span> <span class="pre">imap</span></code></p>
</section>
<section id="edit-etc-dovecot-conf-d-10-auth-conf-to-configure-kerberos-authentication">
<h2>Edit /etc/dovecot/conf.d/10-auth.conf to configure kerberos authentication<a class="headerlink" href="#edit-etc-dovecot-conf-d-10-auth-conf-to-configure-kerberos-authentication" title="Link to this heading">#</a></h2>
<p>Enter the below lines at the end of the file
/etc/dovecot/conf.d/10-auth.conf</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">userdb</span> <span class="p">{</span>
  <span class="n">driver</span> <span class="o">=</span> <span class="n">static</span>
  <span class="n">args</span> <span class="o">=</span> <span class="n">uid</span><span class="o">=</span><span class="n">dovecot</span> <span class="n">gid</span><span class="o">=</span><span class="n">dovecot</span> <span class="n">home</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">mail</span><span class="o">/%</span><span class="n">u</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, find the below lines (these will be in various locations inside
the file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth_mechanisms</span> <span class="o">=</span> <span class="n">plain</span>
<span class="c1">#auth_gssapi_hostname =</span>
<span class="c1">#auth_krb5_keytab =</span>
<span class="c1">#auth_realms =</span>
<span class="c1">#auth_default_realm =</span>
</pre></div>
</div>
<p>and replace with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth_mechanisms</span> <span class="o">=</span> <span class="n">gssapi</span>
<span class="n">auth_gssapi_hostname</span> <span class="o">=</span> <span class="n">mail01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">auth_krb5_keytab</span> <span class="o">=</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">dovecot</span><span class="o">/</span><span class="n">krb5</span><span class="o">.</span><span class="n">keytab</span>
<span class="n">auth_realms</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">auth_default_realm</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</section>
<section id="create-new-ipa-group-for-mailbox-access">
<h2>Create new IPA group for mailbox access<a class="headerlink" href="#create-new-ipa-group-for-mailbox-access" title="Link to this heading">#</a></h2>
<p>From your IPA server, create a new group for your users to store their
mailbox</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span><span class="o">~</span><span class="p">]</span><span class="c1"># ipa group-add</span>
 <span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">mailusers</span>
 <span class="n">Description</span><span class="p">:</span> <span class="n">Mail</span> <span class="n">User</span> <span class="n">Group</span>
 <span class="o">--------------------</span>
 <span class="n">Added</span> <span class="n">group</span> <span class="s2">&quot;mailusers&quot;</span>
 <span class="o">--------------------</span>
 <span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">mailusers</span>
 <span class="n">Description</span><span class="p">:</span> <span class="n">Mail</span> <span class="n">User</span> <span class="n">Group</span>
 <span class="n">GID</span><span class="p">:</span> <span class="mi">1427200003</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="add-users-to-mailusers-group">
<h2>Add users to “mailusers” group<a class="headerlink" href="#add-users-to-mailusers-group" title="Link to this heading">#</a></h2>
<p>Add your users to the new group</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ipa group-add-member mailusers</span>
<span class="p">[</span><span class="n">member</span> <span class="n">user</span><span class="p">]:</span> <span class="n">user1</span>
<span class="p">[</span><span class="n">member</span> <span class="n">group</span><span class="p">]:</span>
  <span class="n">Group</span> <span class="n">name</span><span class="p">:</span> <span class="n">mailusers</span>
  <span class="n">Description</span><span class="p">:</span> <span class="n">Mail</span> <span class="n">User</span> <span class="n">Group</span>
  <span class="n">GID</span><span class="p">:</span> <span class="mi">1427200003</span>
  <span class="n">Member</span> <span class="n">users</span><span class="p">:</span> <span class="n">user1</span>
<span class="o">-------------------------</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">members</span> <span class="n">added</span> <span class="mi">1</span>
<span class="o">-------------------------</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ds01</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="create-new-directory-for-user-mailboxes">
<h2>Create new directory for user mailboxes<a class="headerlink" href="#create-new-directory-for-user-mailboxes" title="Link to this heading">#</a></h2>
<p>Create a new directory to be used as your mail store for the server.
Also remember to change the group membership to allow your “mailusers”
to be able to write to the folder.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">mail</span>
<span class="n">chmod</span> <span class="mi">770</span> <span class="o">/</span><span class="n">mail</span>
<span class="n">chgrp</span> <span class="n">mailusers</span> <span class="o">/</span><span class="n">mail</span>
<span class="n">chcon</span> <span class="o">-</span><span class="n">t</span> <span class="n">user_home_t</span> <span class="o">/</span><span class="n">mail</span>
</pre></div>
</div>
<p>Note: If you wish to use file system quotas or add high availability to
your solution, having this folder on a shared file system would be very
beneficial.</p>
</section>
<section id="edit-etc-dovecot-conf-d-10-mail-conf-to-configure-the-mailbox-location">
<h2>Edit /etc/dovecot/conf.d/10-mail.conf to configure the mailbox location<a class="headerlink" href="#edit-etc-dovecot-conf-d-10-mail-conf-to-configure-the-mailbox-location" title="Link to this heading">#</a></h2>
<p>Find</p>
<p><code class="docutils literal notranslate"><span class="pre">#mail_location</span> <span class="pre">=</span></code></p>
<p>and replace with</p>
<p><code class="docutils literal notranslate"><span class="pre">mail_location</span> <span class="pre">=</span> <span class="pre">mbox:/mail/%u/:INBOX=/var/mail/%u</span></code></p>
</section>
<section id="generate-a-kerberos-keytab-for-dovecot-imap-access">
<h2>Generate a kerberos keytab for Dovecot IMAP access<a class="headerlink" href="#generate-a-kerberos-keytab-for-dovecot-imap-access" title="Link to this heading">#</a></h2>
<p>On the IPA server run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># kinit admin</span>
<span class="n">Password</span> <span class="k">for</span> <span class="n">admin</span><span class="nd">@EXAMPLE</span><span class="o">.</span><span class="n">COM</span><span class="p">:</span>
<span class="c1"># ipa service-add imap/mail01.example.com</span>
</pre></div>
</div>
<p>If successful, you will see the below output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">----------------------------------------------------</span>
<span class="n">Added</span> <span class="n">service</span> <span class="s2">&quot;imap/mail01.example.com@EXAMPLE.COM&quot;</span>
<span class="o">----------------------------------------------------</span>
  <span class="n">Principal</span><span class="p">:</span> <span class="n">imap</span><span class="o">/</span><span class="n">mail01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="nd">@EXAMPLE</span><span class="o">.</span><span class="n">COM</span>
  <span class="n">Managed</span> <span class="n">by</span><span class="p">:</span> <span class="n">mail01</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>On the Dovecot server run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># kinit admin</span>
<span class="c1"># ipa-getkeytab -s ds01.example.com -p imap/mail01.example.com -k /etc/dovecot/krb5.keytab</span>
</pre></div>
</div>
<p>if successful, you will see the below output:</p>
<p><code class="docutils literal notranslate"><span class="pre">Keytab</span> <span class="pre">successfully</span> <span class="pre">retrieved</span> <span class="pre">and</span> <span class="pre">stored</span> <span class="pre">in:</span> <span class="pre">/etc/dovecot/krb5.keytab</span></code></p>
</section>
<section id="change-the-permissions-of-the-keytab-to-allow-dovecot-to-read-the-file-note-this-should-be-kept-secure-so-only-grant-enough-privileges-as-absolutely-necessary">
<h2>Change the permissions of the keytab to allow Dovecot to read the file (Note, this should be kept secure, so only grant enough privileges as absolutely necessary.)<a class="headerlink" href="#change-the-permissions-of-the-keytab-to-allow-dovecot-to-read-the-file-note-this-should-be-kept-secure-so-only-grant-enough-privileges-as-absolutely-necessary" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># chown root:dovecot /etc/dovecot/krb5.keytab</span>
<span class="c1"># chmod 640 /etc/dovecot/krb5.keytab</span>
</pre></div>
</div>
</section>
<section id="restart-dovecot">
<h2>Restart Dovecot<a class="headerlink" href="#restart-dovecot" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service dovecot restart</span>
<span class="n">Stopping</span> <span class="n">Dovecot</span> <span class="n">IMAP</span><span class="p">:</span> <span class="o">................</span>                           <span class="p">[</span>  <span class="n">OK</span>  <span class="p">]</span>
<span class="n">Starting</span> <span class="n">Dovecot</span> <span class="n">IMAP</span><span class="p">:</span> <span class="o">.</span>                                          <span class="p">[</span>  <span class="n">OK</span>  <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="send-a-test-email-to-your-user">
<h2>Send a test email to your user<a class="headerlink" href="#send-a-test-email-to-your-user" title="Link to this heading">#</a></h2>
<p>From your Dovecot server, run the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">echo</span> <span class="pre">Hello</span> <span class="pre">|</span> <span class="pre">mail</span> <span class="pre">-s</span> <span class="pre">Hello</span> <span class="pre">user1&#64;example.com</span></code></p>
</section>
<section id="configure-thunderbird-to-connect-to-imap-server">
<h2>Configure Thunderbird to connect to IMAP Server<a class="headerlink" href="#configure-thunderbird-to-connect-to-imap-server" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Open Thunderbird</p></li>
<li><p>Click the Edit Menu and select Account Settings</p></li>
<li><p>Under Account Actions (Bottom left), select “Add Mail Account”</p></li>
<li><p>Enter Name (user1), Email Address(<a class="reference external" href="mailto:user1&#37;&#52;&#48;example&#46;com">user1<span>&#64;</span>example<span>&#46;</span>com</a>) and leave
password blank, then click continue</p></li>
<li><p>Verify the username is user1 (not <a class="reference external" href="mailto:user1&#37;&#52;&#48;example&#46;com">user1<span>&#64;</span>example<span>&#46;</span>com</a>, Set the imcoming
server to mail01.example.com, select IMAP, Set port to 993, and
select SSL/TLS. Then click Manual Setup</p></li>
<li><p>Select Server Settings under your new mail account</p></li>
<li><p>Select Kerberos/GSSAPI as the Authentication Method, then click OK</p></li>
<li><p>Click Get Mail and you will be presented to accept an SSL
Certificate.</p></li>
<li><p>Once you have accepted the SSL Certificate, you will see your test
email you sent in the previous step.</p></li>
</ol>
</section>
<section id="verify-your-authentication-on-the-dovecot-server">
<h2>Verify your authentication on the Dovecot server<a class="headerlink" href="#verify-your-authentication-on-the-dovecot-server" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># tail /var/log/maillog</span>
<span class="n">Feb</span> <span class="mi">10</span> <span class="mi">13</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">22</span> <span class="n">mail01</span> <span class="n">dovecot</span><span class="p">:</span> <span class="n">imap</span><span class="o">-</span><span class="n">login</span><span class="p">:</span> <span class="n">Login</span><span class="p">:</span> <span class="n">user</span><span class="o">=&lt;</span><span class="n">user1</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">GSSAPI</span><span class="p">,</span> <span class="n">rip</span><span class="o">=</span><span class="mf">192.168.122.51</span><span class="p">,</span> <span class="n">lip</span><span class="o">=</span><span class="mf">192.168.122.63</span><span class="p">,</span> <span class="n">mpid</span><span class="o">=</span><span class="mi">1835</span><span class="p">,</span> <span class="n">TLS</span>
</pre></div>
</div>
<p>If everything has worked successfully, you will see in your logs that
your user has connected using the method GSSAPI and has validated their
session over TLS.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gotcha-s">Gotcha’s</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-system-to-ipa-domain-ensure-dns-is-working-correctly-otherwise-this-step-will-fail">Add system to IPA Domain (ensure DNS is working correctly otherwise this step will fail)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-dovecot-and-set-service-to-start-on-boot">Install Dovecot and set service to start on boot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-dovecot-conf-to-allow-imap">Edit /etc/dovecot/dovecot.conf to allow imap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-conf-d-10-auth-conf-to-configure-kerberos-authentication">Edit /etc/dovecot/conf.d/10-auth.conf to configure kerberos authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-ipa-group-for-mailbox-access">Create new IPA group for mailbox access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-users-to-mailusers-group">Add users to “mailusers” group</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-new-directory-for-user-mailboxes">Create new directory for user mailboxes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edit-etc-dovecot-conf-d-10-mail-conf-to-configure-the-mailbox-location">Edit /etc/dovecot/conf.d/10-mail.conf to configure the mailbox location</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-a-kerberos-keytab-for-dovecot-imap-access">Generate a kerberos keytab for Dovecot IMAP access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#change-the-permissions-of-the-keytab-to-allow-dovecot-to-read-the-file-note-this-should-be-kept-secure-so-only-grant-enough-privileges-as-absolutely-necessary">Change the permissions of the keytab to allow Dovecot to read the file (Note, this should be kept secure, so only grant enough privileges as absolutely necessary.)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#restart-dovecot">Restart Dovecot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#send-a-test-email-to-your-user">Send a test email to your user</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-thunderbird-to-connect-to-imap-server">Configure Thunderbird to connect to IMAP Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verify-your-authentication-on-the-dovecot-server">Verify your authentication on the Dovecot server</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>