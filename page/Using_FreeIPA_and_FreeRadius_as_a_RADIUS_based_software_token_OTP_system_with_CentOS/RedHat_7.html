

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>RedHat_7 &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>RedHat_7</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-a-new-server">Install a new server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-ipa-server">Install, configure and test IPA Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa">Install, configure and test RADIUS Server as a frontend to IPA</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="redhat-7">
<h1>RedHat_7<a class="headerlink" href="#redhat-7" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>This article shows how to configure FreeIPA and integrate it in
FreeRADIUS to implement a RADIUS based authentication system, which uses
its own software token to provide OTP authentication to other, RADIUS
compatible, systems (e.g. a VPN server, etc.).</p>
<p>The IPA server is configured as a stand-alone system, with no
integration with other directory servers or any other system.</p>
<p>This How To is a intended as sort of brain dump of the steps I took to
configure and test RADIUS and IPA with OTP authentication, after I
successfully managed to build such a system, and it owes a lot to other
guides and posts found in Internet. Some of the more helpful were:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://blog.christophersmart.com/articles/freeipa-how-to-fedora/">http://blog.christophersmart.com/articles/freeipa-how-to-fedora/</a></p></li>
<li><p><a class="reference external" href="http://consultancy.edvoncken.net/index.php/HOWTO_Configure_Radius_with_an_IPA_Server">http://consultancy.edvoncken.net/index.php/HOWTO_Configure_Radius_with_an_IPA_Server</a></p></li>
<li><p><a class="reference external" href="http://karloluiten.nl/make-freeradius-talk-to-freeipa-rhel-idm/">http://karloluiten.nl/make-freeradius-talk-to-freeipa-rhel-idm/</a></p></li>
</ul>
<p><strong>PLEASE NOTE that this set-up uses unencrypted passwords between the
client and the authentication server, i.e. password will be trasmitted
as CLEAR TEXT, consider this with respect to your environment.</strong></p>
</section>
<section id="install-a-new-server">
<h2>Install a new server<a class="headerlink" href="#install-a-new-server" title="Permalink to this heading">#</a></h2>
<p>To start from scratch, install a basic CentOS 7 server, selecting a
“Infrastructure Server/Identity Management Server” Environment in
Software Selection.</p>
<figure class="align-default" id="id1">
<img alt="IPA_Radius_1.png" src="../../_images/IPA_Radius_1.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius_1.png</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure that the server is up to date:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``[root@ipa ~
| ``...``
| ``[root@ipa ~]# yum update``
| ``...``
</pre></div>
</div>
</section>
<section id="install-configure-and-test-ipa-server">
<h2>Install, configure and test IPA Server<a class="headerlink" href="#install-configure-and-test-ipa-server" title="Permalink to this heading">#</a></h2>
<p>Ensure that we have all the packages we might need for IPA (<code class="docutils literal notranslate"><span class="pre">bind</span></code> and
<code class="docutils literal notranslate"><span class="pre">bind-dyndb-ldap</span></code> may not be necessary if you don’t plan to use the
native DNS server):</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# yum install ipa-server bind bind-dyndb-ldap</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
<p>To avoid naming problems, we are hardcoding the server IP and name in
the hosts file:</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# echo &quot;192.168.1.10 ipa.test.org ipa&quot; &gt;&gt;/etc/hosts</span></code></p>
<p>Now you can interactively configure the IPA Server:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# ipa-server-install</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This program will set up the IPA Server.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This includes:</span></code></div>
<div class="line">``  * Configure a stand-alone CA (dogtag) for certificate management``</div>
<div class="line">``  * Configure the Network Time Daemon (ntpd)``</div>
<div class="line">``  * Create and configure an instance of Directory Server``</div>
<div class="line">``  * Create and configure a Kerberos Key Distribution Center (KDC)``</div>
<div class="line">``  * Configure Apache (httpd)``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">To accept the default shown in brackets, press the Enter key.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">WARNING: conflicting time&amp;date synchronization service 'chronyd' will be disabled in favor of ntpd</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Do you want to configure integrated DNS (BIND)? [no]:</span></code></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">chronyd</span></code> service will be disabled in order to
successfully configure and run the NTP daemon <code class="docutils literal notranslate"><span class="pre">ntpd</span></code>, which is
required to guarantee that the system’s time is correct and synchronized
with any other device.</p>
<p>For this simple installation, we don’t want to use the integrated DNS,
so answer <code class="docutils literal notranslate"><span class="pre">no</span></code> and then enter the FQDN of this server:</p>
<p><code class="docutils literal notranslate"><span class="pre">Server host name [ipa.test.org]:</span></code></p>
<p>Confirm the domain name</p>
<p><code class="docutils literal notranslate"><span class="pre">Please confirm the domain name [test.org]:</span></code></p>
<p>And the realm name</p>
<p><code class="docutils literal notranslate"><span class="pre">Please provide a realm name [TEST.ORG]:</span></code></p>
<p>Now you must enter the passwords for the LDAP Directory Server admin
user (<code class="docutils literal notranslate"><span class="pre">“cn=Directory</span> <span class="pre">Manager”</span></code>) and for the IPA admin user
(<code class="docutils literal notranslate"><span class="pre">admin</span></code>):</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Directory Manager password:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Password (confirm):</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">IPA admin password:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Password (confirm):</span></code></div>
</div>
<p>At this point the script will ask for confirmation before proceeding to
configure all the systems that comprise the IPA Server:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">The IPA Master Server will be configured with:</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Hostname:       ipa.test.org</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">IP address(es): 192.168.1.10</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Domain name:    test.org</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Realm name:     TEST.ORG</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Continue to configure the system with these values? [no]: yes</span></code></div>
</div>
<p>From now on, the script will automatically configure and enable all the
required subsystems and write the appropriate configuration files at the
right place:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">The following operations may take some minutes to complete.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Please wait until the prompt is returned.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Configuring NTP daemon (ntpd)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Setup complete</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Next steps:</span></code></div>
<div class="line">``        1. You must make sure these network ports are open:``</div>
<div class="line">``                TCP Ports:``</div>
<div class="line">``                  * 80, 443: HTTP/HTTPS``</div>
<div class="line">``                  * 389, 636: LDAP/LDAPS``</div>
<div class="line">``                  * 88, 464: kerberos``</div>
<div class="line">``                UDP Ports:``</div>
<div class="line">``                  * 88, 464: kerberos``</div>
<div class="line">``                  * 123: ntp``</div>
<div class="line">``        2. You can now obtain a kerberos ticket using the command: ‘kinit admin’``</div>
<div class="line">``           This ticket will allow you to use the IPA tools (e.g., ipa user-add)``</div>
<div class="line">``           and the web user interface.``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Be sure to back up the CA certificate stored in /root/cacert.p12</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">This file is required to create replicas. The password for this file is the Directory Manager password</span></code></div>
</div>
<p>We now add the required ports to the firewall public zone and then
restart the firewall service:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# firewall-cmd --permanent --zone=public --add-port=80/tcp --add-port=443/tcp --add-port=389/tcp --add-port=636/tcp --add-port=88/tcp --add-port=464/tcp --add-port=88/udp --add-port=464/udp --add-port=123/udp</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# systemctl restart firewalld.service</span></code></div>
</div>
<p>In order for the IPA Server to work without issues, it is necessary that
the time of the server is synchronized to the other devices using its
services, which is usually guaranteed by a correctly configured NTP
server (<code class="docutils literal notranslate"><span class="pre">ntpd</span></code>). You can check your NTP server status with this
command:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# ntpdc -c sysinfo</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">system peer:          0.centos.pool.ntp.org</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">system peer mode:     client</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">leap indicator:       00</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">stratum:              3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">precision:            -22</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">root distance:        0.01346 s</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">root dispersion:      8.23227 s</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">reference ID:         [195.66.10.51]</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">reference time:       d9cba569.5342443b  Fri, Oct 16 2015 18:33:45.325</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">system flags:         auth ntp stats</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">jitter:               0.000000 s</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">stability:            0.000 ppm</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">broadcastdelay:       0.000000 s</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">authdelay:            0.000000 s</span></code></div>
</div>
<p>If the NTP server is up and running fine, you will see a low number in
the stratum row.</p>
<p>Now, if everything is correctly configured and running, you should be
able to reach the web management interface at <a class="reference external" href="https://ipa.test.org/">https://ipa.test.org/</a> (you
could have to add an exception for the server certificate, since it will
be self-signed…):</p>
<figure class="align-default" id="id2">
<img alt="IPA_Radius2.png" src="../../_images/IPA_Radius2.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius2.png</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>You can now login with the admin user and the password you entered in
the setup script, and reach the Users management page:</p>
<figure class="align-default" id="id3">
<img alt="IPA_Radius3.png" src="../../_images/IPA_Radius3.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius3.png</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Here you can add a new user (which we will call <code class="docutils literal notranslate"><span class="pre">test</span></code>) with the
<code class="docutils literal notranslate"><span class="pre">+Add</span></code> button at the top right of the page:</p>
<figure class="align-default" id="id4">
<img alt="IPA_Radius4.png" src="../../_images/IPA_Radius4.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius4.png</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Now logout as Administrator and login as user <code class="docutils literal notranslate"><span class="pre">test</span></code>. The system
should ask you to pick a new password</p>
<figure class="align-default" id="id5">
<img alt="IPA_Radius5.png" src="../../_images/IPA_Radius5.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius5.png</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>and then login. In the test user’s details page, you can add an OTP
Token with the <code class="docutils literal notranslate"><span class="pre">Action</span></code> dropdown button and the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">OTP</span> <span class="pre">Token</span></code>
button</p>
<figure class="align-default" id="id6">
<img alt="IPA_Radius6.png" src="../../_images/IPA_Radius6.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius6.png</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>You will have to choose the type of the new token (Time-based TOTP or
Counter-based HOTP) and an appropriate description, and then the system
will show a QR code which can be used to configure most software token
application by simply scanning it within the app in your smartphone:</p>
<figure class="align-default" id="id7">
<img alt="IPA_Radius7.png" src="../../_images/IPA_Radius7.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius7.png</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Please be aware that, as of now, there is a bug in the FreeIPA version
(4.1.0-18) released with CentOS 7 which causes the Google Authenticator
to fail recognize the QR code, so you may want to use the FreeOTP app by
RedHat which works. The problem lies in the casing of the SHA protocol
encoded in the QR code: IPA uses lower case (sha) while Google
Authenticator requires upper case (SHA).</p>
<p>In order to fix this bug, you will have to modify two files distributed
with the ipa-server package:</p>
<ul class="simple">
<li><p>in /usr/lib/python2.7/site-packages/ipalib/plugins/otptoken.py change</p></li>
</ul>
<div class="line-block">
<div class="line">``        StrEnum(‘ipatokenotpalgorithm?’,``</div>
<div class="line">``            cli_name=’algo’,``</div>
<div class="line">``            label=_(‘Algorithm’),``</div>
<div class="line">``            doc=_(‘Token hash algorithm’),``</div>
<div class="line">``            default=u’sha1’,``</div>
<div class="line">``            autofill=True,``</div>
<div class="line">``            flags=(‘no_update’),``</div>
<div class="line">``            values=(u’sha1’, u’sha256’, u’sha384’, u’sha512’),``</div>
</div>
<p>to</p>
<div class="line-block">
<div class="line">``        StrEnum(‘ipatokenotpalgorithm?’,``</div>
<div class="line">``            cli_name=’algo’,``</div>
<div class="line">``            label=_(‘Algorithm’),``</div>
<div class="line">``            doc=_(‘Token hash algorithm’),``</div>
<div class="line">``            default=u’SHA1’,``</div>
<div class="line">``            autofill=True,``</div>
<div class="line">``            flags=(‘no_update’),``</div>
<div class="line">``            values=(u’SHA1’, u’SHA256’, u’SHA384’, u’SHA512’),``</div>
</div>
<ul class="simple">
<li><p>in /usr/share/ipa/ui/js/freeipa/app.js change</p></li>
</ul>
<p>``        default_value:”sha1”,options:[“sha1”,”sha256”,”sha384”,”sha512”]}``</p>
<p>to</p>
<p>``        default_value:”SHA1”,options:[“SHA1”,”SHA256”,”SHA384”,”SHA512”]}``</p>
<p>Before trying the newly set up token, you must login as admin, enable
the <code class="docutils literal notranslate"><span class="pre">Two</span> <span class="pre">factor</span> <span class="pre">authentication</span></code> type in the test user setting, and
update the user’s profile with the <code class="docutils literal notranslate"><span class="pre">Update</span></code> button:</p>
<figure class="align-default" id="id8">
<img alt="IPA_Radius8.png" src="../../_images/IPA_Radius8.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius8.png</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Now you should be able to login as user <code class="docutils literal notranslate"><span class="pre">test</span></code> by adding to the
standard password the code provided by the OTP app (es. FreeOTP) (i.e.
if the test user’s password is “password” and FreeOTP shows 762405, you
should enter “password762405” in the password field):</p>
<figure class="align-default" id="id9">
<img alt="IPA_Radius9.png" src="../../_images/IPA_Radius9.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius9.png</span><a class="headerlink" href="#id9" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If everything up to now is working as expected, you can proceed with the
installation and configuration of the RADIUS frontend.</p>
</section>
<section id="install-configure-and-test-radius-server-as-a-frontend-to-ipa">
<h2>Install, configure and test RADIUS Server as a frontend to IPA<a class="headerlink" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa" title="Permalink to this heading">#</a></h2>
<p>As a prerequisite, you must install the required freeradius packages (we
won’t need freeradius-krb5, but we’ll install it just in case…):</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# yum install freeradius freeradius-utils freeradius-ldap freeradius-krb5</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
</div>
<p>In order to configure the RADIUS server to authenticate with the
software token provided by the IPA server, we must let RADIUS accept
requests from your clients (including the IPA server itself), enable the
default configuration to search for users in the IPA server with LDAP
protocol and try to authenticate them with an LDAP bind() operation.</p>
<p>All the RADIUS configuration files are in <code class="docutils literal notranslate"><span class="pre">/etc/raddb</span></code>, and most of
the configuration is done by linking files from the mod-available
directory to <code class="docutils literal notranslate"><span class="pre">mod-enabled</span></code> and then editing them as needed.</p>
<p>As a first step, add the following lines at the beginning of
<code class="docutils literal notranslate"><span class="pre">clients.conf</span></code>:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">client localnet {</span></code></div>
<div class="line">``        ipaddr = 192.168.1.0/24``</div>
<div class="line">``        proto = *``</div>
<div class="line">``        secret = somesecret``</div>
<div class="line">``        nas_type = other&lt;——&gt;# localhost isn’t usually a NAS…``</div>
<div class="line">``        limit {``</div>
<div class="line">``                max_connections = 16``</div>
<div class="line">``                lifetime = 0``</div>
<div class="line">``                idle_timeout = 30``</div>
<div class="line">``        }``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">}</span></code></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">sites-enabled/default</span></code> and <code class="docutils literal notranslate"><span class="pre">sites-enabled/inner-tunnel</span></code> replace
these line</p>
<div class="line-block">
<div class="line">``        #``</div>
<div class="line">``        #  The ldap module reads passwords from the LDAP database.``</div>
<div class="line">``        -ldap``</div>
</div>
<p>with these</p>
<div class="line-block">
<div class="line">``        #``</div>
<div class="line">``        #  The ldap module reads passwords from the LDAP database.``</div>
<div class="line">``        ldap``</div>
<div class="line">``        if ((ok || updated) &amp;&amp; User-Password) {``</div>
<div class="line">``            update {``</div>
<div class="line">``                control:Auth-Type := ldap``</div>
<div class="line">``            }``</div>
<div class="line">``        }``</div>
</div>
<p>and uncomment the following lines</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">#       Auth-Type LDAP {</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">#               ldap</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">#       }</span></code></div>
</div>
<p>As a last step, enable and configure the LDAP backend in RADIUS.</p>
<p>Add LDAP to the enabled mods:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa raddb]# ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa raddb]#</span></code></div>
</div>
<p>Edit mods-enable/ldap to change</p>
<p>``        server = “ldap.rrdns.example.org ldap.rrdns.example.org ldap.example.org”``</p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">#       base_dn = &quot;dc=example,dc=org&quot;</span></code></p>
<p>to</p>
<p>``        server = “ipa.test.org”``</p>
<p>and</p>
<p>``        base_dn = “dc=test,dc=org”``</p>
<p>To reach the RADIUS server from other clients, we must also open the
firewall for the required ports:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# firewall-cmd --permanent --zone=public --add-port=1812/udp --add-port=1813/udp</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Success</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# systemctl restart firewalld.service</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]#</span></code></div>
</div>
<p>Now we can test our RADIUS serve by starting in debug mode with</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# radiusd –X</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">...</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on auth address * port 1812 as server default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on acct address * port 1813 as server default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on auth address :: port 1812 as server default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on acct address :: port 1813 as server default</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on auth address 127.0.0.1 port 18120 as server inner-tunnel</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Opening new proxy socket 'proxy address * port 0'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on proxy address * port 36752</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Ready to process requests</span></code></div>
</div>
<p>Open another shell to ipa.test.org and test the RADIUS server:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# radtest test password123456 ipa.test.org 1812 somesecret</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Sending Access-Request Id 105 from 0.0.0.0:44729 to 192.168.1.10:1812</span></code></div>
<div class="line">``        User-Name = ‘test’``</div>
<div class="line">``        User-Password = ‘ password123456’``</div>
<div class="line">``        NAS-IP-Address = 192.168.1.10``</div>
<div class="line">``        NAS-Port = 1812``</div>
<div class="line">``        Message-Authenticator = 0x00``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Received Access-Accept Id 105 from 192.168.1.10:1812 to 192.168.1.10:44729 length 20</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]#</span></code></div>
</div>
<p>If you receive an “Access-Accept” response, you are ready to go, just
stop the debug server with <code class="docutils literal notranslate"><span class="pre">ctrl-c</span></code>, enable the server daemon and
start it:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Listening on proxy address * port 35327</span></code></div>
<div class="line"><strong>``Ready````````to````````process````````requests``</strong></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">^C</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# systemctl enable radiusd</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">ln -s '/usr/lib/systemd/system/radiusd.service' '/etc/systemd/system/multi-user.target.wants/radiusd.service'</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]# systemctl start radiusd.service</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa ~]#</span></code></div>
</div>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-a-new-server">Install a new server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-ipa-server">Install, configure and test IPA Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa">Install, configure and test RADIUS Server as a frontend to IPA</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>