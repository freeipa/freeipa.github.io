

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Integration_with_SELinux &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Integration_with_SELinux';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/Integration_with_SELinux.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Integration_with_SELinux</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Integration_with_SELinux</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#policy-engine">Policy Engine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-install-or-remove-selinux-policy-modules-with-ipa-action-policy">Download, install or remove SELinux policy modules with IPA action policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xslt-processing">XSLT Processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-selinux-policy-modules-via-selinux-policy-booleans-with-ipa-config-policy">Configure SELinux policy modules via SELinux policy booleans with IPA config policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">XSLT Processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manage-the-relation-of-linux-users-to-selinux-users-with-ipa-role-policy">Manage the relation of Linux users to SELinux users with IPA role policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">XSLT Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-ipa-and-pam-responder">pam_ipa and PAM Responder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-selinux">pam_selinux</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="integration-with-selinux">
<h1>Integration_with_SELinux<a class="headerlink" href="#integration-with-selinux" title="Permalink to this heading">#</a></h1>
</section>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h1>
<p>To support SELinux as an application the IPA shall have several
different kinds of plug-ins implemented. This article talks about these
plug-ins from the prospective of FreeIPA v2 plans.</p>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">#</a></h1>
<p>We agreed that SELinux application would heavily leverage the policy
engine, role engine and pluggable PAM responder. The fact that PAM
responder is not planned to be pluggable in v2 complicates things a bit.
We agreed that we will hard code SELinux related functionality in PAM
responder in v2 and refactor it into a sepaFreeIPAv2:rate plug-in in v3
time frame.</p>
<section id="policy-engine">
<h2>Policy Engine<a class="headerlink" href="#policy-engine" title="Permalink to this heading">#</a></h2>
<p>So far we have identified three different areas where the IPA policy
engine can help to manage a large number of hosts running SELinux.</p>
<ul class="simple">
<li><p>download, install or remove SELinux policy modules</p></li>
<li><p>configure SELinux policy modules via SELinux policy booleans</p></li>
<li><p>manage the relation of Linux users to SELinux users (role
management?)</p></li>
</ul>
<p>These three areas map well to the policy section, action, configuration
and role respectively, we have identified. See <a class="reference external" href="FreeIPAv2:Overall_Design_of_Policy_Related_Components">FreeIPAv2:Overall Design
of Policy Related
Components</a>
for more details.</p>
</section>
<section id="download-install-or-remove-selinux-policy-modules-with-ipa-action-policy">
<h2>Download, install or remove SELinux policy modules with IPA action policy<a class="headerlink" href="#download-install-or-remove-selinux-policy-modules-with-ipa-action-policy" title="Permalink to this heading">#</a></h2>
<p>An IPA action policy has three parts, , and (see <a class="reference external" href="FreeIPAv2:Overall_Design_of_Policy_Related_Components">FreeIPAv2:Overall
Design of Policy Related
Components</a>
for more details). In the context of SELinux we can for example check
with the if SELinux is enabled at all and if yes download a SELinux
policy module and install it. The main section of a corresponding IPA
policy file might look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ipaaction</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redhat</span><span class="o">-</span><span class="n">release</span><span class="o">&lt;/</span><span class="n">command</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">expected_output</span><span class="o">&gt;</span><span class="n">Fedora</span> <span class="n">release</span> <span class="mi">9</span> <span class="p">(</span><span class="n">Sulphur</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">expected_output</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">condition</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">my_selinux_policy</span><span class="o">.</span><span class="n">pp</span><span class="o">&lt;/</span><span class="n">url</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">my_selinux_policy</span><span class="o">.</span><span class="n">pp</span><span class="o">&lt;/</span><span class="n">path</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">owner</span><span class="o">&gt;</span><span class="n">root</span><span class="o">&lt;/</span><span class="n">owner</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="n">root</span><span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">access</span><span class="o">&gt;</span><span class="mi">0400</span><span class="o">&lt;/</span><span class="n">access</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">cleanup</span><span class="o">&gt;</span><span class="n">yes</span><span class="o">&lt;/</span><span class="n">cleanup</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">run</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">semodule</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">my_selinux_policy</span><span class="o">.</span><span class="n">pp</span><span class="o">&lt;/</span><span class="n">command</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span><span class="n">root</span><span class="o">&lt;/</span><span class="n">user</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">run</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ipaaction</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example shows how to download the binary SELinux policy module and
calling semodule to install it.</p>
<section id="xslt-processing">
<h3>XSLT Processing<a class="headerlink" href="#xslt-processing" title="Permalink to this heading">#</a></h3>
<p>This IPA action policy will be processed as any other IPA action policy.</p>
</section>
</section>
<section id="configure-selinux-policy-modules-via-selinux-policy-booleans-with-ipa-config-policy">
<h2>Configure SELinux policy modules via SELinux policy booleans with IPA config policy<a class="headerlink" href="#configure-selinux-policy-modules-via-selinux-policy-booleans-with-ipa-config-policy" title="Permalink to this heading">#</a></h2>
<p>SELinux policies can include conditional section to allow runtime
modification without having to load a new policy. These conditional
sections can be enable or disabled with the help of SELinux policy
booleans.</p>
<p>SELinux policy booleans are simple boolean variable which can be
manipulated with semanage or get/set/togglesebool. Call ‘semanage
boolean -l’ to get a list and a short description of all SELinux policy
booleans currently know to the system.</p>
<p>To make the SELinux policy booleans accessible to IPA a configuration
policy, selinux_booleans, is used. The main section of an IPA XML policy
file may look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ipaconfig</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">selinux_boolean</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">webadm_manage_user_files</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">selinux_boolean</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">selinux_boolean</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">ssh_sysadm_login</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">selinux_boolean</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ipaconfig</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="id1">
<h3>XSLT Processing<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>With the help of a XSL template the IPA config policy will be
transformed to a format suitable as a command line argument for
setseboot. The policy downloader will than call setsebool with the
result as defined by XSL metadata</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">md</span><span class="p">:</span><span class="n">output_handler</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">exec_with_args</span> <span class="n">command_name</span><span class="o">=</span><span class="s2">&quot;/usr/sbin/setsebool&quot;</span> <span class="n">user</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">md</span><span class="p">:</span><span class="n">output_handler</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="manage-the-relation-of-linux-users-to-selinux-users-with-ipa-role-policy">
<h2>Manage the relation of Linux users to SELinux users with IPA role policy<a class="headerlink" href="#manage-the-relation-of-linux-users-to-selinux-users-with-ipa-role-policy" title="Permalink to this heading">#</a></h2>
<p>To give or take certain privileges to/from a user with the help of
SELinux we have to connect three SELinux element, namely</p>
<ul class="simple">
<li><p>the Linux user, e.g. luser</p></li>
<li><p>the SELinux user, e.g. seuser_u</p></li>
<li><p>the SELinux role, e.g. serole_r</p></li>
</ul>
<p>(It is a widespread convention to use suffix _u for SELinux users and
_r for SELinux roles.)</p>
<p>SELinux roles are defined by the SELinux policy or SELinux policy
modules. SELinux users can be connected to SELinux role with semanage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">semanage</span> <span class="n">user</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">R</span> <span class="s2">&quot;serole_r guest_r&quot;</span> <span class="n">seuser_u</span>
</pre></div>
</div>
<p>Linux user can mapped to SELinux user with semanage, too.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">semanage</span> <span class="n">login</span> <span class="o">-</span><span class="n">s</span> <span class="n">seuser_u</span> <span class="n">luser</span>
</pre></div>
</div>
<p>While the relation of SELinux users to roles should be created when the
corresponding SELinux policy modules is installed (see above), the
management of Linux users and SELinux users can be handled by IPA
policies. The simple mapping of a Linux user to a SELinux user can be
done with the help of an IPA action policy or using role defintion
policy. We will concentrate here an a role based approach where a Linux
user can be mapped with the help of pam_selinux to different SELinux
users depending if he logs in via an insecure, e.g. telnet, or secure,
e.g. console login, channel. The following IPA role definition policy
specifies three roles: “guest”, “user” and “admin”, with different
settings. Users which have the “guest” role on a specific host will
always associated with guest_u, independent of the channel they are
using to access the host. If a user logs in via ssh and is associated to
the admin role he will be mapped to staff_u.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">iparole</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">role</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">guest</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">default_context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">guest_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">default_context</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">role</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">role</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">user</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">default_context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">guest_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">default_context</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="n">ssh</span><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="n">console</span><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">user_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">context</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">role</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">role</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">admin</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">default_context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">guest_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">default_context</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="n">ssh</span><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">staff_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">context</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">context</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="n">login</span><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">selinux_user</span><span class="o">&gt;</span><span class="n">staff_u</span><span class="o">&lt;/</span><span class="n">selinux_user</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">mls</span><span class="o">&gt;</span><span class="n">S0</span><span class="o">-</span><span class="n">S15</span><span class="o">&lt;/</span><span class="n">mls</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">context</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">role</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">iparole</span><span class="o">&gt;</span>
</pre></div>
</div>
<section id="id2">
<h3>XSLT Processing<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>The IPA role policy will be transformed to an LDIF format and written
into the LDB of the IPA client. Further processing has to be done
elsewhere, because the XSLT engine has no knowledge of the
user-host-role association.</p>
</section>
<section id="pam-ipa-and-pam-responder">
<h3>pam_ipa and PAM Responder<a class="headerlink" href="#pam-ipa-and-pam-responder" title="Permalink to this heading">#</a></h3>
<p>All the work for the pam_ipa is actually done in the PAM responder. At
the login moment the PAM responder will implement a specific SELinux
logic. Later in v3 it will be replaced with a proper plug-in. The IPA’s
PAM module will be higher in the stack than pam_selinux and will prepare
information for it to consume.</p>
<p>This logic will follow the following algorithm:</p>
<ul class="simple">
<li><p>If the user logging in is not known to IPA, e.g. a local account,
return PAM_USER_UNKNOWN and let the the following PAM modules decide</p></li>
<li><p>Get IPA pam_selinux role for user logging into the machine (this is
done via same internal calls as used to satisfy requests from EXT
library).</p></li>
<li><p>If there is no role for the user return PAM_USER_UNKNOWN and let the
the following PAM modules decide (maybe it would make sense to have
an configurable switch to force role association on certain host, in
this case PAM_AUTH_ERR/PAM_ABORT can be returned).</p></li>
<li><p>Get IPA pam_selinux role definition from the LDB (or other file if we
decide it is better to use a different storage)</p></li>
<li><p>Create a file for this user in the following format:</p></li>
</ul>
<p>``   <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``:</span></code><code class="docutils literal notranslate"><span class="pre">:</span></code></p>
<p>with the example above it would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guest_u</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="n">S0</span>
<span class="n">staff_u</span><span class="p">:</span><span class="n">ssh</span><span class="p">:</span><span class="n">S0</span>
<span class="n">staff_u</span><span class="p">:</span><span class="n">login</span><span class="p">:</span><span class="n">S0</span><span class="o">-</span><span class="n">S15</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Put this file into</p></li>
</ul>
<p>``   /etc/SELinux/targeted/login/<code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``/seusers</span></code></p>
</section>
<section id="pam-selinux">
<h3>pam_selinux<a class="headerlink" href="#pam-selinux" title="Permalink to this heading">#</a></h3>
<p>The current version of pam_selinux will only use
/etc/selinux/targeted/seusers but coming version of SELinux PAM will be
modified to look for</p>
<p>``   /etc/selinux/targeted/logins/<code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``/seusers</span></code></p>
<p>file before falling back to default</p>
<p>``   /etc/selinux/targeted/seusers``</p>
<p>If there is no seusers file under specific user name directory or
directory does not exist at all then the default seusers files from
<strong>/etc/selinux/targeted/seusers</strong> will be used. If the file exists and
pam_selinux cannot decide what to do based content of the file the
authentication should fail and not use the default from
/etc/selinux/targeted/seusers.</p>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Integration_with_SELinux</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#policy-engine">Policy Engine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-install-or-remove-selinux-policy-modules-with-ipa-action-policy">Download, install or remove SELinux policy modules with IPA action policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xslt-processing">XSLT Processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-selinux-policy-modules-via-selinux-policy-booleans-with-ipa-config-policy">Configure SELinux policy modules via SELinux policy booleans with IPA config policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">XSLT Processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manage-the-relation-of-linux-users-to-selinux-users-with-ipa-role-policy">Manage the relation of Linux users to SELinux users with IPA role policy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">XSLT Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-ipa-and-pam-responder">pam_ipa and PAM Responder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam-selinux">pam_selinux</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>