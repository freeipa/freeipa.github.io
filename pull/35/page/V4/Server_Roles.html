
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Server_Roles &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Server_Roles';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Server_Roles.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Server_Roles</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Server Roles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#server-attributes">Server Attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enhanced-commands">Enhanced commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-commands">New Commands</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="server-roles">
<h1>Server_Roles<a class="headerlink" href="#server-roles" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The implementation of a <a class="reference external" href="V4/Manage_replication_topology_4_4">dynamic
management</a> of replication
topology uncovered a need for an additional API for querying for a
presence and status of various services (DNS, CA, KRA) on individual
nodes. FreeIPA holds a list of configured services per master in the
<code class="docutils literal notranslate"><span class="pre">cn=masters,cn=ipa,cn=etc,$SUFFIX</span></code> subtree.</p>
<p>This is however more of an implementation detail than an information
readily consumable by administrators, since there is many-to-one mapping
between systemd services and a high-level functionality provided by
them, e.g. a FreeIPA DNS server functionality is provided by 2 systemd
services set up by <code class="docutils literal notranslate"><span class="pre">ipa-dns-install</span></code>.</p>
<p>That’s why this document introduces the concept of server roles as an
user-facing abstraction providing high-level information about services
running on particular FreeIPA master.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>as an administrator I want a simple and quick way to determine which
FreeIPA master hosts Certification Authority/DNS server/Trust
Controller, etc. I also want to be able to quickly determine which CA
master manages certificate renewals</p></li>
<li><p>I also want to see this information when managing my topology through
WebUI using <a class="reference external" href="V4/Manage_replication_topology_4_4#Topology_graph">Topology
graph</a></p></li>
<li><p>as an administrator, I want to be able to migrate CA renewal master
to a different server with a single command.</p></li>
</ul>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
</section>
<section id="id1">
<h2>Server Roles<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>The systemd-service -&gt; server role mapping will be done entirely by the
python code which will consume existing service entries and map them to
a list of human-readable server roles which will be displayed to a user
with sufficient privilege level, e.g.:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Role</p></th>
<th class="head"><p>Services</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CA</p></td>
<td><p>CA</p></td>
</tr>
<tr class="row-odd"><td><p>DNS server</p></td>
<td><p>DNS, DNSKeySync</p></td>
</tr>
<tr class="row-even"><td><p>Key recovery agent</p></td>
<td><p>KRA</p></td>
</tr>
<tr class="row-odd"><td><p>AD trust controller</p></td>
<td><p>ADTRUST, CIFS service principal is a member
of “adtrust agents” sysaccounts group</p></td>
</tr>
<tr class="row-even"><td><p>AD trust agent</p></td>
<td><p>host is a member of “adtrust agents”
sysaccounts group</p></td>
</tr>
</tbody>
</table>
<p>Additional implicit <code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">master</span></code> role will be defined which will group
services which have to be running on each IPA master to provide the most
basic functionality (access to LDAP backend, Kerberos authentication,
HTTP server). This role will not be exposed in the UI.</p>
<p>Each role object will exist in these three states:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>State</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>available</p></td>
<td><p>the FreeIPA (sub)package providing the role was
installed on the master</p></td>
</tr>
<tr class="row-odd"><td><p>configured</p></td>
<td><p>all services comprising the role were added to the
entry by installer</p></td>
</tr>
<tr class="row-even"><td><p>enabled</p></td>
<td><p>the service entries are marked as enabled in the LDAP</p></td>
</tr>
</tbody>
</table>
<p>There is currently no plan to implement manipulation service entries by
adding/removing a server role. This feature may be considered in the
future when we have the ability to perform tasks on a local system based
on the information present in LDAP backend. The checks for role
availability will also be implemented later during modularization
efforts. The initial implementation will thus only display only
enabled/configured roles.</p>
</section>
<section id="server-attributes">
<h2>Server Attributes<a class="headerlink" href="#server-attributes" title="Link to this heading">#</a></h2>
<p>Each server may have one or more attributes described a more specific
functionality provided by one or more masters fulfilling the role: e. g.
among multiple CA masters, there is one which is responsible for
certificate renewals and one master is responsible for genration of
CRLs. The renewal master functionality is expressed by setting
<code class="docutils literal notranslate"><span class="pre">ipaConfigString=caRenewalMaster</span></code> attribute in the CA LDAP entry of
the corresponding server container, so this can be considered a more
specific attribute of a general CA server role.</p>
<p>CRL master functionality is currently not expressed in the LDAP service
container and can be inferred only from examination of Dogtag
configuration files. Since e.g. search for CRL master would require
accessing local filesystems on all masters and examining Dogtag
configuration, the “CRL master” attribute will not be added until there
is an access to consumable LDAP attribute(s).</p>
<p>An API will be provided to set the server attribute to True/False on one
or more masters. However, this will be currently supported only for
server attributes which are configurable purely in LDAP (e.g. CA renewal
master). Attributes which require also local configuration of the host
system (e.g. <a class="reference external" href="Howto/DNSSEC#Migrate_DNSSEC_master_to_another_IPA_server">DNSSec
keymaster</a>
) will be read-only.</p>
<p>In the case that the attribute is singular, i.e. can be set only on a
single master in the topology, the original master will have the
attribute unset and a warning will be issued to the user. The code will
also check whether the accepting server already provides the required
role, e.g. setting ‘CA renewal master’ attribute on a server without CA
role will raise an error.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>The feature will be implemented in the following steps:</p>
<ul class="simple">
<li><p>A object hierarchy abstracting the server role/attribute concepts.
These objects will</p>
<ul>
<li><p>store the service list-&gt;role mapping and <code class="docutils literal notranslate"><span class="pre">ipaConfigString</span></code>
value-&gt;server attribute mapping</p></li>
<li><p>convert these mappings into LDAP search filters used when looking
up the role/attribute and its status</p></li>
<li><p>query the search results to determine whether the role is
enabled/disabled</p></li>
<li><p>perform check whether the package providing the role is installed
on the master, e.g. by testing for presence of files provided by
the package</p></li>
</ul>
</li>
<li><p>injecting the interface to existing <code class="docutils literal notranslate"><span class="pre">server-{show,find}</span></code> and
<code class="docutils literal notranslate"><span class="pre">config-{show,mod}</span></code> commands to utilize the new functionality</p></li>
<li><p>new command (<code class="docutils literal notranslate"><span class="pre">server-mod</span></code>) which will be used to edit attributes of
specified server. This command will be also used by <a class="reference external" href="http://www.freeipa.org/page/V4/DNS_Location_Mechanism">DNS
Location</a>
to set the location of IPA master.</p></li>
<li><p>new plugin which will display the status of specified role on
different masters and also a list of DNS records associated with the
specific role. The latter information will be consumed during
creation of
<a class="reference external" href="http://www.freeipa.org/page/V4/DNS_Location_Mechanism">location-specific</a>
DNS records for different services.</p></li>
<li><p>new commands (<code class="docutils literal notranslate"><span class="pre">serverrole-{show,find}</span></code>) to list the status of
server roles on a IPA master and to implement substring search among
the roles.</p></li>
<li><p>reimplementation of current code querying for service presence using
the server role API. This includes e.g. service checking code in
installers and check for last remaining services and renewal master
migration in
<a class="reference external" href="V4/Manage_replication_topology_4_4#server_del">server_del</a> API
method.</p></li>
</ul>
</section>
<section id="feature-management">
<h2>Feature Management<a class="headerlink" href="#feature-management" title="Link to this heading">#</a></h2>
<p>Web UI~</p>
<p>WebUI will feature a new <code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">server</span> <span class="pre">-&gt;</span> <span class="pre">Topology</span> <span class="pre">-&gt;</span> <span class="pre">Server</span> <span class="pre">roles</span></code>
section, which will display a list of all server roles. Each role will
in turn display all server on which it is available, configured, and
enabled. Additionally, the enabled roles (and role attributes) shall be
displayed among the details about the IPA master accessed from
<code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">server</span> <span class="pre">-&gt;</span> <span class="pre">Topology</span> <span class="pre">-&gt;</span> <span class="pre">IPA</span> <span class="pre">servers</span></code> tab.</p>
<p>Additionally, <code class="docutils literal notranslate"><span class="pre">IPA</span> <span class="pre">server</span> <span class="pre">-&gt;</span> <span class="pre">Configuration</span></code> will displayed list of
role attributes along the masters on which the attribute is enabled. A
sufficiently privileged used should be able to change the attribute to a
different master(s).</p>
<p>The topology graph introduced in FreeIPA 4.3 will display the roles of
each master after clicking the node. This may be implemented later
during 4.5 development timeframe.</p>
<p>CLI</p>
<section id="enhanced-commands">
<h3>Enhanced commands<a class="headerlink" href="#enhanced-commands" title="Link to this heading">#</a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">server-show</span></code></dt><dd><p>The command will print out the list of enabled roles on the master.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">server-find</span></code></dt><dd><p>new option <code class="docutils literal notranslate"><span class="pre">--servrole</span></code> will enable searching servers having the
specified role(s) enabled.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span> <span class="n">server</span><span class="o">-</span><span class="n">find</span> <span class="o">--</span><span class="n">servrole</span><span class="o">=</span><span class="s2">&quot;DNS server&quot;</span> <span class="o">--</span><span class="n">servrole</span> <span class="s2">&quot;CA server&quot;</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">config-show</span></code></dt><dd><p>the command will display the list of IPA masters and CA servers. CA
renewal master will also be printed out.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dnsconfig-show</span></code></dt><dd><p>the command will display DNSSec keymaster and list of DNS servers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">trustconfig-show</span></code></dt><dd><p>the command will display list of AD trust controllers and agents</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vaultconfig-show</span></code></dt><dd><p>the command will display list of KRA servers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config-mod</span></code></dt><dd><p>the command will be enhanced by the ability to set CA renewal master
to other CA server while unsetting this attribute on the original
master:</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span> <span class="n">config</span><span class="o">-</span><span class="n">mod</span> <span class="o">--</span><span class="n">ca</span><span class="o">-</span><span class="n">renewal</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="n">server1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</section>
<section id="new-commands">
<h3>New Commands<a class="headerlink" href="#new-commands" title="Link to this heading">#</a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">server-role-show</span> <span class="pre">FQDN</span> <span class="pre">&quot;ROLE_NAME&quot;</span></code></dt><dd><p>show the status of role <code class="docutils literal notranslate"><span class="pre">&quot;ROLE_NAME&quot;</span></code> of IPA master <code class="docutils literal notranslate"><span class="pre">FQDN</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">server-role-find</span> <span class="pre">--server</span> <span class="pre">FQDN</span> <span class="pre">--role</span> <span class="pre">&quot;ROLE_NAME&quot;</span> <span class="pre">--status</span> <span class="pre">&quot;enabled|configured|absent&quot;</span></code></dt><dd><p>search for role with <code class="docutils literal notranslate"><span class="pre">&quot;substring&quot;</span></code> in name on master <code class="docutils literal notranslate"><span class="pre">FQDN</span></code> and
display its status. When no FQDN and role name are specifed, will
return status of all recognized roles on all servers. <code class="docutils literal notranslate"><span class="pre">--status</span></code>
option can be optionally used to filter the result by role status.</p>
</dd>
</dl>
</section>
</section>
<section id="upgrade">
<h2>Upgrade<a class="headerlink" href="#upgrade" title="Link to this heading">#</a></h2>
<p>Since there are no changes to LDAP structure/schema, no special upgrade
procedure is necessary.</p>
</section>
<section id="how-to-test">
<h2>How to Test<a class="headerlink" href="#how-to-test" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>see all roles active on a master:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-show ipasrv1.example.com</span>
  <span class="n">Server</span> <span class="n">name</span><span class="p">:</span> <span class="n">ipasrv1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Managed</span> <span class="n">suffixes</span><span class="p">:</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ca</span>
  <span class="n">Min</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">Max</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">Enabled</span> <span class="n">Roles</span><span class="p">:</span> <span class="n">AD</span> <span class="n">Trust</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">CA</span> <span class="n">server</span><span class="p">,</span> <span class="n">DNS</span> <span class="n">server</span><span class="p">,</span> <span class="n">KRA</span> <span class="n">server</span>
</pre></div>
</div>
<ul class="simple">
<li><p>find all DNS servers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-find --servrole &quot;DNS server&quot;</span>
<span class="o">--------------------</span>
<span class="mi">2</span> <span class="n">IPA</span> <span class="n">servers</span> <span class="n">matched</span>
<span class="o">--------------------</span>
  <span class="n">Server</span> <span class="n">name</span><span class="p">:</span> <span class="n">ipasrv1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Managed</span> <span class="n">suffixes</span><span class="p">:</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ca</span>
  <span class="n">Min</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">Max</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">Enabled</span> <span class="n">Roles</span><span class="p">:</span> <span class="n">AD</span> <span class="n">Trust</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">CA</span> <span class="n">server</span><span class="p">,</span> <span class="n">DNS</span> <span class="n">server</span><span class="p">,</span> <span class="n">KRA</span> <span class="n">server</span>

  <span class="n">Server</span> <span class="n">name</span><span class="p">:</span> <span class="n">ipasrv3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Managed</span> <span class="n">suffixes</span><span class="p">:</span> <span class="n">domain</span>
  <span class="n">Min</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">Max</span> <span class="n">domain</span> <span class="n">level</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">Enabled</span> <span class="n">Roles</span><span class="p">:</span> <span class="n">DNS</span> <span class="n">server</span>
<span class="o">----------------------------</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">entries</span> <span class="n">returned</span> <span class="mi">2</span>
<span class="o">----------------------------</span>
</pre></div>
</div>
<ul class="simple">
<li><p>find a CA renewal master</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa config-show | grep &quot;CA renewal master&quot;</span>
<span class="n">IPA</span> <span class="n">CA</span> <span class="n">renewal</span> <span class="n">master</span><span class="p">:</span> <span class="n">ipasrv1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li><p>find DNSSec key master</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa dnsconfig-show  | grep &#39;DNSSec key master&#39;</span>
<span class="n">IPA</span> <span class="n">DNSSec</span> <span class="n">key</span> <span class="n">master</span><span class="p">:</span> <span class="n">ipasrv3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li><p>switch CA master “ipasrv2.example.com” to a renewal master</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa config-mod --ca-renewal-master-server ipasrv2.example.com</span>
 <span class="n">Maximum</span> <span class="n">username</span> <span class="n">length</span><span class="p">:</span> <span class="mi">32</span>
  <span class="n">Home</span> <span class="n">directory</span> <span class="n">base</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span>
  <span class="n">Default</span> <span class="n">shell</span><span class="p">:</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
  <span class="n">Default</span> <span class="n">users</span> <span class="n">group</span><span class="p">:</span> <span class="n">ipausers</span>
  <span class="n">Default</span> <span class="n">e</span><span class="o">-</span><span class="n">mail</span> <span class="n">domain</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Search</span> <span class="n">time</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">Search</span> <span class="n">size</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">100</span>
  <span class="o">...</span>
  <span class="n">IPA</span> <span class="n">CA</span> <span class="n">renewal</span> <span class="n">master</span><span class="p">:</span> <span class="n">ipasrv2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li><p>try to switch CA renewal master to a server without CA role:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa config-mod --renewal-master ipasrv3.example.com</span>
<span class="n">ipa</span><span class="p">:</span> <span class="n">ERROR</span><span class="p">:</span> <span class="s1">&#39;ipasrv3.example.com&#39;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="nb">set</span> <span class="k">as</span> <span class="n">CA</span> <span class="n">renewal</span> <span class="n">master</span><span class="p">:</span> <span class="n">Role</span> <span class="s1">&#39;CA&#39;</span> <span class="ow">not</span> <span class="n">configured</span><span class="o">/</span><span class="n">enabled</span>
</pre></div>
</div>
<ul class="simple">
<li><p>show the status of ‘DNS server’ role on server ipasrv4.example.com
which lacks freeipa-server-dns subpackage</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-role-show ipasrv4.example.com --role &#39;DNS server&#39;</span>
  <span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv4</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">DNS</span> <span class="n">server</span>
  <span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">absent</span>
</pre></div>
</div>
<ul class="simple">
<li><p>configure DNS on ipasrv4.example.com using <code class="docutils literal notranslate"><span class="pre">ipa-dns-install</span></code> and
check the ‘DNS server’ role status</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-role-show ipasrv4.example.com --role &#39;DNS server&#39;</span>
  <span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv4</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">DNS</span> <span class="n">server</span>
  <span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">enabled</span>
</pre></div>
</div>
<ul class="simple">
<li><p>show the status of ‘DNS sevrer’ (typo) role on DNS server
ipasrv3.example.com</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa serverrole-show ipasrv4.example.com --role &#39;DNS sevrer&#39;</span>
<span class="n">ipa</span><span class="p">:</span> <span class="n">ERROR</span><span class="p">:</span> <span class="s1">&#39;DNS sevrer&#39;</span><span class="p">:</span> <span class="n">role</span> <span class="ow">not</span> <span class="n">found</span>
</pre></div>
</div>
<ul class="simple">
<li><p>search for status of all roles on ipasrv1.example.com</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-role-find --server ipasrv1.example.com</span>
<span class="o">--------------------</span>
<span class="mi">5</span> <span class="n">IPA</span> <span class="n">server</span> <span class="n">roles</span> <span class="n">matched</span>
<span class="o">--------------------</span>
<span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">AD</span> <span class="n">Trust</span> <span class="n">Controller</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">absent</span>

<span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">CA</span> <span class="n">server</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">enabled</span>

<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>search for all servers which are not AD trust controller</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ipa server-role-find --role &quot;AD trust controller&quot; --status &quot;absent&quot;</span>
<span class="o">--------------------</span>
<span class="mi">1</span> <span class="n">IPA</span> <span class="n">server</span> <span class="n">role</span> <span class="n">matched</span>
<span class="o">--------------------</span>
<span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">AD</span> <span class="n">Trust</span> <span class="n">Controller</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">absent</span>

<span class="n">Role</span> <span class="n">name</span><span class="p">:</span> <span class="n">AD</span> <span class="n">Trust</span> <span class="n">Controller</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">ipasrv3</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Role</span> <span class="n">status</span><span class="p">:</span> <span class="n">absent</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>basic CRUD tests for the new commands</p></li>
<li><p>existing CI tests for component installation (DNS(SEC), CA, KRA) can
test whether the corresponding role is added to the server.</p></li>
</ul>
<p><a class="reference external" href="V4/Server_Roles/Test_Plan">Server Roles V4.4 test plan</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Server Roles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#server-attributes">Server Attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enhanced-commands">Enhanced commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-commands">New Commands</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade">Upgrade</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-test">How to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>