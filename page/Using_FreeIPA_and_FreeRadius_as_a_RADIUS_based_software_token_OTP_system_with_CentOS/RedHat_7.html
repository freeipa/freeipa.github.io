
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>RedHat_7 &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>RedHat_7</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-a-new-server">Install a new server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-ipa-server">Install, configure and test IPA Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa">Install, configure and test RADIUS Server as a frontend to IPA</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="redhat-7">
<h1>RedHat_7<a class="headerlink" href="#redhat-7" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This article shows how to configure FreeIPA and integrate it in
FreeRADIUS to implement a RADIUS based authentication system, which uses
its own software token to provide OTP authentication to other, RADIUS
compatible, systems (e.g. a VPN server, etc.).</p>
<p>The IPA server is configured as a stand-alone system, with no
integration with other directory servers or any other system.</p>
<p>This How To is a intended as sort of brain dump of the steps I took to
configure and test RADIUS and IPA with OTP authentication, after I
successfully managed to build such a system, and it owes a lot to other
guides and posts found in Internet. Some of the more helpful were:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://blog.christophersmart.com/articles/freeipa-how-to-fedora/">http://blog.christophersmart.com/articles/freeipa-how-to-fedora/</a></p></li>
<li><p><a class="reference external" href="http://consultancy.edvoncken.net/index.php/HOWTO_Configure_Radius_with_an_IPA_Server">http://consultancy.edvoncken.net/index.php/HOWTO_Configure_Radius_with_an_IPA_Server</a></p></li>
<li><p><a class="reference external" href="http://karloluiten.nl/make-freeradius-talk-to-freeipa-rhel-idm/">http://karloluiten.nl/make-freeradius-talk-to-freeipa-rhel-idm/</a></p></li>
</ul>
<p><strong>PLEASE NOTE that this set-up uses unencrypted passwords between the
client and the authentication server, i.e. password will be trasmitted
as CLEAR TEXT, consider this with respect to your environment.</strong></p>
</section>
<section id="install-a-new-server">
<h2>Install a new server<a class="headerlink" href="#install-a-new-server" title="Link to this heading">#</a></h2>
<p>To start from scratch, install a basic CentOS 7 server, selecting a
“Infrastructure Server/Identity Management Server” Environment in
Software Selection.</p>
<figure class="align-default" id="id1">
<img alt="IPA_Radius_1.png" src="../../_images/IPA_Radius_1.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius_1.png</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Ensure that the server is up to date:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>| ``[root@ipa ~
...
[root@ipa ~]# yum update
...
</pre></div>
</div>
</section>
<section id="install-configure-and-test-ipa-server">
<h2>Install, configure and test IPA Server<a class="headerlink" href="#install-configure-and-test-ipa-server" title="Link to this heading">#</a></h2>
<p>Ensure that we have all the packages we might need for IPA (<code class="docutils literal notranslate"><span class="pre">bind</span></code> and
<code class="docutils literal notranslate"><span class="pre">bind-dyndb-ldap</span></code> may not be necessary if you don’t plan to use the
native DNS server):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># yum install ipa-server bind bind-dyndb-ldap</span>
<span class="o">...</span>
</pre></div>
</div>
<p>To avoid naming problems, we are hardcoding the server IP and name in
the hosts file:</p>
<p><code class="docutils literal notranslate"><span class="pre">[root&#64;ipa</span> <span class="pre">~]#</span> <span class="pre">echo</span> <span class="pre">&quot;192.168.1.10</span> <span class="pre">ipa.test.org</span> <span class="pre">ipa&quot;</span> <span class="pre">&gt;&gt;/etc/hosts</span></code></p>
<p>Now you can interactively configure the IPA Server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@ipa ~]# ipa-server-install
...
This program will set up the IPA Server.
This includes:
  * Configure a stand-alone CA (dogtag) for certificate management
  * Configure the Network Time Daemon (ntpd)
  * Create and configure an instance of Directory Server
  * Create and configure a Kerberos Key Distribution Center (KDC)
  * Configure Apache (httpd)
To accept the default shown in brackets, press the Enter key.
WARNING: conflicting time&amp;date synchronization service &#39;chronyd&#39; will be disabled in favor of ntpd
Do you want to configure integrated DNS (BIND)? [no]:
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">chronyd</span></code> service will be disabled in order to
successfully configure and run the NTP daemon <code class="docutils literal notranslate"><span class="pre">ntpd</span></code>, which is
required to guarantee that the system’s time is correct and synchronized
with any other device.</p>
<p>For this simple installation, we don’t want to use the integrated DNS,
so answer <code class="docutils literal notranslate"><span class="pre">no</span></code> and then enter the FQDN of this server:</p>
<p><code class="docutils literal notranslate"><span class="pre">Server</span> <span class="pre">host</span> <span class="pre">name</span> <span class="pre">[ipa.test.org]:</span></code></p>
<p>Confirm the domain name</p>
<p><code class="docutils literal notranslate"><span class="pre">Please</span> <span class="pre">confirm</span> <span class="pre">the</span> <span class="pre">domain</span> <span class="pre">name</span> <span class="pre">[test.org]:</span></code></p>
<p>And the realm name</p>
<p><code class="docutils literal notranslate"><span class="pre">Please</span> <span class="pre">provide</span> <span class="pre">a</span> <span class="pre">realm</span> <span class="pre">name</span> <span class="pre">[TEST.ORG]:</span></code></p>
<p>Now you must enter the passwords for the LDAP Directory Server admin
user (<code class="docutils literal notranslate"><span class="pre">“cn=Directory</span> <span class="pre">Manager”</span></code>) and for the IPA admin user
(<code class="docutils literal notranslate"><span class="pre">admin</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Directory</span> <span class="n">Manager</span> <span class="n">password</span><span class="p">:</span>
<span class="n">Password</span> <span class="p">(</span><span class="n">confirm</span><span class="p">):</span>
<span class="o">...</span>
<span class="n">IPA</span> <span class="n">admin</span> <span class="n">password</span><span class="p">:</span>
<span class="n">Password</span> <span class="p">(</span><span class="n">confirm</span><span class="p">):</span>
</pre></div>
</div>
<p>At this point the script will ask for confirmation before proceeding to
configure all the systems that comprise the IPA Server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The IPA Master Server will be configured with:
Hostname:       ipa.test.org
IP address(es): 192.168.1.10
Domain name:    test.org
Realm name:     TEST.ORG
Continue to configure the system with these values? [no]: yes
</pre></div>
</div>
<p>From now on, the script will automatically configure and enable all the
required subsystems and write the appropriate configuration files at the
right place:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">following</span> <span class="n">operations</span> <span class="n">may</span> <span class="n">take</span> <span class="n">some</span> <span class="n">minutes</span> <span class="n">to</span> <span class="n">complete</span><span class="o">.</span>
<span class="n">Please</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="n">returned</span><span class="o">.</span>
<span class="n">Configuring</span> <span class="n">NTP</span> <span class="n">daemon</span> <span class="p">(</span><span class="n">ntpd</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">Setup</span> <span class="n">complete</span>
<span class="n">Next</span> <span class="n">steps</span><span class="p">:</span>
        <span class="mf">1.</span> <span class="n">You</span> <span class="n">must</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">these</span> <span class="n">network</span> <span class="n">ports</span> <span class="n">are</span> <span class="nb">open</span><span class="p">:</span>
                <span class="n">TCP</span> <span class="n">Ports</span><span class="p">:</span>
                  <span class="o">*</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">:</span> <span class="n">HTTP</span><span class="o">/</span><span class="n">HTTPS</span>
                  <span class="o">*</span> <span class="mi">389</span><span class="p">,</span> <span class="mi">636</span><span class="p">:</span> <span class="n">LDAP</span><span class="o">/</span><span class="n">LDAPS</span>
                  <span class="o">*</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">464</span><span class="p">:</span> <span class="n">kerberos</span>
                <span class="n">UDP</span> <span class="n">Ports</span><span class="p">:</span>
                  <span class="o">*</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">464</span><span class="p">:</span> <span class="n">kerberos</span>
                  <span class="o">*</span> <span class="mi">123</span><span class="p">:</span> <span class="n">ntp</span>
        <span class="mf">2.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">obtain</span> <span class="n">a</span> <span class="n">kerberos</span> <span class="n">ticket</span> <span class="n">using</span> <span class="n">the</span> <span class="n">command</span><span class="p">:</span> <span class="s1">&#39;kinit admin&#39;</span>
           <span class="n">This</span> <span class="n">ticket</span> <span class="n">will</span> <span class="n">allow</span> <span class="n">you</span> <span class="n">to</span> <span class="n">use</span> <span class="n">the</span> <span class="n">IPA</span> <span class="n">tools</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">ipa</span> <span class="n">user</span><span class="o">-</span><span class="n">add</span><span class="p">)</span>
           <span class="ow">and</span> <span class="n">the</span> <span class="n">web</span> <span class="n">user</span> <span class="n">interface</span><span class="o">.</span>
<span class="n">Be</span> <span class="n">sure</span> <span class="n">to</span> <span class="n">back</span> <span class="n">up</span> <span class="n">the</span> <span class="n">CA</span> <span class="n">certificate</span> <span class="n">stored</span> <span class="ow">in</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">cacert</span><span class="o">.</span><span class="n">p12</span>
<span class="n">This</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">to</span> <span class="n">create</span> <span class="n">replicas</span><span class="o">.</span> <span class="n">The</span> <span class="n">password</span> <span class="k">for</span> <span class="n">this</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">Directory</span> <span class="n">Manager</span> <span class="n">password</span>
</pre></div>
</div>
<p>We now add the required ports to the firewall public zone and then
restart the firewall service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># firewall-cmd --permanent --zone=public --add-port=80/tcp --add-port=443/tcp --add-port=389/tcp --add-port=636/tcp --add-port=88/tcp --add-port=464/tcp --add-port=88/udp --add-port=464/udp --add-port=123/udp</span>
<span class="o">...</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl restart firewalld.service</span>
</pre></div>
</div>
<p>In order for the IPA Server to work without issues, it is necessary that
the time of the server is synchronized to the other devices using its
services, which is usually guaranteed by a correctly configured NTP
server (<code class="docutils literal notranslate"><span class="pre">ntpd</span></code>). You can check your NTP server status with this
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># ntpdc -c sysinfo</span>
<span class="n">system</span> <span class="n">peer</span><span class="p">:</span>          <span class="mf">0.</span><span class="n">centos</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">ntp</span><span class="o">.</span><span class="n">org</span>
<span class="n">system</span> <span class="n">peer</span> <span class="n">mode</span><span class="p">:</span>     <span class="n">client</span>
<span class="n">leap</span> <span class="n">indicator</span><span class="p">:</span>       <span class="mi">00</span>
<span class="n">stratum</span><span class="p">:</span>              <span class="mi">3</span>
<span class="n">precision</span><span class="p">:</span>            <span class="o">-</span><span class="mi">22</span>
<span class="n">root</span> <span class="n">distance</span><span class="p">:</span>        <span class="mf">0.01346</span> <span class="n">s</span>
<span class="n">root</span> <span class="n">dispersion</span><span class="p">:</span>      <span class="mf">8.23227</span> <span class="n">s</span>
<span class="n">reference</span> <span class="n">ID</span><span class="p">:</span>         <span class="p">[</span><span class="mf">195.66.10.51</span><span class="p">]</span>
<span class="n">reference</span> <span class="n">time</span><span class="p">:</span>       <span class="n">d9cba569</span><span class="mf">.5342443</span><span class="n">b</span>  <span class="n">Fri</span><span class="p">,</span> <span class="n">Oct</span> <span class="mi">16</span> <span class="mi">2015</span> <span class="mi">18</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">45.325</span>
<span class="n">system</span> <span class="n">flags</span><span class="p">:</span>         <span class="n">auth</span> <span class="n">ntp</span> <span class="n">stats</span>
<span class="n">jitter</span><span class="p">:</span>               <span class="mf">0.000000</span> <span class="n">s</span>
<span class="n">stability</span><span class="p">:</span>            <span class="mf">0.000</span> <span class="n">ppm</span>
<span class="n">broadcastdelay</span><span class="p">:</span>       <span class="mf">0.000000</span> <span class="n">s</span>
<span class="n">authdelay</span><span class="p">:</span>            <span class="mf">0.000000</span> <span class="n">s</span>
</pre></div>
</div>
<p>If the NTP server is up and running fine, you will see a low number in
the stratum row.</p>
<p>Now, if everything is correctly configured and running, you should be
able to reach the web management interface at <a class="reference external" href="https://ipa.test.org/">https://ipa.test.org/</a> (you
could have to add an exception for the server certificate, since it will
be self-signed…):</p>
<figure class="align-default" id="id2">
<img alt="IPA_Radius2.png" src="../../_images/IPA_Radius2.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius2.png</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You can now login with the admin user and the password you entered in
the setup script, and reach the Users management page:</p>
<figure class="align-default" id="id3">
<img alt="IPA_Radius3.png" src="../../_images/IPA_Radius3.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius3.png</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Here you can add a new user (which we will call <code class="docutils literal notranslate"><span class="pre">test</span></code>) with the
<code class="docutils literal notranslate"><span class="pre">+Add</span></code> button at the top right of the page:</p>
<figure class="align-default" id="id4">
<img alt="IPA_Radius4.png" src="../../_images/IPA_Radius4.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius4.png</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now logout as Administrator and login as user <code class="docutils literal notranslate"><span class="pre">test</span></code>. The system
should ask you to pick a new password</p>
<figure class="align-default" id="id5">
<img alt="IPA_Radius5.png" src="../../_images/IPA_Radius5.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius5.png</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>and then login. In the test user’s details page, you can add an OTP
Token with the <code class="docutils literal notranslate"><span class="pre">Action</span></code> dropdown button and the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">OTP</span> <span class="pre">Token</span></code>
button</p>
<figure class="align-default" id="id6">
<img alt="IPA_Radius6.png" src="../../_images/IPA_Radius6.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius6.png</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>You will have to choose the type of the new token (Time-based TOTP or
Counter-based HOTP) and an appropriate description, and then the system
will show a QR code which can be used to configure most software token
application by simply scanning it within the app in your smartphone:</p>
<figure class="align-default" id="id7">
<img alt="IPA_Radius7.png" src="../../_images/IPA_Radius7.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius7.png</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Please be aware that, as of now, there is a bug in the FreeIPA version
(4.1.0-18) released with CentOS 7 which causes the Google Authenticator
to fail recognize the QR code, so you may want to use the FreeOTP app by
RedHat which works. The problem lies in the casing of the SHA protocol
encoded in the QR code: IPA uses lower case (sha) while Google
Authenticator requires upper case (SHA).</p>
<p>In order to fix this bug, you will have to modify two files distributed
with the ipa-server package:</p>
<ul class="simple">
<li><p>in /usr/lib/python2.7/site-packages/ipalib/plugins/otptoken.py change</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">StrEnum</span><span class="p">(</span><span class="s1">&#39;ipatokenotpalgorithm?&#39;</span><span class="p">,</span>
    <span class="n">cli_name</span><span class="o">=</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Algorithm&#39;</span><span class="p">),</span>
    <span class="n">doc</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Token hash algorithm&#39;</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span>
    <span class="n">autofill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;no_update&#39;</span><span class="p">),</span>
    <span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;sha384&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;sha512&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">StrEnum</span><span class="p">(</span><span class="s1">&#39;ipatokenotpalgorithm?&#39;</span><span class="p">,</span>
    <span class="n">cli_name</span><span class="o">=</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Algorithm&#39;</span><span class="p">),</span>
    <span class="n">doc</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Token hash algorithm&#39;</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;SHA1&#39;</span><span class="p">,</span>
    <span class="n">autofill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;no_update&#39;</span><span class="p">),</span>
    <span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;SHA1&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;SHA256&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;SHA384&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;SHA512&#39;</span><span class="p">),</span>
</pre></div>
</div>
<ul class="simple">
<li><p>in /usr/share/ipa/ui/js/freeipa/app.js change</p></li>
</ul>
<p>``        default_value:”sha1”,options:[“sha1”,”sha256”,”sha384”,”sha512”]}``</p>
<p>to</p>
<p>``        default_value:”SHA1”,options:[“SHA1”,”SHA256”,”SHA384”,”SHA512”]}``</p>
<p>Before trying the newly set up token, you must login as admin, enable
the <code class="docutils literal notranslate"><span class="pre">Two</span> <span class="pre">factor</span> <span class="pre">authentication</span></code> type in the test user setting, and
update the user’s profile with the <code class="docutils literal notranslate"><span class="pre">Update</span></code> button:</p>
<figure class="align-default" id="id8">
<img alt="IPA_Radius8.png" src="../../_images/IPA_Radius8.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius8.png</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Now you should be able to login as user <code class="docutils literal notranslate"><span class="pre">test</span></code> by adding to the
standard password the code provided by the OTP app (es. FreeOTP) (i.e.
if the test user’s password is “password” and FreeOTP shows 762405, you
should enter “password762405” in the password field):</p>
<figure class="align-default" id="id9">
<img alt="IPA_Radius9.png" src="../../_images/IPA_Radius9.png" />
<figcaption>
<p><span class="caption-text">IPA_Radius9.png</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>If everything up to now is working as expected, you can proceed with the
installation and configuration of the RADIUS frontend.</p>
</section>
<section id="install-configure-and-test-radius-server-as-a-frontend-to-ipa">
<h2>Install, configure and test RADIUS Server as a frontend to IPA<a class="headerlink" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa" title="Link to this heading">#</a></h2>
<p>As a prerequisite, you must install the required freeradius packages (we
won’t need freeradius-krb5, but we’ll install it just in case…):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># yum install freeradius freeradius-utils freeradius-ldap freeradius-krb5</span>
<span class="o">...</span>
</pre></div>
</div>
<p>In order to configure the RADIUS server to authenticate with the
software token provided by the IPA server, we must let RADIUS accept
requests from your clients (including the IPA server itself), enable the
default configuration to search for users in the IPA server with LDAP
protocol and try to authenticate them with an LDAP bind() operation.</p>
<p>All the RADIUS configuration files are in <code class="docutils literal notranslate"><span class="pre">/etc/raddb</span></code>, and most of
the configuration is done by linking files from the mod-available
directory to <code class="docutils literal notranslate"><span class="pre">mod-enabled</span></code> and then editing them as needed.</p>
<p>As a first step, add the following lines at the beginning of
<code class="docutils literal notranslate"><span class="pre">clients.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="n">localnet</span> <span class="p">{</span>
        <span class="n">ipaddr</span> <span class="o">=</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span>
        <span class="n">proto</span> <span class="o">=</span> \<span class="o">*</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="n">somesecret</span>
        <span class="n">nas_type</span> <span class="o">=</span> <span class="n">other</span><span class="o">&lt;------&gt;</span><span class="c1"># localhost isn&#39;t usually a NAS...</span>
        <span class="n">limit</span> <span class="p">{</span>
                <span class="n">max_connections</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="n">lifetime</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">idle_timeout</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">sites-enabled/default</span></code> and <code class="docutils literal notranslate"><span class="pre">sites-enabled/inner-tunnel</span></code> replace
these line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1">#  The ldap module reads passwords from the LDAP database.</span>
<span class="o">-</span><span class="n">ldap</span>
</pre></div>
</div>
<p>with these</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1">#  The ldap module reads passwords from the LDAP database.</span>
<span class="n">ldap</span>
<span class="k">if</span> <span class="p">((</span><span class="n">ok</span> <span class="o">||</span> <span class="n">updated</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">User</span><span class="o">-</span><span class="n">Password</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">update</span> <span class="p">{</span>
        <span class="n">control</span><span class="p">:</span><span class="n">Auth</span><span class="o">-</span><span class="n">Type</span> <span class="o">:=</span> <span class="n">ldap</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and uncomment the following lines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#       Auth-Type LDAP {</span>
<span class="c1">#               ldap</span>
<span class="c1">#       }</span>
</pre></div>
</div>
<p>As a last step, enable and configure the LDAP backend in RADIUS.</p>
<p>Add LDAP to the enabled mods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="n">raddb</span><span class="p">]</span><span class="c1"># ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="n">raddb</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Edit mods-enable/ldap to change</p>
<p>``        server = “ldap.rrdns.example.org ldap.rrdns.example.org ldap.example.org”``</p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">base_dn</span> <span class="pre">=</span> <span class="pre">&quot;dc=example,dc=org&quot;</span></code></p>
<p>to</p>
<p>``        server = “ipa.test.org”``</p>
<p>and</p>
<p>``        base_dn = “dc=test,dc=org”``</p>
<p>To reach the RADIUS server from other clients, we must also open the
firewall for the required ports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># firewall-cmd --permanent --zone=public --add-port=1812/udp --add-port=1813/udp</span>
<span class="n">Success</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl restart firewalld.service</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Now we can test our RADIUS serve by starting in debug mode with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># radiusd –X</span>
<span class="o">...</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">auth</span> <span class="n">address</span> <span class="o">*</span> <span class="n">port</span> <span class="mi">1812</span> <span class="k">as</span> <span class="n">server</span> <span class="n">default</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">acct</span> <span class="n">address</span> <span class="o">*</span> <span class="n">port</span> <span class="mi">1813</span> <span class="k">as</span> <span class="n">server</span> <span class="n">default</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">auth</span> <span class="n">address</span> <span class="p">::</span> <span class="n">port</span> <span class="mi">1812</span> <span class="k">as</span> <span class="n">server</span> <span class="n">default</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">acct</span> <span class="n">address</span> <span class="p">::</span> <span class="n">port</span> <span class="mi">1813</span> <span class="k">as</span> <span class="n">server</span> <span class="n">default</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">auth</span> <span class="n">address</span> <span class="mf">127.0.0.1</span> <span class="n">port</span> <span class="mi">18120</span> <span class="k">as</span> <span class="n">server</span> <span class="n">inner</span><span class="o">-</span><span class="n">tunnel</span>
<span class="n">Opening</span> <span class="n">new</span> <span class="n">proxy</span> <span class="n">socket</span> <span class="s1">&#39;proxy address * port 0&#39;</span>
<span class="n">Listening</span> <span class="n">on</span> <span class="n">proxy</span> <span class="n">address</span> <span class="o">*</span> <span class="n">port</span> <span class="mi">36752</span>
<span class="n">Ready</span> <span class="n">to</span> <span class="n">process</span> <span class="n">requests</span>
</pre></div>
</div>
<p>Open another shell to ipa.test.org and test the RADIUS server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># radtest test password123456 ipa.test.org 1812 somesecret</span>
<span class="n">Sending</span> <span class="n">Access</span><span class="o">-</span><span class="n">Request</span> <span class="n">Id</span> <span class="mi">105</span> <span class="kn">from</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">44729</span> <span class="n">to</span> <span class="mf">192.168.1.10</span><span class="p">:</span><span class="mi">1812</span>
        <span class="n">User</span><span class="o">-</span><span class="n">Name</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
        <span class="n">User</span><span class="o">-</span><span class="n">Password</span> <span class="o">=</span> <span class="s1">&#39; password123456&#39;</span>
        <span class="n">NAS</span><span class="o">-</span><span class="n">IP</span><span class="o">-</span><span class="n">Address</span> <span class="o">=</span> <span class="mf">192.168.1.10</span>
        <span class="n">NAS</span><span class="o">-</span><span class="n">Port</span> <span class="o">=</span> <span class="mi">1812</span>
        <span class="n">Message</span><span class="o">-</span><span class="n">Authenticator</span> <span class="o">=</span> <span class="mh">0x00</span>
<span class="n">Received</span> <span class="n">Access</span><span class="o">-</span><span class="n">Accept</span> <span class="n">Id</span> <span class="mi">105</span> <span class="kn">from</span> <span class="mf">192.168.1.10</span><span class="p">:</span><span class="mi">1812</span> <span class="n">to</span> <span class="mf">192.168.1.10</span><span class="p">:</span><span class="mi">44729</span> <span class="n">length</span> <span class="mi">20</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>If you receive an “Access-Accept” response, you are ready to go, just
stop the debug server with <code class="docutils literal notranslate"><span class="pre">ctrl-c</span></code>, enable the server daemon and
start it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Listening</span> <span class="n">on</span> <span class="n">proxy</span> <span class="n">address</span> <span class="o">*</span> <span class="n">port</span> <span class="mi">35327</span>
<span class="n">Ready</span> <span class="n">to</span> <span class="n">process</span> <span class="n">requests</span>
<span class="o">^</span><span class="n">C</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl enable radiusd</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="s1">&#39;/usr/lib/systemd/system/radiusd.service&#39;</span> <span class="s1">&#39;/etc/systemd/system/multi-user.target.wants/radiusd.service&#39;</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl start radiusd.service</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@ipa</span> <span class="o">~</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-a-new-server">Install a new server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-ipa-server">Install, configure and test IPA Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-configure-and-test-radius-server-as-a-frontend-to-ipa">Install, configure and test RADIUS Server as a frontend to IPA</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>