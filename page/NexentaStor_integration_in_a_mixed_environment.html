

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>NexentaStor_integration_in_a_mixed_environment &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/NexentaStor_integration_in_a_mixed_environment';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="/_static/freeipa-logo-small.png" class="logo__image only-light" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/NexentaStor_integration_in_a_mixed_environment.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>NexentaStor_integration_in_a_mixed_environment</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-part-cifs-nfs-no-kerberos">First part: CIFS + NFS no-kerberos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-part-adding-kerberos-to-nfs4-nfs-krb5">Second part, adding kerberos to NFS4: NFS + KRB5</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="nexentastor-integration-in-a-mixed-environment">
<h1>NexentaStor_integration_in_a_mixed_environment<a class="headerlink" href="#nexentastor-integration-in-a-mixed-environment" title="Permalink to this heading">#</a></h1>
<p><strong>NexentaStor integration with IPA in a mixed environment</strong></p>
<hr class="docutils" />
<p>Provided by: Sigbjorn Lie</p>
<p>Making NexentaStor speak to AD and LDAP/IPA is easy, adding krb5 for NFS
is a bit more tricky.</p>
<section id="first-part-cifs-nfs-no-kerberos">
<h2>First part: CIFS + NFS no-kerberos<a class="headerlink" href="#first-part-cifs-nfs-no-kerberos" title="Permalink to this heading">#</a></h2>
<p>Configure the CIFS service to join to AD, and configure the LDAP client
to point at IPA. Use the following configuration for LDAP,</p>
<p>REMEBER to edit /etc/nsswitch.ldap before applying LDAP configuration.
Failing to do so will freeze NexentaStor as all services will be
configured to use LDAP, and maps such as protocols and service is not
served by IPA. You’ll do this in a shell using expert_mode in the NMC.
The only maps in /etc/nsswitch.ldap that should be configured for ldap
lookup is passwd, group, and netgroup.</p>
<p>Make the following changes under Settings -&gt; Misc Services -&gt; LDAP
client -&gt; Configure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LDAP</span> <span class="n">config</span> <span class="nb">type</span><span class="p">:</span> <span class="n">manual</span>
<span class="n">Profile</span> <span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Groups</span> <span class="n">Service</span> <span class="n">Descriptor</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">compat</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">ix</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">Netgroup</span> <span class="n">Service</span> <span class="n">Descriptor</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">ng</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">compat</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">ix</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">Credential</span> <span class="n">Level</span><span class="p">:</span> <span class="n">anonymous</span>
<span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Base</span> <span class="n">DN</span><span class="p">:</span> <span class="n">dc</span><span class="o">=</span><span class="n">ix</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">LDAP</span> <span class="n">Authentication</span> <span class="n">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">LDAP</span> <span class="n">Servers</span><span class="p">:</span> <span class="n">ipa01</span><span class="o">.</span><span class="n">ix</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">ipa02</span><span class="o">.</span><span class="n">ix</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">com</span>
<span class="n">Authentication</span> <span class="n">Method</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Proxy</span> <span class="n">DN</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Proxy</span> <span class="n">Password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Users</span> <span class="n">Service</span> <span class="n">Descriptor</span><span class="p">:</span> <span class="n">cn</span><span class="o">=</span><span class="n">users</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">compat</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">ix</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
</pre></div>
</div>
<p>In a shell using expert_mode, edit the nsswitch.conf as the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">passwd</span><span class="p">:</span>   <span class="n">files</span> <span class="n">ldap</span> <span class="n">ad</span>
<span class="n">group</span><span class="p">:</span>    <span class="n">files</span> <span class="n">ldap</span> <span class="n">ad</span>
</pre></div>
</div>
<p>This will make Nexenta look for Unix accounts and ground in IPA first,
before looking up the rest from Active Directory.</p>
</section>
<section id="second-part-adding-kerberos-to-nfs4-nfs-krb5">
<h2>Second part, adding kerberos to NFS4: NFS + KRB5<a class="headerlink" href="#second-part-adding-kerberos-to-nfs4-nfs-krb5" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>After the server has been joined to AD, scp the /etc/krb5/krb5.keytab
file from the NexentaStor server to the IPA server.</p></li>
<li><p>Add a host entry for the NexentaStor server to IPA, and retrieve the
kerberos keytab and add them to the krb5.keytab file copied from the
NexentaStor machine. This is required as the NFS service and the CIFS
service share the same krb5.keytab file.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre"># ipa-getkeytab -s ipa-server -p nexentastorserver.fqdn -k /path/to/nexentastor/krb5.keytab</span></code></p>
<ul class="simple">
<li><p>scp the modified krb5.keytab file back into the NexentaStor server at
/etc/krb5/krb5.keytab.</p></li>
<li><p>Edit /etc/nsswitch.conf again, make sure “ad” is still present for
passwd and group, if not, add it back in.</p></li>
<li><p>Remove /etc/krb5/krb5.conf,v (bug in NexentaStor makes this file
re-appear with old contents, even if it’s edited trough the NMC.</p></li>
<li><p>Edit /etc/krb5/krb5.conf, add a sections under [realms] for your IPA
domain. I’ve specified admin_server, kdc, and kpasswd_server for all
my IPA servers.</p></li>
<li><p>Add “allow_weak_crypto = true” under libdefaults to widen the support
for Linux clients.</p></li>
<li><p>Set “default_realm = IPA-REALM-CAPITAL-LETTERS”</p></li>
<li><p>Add a section for the IPA domain under [domain_realm]:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">ipa</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="n">IPA</span><span class="o">-</span><span class="n">REALM</span><span class="o">-</span><span class="n">CAPITAL</span><span class="o">-</span><span class="n">LETTERS</span>
<span class="n">ipa</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">=</span> <span class="n">IPA</span><span class="o">-</span><span class="n">REALM</span><span class="o">-</span><span class="n">CAPITAL</span><span class="o">-</span><span class="n">LETTERS</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Edit /etc/defaultdomain, create the file if it does not exist
already, and add the IPA domain.</p></li>
<li><p>Edit /etc/resolv.conf:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="n">addomain</span><span class="o">.</span><span class="n">com</span> <span class="n">ipadomain</span><span class="o">.</span><span class="n">com</span>
<span class="n">domain</span> <span class="n">addomain</span><span class="o">.</span><span class="n">com</span>
<span class="n">nameserver</span> <span class="o">&lt;</span><span class="n">ipa</span><span class="o">-</span><span class="n">dns</span><span class="o">-</span><span class="n">ip</span><span class="o">&gt;</span>
<span class="n">nameserver</span> <span class="o">&lt;</span><span class="n">ad</span><span class="o">-</span><span class="n">dns</span><span class="o">-</span><span class="n">ip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>I have also configured my IPA DNS server to forward any requests for my
AD domain directly to the AD dns servers. This should not be required if
your domains is delegated properly, but it speeds AD requests up a bit.
:)</p>
<p>The addomain must be the first domain listed to make the nss_ad module
work.</p>
<ul class="simple">
<li><p>Switch back to the NMC, and edit the nfs defaults file:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre"># NMC: $ setup network service nfs-server edit-settings</span></code></p>
<ul class="simple">
<li><p>Uncomment and modify:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NFSMAPID_DOMAIN</span><span class="o">=</span><span class="n">ipa</span><span class="o">-</span><span class="n">domain</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Restart the NFS service.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre"># NMC $ setup network service nfs-server restart</span></code></p>
<p>That’s it. Your NexentaStor server will now look up LDAP/IPA users and
groups first, and then generate UID/GID’s for any other users/groups
only found in AD.</p>
<p><a class="reference external" href="Category:How_to">Category:How to</a> <a class="reference external" href="Category:Draft_documentation">Category:Draft
documentation</a></p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-part-cifs-nfs-no-kerberos">First part: CIFS + NFS no-kerberos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-part-adding-kerberos-to-nfs4-nfs-krb5">Second part, adding kerberos to NFS4: NFS + KRB5</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>