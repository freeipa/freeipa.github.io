
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Permissions_V2 &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/V4/Permissions_V2';</script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a>
<div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/page/V4/Permissions_V2.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Permissions_V2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#v2-permissions">V2 permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permission-flags">Permission flags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-in-the-permission-entry">Data in the permission entry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-acis-out-of-the-root">Moving ACIs out of the root</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-attribute-mapping">Option/Attribute mapping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-noaci-command">add_noaci command</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-with-old-clients">Compatibility with old clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-and-upgrading-permissions">Modifying and Upgrading Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-and-deleting-permissions">Adding and Deleting Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mass-update">Mass update</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-show-for-old-permissions">Find/show for old permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-rights">Read rights</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="permissions-v2">
<h1>Permissions_V2<a class="headerlink" href="#permissions-v2" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The internal workings of Permissions and their relationship to ACIs are
overhauled.</p>
<ul class="simple">
<li><p>Permission flags are extended to ensure backwards compatibility</p></li>
<li><p>Permission ACIs may be located in any container, not just $SUFFIX</p></li>
<li><p>Permission entries now contain all data needed to (re-)generate (or
check) the ACI</p></li>
<li><p>It is now possible to grant read rights</p></li>
</ul>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<p>This feature brings no major user-visible changes, but will enable
development of <a class="reference external" href="V3/Managed_Read_permissions">Managed Read
permissions</a>.</p>
<p>The UI is re-organized and the CLI now allows some previously disabled
combinations of options – see the respective sections.</p>
</section>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
</section>
<section id="v2-permissions">
<h2>V2 permissions<a class="headerlink" href="#v2-permissions" title="Link to this heading">#</a></h2>
<p>This document describes the semantics of “V2” permissions. These are
permissions with a “V2” flag.</p>
<p>V2 permissions cannot be modified by older versions of IPA. An old-style
permission will be converted to V2 whenever it is modified.</p>
<p>Assigning permissions to privileges will still be possible on older IPA
servers.</p>
</section>
<section id="permission-flags">
<h2>Permission flags<a class="headerlink" href="#permission-flags" title="Link to this heading">#</a></h2>
<p>Permission objects can have flags in their “ipaPermissionType”
attribute. Currently we use one such flag, SYSTEM, which means that the
underlying ACI is not managed by the Permission object. The code does
not even assume an underlying ACI exists for SYSTEM permissions.</p>
<p>The permission flags will be repurposed to allow adding new
functionality while retaining a degree of backwards compatibility.</p>
<p>New flags will be added for additional features. Permissions that have
an unknown flag will be assumed to have unknown semantics implemented in
future IPA versions, and the underlying ACI will not be manipulated (as
with current SYSTEM flags).</p>
<p>For compatibility with old versions of IPA, all new flags must be
accompanied by SYSTEM. Permissions with <em>only</em> the SYSTEM flag retain
the old semantics.</p>
</section>
<section id="data-in-the-permission-entry">
<h2>Data in the permission entry<a class="headerlink" href="#data-in-the-permission-entry" title="Link to this heading">#</a></h2>
<p>The new permission objects will contain all data needed to generate (or
check) the ACI. This means IPA code will no longer need to parse ACIs
(except when upgrading old permissions). Any change to a Permission will
result in removing any old ACI and adding a new one.</p>
<p>The new schema (including schema from other related designs) is as
follows:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.42 NAME 'ipaPermDefaultAttr' DESC 'IPA permission default attribute' EQUALITY caseIgnoreMatch ORDERING caseIgnoreOrderingMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.43 NAME 'ipaPermIncludedAttr' DESC 'IPA permission explicitly included attribute' EQUALITY caseIgnoreMatch ORDERING caseIgnoreOrderingMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.44 NAME 'ipaPermExcludedAttr' DESC 'IPA permission explicitly excluded attribute' EQUALITY caseIgnoreMatch ORDERING caseIgnoreOrderingMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.45 NAME 'ipaPermBindRuleType' DESC 'IPA permission bind rule type' EQUALITY caseExactMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE-VALUE X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.46 NAME 'ipaPermLocation' DESC 'Location of IPA permission ACI' EQUALITY distinguishedNameMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 SINGLE-VALUE X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.47 NAME 'ipaPermRight' DESC 'IPA permission rights' EQUALITY caseIgnoreMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.48 NAME 'ipaPermTargetFilter' DESC 'IPA permission target filter' EQUALITY caseIgnoreMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">attributeTypes: (2.16.840.1.113730.3.8.11.49 NAME 'ipaPermTarget' DESC 'IPA permission target' EQUALITY caseIgnoreMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 X-ORIGIN 'IPA v3' )</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">objectClasses: (2.16.840.1.113730.3.8.12.21 NAME 'ipaPermissionV2' DESC 'IPA Permission objectclass, version 2' SUP ipaPermission AUXILIARY MUST ( ipaPermissionType $ ipaPermBindRuleType $ ipaPermRight $ ipaPermLocation ) MAY ( ipaPermDefaultAttr $ ipaPermIncludedAttr $ ipaPermExcludedAttr $ ipaPermTargetFilter $ ipaPermTarget ) X-ORIGIN 'IPA v3' )</span></code></div>
</div>
<p>(Note: ipaPermIncludedAttr was known as ipaPermAllowedAttr in the first
versions of this document, and in the patches that implement it. It has
been renamed for <a class="reference external" href="V3/Managed_Read_permissions">V3/Managed Read
permissions</a>.)</p>
<ul class="simple">
<li><p>ipaPermIncludedAttr lists the attributes of the ACI; for example:</p></li>
</ul>
<div class="line-block">
<div class="line">``   ipaPermIncludedAttr: cn``</div>
<div class="line">``   ipaPermIncludedAttr: sn``</div>
</div>
<ul class="simple">
<li><p>the other ipaPerm*Attr are for Managed permissions, will be explained
in <a class="reference external" href="V3/Managed_Read_permissions">V3/Managed Read permissions</a></p></li>
<li><p>ipaPermBindRuleType is for general access ACIs, will be explained in
<a class="reference external" href="V3/Anonymous_and_Any_permissions">V3/Anonymous and Any
permissions</a>; default:</p></li>
</ul>
<p>``   ipaPermBindRuleType: permission``</p>
<ul class="simple">
<li><p>ipaPermLocation is the location of the ACI in the tree.</p></li>
</ul>
<p>``   ipaPermLocation: cn=users,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com``</p>
<ul class="simple">
<li><p>ipaPermRight is the right(s) the permission grants; for example:</p></li>
</ul>
<div class="line-block">
<div class="line">``   ipaPermRight: add``</div>
<div class="line">``   ipaPermRight: write``</div>
</div>
<ul class="simple">
<li><p>ipaPermTargetFilter is the target filter part of the ACI, for
example:</p></li>
</ul>
<p>``   ipaPermTargetFilter: (memberOf=cn=ipausers,cn=groups,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com)``</p>
<ul class="simple">
<li><p>ipaPermTarget is the target part of the ACI, as a DN with possible
wildcards; for example:</p></li>
</ul>
<p>``   ipaPermTarget: uid=*,cn=users,cn=accounts,dc=idm,dc=lab,dc=eng,dc=brq,dc=redhat,dc=com``</p>
</section>
<section id="moving-acis-out-of-the-root">
<h2>Moving ACIs out of the root<a class="headerlink" href="#moving-acis-out-of-the-root" title="Link to this heading">#</a></h2>
<p>ACIs will be created on appropriate containers, rather than in the
$SUFFIX. This will increase performance of LDAP operations, as fewer
ACIs need to be checked for an entry.</p>
<p>The location of the ACI will be determined by <code class="docutils literal notranslate"><span class="pre">ipaPermLocation</span></code>.</p>
</section>
<section id="option-attribute-mapping">
<h2>Option/Attribute mapping<a class="headerlink" href="#option-attribute-mapping" title="Link to this heading">#</a></h2>
<p>Due to technical reasons, API parameters need to be named the same as
LDAP attributes. (This assumption runs rather deep in the framework, and
makes adding new LDAP attributes for previously existing options
somewhat complicated.)</p>
<p>In each of the following pairs of options, the two are mutually
exclusive; if the second is present it acts as the first one. The second
option will only be available when called with a lower API version than
the one where V2 permissions are introduced.</p>
<div class="line-block">
<div class="line">``  API name            CLI name``</div>
<div class="line">``  ——————————-``</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/ ipapermright        permissions</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">\ permissions         (no_cli)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/ ipapermincludedattr  attrs</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">\ attrs               (no_cli)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/ ipapermtargetfilter filter</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">\ filter              (no_cli)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">/ ipapermlocation     subtree</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">\ subtree             (no_cli)</span></code></div>
</div>
<p>A new no-cli option will be added: <code class="docutils literal notranslate"><span class="pre">ipapermtarget</span></code>.</p>
<p>IPA will validate the filter before setting it by performing a search.</p>
<p>Finally, 3 existing options will be available to set the above:</p>
<p><code class="docutils literal notranslate"><span class="pre">memberof</span></code> will set target filter to <code class="docutils literal notranslate"><span class="pre">(memberOf={group})</span></code>, after
checking that the group exists. <code class="docutils literal notranslate"><span class="pre">memberof</span></code> and <code class="docutils literal notranslate"><span class="pre">filter</span></code> are mutually
exclusive.</p>
<p><code class="docutils literal notranslate"><span class="pre">targetgroup</span></code> will set target to
<code class="docutils literal notranslate"><span class="pre">`ldap:///{group}</span></code> &lt;<a class="reference external" href="ldap:///%7Bgroup%7D">ldap:///%7Bgroup%7D</a>&gt;`__, after checking that the
group exists. <code class="docutils literal notranslate"><span class="pre">targetgroup</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code> are mutually exclusive.</p>
<p><code class="docutils literal notranslate"><span class="pre">type</span></code> will set target and subtree to one of pre-defined values
correspondint to IPA object types. <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">subtree</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code>
are mutually exclusive.</p>
<p>These values will be output if the filter/target/location values match
the respective patterns.</p>
<p>Note that this introduces an incompatibility: when a permission “type”
is set, updating it to “memberof” or “targetgroup” will NOT reset all
aspects of “type”, as was the case before. (This change is part of
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2355">ticket 2355</a> - Allow
filter and subtree to be added in same permission)</p>
<p>Also Note that <code class="docutils literal notranslate"><span class="pre">subtree</span></code> (ipapermlocation) must now always refer to an
existing entry; wildcards or non-existent DNs are not allowed.</p>
</section>
<section id="add-noaci-command">
<h2>add_noaci command<a class="headerlink" href="#add-noaci-command" title="Link to this heading">#</a></h2>
<p>There is no expectation of backwards compatibility for
<code class="docutils literal notranslate"><span class="pre">permission_add_noaci</span></code>. This command will be marked as internal.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<p>See the Test Plan below.</p>
</section>
<section id="compatibility-with-old-clients">
<h2>Compatibility with old clients<a class="headerlink" href="#compatibility-with-old-clients" title="Link to this heading">#</a></h2>
<p>For clients which report an API version lower than the one of this
feature, the output will be modified to keep basic compatibility. A new
“permissions2” capability will be added to track the version.</p>
<p>Attributes ipapermright, ipapermincludedattr, ipapermtargetfilter,
ipapermlocation will be output under their old names: permissions,
attrs, filter, subtree.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">targetgroup</span></code>, and <code class="docutils literal notranslate"><span class="pre">memberof</span></code> will be output as single
values rather than single-element lists.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">subtree</span></code> (ipapermlocation), the entry will also be made
single-valued, and a ‘<a class="reference external" href="ldap:///">ldap:///</a>’ prefix will be added to it.</p>
</section>
<section id="modifying-and-upgrading-permissions">
<h2>Modifying and Upgrading Permissions<a class="headerlink" href="#modifying-and-upgrading-permissions" title="Link to this heading">#</a></h2>
<p>A permission object can not be modified if:</p>
<ul class="simple">
<li><p>it has any unknown flags (<code class="docutils literal notranslate"><span class="pre">ipaPermissionType</span></code>), or</p></li>
<li><p>it has *only* the SYSTEM flag</p></li>
</ul>
<p>The process for modifying a permission (and its ACI) is as follows:</p>
<p>1. Before a permission object is changed, location of its corresponding
ACI is found using the old permission name and ipaPermLocation (which
defaults to $SUFFIX).</p>
<p>2. If the permission object does not have any flags (i.e. it is an
old-style permission), the ACI is parsed and appropriate attributes are
set on the Python representation of the entry, the SYSTEM and V2 flags
are added, and the ipaPermissionV2 objectclass is added. The new ACI
string is calculated from this.</p>
<p>3. If the location (subtree) did *not* change, the old ACI is replaced
by the new ACI.</p>
<ol class="arabic simple" start="4">
<li><p>If the location (subtree) changed, the old ACI is removed.</p></li>
<li><p>The permission entry is updated in LDAP.</p></li>
<li><p>If the location (subtree) changed, the new ACI is added.</p></li>
</ol>
</section>
<section id="adding-and-deleting-permissions">
<h2>Adding and Deleting Permissions<a class="headerlink" href="#adding-and-deleting-permissions" title="Link to this heading">#</a></h2>
<p>When adding, the ACI is inserted after the permission entry.</p>
<p>When deleting, the ACI is deleted first, then the permission entry.</p>
</section>
<section id="mass-update">
<h2>Mass update<a class="headerlink" href="#mass-update" title="Link to this heading">#</a></h2>
<p>Old permisisons can be updated to V2 by running the process in
“Modifying and Upgrading Permissions” on all permissions without the
SYSTEM flag. We can run this process on upgrade (for example in the
release where we introduce an audit tool), or just let users upgrade
manually.</p>
<p>The decision on when/if to do this has been postponed.</p>
<p>(The upgrade-on-modify mechanism, and permission-{find,show} for
old-style permissions, need to be in place in any case, because
old-style permisisons can be created on old servers.)</p>
</section>
<section id="find-show-for-old-permissions">
<h2>Find/show for old permissions<a class="headerlink" href="#find-show-for-old-permissions" title="Link to this heading">#</a></h2>
<p>Old-style permissions will continue be recognized by
permission-{find,show} commands.</p>
<p>The show command will upgrade the entry (in memory, without commiting to
LDAP), before outputting data.</p>
<p>This “output only” upgrade is the same as step 2 in “Modifying and
Upgrading Permissions”, except it will not touch the flags, i.e. “V2”
and “SYSTEM” will not be added, and the ‘ipaPermissionV2’ objectclass is
not added.</p>
<p>The find command will iterate through all old-stryle permissions, do the
“output-only” upgrade on each one, and filter the result based on given
options.</p>
</section>
<section id="read-rights">
<h2>Read rights<a class="headerlink" href="#read-rights" title="Link to this heading">#</a></h2>
<p>The “read”, “search”, and “compare” rights are added to “write”, “add”,
“delete”, and “all” in the list of rights that can be granted
(ipaPermRight).</p>
<p>UI</p>
<p>The UI will need to be updated to use the attribute names in the API,
see the “Option/Attribute mapping” section.</p>
</section>
<section id="feature-management">
<h2>Feature Management<a class="headerlink" href="#feature-management" title="Link to this heading">#</a></h2>
<p>UI</p>
<p>As part of the related <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2355">ticket
2355</a>, The UI is
reorganized to allow type, filter, subtree, targetgroup to be specified
independently.</p>
<p>CLI</p>
<ul class="simple">
<li><p>As part of the related <a class="reference external" href="https://fedorahosted.org/freeipa/ticket/2355">ticket
2355</a>, the type,
filter, subtree, targetgroup options are no longer mutually exclusive</p></li>
<li><p>The type is a convenience option that sets rawfilter and subtree on
input, and is computed from them on output</p></li>
</ul>
</section>
<section id="test-plan">
<h2>Test Plan<a class="headerlink" href="#test-plan" title="Link to this heading">#</a></h2>
<p>See <a class="reference external" href="V3/Permissions_V2/tests">dedicated Test Plan page</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#v2-permissions">V2 permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permission-flags">Permission flags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-in-the-permission-entry">Data in the permission entry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-acis-out-of-the-root">Moving ACIs out of the root</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#option-attribute-mapping">Option/Attribute mapping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-noaci-command">add_noaci command</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-with-old-clients">Compatibility with old clients</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-and-upgrading-permissions">Modifying and Upgrading Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-and-deleting-permissions">Adding and Deleting Permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mass-update">Mass update</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-show-for-old-permissions">Find/show for old permissions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-rights">Read rights</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-management">Feature Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plan">Test Plan</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>