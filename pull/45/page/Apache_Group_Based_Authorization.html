
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Apache_Group_Based_Authorization &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Apache_Group_Based_Authorization';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/Apache_Group_Based_Authorization.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Apache_Group_Based_Authorization</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#draft-version-work-in-progress-to-be-completed">*** DRAFT VERSION - WORK IN PROGRESS TO BE COMPLETED ***</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="apache-group-based-authorization">
<h1>Apache_Group_Based_Authorization<a class="headerlink" href="#apache-group-based-authorization" title="Link to this heading">#</a></h1>
<section id="draft-version-work-in-progress-to-be-completed">
<h2>*** DRAFT VERSION - WORK IN PROGRESS TO BE COMPLETED ***<a class="headerlink" href="#draft-version-work-in-progress-to-be-completed" title="Link to this heading">#</a></h2>
<p>Following on from the previous documentation for an IPA backend to
protect Apache it’s not unusual to require only a subset of users to
have access to a system rather than all valid users.</p>
<p>There’s two approaches that will be taken in this document - the first
will be PAM based authentication and the second will be extended the
previous kerberos configuration with LDAP groups. There are pros and
cons to each direction and each are suitable for different scenarios
dependant on the use case.</p>
<p>Using PAM authentication</p>
<p>With the EPEL repository enabled installing the mod_auth_pam package
will install teh module, add a configuration file to httpd to enable the
module and place an httpd file in /etc/pam.d for the PAM configuration.</p>
<p>The default is to use whatever is in /etc/pam.d/password-auth but this
may be overkill. To just use SSSD all that is needed is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span>        <span class="n">required</span>      <span class="n">pam_env</span><span class="o">.</span><span class="n">so</span>
<span class="n">auth</span>        <span class="n">sufficient</span>    <span class="n">pam_sss</span><span class="o">.</span><span class="n">so</span>
<span class="n">auth</span>        <span class="n">required</span>      <span class="n">pam_deny</span><span class="o">.</span><span class="n">so</span>
<span class="n">account</span>     <span class="n">sufficient</span>    <span class="n">pam_sss</span><span class="o">.</span><span class="n">so</span>
<span class="n">account</span>     <span class="n">required</span>      <span class="n">pam_deny</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>To allow httpd to talk to PAM with selinux enabled a boolean needs to be
set:</p>
<p>`` setsebool -P allow_httpd_mod_auth_pam on``</p>
<p>With that in place it’s simple enough to add user/group behaviour via
adding the appropriate entries for the directory or location concerned
in the conf files or .htaccess:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AuthPAM_Enabled</span> <span class="n">on</span>
<span class="n">AuthType</span> <span class="n">Basic</span>
<span class="n">AuthName</span> <span class="s2">&quot;Group Restricted  Server&quot;</span>
<span class="n">require</span> <span class="n">valid</span><span class="o">-</span><span class="n">user</span>
</pre></div>
</div>
<p>Pros</p>
<p>This will work with the HBAC options/pages in IPA (add httpd as a
service) so allow for testing of rules. A user won’t be considered
‘valid’ unless it can pass the HBAC tests. This way controls can be
centralized with a standardized httpd config or standard users have very
simple copy/paste to go into .htaccess over multiple servers very
easily. This also does not require any sort of ldap service user to bind
as (and consequently any plain text passwords anywhere) since it is the
system carrying out the check via the secure kerberos/ldap mechanism
through SSSD. Optionally rather than require valid-user require group
can be used - with the downside this wouldn’t be visible in the IPA UI
and HBAC would still need to be completed so it could confuse in
troubleshooting.</p>
<p>Cons</p>
<p>Depending on httpd activity this has the potential for being fairly
heavy on load - principally due to HBAC having a fairly short cache
time. This may or may not be a problem depending on the use case of the
httpd server. This only offers basic auth so no single sign on would be
available - if that’s a desirable feature.</p>
<p>Using LDAP groups alongside Kerberos Authentication</p>
<p><a class="reference external" href="Apache_SNI_With_Kerberos">With Kerberos already working</a> we can add
LDAP groups via mod_authnz_ldap which is included in the base httpd
install. The important lines to look at for basic lockdown via groups
are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AuthLDAPURL</span>
<span class="n">AuthLDAPBindDN</span>
<span class="n">AuthLDAPBindPassword</span>
<span class="n">require</span> <span class="n">ldap</span><span class="o">-</span><span class="n">group</span>
</pre></div>
</div>
<p>The bind user and password are only required if anonymous lookups are
disabled (which is preferred in general).</p>
<p>First a dedicated system user should be created to use to bind with. To
do this create a file (eg httpbind.ldif) containing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span><span class="p">:</span> <span class="n">uid</span><span class="o">=</span><span class="n">httpbind</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">sysaccounts</span><span class="p">,</span><span class="n">cn</span><span class="o">=</span><span class="n">etc</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">dc</span><span class="o">=</span><span class="n">com</span>
<span class="n">changetype</span><span class="p">:</span> <span class="n">add</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">account</span>
<span class="n">objectclass</span><span class="p">:</span> <span class="n">simplesecurityobject</span>
<span class="n">uid</span><span class="p">:</span> <span class="n">httpbind</span>
<span class="n">userPassword</span><span class="p">:</span> <span class="n">ohaimakethissimethingtoughtobreak</span>
<span class="n">passwordExpirationTime</span><span class="p">:</span> <span class="mi">20380119031407</span><span class="n">Z</span>
<span class="n">nsIdleTimeout</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This can then be imported by:</p>
<p>`` ldapmodify -h ipa01.example.com -p 389 -x -D “cn=Directory  Manager” -w <code class="docutils literal notranslate"><span class="pre">\</span> <span class="pre">``</span> <span class="pre">-f</span> <span class="pre">httpbind.ldif</span></code></p>
<p>Now the configuration can be carried out. Full details can be found
<a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html">here</a> but
in brief…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>AuthLDAPURL   ``\ ```ldaps://ipa01.example.com:636/dc=example,dc=com`` &lt;ldaps://ipa01.example.com:636/dc=example,dc=com&gt;`__
AuthLDAPBindDN    uid=httpbind,cn=sysaccounts,cn=etc,dc=example,dc=com
AuthLDAPBindPassword  ohaimakethissimethingtoughtobreak
require ldap-group
LDAPTrustedGlobalCert CA_BASE64 /etc/httpd/certs/ca.crt
AuthLDAPGroupAttributeIsDN off
</pre></div>
</div>
<p>Make sure that /etc/ipa/ca.crt has been copied to a location that httpd
can read (such as /etc/httpd/certs/ca.crt if following the previous
guide).</p>
<p><a class="reference external" href="Category:ImproveOrRemove">Category:ImproveOrRemove</a>
<a class="reference external" href="Category:NoLink">Category:NoLink</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#draft-version-work-in-progress-to-be-completed">*** DRAFT VERSION - WORK IN PROGRESS TO BE COMPLETED ***</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>