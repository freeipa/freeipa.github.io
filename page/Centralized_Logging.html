
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Centralized_Logging &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Centralized_Logging';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/Centralized_Logging.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Centralized_Logging</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#freeipa-logs">FreeIPA logs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-solution">Proposed Solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#centralized-logging-server">Centralized Logging Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-gathering-and-transport">Log Gathering and Transport</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dashboards">Dashboards</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-of-the-kibana-dashboards">Demo of the Kibana Dashboards</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-resources">Other Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="centralized-logging">
<h1>Centralized_Logging<a class="headerlink" href="#centralized-logging" title="Link to this heading">#</a></h1>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">#</a></h2>
<p>When a system grows to multiple hosts, managing the logs and accessing
them can get complicated. Searching for a particular error across
hundreds of log files on hundreds of servers is difficult without good
tools. FreeIPA currently does not have documentation or even own tools
how to set up the infrastructure and it is being solved separately by
each FreeIPA user. This page summarizes the efforts and development of a
Centralized Logging solution in/for FreeIPA that would close that gap.</p>
<p>FreeIPA is a security related project, usually a backbone of the
infrastructure. Tracking, audit or analysis of the logs of the FreeIPA
server behavior and related FreeIPA user behavior is useful as it allows
detecting problems in time before they grow in even bigger problems
(e.g., replication errors) or helps detecting attacks, misbehavior or
simply configuration problems in the infrastructure and amending them.</p>
</section>
<section id="freeipa-logs">
<h2>FreeIPA logs<a class="headerlink" href="#freeipa-logs" title="Link to this heading">#</a></h2>
<p>FreeIPA server itself is not a monolithic application, but rather
compound of selected open source projects creating a solution for
identity management. This makes log collection, processing and
aggregation a challenge as each project have own way and technology how
to structure and produce logs. This applies both for FreeIPA server and
it’s many services, but also for FreeIPA clients, where different
information lies in different logs (SSSD log, audit log).</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">#</a></h2>
<p>Before designing a particular solution, basic use cases and intents of
what logs will be used and how should be defined. Currently, following
set of use cases is tracked:</p>
<ul class="simple">
<li><p>As Admin or Auditor, I want to see all calls to FreeIPA API so that I
can audit administrative changes to FreeIPA server (for instance: who
added user “foo”? Who revoked a certificate and when?)</p></li>
<li><p>As Auditor, I want to see all logins attempts for meeting security
requirements and forensic analysis</p></li>
<li><p>As Security Administrator, I want to visualize failed login attempts
to brute-force attack</p></li>
<li><p>As Admin, I want to see replication status of all my FreeIPA replicas
so that I can amend the issue in a timely manner to avoid replication
conflicts or out-of-sync data (I want my login to work on all
servers)</p></li>
<li><p>As Admin, I want to identify AD interoperability problems on FreeIPA
server (example: SSSD on the FreeIPA server cannot talk to the Active
Directory server and thus resolve groups)</p></li>
<li><p>As Admin, I want to see load of Kerberos and LDAP server to be able
to compare the load on the FreeIPA servers (and for example identify
badly configured DNS SRV records or clients always calling the same
server), network problems (some servers may not be reachable by most
clients and have thus very small load) or simply by some of the
services not running.</p></li>
</ul>
</section>
<section id="proposed-solution">
<h2>Proposed Solution<a class="headerlink" href="#proposed-solution" title="Link to this heading">#</a></h2>
<p>The centralized log collection problem has 2 basic parts:</p>
<ul class="simple">
<li><p>Selecting and configuring the right <strong>centralized server</strong> that will
collect, process, annotate and visualize the logs</p></li>
<li><p>Configuring the actual machines (FreeIPA servers or clients) to
<strong>send the interesting logs</strong> to the centralized server and selecting
<strong>proper and secure transport</strong> for the logs.</p></li>
</ul>
</section>
<section id="centralized-logging-server">
<h2>Centralized Logging Server<a class="headerlink" href="#centralized-logging-server" title="Link to this heading">#</a></h2>
<p>Currently, the most used and advanced open source solutions are the
centralized servers based on
<a class="reference external" href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> for
data storage and searches,
<a class="reference external" href="http://www.rsyslog.com/">rsyslog</a>/<a class="reference external" href="https://www.elastic.co/products/logstash">logstash</a>/<a class="reference external" href="http://www.fluentd.org/">fluentd</a>
for log reception and processing and
<a class="reference external" href="https://www.elastic.co/products/kibana">Kibana</a> for data display and
dashboards (commonly referred to as REK, ELK servers based on the log
receiving part).</p>
<p>Currently proposed solution chosen <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code>. The server is packaged
as <a class="reference external" href="https://registry.hub.docker.com/u/pschiffe/rsyslog-elasticsearch-kibana/">Docker
image</a>.
See the <a class="reference external" href="https://registry.hub.docker.com/u/pschiffe/rsyslog-elasticsearch-kibana/">Docker Hub
Registry</a>
or respective <a class="reference external" href="https://github.com/pschiffe/rsyslog-elasticsearch-kibana">github
repo</a> for
details how to download and run the preconfigured REK server.</p>
</section>
<section id="log-gathering-and-transport">
<h2>Log Gathering and Transport<a class="headerlink" href="#log-gathering-and-transport" title="Link to this heading">#</a></h2>
<p>To meet the defined use cases, at least following logs have to be
gathered from the <strong>FreeIPA server</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/httpd/error_log</span></code>: FreeIPA API call logs (and Apache
errors)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/krb5kdc.log</span></code>: FreeIPA <a class="reference external" href="Kerberos">KDC</a> utilization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/dirsrv/slapd-$REALM/access</span></code>: <a class="reference external" href="Directory_Server">Directory
Server</a> utilization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/dirsrv/slapd-$REALM/errors</span></code>: <a class="reference external" href="Directory_Server">Directory
Server</a> errors (including mentioned replication
errors)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/pki/pki-tomcat/ca/transactions</span></code>: FreeIPA <a class="reference external" href="PKI">PKI</a>
transactions/logs</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>FreeIPA client</strong> logs:</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/sssd/*.log</span></code>: SSSD logs (multiple, for all tracked logs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/audit/audit.log</span></code>: user login attempts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/secure</span></code>: reasons why user login failed</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">For easier FreeIPA log forwarding configuration,
<a class="reference external" href="https://github.com/pschiffe/ipa-log-config">ipa-log-config</a> tool
can be used. Visit its <a class="reference external" href="https://github.com/pschiffe/ipa-log-config">github
page</a> for more
information and usage.</div>
</div>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<p>Current the proof of concept project contains:</p>
<ul class="simple">
<li><p>Aforementioned CentOS-7 based REK server for log collection (<a class="reference external" href="https://registry.hub.docker.com/u/pschiffe/rsyslog-elasticsearch-kibana/">Docker
image</a>)</p></li>
<li><p>Set of preconfigured Kibana dashboards visualizing different logs in
readable graphs. See the next subsection for details. (<a class="reference external" href="https://github.com/pschiffe/rsyslog-elasticsearch-kibana/tree/master/kibana">Kibana
dashboards and
searches</a>)</p></li>
<li><p>Basic log message filtering rules for the <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code> on the server,
turning the log messages into structured logs that are searchable in
Kibana (<a class="reference external" href="https://github.com/pschiffe/rsyslog-elasticsearch-kibana/tree/master/rsyslog">rsyslog
rules</a>)</p></li>
<li><p>Script to configure rsyslog-based log transmission on the FreeIPA
servers and clients (<a class="reference external" href="https://github.com/pschiffe/ipa-log-config">github
page</a>)</p></li>
</ul>
<section id="dashboards">
<h3>Dashboards<a class="headerlink" href="#dashboards" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/freeipa/freeipa.github.io/blob/main/src/page/Rek-user-logins.png">User Logins</a>: User login attempts and
their results across FreeIPA domain, most-logged-to hosts</p></li>
<li><p><a class="reference external" href="https://github.com/freeipa/freeipa.github.io/blob/main/src/page/Rek-ipa-server-administration.png">IPA Server
Administration</a>:
Administrative API usage on the FreeIPA servers</p></li>
<li><p><a class="reference external" href="https://github.com/freeipa/freeipa.github.io/blob/main/src/page/Rek-ipa-server-utilization.png">IPA Server Utilization</a>:
Kerberos/LDAP protocol utilization across FreeIPA servers</p></li>
<li><p><a class="reference external" href="https://github.com/freeipa/freeipa.github.io/blob/main/src/page/Rek-ipa-server-health.png">IPA Server Health</a>: Replication
errors, server SSSD errors</p></li>
<li><p><a class="reference external" href="https://github.com/freeipa/freeipa.github.io/blob/main/src/page/Rek-sssd.png">SSSD</a>: selected client SSSD errors (dashboard
still in progress)</p></li>
</ul>
</section>
<section id="demo-of-the-kibana-dashboards">
<h3>Demo of the Kibana Dashboards<a class="headerlink" href="#demo-of-the-kibana-dashboards" title="Link to this heading">#</a></h3>
<p>{{#ev:youtube|7YjA6z5nE0I|640|center}}</p>
</section>
</section>
<section id="other-resources">
<h2>Other Resources<a class="headerlink" href="#other-resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="Howto/Centralised_Logging_with_Logstash/ElasticSearch/Kibana">Howto/Centralised Logging with
Logstash/ElasticSearch/Kibana</a>
- user provided HowTo on configuring the ELK</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#freeipa-logs">FreeIPA logs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-cases">Use Cases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proposed-solution">Proposed Solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#centralized-logging-server">Centralized Logging Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-gathering-and-transport">Log Gathering and Transport</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dashboards">Dashboards</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-of-the-kibana-dashboards">Demo of the Kibana Dashboards</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-resources">Other Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>