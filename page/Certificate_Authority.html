
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Certificate_Authority &#8212; FreeIPA  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'page/Certificate_Authority';</script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><a class="navbar-brand logo" href="/">
    <img src="https://raw.githubusercontent.com/freeipa/freeipa.github.io/main/src/_static/freeipa-logo-small.png" class="logo__image" alt="Logo image" />
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><div class="sidebar-primary-item">
    <nav class="bd-links" id="bd-docs-nav" aria-label="Main">
        <div class="bd-toc-item navbar-nav active">
            <ul class="nav bd-sidenav">
                <li class="toctree-l1"><a class="reference internal" href="/About.html">About</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Contribute.html">Contribute</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Documentation.html">Documentation</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/page/Troubleshooting.html">Troubleshooting</a></li>
                <li class="toctree-l1"><a class="reference internal" href="/Downloads.html">Downloads</a></li>
            </ul>
        </div>
    </nav>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/page/Certificate_Authority.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Certificate_Authority</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#status">Status</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fedora">Fedora</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing">Installing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-different-ca-to-sign-the-ipa-ca-certificate">Use a Different CA to sign the IPA CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-instructions">Detailed instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-certificates-from-a-different-ca">Using Certificates From a Different CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-and-replace">Install and Replace</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-with-your-own-certificates">Install with your own certificates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-certificates">Working with Certificates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request-a-certificate">Request a certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#put-a-cert-on-hold">Put a cert on hold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-a-cert-from-hold">Remove a cert from hold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revoke-a-certificate">Revoke a certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-a-revoked-certificate">Retrieve a revoked certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revocation">Revocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-services">Working with Services</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managedby-attribute">managedBy attribute</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-this-does">What this does</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vpn-example">VPN Example</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="certificate-authority">
<h1>Certificate_Authority<a class="headerlink" href="#certificate-authority" title="Link to this heading">#</a></h1>
<p>__TOC__</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Link to this heading">#</a></h2>
<p>Feature complete, needs testing.</p>
</section>
<section id="fedora">
<h2>Fedora<a class="headerlink" href="#fedora" title="Link to this heading">#</a></h2>
<p>The dogtag packages are now available in Fedora. The required packages
should be pulled in as dependencies when ipa-server is installed.</p>
<p>This just makes the binaries available for the IPA installer script. The
installer creates and configures the necessary dogtag components to
stand up a CA.</p>
</section>
<section id="installing">
<h2>Installing<a class="headerlink" href="#installing" title="Link to this heading">#</a></h2>
<p>A dogtag CA is installed by default by IPA. To install using a
self-signed CA instead of dogtag pass in the <code class="docutils literal notranslate"><span class="pre">--selfsign</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">ipa-server-install</span></code>.</p>
<p>The CA uses a separate instance of DS that is used only for the CA. This
instance is named PKI-IPA.</p>
<p>It will install a CA instance into /var/lib/pki-ca.</p>
<p>A copy of the root CA certificate and private key will be put into
/root/cacert.p12.</p>
<p>A copy of the CA agent certificate will be put into /root/ca-agent.p12.
This agent certificate can be imported into a browser and used to
administer CS using the web interface (not recommended).</p>
</section>
<section id="use-a-different-ca-to-sign-the-ipa-ca-certificate">
<h2>Use a Different CA to sign the IPA CA certificate<a class="headerlink" href="#use-a-different-ca-to-sign-the-ipa-ca-certificate" title="Link to this heading">#</a></h2>
<p>If you have an existing CA you can use it make the IPA CA a subordinate.</p>
<p>This is a three-step process:</p>
<ul class="simple">
<li><p>Have ipa-server-install generate a Certificate Signing Request (CSR)</p></li>
<li><p>Take the CSR to your CA and have it signed</p></li>
<li><p>Provide the resulting certificate to ipa-server-install to complete
the installation</p></li>
</ul>
</section>
<section id="detailed-instructions">
<h2>Detailed instructions<a class="headerlink" href="#detailed-instructions" title="Link to this heading">#</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">ipa-server-install</span></code> with whatever arguments are appropriate for
your environment and include the <code class="docutils literal notranslate"><span class="pre">--external_ca</span></code> flag:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipa-server-install</span> <span class="pre">--external-ca</span></code></p>
<p>This will generate a CSR in <code class="docutils literal notranslate"><span class="pre">/root/ipa.csr</span></code>. This is the file you need
to provide to your CA for signing. You will also need to obtain a PEM
copy of your CA trust chain.</p>
<p>Once you have both of these you can continue the installer:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">ipa-server-install</span> <span class="pre">--external_cert_file=/root/ipa.crt</span> <span class="pre">--external_ca_file=/root/existing_ca.crt</span></code></p>
<p>The server caches the answers the first time you run the installer so
you don’t need to answer the questions again the second time. This cache
is removed when the installer is run again.</p>
<p>The paths to the certificate and CA must be absolute paths. The dogtag
silent installer will fail if they are not.</p>
<p>Once the installation is complete you will have the same files as a
standalone IPA CA: /root/cacert.p12 and /root/ca-agent.p12.</p>
<p>The only difference is that the CA certificate is signed by your
external CA in this mode and self-signed in the default mode.</p>
</section>
<section id="using-certificates-from-a-different-ca">
<h2>Using Certificates From a Different CA<a class="headerlink" href="#using-certificates-from-a-different-ca" title="Link to this heading">#</a></h2>
<p>If don’t you want to use the new IPA CA features at all that is ok but
you’ll need to take a few extra steps.</p>
<p>There are two ways to achieve this:</p>
<ul class="simple">
<li><p>Install IPA using the selfsign CA and replace the server certs
post-installation</p></li>
<li><p>Provide PKCS#12 files to the installer (and still use the selfsign
CA, it just won’t generate any certs)</p></li>
</ul>
<p>The step setting <code class="docutils literal notranslate"><span class="pre">enable_ra</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> disables the cert plugin in
the XML-RPC interface. Your IPA server will be unable to issue
certificates.</p>
</section>
<section id="install-and-replace">
<h2>Install and Replace<a class="headerlink" href="#install-and-replace" title="Link to this heading">#</a></h2>
<p>To use the Install and Replace method do the following:</p>
<ul class="simple">
<li><p>Install IPA server with the <code class="docutils literal notranslate"><span class="pre">--selfsign</span></code> option</p></li>
<li><p>Once IPA is up and working run <code class="docutils literal notranslate"><span class="pre">ipa-server-certinstall</span></code> once for
the DS and once for Apache to replace the server certificates</p></li>
<li><p>If you want the Firefox autoconfiguration to work use an object
signing certificate to sign the jar file in
<code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/configure.jar</span></code></p></li>
<li><p>Replace the CA certificate in <code class="docutils literal notranslate"><span class="pre">/etc/ipa/ca.crt</span></code> and
<code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/ca.crt</span></code></p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/ipa/default.conf</span></code> and set <code class="docutils literal notranslate"><span class="pre">enable_ra</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Restart Apache</p></li>
</ul>
</section>
<section id="install-with-your-own-certificates">
<h2>Install with your own certificates<a class="headerlink" href="#install-with-your-own-certificates" title="Link to this heading">#</a></h2>
<p>To use the Install your own method do the following:</p>
<ul class="simple">
<li><p>Install IPA server with the <code class="docutils literal notranslate"><span class="pre">--http_pkcs12</span></code> and <code class="docutils literal notranslate"><span class="pre">--dirsrv_pkcs12</span></code>
and their respective pin arguments. Your PKCS#12 files should contain
the server cert, key and the CA cert chain.</p></li>
<li><p>If you want the Firefox autoconfiguration to work use an object
signing certificate to sign the jar file in
<code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/configure.jar</span></code></p></li>
<li><p>Verify that the CA certificate in <code class="docutils literal notranslate"><span class="pre">/etc/ipa/ca.crt</span></code> and
<code class="docutils literal notranslate"><span class="pre">/usr/share/ipa/html/ca.crt</span></code> are correct</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/ipa/default.conf</span></code> and set <code class="docutils literal notranslate"><span class="pre">enable_ra</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Restart Apache</p></li>
</ul>
</section>
<section id="working-with-certificates">
<h2>Working with Certificates<a class="headerlink" href="#working-with-certificates" title="Link to this heading">#</a></h2>
<p>Once your CA is configured authorized users can perform a number of
operations.</p>
</section>
<section id="request-a-certificate">
<h2>Request a certificate<a class="headerlink" href="#request-a-certificate" title="Link to this heading">#</a></h2>
<p>You start with a Certificate Signing Request (CSR). In our case this is
a base-64 encoded PKCS#10 request which looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----</span><span class="n">BEGIN</span> <span class="n">CERTIFICATE</span> <span class="n">REQUEST</span><span class="o">-----</span>
<span class="n">MIIBnTCCAQYCAQAwXTELMAkGA1UEBhMCU0cxETAPBgNVBAoTCE0yQ3J5cHRvMRIw</span>
<span class="n">EAYDVQQDEwlsb2NhbGhvc3QxJzAlBgkqhkiG9w0BCQEWGGFkbWluQHNlcnZlci5l</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="mi">9</span><span class="n">rsQkRc9Urv9mRBIsredGnYECNeRaK5R1yzpOowninXC</span>
<span class="o">-----</span><span class="n">END</span> <span class="n">CERTIFICATE</span> <span class="n">REQUEST</span><span class="o">-----</span>
</pre></div>
</div>
<p>To generate a CSR using OpenSSL run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">new</span> <span class="o">-</span><span class="n">nodes</span> <span class="o">-</span><span class="n">out</span> <span class="n">host</span><span class="o">.</span><span class="n">csr</span>
</pre></div>
</div>
<p>You will be prompted for the contents of the certificate subject
(country, state, organization, etc). The only critical piece is the
common name, this needs to be set to the FQDN of your host.</p>
<p>The CSR is in the file <code class="docutils literal notranslate"><span class="pre">host.csr</span></code> and the key for this request is in
<code class="docutils literal notranslate"><span class="pre">privkey.pem</span></code></p>
<p>In NSS you need to start with a cert database so you have an extra step.
An NSS CSR generation looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">certutil</span> <span class="o">-</span><span class="n">N</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test</span>
<span class="o">%</span> <span class="n">certutil</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;CN=ipa.example.com&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test</span> <span class="o">-</span><span class="n">o</span> <span class="n">test</span><span class="o">.</span><span class="n">csr</span> <span class="o">-</span><span class="n">g</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>The CSR needs to be passed as one single string on the command-line:</p>
<p>$ ipa cert-request –principal=ldap2/zeus.example.com –add
‘MIIBejCB5AIBADA7MQwwCgYDVQQKEwNJUEExEDAOBgNVBAsTB3BraS1pcGExGTAXBgNVBAMTEHpldXMuZ3JleW9hay5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBANSiseMKVF/ft44rJDM5XKaMo6jo03TBAC2i61D1GZL6nZ1trl6Oc4YfXccrbQLQ4RGLB6vwDE8vHyYh36OICb1EiWJ+bRaPsn9FaO2mk4qyZp2U/om52BCTSrOq+O+EhTdqLs+hUmUFRDpzmGX3x3UU0JR7cPcvNbcnNQvqfb2NAgMBAAGgADANBgkq
&gt;
hkiG9w0BAQUFAAOBgQAjWFSgv3KZbcjn8V3rhAnuXG9xFzsqD5XsDRBsIMIrG/KNtw4VZBzuXlU2zOdoYm1vlSlzwep9xWXJi5L8HejyqPiCf2mLB60ZxBJLbe1UQ07+oCBMrxck4VXmnySWekRzfYy9lqV0lP/3A5UC6jbtrqJ6t5mp3yiwkjEzEJGp3A==’</p>
<p>certificate:
MIIC7DCCAdSgAwIBAgIBCzANBgkqhkiG9w0BAQUFADAuMQwwCgYDVQQKEwNJUEExHjAcBgNVBAMTFUNlcnRpZmljYXRlIEF1dGhvcml0eTAeFw0wOTEwMDkxNTU5MzJaFw0xMDA0MDcxNTU5MzJaMDsxDDAKBgNVBAoTA0lQQTEQMA4GA1UECxMHcGtpLWlwYTEZMBcGA1UEAxMQemV1cy5ncmV5b2FrLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA1KKx4wpUX9+3jiskMzlcpoyjqOjTdMEALaLrUPUZkvqdnW2uXo5zhh9dxyttAtDhEYsHq/AMTy8fJiHfo4gJvUSJYn5tFo+yf0Vo7aaTirJmnZT+ibnYEJNKs6r474SFN2ouz6FSZQVEOnOYZffHdRTQlHtw9y81tyc1C+p9vY0CAwEAAaOBizCBiDAfBgNVHSMEGDAWgBSaCxEepKwX6jI6LVrOiHgmiM4EwjBABggrBgEFBQcBAQQ0MDIwMAYIKwYBBQUHMAGGJGh0dHA6Ly96ZXVzLmdyZXlvYWsuY29tOjkxODAvY2Evb2NzcDAOBgNVHQ8BAf8EBAMCBPAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwDQYJKoZIhvcNAQEFBQADggEBAGljf00jgdkyivJFOONlu/lNb25vpWnM/Wu3N6F6hcYC722YjzAFFAFA6wJf4QybrUGQiihh4veqRlknZeoR8Wlc9491E+lGwyk4SZxmSWMHc/TEoTDKPqrngTaf3YsjzBqPhQQF6TkM1TL68uMsU4uHl7mWtD9ueDVQkWlWmTJEJXcT8OdvIFOC/Wb+Vq9FV1lgJAosXmt8poZyHPGX+GiVxdtdZpoZSb7vyMg0FvjhSHNoX8tVo5QKlzxsci+xRkT4tcAe+ReFyQ7+aX851QMluttEUT1Gz1OxnfGojvHbiqYkH92fk+eUJtTZHGpK5H1U5gJVFauCKf/8SzU4awE=
request_id: 11 serial_number: 0xb status: 0 subject:
CN=zeus.example.com,OU=pki-ipa,O=IPA</p>
<p>There is also a short-cut method though it isn’t working today (Oct 9).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span> <span class="n">cert</span><span class="o">-</span><span class="n">request</span> <span class="n">file</span><span class="p">:</span><span class="o">//</span><span class="n">test</span><span class="o">.</span><span class="n">csr</span> <span class="o">--</span><span class="n">principal</span><span class="o">=</span><span class="n">ldap3</span><span class="o">/</span><span class="n">zeus</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">add</span>
</pre></div>
</div>
</section>
<section id="put-a-cert-on-hold">
<h2>Put a cert on hold<a class="headerlink" href="#put-a-cert-on-hold" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa cert-revoke --revocation-reason=6 0xb
</pre></div>
</div>
</section>
<section id="remove-a-cert-from-hold">
<h2>Remove a cert from hold<a class="headerlink" href="#remove-a-cert-from-hold" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa cert-revoke --revocation-reason=6 0xb
</pre></div>
</div>
</section>
<section id="revoke-a-certificate">
<h2>Revoke a certificate<a class="headerlink" href="#revoke-a-certificate" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa cert-revoke --revocation-reason=1 0xb
revoked: True
status: 0
</pre></div>
</div>
</section>
<section id="retrieve-a-revoked-certificate">
<h2>Retrieve a revoked certificate<a class="headerlink" href="#retrieve-a-revoked-certificate" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipa cert-get 0xb
certificate: MIIC7D...
revocation_reason: 1
status: 0
</pre></div>
</div>
</section>
<section id="revocation">
<h2>Revocation<a class="headerlink" href="#revocation" title="Link to this heading">#</a></h2>
<p>When you want a certificate to go away you revoke it. <a class="reference external" href="http://www.ietf.org/rfc/rfc5280.txt">RFC
5280</a> defines the following
reasons for revocation:</p>
<ul class="simple">
<li><p>0 - unspecified</p></li>
<li><p>1 - keyCompromise</p></li>
<li><p>2 - cACompromise</p></li>
<li><p>3 - affiliationChanged</p></li>
<li><p>4 - superseded</p></li>
<li><p>5 - cessationOfOperation</p></li>
<li><p>6 - certificateHold</p></li>
<li><p>8 - removeFromCRL</p></li>
<li><p>9 - privilegeWithdrawn</p></li>
<li><p>10 - aACompromise</p></li>
</ul>
<p>Note that reason code 7 is not used.</p>
<p>A CRL is generated by the CA that contains a list of revoked
certificates. This may be retrieved from an IPA server at:
<a class="reference external" href="http://ipa.example.com/ipa/crl/MasterCRL.bin">http://ipa.example.com/ipa/crl/MasterCRL.bin</a></p>
</section>
<section id="working-with-services">
<h2>Working with Services<a class="headerlink" href="#working-with-services" title="Link to this heading">#</a></h2>
<p><strong>Note</strong> this services capability is not in alpha 1</p>
<p>When requesting a certificate a number of things happen:</p>
<ul class="simple">
<li><p>The server checks the virtual ACI “request certificate” to see if the
requestor has permission to request certificates.</p></li>
<li><p>The subject of the certificate is compared to the hostname in the
requested principal. They must match.</p></li>
<li><p>The requested service record is retrieved. If the service already has
a userCertificate attribute then the request stops</p></li>
<li><p>If the service does not exist and the –add argument wasn’t provided
then the request stops</p></li>
<li><p>If the –add option was requested and the requestor doesn’t have
permission to add services the request stops</p></li>
<li><p>The requestor must be listed in the managedBy attribute of the
service record.</p></li>
</ul>
</section>
<section id="managedby-attribute">
<h2>managedBy attribute<a class="headerlink" href="#managedby-attribute" title="Link to this heading">#</a></h2>
<p>This is a multi-value attribute that contains the distinguished name of
all hosts that are allowed to write the userCertificate attribute of
this service. Use the service-add-host and service-remove-host to
control access.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>This example demonstrates the steps need to be taken by an administrator
and a client machine that is attempting to request a certificate for
itself. This assumes that the CSR has already been generated and is in
the file web.csr in the current directory.</p>
<p><strong>admin</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipa</span> <span class="n">host</span><span class="o">-</span><span class="n">add</span> <span class="n">client</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="n">secret123</span>
<span class="n">ipa</span> <span class="n">service</span><span class="o">-</span><span class="n">add</span> <span class="n">HTTP</span><span class="o">/</span><span class="n">client</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">ipa</span> <span class="n">service</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">host</span> <span class="o">--</span><span class="n">hosts</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">HTTP</span><span class="o">/</span><span class="n">client</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">ipa</span> <span class="n">rolegroup</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">member</span> <span class="o">--</span><span class="n">hosts</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">certadmin</span>
</pre></div>
</div>
<p><strong>client</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ipa-client-install
ipa-join -w secret123
kinit -kt /etc/krb5.keytab host/client.example.com
ipa -d cert-request ``\ ```file://web.csr`` &lt;file://web.csr&gt;`__\ `` --principal=HTTP/client.example.com
</pre></div>
</div>
<section id="what-this-does">
<h3>What this does<a class="headerlink" href="#what-this-does" title="Link to this heading">#</a></h3>
<p><strong>admin</strong></p>
<ul class="simple">
<li><p>Add a new host with a one-time password</p></li>
<li><p>Create an HTTP service principal for the host</p></li>
<li><p>Allow the host to manage its own userCertificate attribute</p></li>
<li><p>Allow the host to manage certificates (request, revoke, etc)</p></li>
</ul>
<p><strong>client</strong></p>
<ul class="simple">
<li><p>Configure the client to use the IPA realm</p></li>
<li><p>join the host to the realm and retrieve a keytab</p></li>
<li><p>get a kerberos ticket for the machine</p></li>
<li><p>request a certificate</p></li>
</ul>
</section>
</section>
<section id="vpn-example">
<h2>VPN Example<a class="headerlink" href="#vpn-example" title="Link to this heading">#</a></h2>
<p>Lets consider the case of a VPN server. On an IPA client we want to set
up a VPN tunnel to a remote host, perhaps at another company. To do this
we need to create an entry for that remote host, a service principal to
store the certificate, then we can issue the cert.</p>
<p>Some of this work needs to be done as an admin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">kinit</span> <span class="n">admin</span>
<span class="o">%</span> <span class="n">ipa</span> <span class="n">host</span><span class="o">-</span><span class="n">add</span> <span class="n">vpn</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">com</span>
<span class="o">%</span> <span class="n">ipa</span> <span class="n">service</span><span class="o">-</span><span class="n">add</span> <span class="n">vpn</span><span class="o">/</span><span class="n">vpn</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">com</span>
<span class="o">%</span> <span class="n">ipa</span> <span class="n">service</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">host</span> <span class="o">--</span><span class="n">hosts</span><span class="o">=</span><span class="n">ipa</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">vpn</span><span class="o">/</span><span class="n">vpn</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>We’ve created the remote host and a service principal for it, then gave
permission for the host ipa.example.com to request a certificate on
behalf of vpn.remote.com. This assumes that the certificate request for
vpn.remote.com is in the file <strong>vpn.csr</strong>.</p>
<p>On ipa.example com:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% kinit -kt /etc/krb5.keytab host/ipa.example.com@EXAMPLE.COM
% ipa cert-request --principal=vpn/vpn.remote.com vpn.csr
| ``% ipa service-show vpn/vpn.remote.com``
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#status">Status</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fedora">Fedora</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing">Installing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-different-ca-to-sign-the-ipa-ca-certificate">Use a Different CA to sign the IPA CA certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-instructions">Detailed instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-certificates-from-a-different-ca">Using Certificates From a Different CA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-and-replace">Install and Replace</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-with-your-own-certificates">Install with your own certificates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-certificates">Working with Certificates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#request-a-certificate">Request a certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#put-a-cert-on-hold">Put a cert on hold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-a-cert-from-hold">Remove a cert from hold</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revoke-a-certificate">Revoke a certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-a-revoked-certificate">Retrieve a revoked certificate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#revocation">Revocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-services">Working with Services</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managedby-attribute">managedBy attribute</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-this-does">What this does</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vpn-example">VPN Example</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By FreeIPA Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, FreeIPA Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>