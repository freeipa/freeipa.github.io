<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; FreeIPA  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Overview" href="Transitive_Trusts.html" />
    <link rel="prev" title="Overview" href="Serving_legacy_clients_for_trusts.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>__NOTOC__</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>Relevant upstream tickets:
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3547">#3547</a>,
<a class="reference external" href="https://fedorahosted.org/freeipa/ticket/3552">#3552</a></p>
<p>Certificates issued by FreeIPA server 3.1 and later contains 2 CRL/OCSP
URIs server by Dogtag CA configured by FreeIPA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Certificate</span><span class="p">:</span>
    <span class="n">Data</span><span class="p">:</span>
        <span class="n">Version</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mh">0x2</span><span class="p">)</span>
        <span class="n">Serial</span> <span class="n">Number</span><span class="p">:</span> <span class="mi">17</span> <span class="p">(</span><span class="mh">0x11</span><span class="p">)</span>
    <span class="n">Signature</span> <span class="n">Algorithm</span><span class="p">:</span> <span class="n">sha256WithRSAEncryption</span>
        <span class="n">Issuer</span><span class="p">:</span> <span class="n">O</span><span class="o">=</span><span class="n">EXAMPLE</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">CN</span><span class="o">=</span><span class="n">Certificate</span> <span class="n">Authority</span>
        <span class="n">Validity</span>
            <span class="n">Not</span> <span class="n">Before</span><span class="p">:</span> <span class="n">Apr</span>  <span class="mi">8</span> <span class="mi">10</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">15</span> <span class="mi">2013</span> <span class="n">GMT</span>
            <span class="n">Not</span> <span class="n">After</span> <span class="p">:</span> <span class="n">Apr</span>  <span class="mi">9</span> <span class="mi">10</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">15</span> <span class="mi">2015</span> <span class="n">GMT</span>
        <span class="n">Subject</span><span class="p">:</span> <span class="n">O</span><span class="o">=</span><span class="n">EXAMPLE</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">CN</span><span class="o">=</span><span class="n">testcert</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
        <span class="o">...</span>
        <span class="n">X509v3</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="n">X509v3</span> <span class="n">Authority</span> <span class="n">Key</span> <span class="n">Identifier</span><span class="p">:</span>
                <span class="n">keyid</span><span class="p">:</span><span class="mi">9</span><span class="n">F</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="mi">2</span><span class="n">F</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">2</span><span class="n">A</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="mi">9</span><span class="n">A</span><span class="p">:</span><span class="n">A8</span><span class="p">:</span><span class="mi">88</span><span class="p">:</span><span class="n">CF</span><span class="p">:</span><span class="n">CC</span><span class="p">:</span><span class="n">EB</span><span class="p">:</span><span class="n">D0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="n">E7</span><span class="p">:</span><span class="mi">3</span><span class="n">B</span><span class="p">:</span><span class="n">B1</span><span class="p">:</span><span class="n">EE</span>

            <span class="n">Authority</span> <span class="n">Information</span> <span class="n">Access</span><span class="p">:</span>
                <span class="n">OCSP</span> <span class="o">-</span> <span class="n">URI</span><span class="p">:</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ipa</span><span class="o">-</span><span class="n">ca</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ca</span><span class="o">/</span><span class="n">ocsp</span>
                <span class="n">OCSP</span> <span class="o">-</span> <span class="n">URI</span><span class="p">:</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">server1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ca</span><span class="o">/</span><span class="n">ocsp</span>

            <span class="n">X509v3</span> <span class="n">Key</span> <span class="n">Usage</span><span class="p">:</span> <span class="n">critical</span>
                <span class="n">Digital</span> <span class="n">Signature</span><span class="p">,</span> <span class="n">Non</span> <span class="n">Repudiation</span><span class="p">,</span> <span class="n">Key</span> <span class="n">Encipherment</span><span class="p">,</span> <span class="n">Data</span>
<span class="n">Encipherment</span>
            <span class="n">X509v3</span> <span class="n">Extended</span> <span class="n">Key</span> <span class="n">Usage</span><span class="p">:</span>
                <span class="n">TLS</span> <span class="n">Web</span> <span class="n">Server</span> <span class="n">Authentication</span><span class="p">,</span> <span class="n">TLS</span> <span class="n">Web</span> <span class="n">Client</span> <span class="n">Authentication</span>
            <span class="n">X509v3</span> <span class="n">CRL</span> <span class="n">Distribution</span> <span class="n">Points</span><span class="p">:</span>

                <span class="n">Full</span> <span class="n">Name</span><span class="p">:</span>
                  <span class="n">URI</span><span class="p">:</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ipa</span><span class="o">-</span><span class="n">ca</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ipa</span><span class="o">/</span><span class="n">crl</span><span class="o">/</span><span class="n">MasterCRL</span><span class="o">.</span><span class="n">bin</span>
                <span class="n">CRL</span> <span class="n">Issuer</span><span class="p">:</span>
                  <span class="n">DirName</span><span class="p">:</span> <span class="n">O</span> <span class="o">=</span> <span class="n">ipaca</span><span class="p">,</span> <span class="n">CN</span> <span class="o">=</span> <span class="n">Certificate</span> <span class="n">Authority</span>

                <span class="n">Full</span> <span class="n">Name</span><span class="p">:</span>
                  <span class="n">URI</span><span class="p">:</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">server1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ipa</span><span class="o">/</span><span class="n">crl</span><span class="o">/</span><span class="n">MasterCRL</span><span class="o">.</span><span class="n">bin</span>
                <span class="n">CRL</span> <span class="n">Issuer</span><span class="p">:</span>
                  <span class="n">DirName</span><span class="p">:</span> <span class="n">O</span> <span class="o">=</span> <span class="n">ipaca</span><span class="p">,</span> <span class="n">CN</span> <span class="o">=</span> <span class="n">Certificate</span> <span class="n">Authority</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>One OCSP/CRL URI points to the original CA issuing the certificate and
one points to a general URL (managed by FreeIPA) pointing to any other
FreeIPA CA via CNAME/A DNS record that can serve the OCSP/CRL URI in
case if the original FreeIPA CA was decommissioned or unavailable at the
moment.</p>
<p>However, it <a class="reference external" href="http://www.redhat.com/archives/freeipa-users/2013-April/msg00085.html">was
discovered</a>
there are 2 issues related to this change:</p>
<ol class="arabic simple">
<li><p>Having https in the URIs requires client (e.g. a web browser)
validating the request to validate the machine serving the CRL/OCSP
response itself even though he CRL/OCSP response is already signed by
the CA and thus verifiable. Clients will fail to retrieve the
CRL/OCSP in case of the general address as it is just a CNAME for a
FreeIPA server whose certificate does not allow it to serve this
address.</p></li>
<li><p>Even though we have 2 OCSP URIs in the certificate, the Firefox
browser will not fail over to the general URI due to limitation in
NSS which only tries the last OCSP and then fail when it is not
available.</p></li>
</ol>
</section>
<section id="use-cases">
<span id="use-cases10n"></span><h1>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>Client browser with strict OCSP check tries to validate certificate
issued by FreeIPA for a web service. When OCSP URIs are not right
(due to limitations above), client browser may refuse to open the
page</p></li>
<li><p>Any other client software may try to validate a certificate issues by
FreeIPA</p></li>
</ul>
</section>
<section id="design">
<h1>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h1>
<p>Issue certificates with just one OCSP/CRL URI pointing to the general
DNS name <em>ipa-ca.$DOMAIN</em>. This DNS name will contain A/AAAA DNS records
to all FreeIPA CAs and it will be automatically maintained by FreeIPA
(if it manages DNS). Otherwise, administrator would need to maintain
this DNS name on his own if he wants to keep the OCSP/CRL links
functional.</p>
<p>The general name <em>ipa-ca.$DOMAIN</em> was originally implemented to contain
a list of CNAMEs pointing to FreeIPA masters with CA installed. This DNS
record needs to be changed to use A/AAAA records instead as DNS
specification forbids multiple CNAMEs in one DNS name.</p>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><em>ipa-replica-install</em> and ipa-ca-install needs to be updated to add
A/AAAA records to <em>ipa-ca.$DOMAIN</em> when replica with CA is being
installed</p></li>
<li><p><em>ipa-csreplica-manage del</em> command should delete A/AAAA record from
<em>ipa-ca.$DOMAIN</em> of the deleted CA replica</p></li>
<li><p>When IPA server is being upgraded, it should convert existing
<em>ipa-ca.$DOMAIN</em> based on CNAMEs to version based on A/AAAA
addresses. When there was a custom update to <em>ipa-ca.$DOMAIN</em>,
upgrade should not touch it.</p></li>
</ul>
</section>
<section id="feature-management">
<h1>Feature Management<a class="headerlink" href="#feature-management" title="Permalink to this heading">¶</a></h1>
<section id="ui">
<h2>UI<a class="headerlink" href="#ui" title="Permalink to this heading">¶</a></h2>
<p>No change to UI needed. The change is done under-the-hood and in the
installation tools.</p>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Permalink to this heading">¶</a></h2>
<p>No change to CLI needed.</p>
</section>
</section>
<section id="major-configuration-options-and-enablement">
<h1>Major configuration options and enablement<a class="headerlink" href="#major-configuration-options-and-enablement" title="Permalink to this heading">¶</a></h1>
<p>The feature is enabled by default.</p>
</section>
<section id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this heading">¶</a></h1>
<p>Certificates are already replicated, so no change in this area.</p>
</section>
<section id="updates-and-upgrades">
<h1>Updates and Upgrades<a class="headerlink" href="#updates-and-upgrades" title="Permalink to this heading">¶</a></h1>
<p>When FreeIPA is upgraded to the new version, it should:</p>
<ol class="arabic simple">
<li><p>Update <em>ipa-ca.$DOMAIN</em> DNS name to use A/AAAA instead of CNAMEs</p></li>
<li><p>Update FreeIPA Dogtag certificate profile to use single OCSP/CRL URI
for new certificates. When already issued certificates needs to be
fixed, a new certificate needs to be issued. certmonger can be used
to simplify this task on a client if it tracks the certificate:</p>
<ol class="arabic simple">
<li><p><em>ipa-getcert list</em> - to identify tracking request ID of a
certificate that needs to be re-issued</p></li>
<li><p><em>ipa-getcert resubmit -i $TRACKING_REQUEST_ID</em> - to ask for
reissue of the certificate</p></li>
<li><p><em>ipa-getcert list -i $TRACKING_REQUEST_ID</em> - to check that
certificate was successfully renewed</p></li>
</ol>
</li>
</ol>
</section>
<section id="dependencies">
<h1>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading">¶</a></h1>
<p>Certificate validation depends on capabilities of certificate libraries
(e.g. NSS, OpenSSL). This design was based on abilities of NSS library
used in Mozilla Firefox (see <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=797815">NSS Bug
797815</a> for
relevant discussion).</p>
</section>
<section id="external-impact">
<h1>External Impact<a class="headerlink" href="#external-impact" title="Permalink to this heading">¶</a></h1>
<p>Change impacts projects processing certificate issued by FreeIPA server.</p>
</section>
<section id="rfe-author">
<h1>RFE Author<a class="headerlink" href="#rfe-author" title="Permalink to this heading">¶</a></h1>
<p>Martin Kosek</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/freeipa-logo-small.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, FreeIPA Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../../_sources/archive/pages/V3/Single_OCSP_and_CRL_in_certs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>